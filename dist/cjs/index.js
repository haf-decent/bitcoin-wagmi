"use strict";var t=require("react"),e=require("react/jsx-runtime"),r=require("buffer"),n=require("valibot"),i=require("crypto");function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function s(t){if(t&&"object"==typeof t&&"default"in t)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var a=s(t),u=o(r),c=s(n),f=o(i),h=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},p="undefined"==typeof window||"Deno"in globalThis;function l(){}function d(t){return"number"==typeof t&&t>=0&&t!==1/0}function y(t,e){return Math.max(t+(e||0)-Date.now(),0)}function w(t,e){return"function"==typeof t?t(e):t}function g(t,e){return"function"==typeof t?t(e):t}function b(t,e){const{type:r="all",exact:n,fetchStatus:i,predicate:o,queryKey:s,stale:a}=t;if(s)if(n){if(e.queryHash!==E(s,e.options))return!1}else if(!S(e.queryKey,s))return!1;if("all"!==r){const t=e.isActive();if("active"===r&&!t)return!1;if("inactive"===r&&t)return!1}return("boolean"!=typeof a||e.isStale()===a)&&((!i||i===e.state.fetchStatus)&&!(o&&!o(e)))}function m(t,e){const{exact:r,status:n,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(r){if(v(e.options.mutationKey)!==v(o))return!1}else if(!S(e.options.mutationKey,o))return!1}return(!n||e.state.status===n)&&!(i&&!i(e))}function E(t,e){return(e?.queryKeyHashFn||v)(t)}function v(t){return JSON.stringify(t,((t,e)=>_(e)?Object.keys(e).sort().reduce(((t,r)=>(t[r]=e[r],t)),{}):e))}function S(t,e){return t===e||typeof t==typeof e&&(!(!t||!e||"object"!=typeof t||"object"!=typeof e)&&!Object.keys(e).some((r=>!S(t[r],e[r]))))}function T(t,e){if(t===e)return t;const r=P(t)&&P(e);if(r||_(t)&&_(e)){const n=r?t:Object.keys(t),i=n.length,o=r?e:Object.keys(e),s=o.length,a=r?[]:{};let u=0;for(let i=0;i<s;i++){const s=r?i:o[i];(!r&&n.includes(s)||r)&&void 0===t[s]&&void 0===e[s]?(a[s]=void 0,u++):(a[s]=T(t[s],e[s]),a[s]===t[s]&&void 0!==t[s]&&u++)}return i===s&&u===i?t:a}return e}function O(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}function P(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function _(t){if(!I(t))return!1;const e=t.constructor;if(void 0===e)return!0;const r=e.prototype;return!!I(r)&&(!!r.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(t)===Object.prototype)}function I(t){return"[object Object]"===Object.prototype.toString.call(t)}function k(t,e,r){return"function"==typeof r.structuralSharing?r.structuralSharing(t,e):!1!==r.structuralSharing?T(t,e):e}function A(t,e,r=0){const n=[...t,e];return r&&n.length>r?n.slice(1):n}function B(t,e,r=0){const n=[e,...t];return r&&n.length>r?n.slice(0,-1):n}var x=Symbol();function U(t,e){return"production"!==process.env.NODE_ENV&&t.queryFn===x&&console.error(`Attempted to invoke queryFn when set to skipToken. This is likely a configuration error. Query hash: '${t.queryHash}'`),!t.queryFn&&e?.initialPromise?()=>e.initialPromise:t.queryFn&&t.queryFn!==x?t.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`))}var C=new class extends h{#t;#e;#r;constructor(){super(),this.#r=t=>{if(!p&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#e||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(t){this.#r=t,this.#e?.(),this.#e=t((t=>{"boolean"==typeof t?this.setFocused(t):this.onFocus()}))}setFocused(t){this.#t!==t&&(this.#t=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach((e=>{e(t)}))}isFocused(){return"boolean"==typeof this.#t?this.#t:"hidden"!==globalThis.document?.visibilityState}},N=new class extends h{#n=!0;#e;#r;constructor(){super(),this.#r=t=>{if(!p&&window.addEventListener){const e=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#e||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(t){this.#r=t,this.#e?.(),this.#e=t(this.setOnline.bind(this))}setOnline(t){this.#n!==t&&(this.#n=t,this.listeners.forEach((e=>{e(t)})))}isOnline(){return this.#n}};function R(t){return Math.min(1e3*2**t,3e4)}function L(t){return"online"!==(t??"online")||N.isOnline()}var H=class{constructor(t){this.revert=t?.revert,this.silent=t?.silent}};function D(t){return t instanceof H}function M(t){let e,r,n,i=!1,o=0,s=!1;const a=new Promise(((t,e)=>{r=t,n=e})),u=()=>C.isFocused()&&("always"===t.networkMode||N.isOnline())&&t.canRun(),c=()=>L(t.networkMode)&&t.canRun(),f=n=>{s||(s=!0,t.onSuccess?.(n),e?.(),r(n))},h=r=>{s||(s=!0,t.onError?.(r),e?.(),n(r))},l=()=>new Promise((r=>{e=t=>{(s||u())&&r(t)},t.onPause?.()})).then((()=>{e=void 0,s||t.onContinue?.()})),d=()=>{if(s)return;let e;const r=0===o?t.initialPromise:void 0;try{e=r??t.fn()}catch(t){e=Promise.reject(t)}Promise.resolve(e).then(f).catch((e=>{if(s)return;const r=t.retry??(p?0:3),n=t.retryDelay??R,a="function"==typeof n?n(o,e):n,c=!0===r||"number"==typeof r&&o<r||"function"==typeof r&&r(o,e);var f;!i&&c?(o++,t.onFail?.(o,e),(f=a,new Promise((t=>{setTimeout(t,f)}))).then((()=>u()?void 0:l())).then((()=>{i?h(e):d()}))):h(e)}))};return{promise:a,cancel:e=>{s||(h(new H(e)),t.abort?.())},continue:()=>(e?.(),a),cancelRetry:()=>{i=!0},continueRetry:()=>{i=!1},canStart:c,start:()=>(c()?d():l().then(d),a)}}var F=function(){let t=[],e=0,r=t=>{t()},n=t=>{t()},i=t=>setTimeout(t,0);const o=n=>{e?t.push(n):i((()=>{r(n)}))},s=()=>{const e=t;t=[],e.length&&i((()=>{n((()=>{e.forEach((t=>{r(t)}))}))}))};return{batch:t=>{let r;e++;try{r=t()}finally{e--,e||s()}return r},batchCalls:t=>(...e)=>{o((()=>{t(...e)}))},schedule:o,setNotifyFunction:t=>{r=t},setBatchNotifyFunction:t=>{n=t},setScheduler:t=>{i=t}}}(),j=class{#i;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),d(this.gcTime)&&(this.#i=setTimeout((()=>{this.optionalRemove()}),this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(p?1/0:3e5))}clearGcTimeout(){this.#i&&(clearTimeout(this.#i),this.#i=void 0)}},K=class extends j{#o;#s;#a;#u;#c;#f;constructor(t){super(),this.#f=!1,this.#c=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#a=t.cache,this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#o=t.state||function(t){const e="function"==typeof t.initialData?t.initialData():t.initialData,r=void 0!==e,n=r?"function"==typeof t.initialDataUpdatedAt?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}(this.options),this.state=this.#o,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#u?.promise}setOptions(t){this.options={...this.#c,...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#a.remove(this)}setData(t,e){const r=k(this.state.data,t,this.options);return this.#h({data:r,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),r}setState(t,e){this.#h({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#u?.promise;return this.#u?.cancel(t),e?e.then(l).catch(l):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#o)}isActive(){return this.observers.some((t=>!1!==g(t.options.enabled,this)))}isDisabled(){return this.getObserversCount()>0&&!this.isActive()}isStale(){return!!this.state.isInvalidated||(this.getObserversCount()>0?this.observers.some((t=>t.getCurrentResult().isStale)):void 0===this.state.data)}isStaleByTime(t=0){return this.state.isInvalidated||void 0===this.state.data||!y(this.state.dataUpdatedAt,t)}onFocus(){const t=this.observers.find((t=>t.shouldFetchOnWindowFocus()));t?.refetch({cancelRefetch:!1}),this.#u?.continue()}onOnline(){const t=this.observers.find((t=>t.shouldFetchOnReconnect()));t?.refetch({cancelRefetch:!1}),this.#u?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#a.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter((e=>e!==t)),this.observers.length||(this.#u&&(this.#f?this.#u.cancel({revert:!0}):this.#u.cancelRetry()),this.scheduleGc()),this.#a.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#h({type:"invalidate"})}fetch(t,e){if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#u)return this.#u.continueRetry(),this.#u.promise;if(t&&this.setOptions(t),!this.options.queryFn){const t=this.observers.find((t=>t.options.queryFn));t&&this.setOptions(t.options)}"production"!==process.env.NODE_ENV&&(Array.isArray(this.options.queryKey)||console.error("As of v4, queryKey needs to be an Array. If you are using a string like 'repoData', please change it to an Array, e.g. ['repoData']"));const r=new AbortController,n=t=>{Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(this.#f=!0,r.signal)})},i={fetchOptions:e,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:()=>{const t=U(this.options,e),r={queryKey:this.queryKey,meta:this.meta};return n(r),this.#f=!1,this.options.persister?this.options.persister(t,r,this):t(r)}};n(i),this.options.behavior?.onFetch(i,this),this.#s=this.state,"idle"!==this.state.fetchStatus&&this.state.fetchMeta===i.fetchOptions?.meta||this.#h({type:"fetch",meta:i.fetchOptions?.meta});const o=t=>{D(t)&&t.silent||this.#h({type:"error",error:t}),D(t)||(this.#a.config.onError?.(t,this),this.#a.config.onSettled?.(this.state.data,t,this)),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1};return this.#u=M({initialPromise:e?.initialPromise,fn:i.fetchFn,abort:r.abort.bind(r),onSuccess:t=>{if(void 0===t)return"production"!==process.env.NODE_ENV&&console.error(`Query data cannot be undefined. Please make sure to return a value other than undefined from your query function. Affected query key: ${this.queryHash}`),void o(new Error(`${this.queryHash} data is undefined`));this.setData(t),this.#a.config.onSuccess?.(t,this),this.#a.config.onSettled?.(t,this.state.error,this),this.isFetchingOptimistic||this.scheduleGc(),this.isFetchingOptimistic=!1},onError:o,onFail:(t,e)=>{this.#h({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#h({type:"pause"})},onContinue:()=>{this.#h({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0}),this.#u.start()}#h(t){this.state=(e=>{switch(t.type){case"failed":return{...e,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...e,fetchStatus:"paused"};case"continue":return{...e,fetchStatus:"fetching"};case"fetch":return{...e,...$(e.data,this.options),fetchMeta:t.meta??null};case"success":return{...e,data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const r=t.error;return D(r)&&r.revert&&this.#s?{...this.#s,fetchStatus:"idle"}:{...e,error:r,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...e,isInvalidated:!0};case"setState":return{...e,...t.state}}})(this.state),F.batch((()=>{this.observers.forEach((t=>{t.onQueryUpdate()})),this.#a.notify({query:this,type:"updated",action:t})}))}};function $(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:L(e.networkMode)?"fetching":"paused",...void 0===t&&{error:null,status:"pending"}}}var V=class extends h{constructor(t={}){super(),this.config=t,this.#p=new Map}#p;build(t,e,r){const n=e.queryKey,i=e.queryHash??E(n,e);let o=this.get(i);return o||(o=new K({cache:this,queryKey:n,queryHash:i,options:t.defaultQueryOptions(e),state:r,defaultOptions:t.getQueryDefaults(n)}),this.add(o)),o}add(t){this.#p.has(t.queryHash)||(this.#p.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#p.get(t.queryHash);e&&(t.destroy(),e===t&&this.#p.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){F.batch((()=>{this.getAll().forEach((t=>{this.remove(t)}))}))}get(t){return this.#p.get(t)}getAll(){return[...this.#p.values()]}find(t){const e={exact:!0,...t};return this.getAll().find((t=>b(e,t)))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter((e=>b(t,e))):e}notify(t){F.batch((()=>{this.listeners.forEach((e=>{e(t)}))}))}onFocus(){F.batch((()=>{this.getAll().forEach((t=>{t.onFocus()}))}))}onOnline(){F.batch((()=>{this.getAll().forEach((t=>{t.onOnline()}))}))}},W=class extends j{#l;#d;#u;constructor(t){super(),this.mutationId=t.mutationId,this.#d=t.mutationCache,this.#l=[],this.state=t.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#l.includes(t)||(this.#l.push(t),this.clearGcTimeout(),this.#d.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#l=this.#l.filter((e=>e!==t)),this.scheduleGc(),this.#d.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#l.length||("pending"===this.state.status?this.scheduleGc():this.#d.remove(this))}continue(){return this.#u?.continue()??this.execute(this.state.variables)}async execute(t){this.#u=M({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(t,e)=>{this.#h({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#h({type:"pause"})},onContinue:()=>{this.#h({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#d.canRun(this)});const e="pending"===this.state.status,r=!this.#u.canStart();try{if(!e){this.#h({type:"pending",variables:t,isPaused:r}),await(this.#d.config.onMutate?.(t,this));const e=await(this.options.onMutate?.(t));e!==this.state.context&&this.#h({type:"pending",context:e,variables:t,isPaused:r})}const n=await this.#u.start();return await(this.#d.config.onSuccess?.(n,t,this.state.context,this)),await(this.options.onSuccess?.(n,t,this.state.context)),await(this.#d.config.onSettled?.(n,null,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(n,null,t,this.state.context)),this.#h({type:"success",data:n}),n}catch(e){try{throw await(this.#d.config.onError?.(e,t,this.state.context,this)),await(this.options.onError?.(e,t,this.state.context)),await(this.#d.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(void 0,e,t,this.state.context)),e}finally{this.#h({type:"error",error:e})}}finally{this.#d.runNext(this)}}#h(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),F.batch((()=>{this.#l.forEach((e=>{e.onMutationUpdate(t)})),this.#d.notify({mutation:this,type:"updated",action:t})}))}};var q=class extends h{constructor(t={}){super(),this.config=t,this.#y=new Map,this.#w=Date.now()}#y;#w;build(t,e,r){const n=new W({mutationCache:this,mutationId:++this.#w,options:t.defaultMutationOptions(e),state:r});return this.add(n),n}add(t){const e=z(t),r=this.#y.get(e)??[];r.push(t),this.#y.set(e,r),this.notify({type:"added",mutation:t})}remove(t){const e=z(t);if(this.#y.has(e)){const r=this.#y.get(e)?.filter((e=>e!==t));r&&(0===r.length?this.#y.delete(e):this.#y.set(e,r))}this.notify({type:"removed",mutation:t})}canRun(t){const e=this.#y.get(z(t))?.find((t=>"pending"===t.state.status));return!e||e===t}runNext(t){const e=this.#y.get(z(t))?.find((e=>e!==t&&e.state.isPaused));return e?.continue()??Promise.resolve()}clear(){F.batch((()=>{this.getAll().forEach((t=>{this.remove(t)}))}))}getAll(){return[...this.#y.values()].flat()}find(t){const e={exact:!0,...t};return this.getAll().find((t=>m(e,t)))}findAll(t={}){return this.getAll().filter((e=>m(t,e)))}notify(t){F.batch((()=>{this.listeners.forEach((e=>{e(t)}))}))}resumePausedMutations(){const t=this.getAll().filter((t=>t.state.isPaused));return F.batch((()=>Promise.all(t.map((t=>t.continue().catch(l))))))}};function z(t){return t.options.scope?.id??String(t.mutationId)}function G(t){return{onFetch:(e,r)=>{const n=async()=>{const r=e.options,n=e.fetchOptions?.meta?.fetchMore?.direction,i=e.state.data?.pages||[],o=e.state.data?.pageParams||[],s={pages:[],pageParams:[]};let a=!1;const u=U(e.options,e.fetchOptions),c=async(t,r,n)=>{if(a)return Promise.reject();if(null==r&&t.pages.length)return Promise.resolve(t);const i={queryKey:e.queryKey,pageParam:r,direction:n?"backward":"forward",meta:e.options.meta};var o;o=i,Object.defineProperty(o,"signal",{enumerable:!0,get:()=>(e.signal.aborted?a=!0:e.signal.addEventListener("abort",(()=>{a=!0})),e.signal)});const s=await u(i),{maxPages:c}=e.options,f=n?B:A;return{pages:f(t.pages,s,c),pageParams:f(t.pageParams,r,c)}};let f;if(n&&i.length){const t="backward"===n,e={pages:i,pageParams:o},s=(t?X:Y)(r,e);f=await c(e,s,t)}else{f=await c(s,o[0]??r.initialPageParam);const e=t??i.length;for(let t=1;t<e;t++){const t=Y(r,f);f=await c(f,t)}}return f};e.options.persister?e.fetchFn=()=>e.options.persister?.(n,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},r):e.fetchFn=n}}}function Y(t,{pages:e,pageParams:r}){const n=e.length-1;return e.length>0?t.getNextPageParam(e[n],e,r[n],r):void 0}function X(t,{pages:e,pageParams:r}){return e.length>0?t.getPreviousPageParam?.(e[0],e,r[0],r):void 0}var Q=class{#g;#d;#c;#b;#m;#E;#v;#S;constructor(t={}){this.#g=t.queryCache||new V,this.#d=t.mutationCache||new q,this.#c=t.defaultOptions||{},this.#b=new Map,this.#m=new Map,this.#E=0}mount(){this.#E++,1===this.#E&&(this.#v=C.subscribe((async t=>{t&&(await this.resumePausedMutations(),this.#g.onFocus())})),this.#S=N.subscribe((async t=>{t&&(await this.resumePausedMutations(),this.#g.onOnline())})))}unmount(){this.#E--,0===this.#E&&(this.#v?.(),this.#v=void 0,this.#S?.(),this.#S=void 0)}isFetching(t){return this.#g.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#d.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#g.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.getQueryData(t.queryKey);if(void 0===e)return this.fetchQuery(t);{const r=this.defaultQueryOptions(t),n=this.#g.build(this,r);return t.revalidateIfStale&&n.isStaleByTime(w(r.staleTime,n))&&this.prefetchQuery(r),Promise.resolve(e)}}getQueriesData(t){return this.#g.findAll(t).map((({queryKey:t,state:e})=>[t,e.data]))}setQueryData(t,e,r){const n=this.defaultQueryOptions({queryKey:t}),i=this.#g.get(n.queryHash),o=i?.state.data,s=function(t,e){return"function"==typeof t?t(e):t}(e,o);if(void 0!==s)return this.#g.build(this,n).setData(s,{...r,manual:!0})}setQueriesData(t,e,r){return F.batch((()=>this.#g.findAll(t).map((({queryKey:t})=>[t,this.setQueryData(t,e,r)]))))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#g.get(e.queryHash)?.state}removeQueries(t){const e=this.#g;F.batch((()=>{e.findAll(t).forEach((t=>{e.remove(t)}))}))}resetQueries(t,e){const r=this.#g,n={type:"active",...t};return F.batch((()=>(r.findAll(t).forEach((t=>{t.reset()})),this.refetchQueries(n,e))))}cancelQueries(t={},e={}){const r={revert:!0,...e},n=F.batch((()=>this.#g.findAll(t).map((t=>t.cancel(r)))));return Promise.all(n).then(l).catch(l)}invalidateQueries(t={},e={}){return F.batch((()=>{if(this.#g.findAll(t).forEach((t=>{t.invalidate()})),"none"===t.refetchType)return Promise.resolve();const r={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(r,e)}))}refetchQueries(t={},e){const r={...e,cancelRefetch:e?.cancelRefetch??!0},n=F.batch((()=>this.#g.findAll(t).filter((t=>!t.isDisabled())).map((t=>{let e=t.fetch(void 0,r);return r.throwOnError||(e=e.catch(l)),"paused"===t.state.fetchStatus?Promise.resolve():e}))));return Promise.all(n).then(l)}fetchQuery(t){const e=this.defaultQueryOptions(t);void 0===e.retry&&(e.retry=!1);const r=this.#g.build(this,e);return r.isStaleByTime(w(e.staleTime,r))?r.fetch(e):Promise.resolve(r.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(l).catch(l)}fetchInfiniteQuery(t){return t.behavior=G(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(l).catch(l)}resumePausedMutations(){return N.isOnline()?this.#d.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#g}getMutationCache(){return this.#d}getDefaultOptions(){return this.#c}setDefaultOptions(t){this.#c=t}setQueryDefaults(t,e){this.#b.set(v(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#b.values()];let r={};return e.forEach((e=>{S(t,e.queryKey)&&(r={...r,...e.defaultOptions})})),r}setMutationDefaults(t,e){this.#m.set(v(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#m.values()];let r={};return e.forEach((e=>{S(t,e.mutationKey)&&(r={...r,...e.defaultOptions})})),r}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#c.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=E(e.queryKey,e)),void 0===e.refetchOnReconnect&&(e.refetchOnReconnect="always"!==e.networkMode),void 0===e.throwOnError&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),!0!==e.enabled&&e.queryFn===x&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#c.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#g.clear(),this.#d.clear()}},Z=class extends h{constructor(t,e){super(),this.options=e,this.#T=t,this.#O=null,this.bindMethods(),this.setOptions(e)}#T;#P=void 0;#_=void 0;#I=void 0;#k;#A;#O;#B;#x;#U;#C;#N;#R;#L=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#P.addObserver(this),J(this.#P,this.options)?this.#H():this.updateResult(),this.#D())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return tt(this.#P,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return tt(this.#P,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#M(),this.#F(),this.#P.removeObserver(this)}setOptions(t,e){const r=this.options,n=this.#P;if(this.options=this.#T.defaultQueryOptions(t),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof g(this.options.enabled,this.#P))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#P.setOptions(this.options),r._defaulted&&!O(this.options,r)&&this.#T.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#P,observer:this});const i=this.hasListeners();i&&et(this.#P,n,this.options,r)&&this.#H(),this.updateResult(e),!i||this.#P===n&&g(this.options.enabled,this.#P)===g(r.enabled,this.#P)&&w(this.options.staleTime,this.#P)===w(r.staleTime,this.#P)||this.#K();const o=this.#$();!i||this.#P===n&&g(this.options.enabled,this.#P)===g(r.enabled,this.#P)&&o===this.#R||this.#V(o)}getOptimisticResult(t){const e=this.#T.getQueryCache().build(this.#T,t),r=this.createResult(e,t);return function(t,e){if(!O(t.getCurrentResult(),e))return!0;return!1}(this,r)&&(this.#I=r,this.#A=this.options,this.#k=this.#P.state),r}getCurrentResult(){return this.#I}trackResult(t,e){const r={};return Object.keys(t).forEach((n=>{Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(n),e?.(n),t[n])})})),r}trackProp(t){this.#L.add(t)}getCurrentQuery(){return this.#P}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#T.defaultQueryOptions(t),r=this.#T.getQueryCache().build(this.#T,e);return r.isFetchingOptimistic=!0,r.fetch().then((()=>this.createResult(r,e)))}fetch(t){return this.#H({...t,cancelRefetch:t.cancelRefetch??!0}).then((()=>(this.updateResult(),this.#I)))}#H(t){this.#j();let e=this.#P.fetch(this.options,t);return t?.throwOnError||(e=e.catch(l)),e}#K(){this.#M();const t=w(this.options.staleTime,this.#P);if(p||this.#I.isStale||!d(t))return;const e=y(this.#I.dataUpdatedAt,t)+1;this.#C=setTimeout((()=>{this.#I.isStale||this.updateResult()}),e)}#$(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#P):this.options.refetchInterval)??!1}#V(t){this.#F(),this.#R=t,!p&&!1!==g(this.options.enabled,this.#P)&&d(this.#R)&&0!==this.#R&&(this.#N=setInterval((()=>{(this.options.refetchIntervalInBackground||C.isFocused())&&this.#H()}),this.#R))}#D(){this.#K(),this.#V(this.#$())}#M(){this.#C&&(clearTimeout(this.#C),this.#C=void 0)}#F(){this.#N&&(clearInterval(this.#N),this.#N=void 0)}createResult(t,e){const r=this.#P,n=this.options,i=this.#I,o=this.#k,s=this.#A,a=t!==r?t.state:this.#_,{state:u}=t;let c,f={...u},h=!1;if(e._optimisticResults){const i=this.hasListeners(),o=!i&&J(t,e),s=i&&et(t,r,e,n);(o||s)&&(f={...f,...$(u.data,t.options)}),"isRestoring"===e._optimisticResults&&(f.fetchStatus="idle")}let{error:p,errorUpdatedAt:l,status:d}=f;if(e.select&&void 0!==f.data)if(i&&f.data===o?.data&&e.select===this.#B)c=this.#x;else try{this.#B=e.select,c=e.select(f.data),c=k(i?.data,c,e),this.#x=c,this.#O=null}catch(t){this.#O=t}else c=f.data;if(void 0!==e.placeholderData&&void 0===c&&"pending"===d){let t;if(i?.isPlaceholderData&&e.placeholderData===s?.placeholderData)t=i.data;else if(t="function"==typeof e.placeholderData?e.placeholderData(this.#U?.state.data,this.#U):e.placeholderData,e.select&&void 0!==t)try{t=e.select(t),this.#O=null}catch(t){this.#O=t}void 0!==t&&(d="success",c=k(i?.data,t,e),h=!0)}this.#O&&(p=this.#O,c=this.#x,l=Date.now(),d="error");const y="fetching"===f.fetchStatus,w="pending"===d,g="error"===d,b=w&&y,m=void 0!==c;return{status:d,fetchStatus:f.fetchStatus,isPending:w,isSuccess:"success"===d,isError:g,isInitialLoading:b,isLoading:b,data:c,dataUpdatedAt:f.dataUpdatedAt,error:p,errorUpdatedAt:l,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>a.dataUpdateCount||f.errorUpdateCount>a.errorUpdateCount,isFetching:y,isRefetching:y&&!w,isLoadingError:g&&!m,isPaused:"paused"===f.fetchStatus,isPlaceholderData:h,isRefetchError:g&&m,isStale:rt(t,e),refetch:this.refetch}}updateResult(t){const e=this.#I,r=this.createResult(this.#P,this.options);if(this.#k=this.#P.state,this.#A=this.options,void 0!==this.#k.data&&(this.#U=this.#P),O(r,e))return;this.#I=r;const n={};!1!==t?.listeners&&(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,r="function"==typeof t?t():t;if("all"===r||!r&&!this.#L.size)return!0;const n=new Set(r??this.#L);return this.options.throwOnError&&n.add("error"),Object.keys(this.#I).some((t=>{const r=t;return this.#I[r]!==e[r]&&n.has(r)}))})()&&(n.listeners=!0),this.#W({...n,...t})}#j(){const t=this.#T.getQueryCache().build(this.#T,this.options);if(t===this.#P)return;const e=this.#P;this.#P=t,this.#_=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#D()}#W(t){F.batch((()=>{t.listeners&&this.listeners.forEach((t=>{t(this.#I)})),this.#T.getQueryCache().notify({query:this.#P,type:"observerResultsUpdated"})}))}};function J(t,e){return function(t,e){return!1!==g(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&tt(t,e,e.refetchOnMount)}function tt(t,e,r){if(!1!==g(e.enabled,t)){const n="function"==typeof r?r(t):r;return"always"===n||!1!==n&&rt(t,e)}return!1}function et(t,e,r,n){return(t!==e||!1===g(n.enabled,t))&&(!r.suspense||"error"!==t.state.status)&&rt(t,r)}function rt(t,e){return!1!==g(e.enabled,t)&&t.isStaleByTime(w(e.staleTime,t))}var nt=class extends h{#T;#I=void 0;#q;#z;constructor(t,e){super(),this.#T=t,this.setOptions(e),this.bindMethods(),this.#G()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#T.defaultMutationOptions(t),O(this.options,e)||this.#T.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#q,observer:this}),e?.mutationKey&&this.options.mutationKey&&v(e.mutationKey)!==v(this.options.mutationKey)?this.reset():"pending"===this.#q?.state.status&&this.#q.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#q?.removeObserver(this)}onMutationUpdate(t){this.#G(),this.#W(t)}getCurrentResult(){return this.#I}reset(){this.#q?.removeObserver(this),this.#q=void 0,this.#G(),this.#W()}mutate(t,e){return this.#z=e,this.#q?.removeObserver(this),this.#q=this.#T.getMutationCache().build(this.#T,this.options),this.#q.addObserver(this),this.#q.execute(t)}#G(){const t=this.#q?.state??{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};this.#I={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#W(t){F.batch((()=>{if(this.#z&&this.hasListeners()){const e=this.#I.variables,r=this.#I.context;"success"===t?.type?(this.#z.onSuccess?.(t.data,e,r),this.#z.onSettled?.(t.data,null,e,r)):"error"===t?.type&&(this.#z.onError?.(t.error,e,r),this.#z.onSettled?.(void 0,t.error,e,r))}this.listeners.forEach((t=>{t(this.#I)}))}))}},it=a.createContext(void 0),ot=t=>{const e=a.useContext(it);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},st=({client:t,children:r})=>(a.useEffect((()=>(t.mount(),()=>{t.unmount()})),[t]),e.jsx(it.Provider,{value:t,children:r})),at=a.createContext(!1),ut=()=>a.useContext(at);at.Provider;var ct=a.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),ft=()=>a.useContext(ct);function ht(t,e){return"function"==typeof t?t(...e):!!t}function pt(){}var lt=(t,e)=>{(t.suspense||t.throwOnError)&&(e.isReset()||(t.retryOnMount=!1))},dt=t=>{a.useEffect((()=>{t.clearReset()}),[t])},yt=({result:t,errorResetBoundary:e,throwOnError:r,query:n})=>t.isError&&!e.isReset()&&!t.isFetching&&n&&ht(r,[t.error,n]),wt=t=>{t.suspense&&"number"!=typeof t.staleTime&&(t.staleTime=1e3)},gt=(t,e)=>t?.suspense&&e.isPending,bt=(t,e,r)=>e.fetchOptimistic(t).catch((()=>{r.clearReset()}));function mt(t,e){return function(t,e){if("production"!==process.env.NODE_ENV&&("object"!=typeof t||Array.isArray(t)))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const r=ot(),n=ut(),i=ft(),o=r.defaultQueryOptions(t);r.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=n?"isRestoring":"optimistic",wt(o),lt(o,i),dt(i);const[s]=a.useState((()=>new e(r,o))),u=s.getOptimisticResult(o);if(a.useSyncExternalStore(a.useCallback((t=>{const e=n?()=>{}:s.subscribe(F.batchCalls(t));return s.updateResult(),e}),[s,n]),(()=>s.getCurrentResult()),(()=>s.getCurrentResult())),a.useEffect((()=>{s.setOptions(o,{listeners:!1})}),[o,s]),gt(o,u))throw bt(o,s,i);if(yt({result:u,errorResetBoundary:i,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash)}))throw u.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(o,u),o.notifyOnChangeProps?u:s.trackResult(u)}(t,Z)}function Et(t,e){const r=ot(),[n]=a.useState((()=>new nt(r,t)));a.useEffect((()=>{n.setOptions(t)}),[n,t]);const i=a.useSyncExternalStore(a.useCallback((t=>n.subscribe(F.batchCalls(t))),[n]),(()=>n.getCurrentResult()),(()=>n.getCurrentResult())),o=a.useCallback(((t,e)=>{n.mutate(t,e).catch(pt)}),[n]);if(i.error&&ht(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}var vt=function(t,e){return vt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},vt(t,e)};function St(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}vt(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Tt=function(){return Tt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Tt.apply(this,arguments)};function Ot(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function Pt(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(t.value).then(s,a)}u((n=n.apply(t,e||[])).next())}))}function _t(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var It="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function kt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function At(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})})),r}var Bt={};function xt(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Ut=xt;xt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},xt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},xt.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},xt.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},xt.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},xt.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},xt.prototype.start=xt.prototype.try,xt.prototype.errors=function(){return this._errors},xt.prototype.attempts=function(){return this._attempts},xt.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,s=(t[o]||0)+1;t[o]=s,s>=r&&(e=i,r=s)}return e},function(t){var e=Ut;t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort((function(t,e){return t-e})),n},t.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var o=0;o<n.length;o++){var s=n[o],a=e[s];e[s]=function(n){var i=t.operation(r),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push((function(t){i.retry(t)||(t&&(arguments[0]=i.mainError()),s.apply(this,arguments))})),i.attempt((function(){n.apply(e,o)}))}.bind(e,a),e[s].options=r}}}(Bt);var Ct=Bt;var Nt=kt((function(t,e){return new Promise((function(r,n){var i,o=e||{};function s(t){n(t||new Error("Aborted"))}function a(t,e){t.bail?s(t):i.retry(t)?o.onRetry&&o.onRetry(t,e):n(i.mainError())}"randomize"in o||(o.randomize=!0),(i=Ct.operation(o)).attempt((function(e){var n;try{n=t(s,e)}catch(t){return void a(t,e)}Promise.resolve(n).then(r).catch((function(t){a(t,e)}))}))}))})),Rt={},Lt={},Ht={};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.testnet=Ht.regtest=Ht.bitcoin=void 0,Ht.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},Ht.regtest={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},Ht.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};var Dt={},Mt={},Ft={},jt={};Object.defineProperty(jt,"__esModule",{value:!0}),jt.encode=jt.decode=jt.check=void 0,jt.check=function(t){if(t.length<8)return!1;if(t.length>72)return!1;if(48!==t[0])return!1;if(t[1]!==t.length-2)return!1;if(2!==t[2])return!1;const e=t[3];if(0===e)return!1;if(5+e>=t.length)return!1;if(2!==t[4+e])return!1;const r=t[5+e];return 0!==r&&(6+e+r===t.length&&(!(128&t[4])&&(!(e>1&&0===t[4]&&!(128&t[5]))&&(!(128&t[e+6])&&!(r>1&&0===t[e+6]&&!(128&t[e+7]))))))},jt.decode=function(t){if(t.length<8)throw new Error("DER sequence length is too short");if(t.length>72)throw new Error("DER sequence length is too long");if(48!==t[0])throw new Error("Expected DER sequence");if(t[1]!==t.length-2)throw new Error("DER sequence length is invalid");if(2!==t[2])throw new Error("Expected DER integer");const e=t[3];if(0===e)throw new Error("R length is zero");if(5+e>=t.length)throw new Error("R length is too long");if(2!==t[4+e])throw new Error("Expected DER integer (2)");const r=t[5+e];if(0===r)throw new Error("S length is zero");if(6+e+r!==t.length)throw new Error("S length is invalid");if(128&t[4])throw new Error("R value is negative");if(e>1&&0===t[4]&&!(128&t[5]))throw new Error("R value excessively padded");if(128&t[e+6])throw new Error("S value is negative");if(r>1&&0===t[e+6]&&!(128&t[e+7]))throw new Error("S value excessively padded");return{r:t.slice(4,4+e),s:t.slice(6+e)}},jt.encode=function(t,e){const r=t.length,n=e.length;if(0===r)throw new Error("R length is zero");if(0===n)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(128&t[0])throw new Error("R value is negative");if(128&e[0])throw new Error("S value is negative");if(r>1&&0===t[0]&&!(128&t[1]))throw new Error("R value excessively padded");if(n>1&&0===e[0]&&!(128&e[1]))throw new Error("S value excessively padded");const i=Buffer.allocUnsafe(6+r+n);return i[0]=48,i[1]=i.length-2,i[2]=2,i[3]=t.length,t.copy(i,4),i[4+r]=2,i[5+r]=e.length,e.copy(i,6+r),i};var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.REVERSE_OPS=Kt.OPS=void 0;const $t={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};Kt.OPS=$t;const Vt={};Kt.REVERSE_OPS=Vt;for(const t of Object.keys($t)){Vt[$t[t]]=t}var Wt={};Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.decode=Wt.encode=Wt.encodingLength=void 0;const qt=Kt;function zt(t){return t<qt.OPS.OP_PUSHDATA1?1:t<=255?2:t<=65535?3:5}Wt.encodingLength=zt,Wt.encode=function(t,e,r){const n=zt(e);return 1===n?t.writeUInt8(e,r):2===n?(t.writeUInt8(qt.OPS.OP_PUSHDATA1,r),t.writeUInt8(e,r+1)):3===n?(t.writeUInt8(qt.OPS.OP_PUSHDATA2,r),t.writeUInt16LE(e,r+1)):(t.writeUInt8(qt.OPS.OP_PUSHDATA4,r),t.writeUInt32LE(e,r+1)),n},Wt.decode=function(t,e){const r=t.readUInt8(e);let n,i;if(r<qt.OPS.OP_PUSHDATA1)n=r,i=1;else if(r===qt.OPS.OP_PUSHDATA1){if(e+2>t.length)return null;n=t.readUInt8(e+1),i=2}else if(r===qt.OPS.OP_PUSHDATA2){if(e+3>t.length)return null;n=t.readUInt16LE(e+1),i=3}else{if(e+5>t.length)return null;if(r!==qt.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=t.readUInt32LE(e+1),i=5}return{opcode:r,number:n,size:i}};var Gt={};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.encode=Gt.decode=void 0,Gt.decode=function(t,e,r){e=e||4,r=void 0===r||r;const n=t.length;if(0===n)return 0;if(n>e)throw new TypeError("Script number overflow");if(r&&!(127&t[n-1]||!(n<=1)&&128&t[n-2]))throw new Error("Non-minimally encoded script number");if(5===n){const e=t.readUInt32LE(0),r=t.readUInt8(4);return 128&r?-(4294967296*(-129&r)+e):4294967296*r+e}let i=0;for(let e=0;e<n;++e)i|=t[e]<<8*e;return 128&t[n-1]?-(i&~(128<<8*(n-1))):i},Gt.encode=function(t){let e=Math.abs(t);const r=function(t){return t>2147483647?5:t>8388607?4:t>32767?3:t>127?2:t>0?1:0}(e),n=Buffer.allocUnsafe(r),i=t<0;for(let t=0;t<r;++t)n.writeUInt8(255&e,t),e>>=8;return 128&n[r-1]?n.writeUInt8(i?128:0,r-1):i&&(n[r-1]|=128),n};var Yt={},Xt={},Qt={Array:function(t){return null!=t&&t.constructor===Array},Boolean:function(t){return"boolean"==typeof t},Function:function(t){return"function"==typeof t},Nil:function(t){return null==t},Number:function(t){return"number"==typeof t},Object:function(t){return"object"==typeof t},String:function(t){return"string"==typeof t},"":function(){return!0}};for(var Zt in Qt.Null=Qt.Nil,Qt)Qt[Zt].toJSON=function(t){return t}.bind(null,Zt);var Jt=Qt,te=Jt;function ee(t){return t.name||t.toString().match(/function (.*?)\s*\(/)[1]}function re(t){return te.Nil(t)?"":ee(t.constructor)}function ne(t,e){Error.captureStackTrace&&Error.captureStackTrace(t,e)}function ie(t){return te.Function(t)?t.toJSON?t.toJSON():ee(t):te.Array(t)?"Array":t&&te.Object(t)?"Object":void 0!==t?t:""}function oe(t,e,r){var n=function(t){return te.Function(t)?"":te.String(t)?JSON.stringify(t):t&&te.Object(t)?"":t}(e);return"Expected "+ie(t)+", got"+(""!==r?" "+r:"")+(""!==n?" "+n:"")}function se(t,e,r){r=r||re(e),this.message=oe(t,e,r),ne(this,se),this.__type=t,this.__value=e,this.__valueTypeName=r}function ae(t,e,r,n,i){t?(i=i||re(n),this.message=function(t,e,r,n,i){var o='" of type ';return"key"===e&&(o='" with key type '),oe('property "'+ie(r)+o+ie(t),n,i)}(t,r,e,n,i)):this.message='Unexpected property "'+e+'"',ne(this,se),this.__label=r,this.__property=e,this.__type=t,this.__value=n,this.__valueTypeName=i}se.prototype=Object.create(Error.prototype),se.prototype.constructor=se,ae.prototype=Object.create(Error.prototype),ae.prototype.constructor=se;var ue,ce,fe={TfTypeError:se,TfPropertyTypeError:ae,tfCustomError:function(t,e){return new se(t,{},e)},tfSubError:function(t,e,r){return t instanceof ae?(e=e+"."+t.__property,t=new ae(t.__type,e,t.__label,t.__value,t.__valueTypeName)):t instanceof se&&(t=new ae(t.__type,e,r,t.__value,t.__valueTypeName)),ne(t),t},tfJSON:ie,getValueTypeName:re};var he=Jt,pe=fe.tfJSON,le=fe.TfTypeError,de=fe.TfPropertyTypeError,ye=fe.tfSubError,we=fe.getValueTypeName,ge={arrayOf:function(t,e){function r(r,n){return!!he.Array(r)&&(!he.Nil(r)&&(!(void 0!==e.minLength&&r.length<e.minLength)&&(!(void 0!==e.maxLength&&r.length>e.maxLength)&&((void 0===e.length||r.length===e.length)&&r.every((function(e,r){try{return me(t,e,n)}catch(t){throw ye(t,r)}}))))))}return t=be(t),e=e||{},r.toJSON=function(){var r="["+pe(t)+"]";return void 0!==e.length?r+="{"+e.length+"}":void 0===e.minLength&&void 0===e.maxLength||(r+="{"+(void 0===e.minLength?0:e.minLength)+","+(void 0===e.maxLength?1/0:e.maxLength)+"}"),r},r},maybe:function t(e){function r(r,n){return he.Nil(r)||e(r,n,t)}return e=be(e),r.toJSON=function(){return"?"+pe(e)},r},map:function(t,e){function r(r,n){if(!he.Object(r))return!1;if(he.Nil(r))return!1;for(var i in r){try{e&&me(e,i,n)}catch(t){throw ye(t,i,"key")}try{var o=r[i];me(t,o,n)}catch(t){throw ye(t,i)}}return!0}return t=be(t),e&&(e=be(e)),r.toJSON=e?function(){return"{"+pe(e)+": "+pe(t)+"}"}:function(){return"{"+pe(t)+"}"},r},object:function(t){var e={};for(var r in t)e[r]=be(t[r]);function n(t,r){if(!he.Object(t))return!1;if(he.Nil(t))return!1;var n;try{for(n in e){me(e[n],t[n],r)}}catch(t){throw ye(t,n)}if(r)for(n in t)if(!e[n])throw new de(void 0,n);return!0}return n.toJSON=function(){return pe(e)},n},anyOf:function(){var t=[].slice.call(arguments).map(be);function e(e,r){return t.some((function(t){try{return me(t,e,r)}catch(t){return!1}}))}return e.toJSON=function(){return t.map(pe).join("|")},e},allOf:function(){var t=[].slice.call(arguments).map(be);function e(e,r){return t.every((function(t){try{return me(t,e,r)}catch(t){return!1}}))}return e.toJSON=function(){return t.map(pe).join(" & ")},e},quacksLike:function(t){function e(e){return t===we(e)}return e.toJSON=function(){return t},e},tuple:function(){var t=[].slice.call(arguments).map(be);function e(e,r){return!he.Nil(e)&&(!he.Nil(e.length)&&((!r||e.length===t.length)&&t.every((function(t,n){try{return me(t,e[n],r)}catch(t){throw ye(t,n)}}))))}return e.toJSON=function(){return"("+t.map(pe).join(", ")+")"},e},value:function(t){function e(e){return e===t}return e.toJSON=function(){return t},e}};function be(t){if(he.String(t))return"?"===t[0]?ge.maybe(t.slice(1)):he[t]||ge.quacksLike(t);if(t&&he.Object(t)){if(he.Array(t)){if(1!==t.length)throw new TypeError("Expected compile() parameter of type Array of length 1");return ge.arrayOf(t[0])}return ge.object(t)}return he.Function(t)?t:ge.value(t)}function me(t,e,r,n){if(he.Function(t)){if(t(e,r))return!0;throw new le(n||t,e)}return me(be(t),e,r)}for(var Ee in ge.oneOf=ge.anyOf,he)me[Ee]=he[Ee];for(Ee in ge)me[Ee]=ge[Ee];var ve=function(){if(ce)return ue;ce=1;var t=Jt,e=fe;function r(t){return Buffer.isBuffer(t)}function n(t){return"string"==typeof t&&/^([0-9a-f]{2})+$/i.test(t)}function i(t,r){var n=t.toJSON();function i(i){if(!t(i))return!1;if(i.length===r)return!0;throw e.tfCustomError(n+"(Length: "+r+")",n+"(Length: "+i.length+")")}return i.toJSON=function(){return n},i}var o=i.bind(null,t.Array),s=i.bind(null,r),a=i.bind(null,n),u=i.bind(null,t.String),c=Math.pow(2,53)-1,f={ArrayN:o,Buffer:r,BufferN:s,Finite:function(t){return"number"==typeof t&&isFinite(t)},Hex:n,HexN:a,Int8:function(t){return t<<24>>24===t},Int16:function(t){return t<<16>>16===t},Int32:function(t){return(0|t)===t},Int53:function(t){return"number"==typeof t&&t>=-c&&t<=c&&Math.floor(t)===t},Range:function(e,r,n){function i(t,i){return n(t,i)&&t>e&&t<r}return n=n||t.Number,i.toJSON=function(){return`${n.toJSON()} between [${e}, ${r}]`},i},StringN:u,UInt8:function(t){return(255&t)===t},UInt16:function(t){return(65535&t)===t},UInt32:function(t){return t>>>0===t},UInt53:function(t){return"number"==typeof t&&t>=0&&t<=c&&Math.floor(t)===t}};for(var h in f)f[h].toJSON=function(t){return t}.bind(null,h);return ue=f}();for(Ee in ve)me[Ee]=ve[Ee];me.compile=be,me.TfTypeError=le,me.TfPropertyTypeError=de;var Se,Te,Oe=me;function Pe(){return Te||(Te=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.signature=t.number=t.isCanonicalScriptSignature=t.isDefinedHashType=t.isCanonicalPubKey=t.toStack=t.fromASM=t.toASM=t.decompile=t.compile=t.countNonPushOnlyOPs=t.isPushOnly=t.OPS=void 0;const e=jt,r=Kt;Object.defineProperty(t,"OPS",{enumerable:!0,get:function(){return r.OPS}});const n=Wt,i=Gt,o=function(){if(Se)return Yt;Se=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.encode=Yt.decode=void 0;const t=jt,e=Pe(),r=Xt,{typeforce:n}=r,i=Buffer.alloc(1,0);function o(t){let e=0;for(;0===t[e];)++e;return e===t.length?i:128&(t=t.slice(e))[0]?Buffer.concat([i,t],1+t.length):t}function s(t){0===t[0]&&(t=t.slice(1));const e=Buffer.alloc(32,0),r=Math.max(0,32-t.length);return t.copy(e,r),e}return Yt.decode=function(r){const n=r.readUInt8(r.length-1);if(!(0,e.isDefinedHashType)(n))throw new Error("Invalid hashType "+n);const i=t.decode(r.slice(0,-1)),o=s(i.r),a=s(i.s);return{signature:Buffer.concat([o,a],64),hashType:n}},Yt.encode=function(i,s){if(n({signature:r.BufferN(64),hashType:r.UInt8},{signature:i,hashType:s}),!(0,e.isDefinedHashType)(s))throw new Error("Invalid hashType "+s);const a=Buffer.allocUnsafe(1);a.writeUInt8(s,0);const u=o(i.slice(0,32)),c=o(i.slice(32,64));return Buffer.concat([t.encode(u,c),a])},Yt}(),s=Xt,{typeforce:a}=s,u=r.OPS.OP_RESERVED;function c(t){return s.Buffer(t)||function(t){return s.Number(t)&&(t===r.OPS.OP_0||t>=r.OPS.OP_1&&t<=r.OPS.OP_16||t===r.OPS.OP_1NEGATE)}(t)}function f(t){return s.Array(t)&&t.every(c)}function h(t){return 0===t.length?r.OPS.OP_0:1===t.length?t[0]>=1&&t[0]<=16?u+t[0]:129===t[0]?r.OPS.OP_1NEGATE:void 0:void 0}function p(t){return Buffer.isBuffer(t)}function l(t){return Buffer.isBuffer(t)}function d(t){if(p(t))return t;a(s.Array,t);const e=t.reduce(((t,e)=>l(e)?1===e.length&&void 0!==h(e)?t+1:t+n.encodingLength(e.length)+e.length:t+1),0),r=Buffer.allocUnsafe(e);let i=0;if(t.forEach((t=>{if(l(t)){const e=h(t);if(void 0!==e)return r.writeUInt8(e,i),void(i+=1);i+=n.encode(r,t.length,i),t.copy(r,i),i+=t.length}else r.writeUInt8(t,i),i+=1})),i!==r.length)throw new Error("Could not decode chunks");return r}function y(t){if(e=t,s.Array(e))return t;var e;a(s.Buffer,t);const i=[];let o=0;for(;o<t.length;){const e=t[o];if(e>r.OPS.OP_0&&e<=r.OPS.OP_PUSHDATA4){const e=n.decode(t,o);if(null===e)return null;if(o+=e.size,o+e.number>t.length)return null;const r=t.slice(o,o+e.number);o+=e.number;const s=h(r);void 0!==s?i.push(s):i.push(r)}else i.push(e),o+=1}return i}function w(t){const e=-129&t;return e>0&&e<4}t.isPushOnly=f,t.countNonPushOnlyOPs=function(t){return t.length-t.filter(c).length},t.compile=d,t.decompile=y,t.toASM=function(t){if(p(t)&&(t=y(t)),!t)throw new Error("Could not convert invalid chunks to ASM");return t.map((t=>{if(l(t)){const e=h(t);if(void 0===e)return t.toString("hex");t=e}return r.REVERSE_OPS[t]})).join(" ")},t.fromASM=function(t){return a(s.String,t),d(t.split(" ").map((t=>void 0!==r.OPS[t]?r.OPS[t]:(a(s.Hex,t),Buffer.from(t,"hex")))))},t.toStack=function(t){return t=y(t),a(f,t),t.map((t=>l(t)?t:t===r.OPS.OP_0?Buffer.allocUnsafe(0):i.encode(t-u)))},t.isCanonicalPubKey=function(t){return s.isPoint(t)},t.isDefinedHashType=w,t.isCanonicalScriptSignature=function(t){return!!Buffer.isBuffer(t)&&(!!w(t[t.length-1])&&e.check(t.slice(0,-1)))},t.number=i,t.signature=o}(Ft)),Ft}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.oneOf=t.Null=t.BufferN=t.Function=t.UInt32=t.UInt8=t.tuple=t.maybe=t.Hex=t.Buffer=t.String=t.Boolean=t.Array=t.Number=t.Hash256bit=t.Hash160bit=t.Buffer256bit=t.isTaptree=t.isTapleaf=t.TAPLEAF_VERSION_MASK=t.Satoshi=t.isPoint=t.stacksEqual=t.typeforce=void 0;const e=u.default;t.typeforce=Oe;const r=e.Buffer.alloc(32,0),n=e.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");t.stacksEqual=function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))},t.isPoint=function(t){if(!e.Buffer.isBuffer(t))return!1;if(t.length<33)return!1;const i=t[0],o=t.slice(1,33);if(0===o.compare(r))return!1;if(o.compare(n)>=0)return!1;if((2===i||3===i)&&33===t.length)return!0;const s=t.slice(33);return 0!==s.compare(r)&&(!(s.compare(n)>=0)&&(4===i&&65===t.length))};function i(r){return!(!r||!("output"in r))&&(!!e.Buffer.isBuffer(r.output)&&(void 0===r.version||(r.version&t.TAPLEAF_VERSION_MASK)===r.version))}t.Satoshi=function(e){return t.typeforce.UInt53(e)&&e<=21e14},t.TAPLEAF_VERSION_MASK=254,t.isTapleaf=i,t.isTaptree=function e(r){return(0,t.Array)(r)?2===r.length&&r.every((t=>e(t))):i(r)},t.Buffer256bit=t.typeforce.BufferN(32),t.Hash160bit=t.typeforce.BufferN(20),t.Hash256bit=t.typeforce.BufferN(32),t.Number=t.typeforce.Number,t.Array=t.typeforce.Array,t.Boolean=t.typeforce.Boolean,t.String=t.typeforce.String,t.Buffer=t.typeforce.Buffer,t.Hex=t.typeforce.Hex,t.maybe=t.typeforce.maybe,t.tuple=t.typeforce.tuple,t.UInt8=t.typeforce.UInt8,t.UInt32=t.typeforce.UInt32,t.Function=t.typeforce.Function,t.BufferN=t.typeforce.BufferN,t.Null=t.typeforce.Null,t.oneOf=t.typeforce.oneOf}(Xt);var _e={};Object.defineProperty(_e,"__esModule",{value:!0}),_e.value=_e.prop=void 0,_e.prop=function(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const t=r.call(this);return this[e]=t,t},set(t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})}})},_e.value=function(t){let e;return()=>(void 0!==e||(e=t()),e)},Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.p2data=void 0;const Ie=Ht,ke=Pe(),Ae=Xt,Be=_e,xe=ke.OPS;Mt.p2data=function(t,e){if(!t.data&&!t.output)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Ae.typeforce)({network:Ae.typeforce.maybe(Ae.typeforce.Object),output:Ae.typeforce.maybe(Ae.typeforce.Buffer),data:Ae.typeforce.maybe(Ae.typeforce.arrayOf(Ae.typeforce.Buffer))},t);const r={name:"embed",network:t.network||Ie.bitcoin};if(Be.prop(r,"output",(()=>{if(t.data)return ke.compile([xe.OP_RETURN].concat(t.data))})),Be.prop(r,"data",(()=>{if(t.output)return ke.decompile(t.output).slice(1)})),e.validate&&t.output){const e=ke.decompile(t.output);if(e[0]!==xe.OP_RETURN)throw new TypeError("Output is invalid");if(!e.slice(1).every(Ae.typeforce.Buffer))throw new TypeError("Output is invalid");if(t.data&&!(0,Ae.stacksEqual)(t.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,t)};var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.p2ms=void 0;const Ce=Ht,Ne=Pe(),Re=Xt,Le=_e,He=Ne.OPS,De=He.OP_RESERVED;Ue.p2ms=function(t,e){if(!(t.input||t.output||t.pubkeys&&void 0!==t.m||t.signatures))throw new TypeError("Not enough data");function r(t){return Ne.isCanonicalScriptSignature(t)||void 0!==(e.allowIncomplete&&t===He.OP_0)}e=Object.assign({validate:!0},e||{}),(0,Re.typeforce)({network:Re.typeforce.maybe(Re.typeforce.Object),m:Re.typeforce.maybe(Re.typeforce.Number),n:Re.typeforce.maybe(Re.typeforce.Number),output:Re.typeforce.maybe(Re.typeforce.Buffer),pubkeys:Re.typeforce.maybe(Re.typeforce.arrayOf(Re.isPoint)),signatures:Re.typeforce.maybe(Re.typeforce.arrayOf(r)),input:Re.typeforce.maybe(Re.typeforce.Buffer)},t);const n={network:t.network||Ce.bitcoin};let i=[],o=!1;function s(t){o||(o=!0,i=Ne.decompile(t),n.m=i[0]-De,n.n=i[i.length-2]-De,n.pubkeys=i.slice(1,-2))}if(Le.prop(n,"output",(()=>{if(t.m&&n.n&&t.pubkeys)return Ne.compile([].concat(De+t.m,t.pubkeys,De+n.n,He.OP_CHECKMULTISIG))})),Le.prop(n,"m",(()=>{if(n.output)return s(n.output),n.m})),Le.prop(n,"n",(()=>{if(n.pubkeys)return n.pubkeys.length})),Le.prop(n,"pubkeys",(()=>{if(t.output)return s(t.output),n.pubkeys})),Le.prop(n,"signatures",(()=>{if(t.input)return Ne.decompile(t.input).slice(1)})),Le.prop(n,"input",(()=>{if(t.signatures)return Ne.compile([He.OP_0].concat(t.signatures))})),Le.prop(n,"witness",(()=>{if(n.input)return[]})),Le.prop(n,"name",(()=>{if(n.m&&n.n)return`p2ms(${n.m} of ${n.n})`})),e.validate){if(t.output){if(s(t.output),!Re.typeforce.Number(i[0]))throw new TypeError("Output is invalid");if(!Re.typeforce.Number(i[i.length-2]))throw new TypeError("Output is invalid");if(i[i.length-1]!==He.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(n.m<=0||n.n>16||n.m>n.n||n.n!==i.length-3)throw new TypeError("Output is invalid");if(!n.pubkeys.every((t=>(0,Re.isPoint)(t))))throw new TypeError("Output is invalid");if(void 0!==t.m&&t.m!==n.m)throw new TypeError("m mismatch");if(void 0!==t.n&&t.n!==n.n)throw new TypeError("n mismatch");if(t.pubkeys&&!(0,Re.stacksEqual)(t.pubkeys,n.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(void 0!==t.n&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(n.n=t.pubkeys.length,n.n<n.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<n.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>n.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==He.OP_0)throw new TypeError("Input is invalid");if(0===n.signatures.length||!n.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!(0,Re.stacksEqual)(t.signatures,n.signatures))throw new TypeError("Signature mismatch");if(void 0!==t.m&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(n,t)};var Me={};Object.defineProperty(Me,"__esModule",{value:!0}),Me.p2pk=void 0;const Fe=Ht,je=Pe(),Ke=Xt,$e=_e,Ve=je.OPS;Me.p2pk=function(t,e){if(!(t.input||t.output||t.pubkey||t.input||t.signature))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Ke.typeforce)({network:Ke.typeforce.maybe(Ke.typeforce.Object),output:Ke.typeforce.maybe(Ke.typeforce.Buffer),pubkey:Ke.typeforce.maybe(Ke.isPoint),signature:Ke.typeforce.maybe(je.isCanonicalScriptSignature),input:Ke.typeforce.maybe(Ke.typeforce.Buffer)},t);const r=$e.value((()=>je.decompile(t.input))),n={name:"p2pk",network:t.network||Fe.bitcoin};if($e.prop(n,"output",(()=>{if(t.pubkey)return je.compile([t.pubkey,Ve.OP_CHECKSIG])})),$e.prop(n,"pubkey",(()=>{if(t.output)return t.output.slice(1,-1)})),$e.prop(n,"signature",(()=>{if(t.input)return r()[0]})),$e.prop(n,"input",(()=>{if(t.signature)return je.compile([t.signature])})),$e.prop(n,"witness",(()=>{if(n.input)return[]})),e.validate){if(t.output){if(t.output[t.output.length-1]!==Ve.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,Ke.isPoint)(n.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&!t.pubkey.equals(n.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&!t.input.equals(n.input))throw new TypeError("Signature mismatch");if(t.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!je.isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,t)};var We={},qe={},ze={},Ge={},Ye={};function Xe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Qe(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function Ze(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Je(t,...e){if(!Ze(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function tr(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Xe(t.outputLen),Xe(t.blockLen)}function er(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function rr(t,e){Je(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.output=Ye.exists=Ye.hash=Ye.bytes=Ye.bool=Ye.number=Ye.isBytes=void 0,Ye.number=Xe,Ye.bool=Qe,Ye.isBytes=Ze,Ye.bytes=Je,Ye.hash=tr,Ye.exists=er,Ye.output=rr;const nr={number:Xe,bool:Qe,bytes:Je,hash:tr,exists:er,output:rr};Ye.default=nr;var ir={},or={};Object.defineProperty(or,"__esModule",{value:!0}),or.crypto=void 0,or.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,function(t){
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.randomBytes=t.wrapXOFConstructorWithOpts=t.wrapConstructorWithOpts=t.wrapConstructor=t.checkOpts=t.Hash=t.concatBytes=t.toBytes=t.utf8ToBytes=t.asyncLoop=t.nextTick=t.hexToBytes=t.bytesToHex=t.byteSwap32=t.byteSwapIfBE=t.byteSwap=t.isLE=t.rotl=t.rotr=t.createView=t.u32=t.u8=t.isBytes=void 0;const e=or,r=Ye;t.isBytes=function(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name};t.u8=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength);t.u32=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));t.createView=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);t.rotr=(t,e)=>t<<32-e|t>>>e;t.rotl=(t,e)=>t<<e|t>>>32-e>>>0,t.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];t.byteSwap=t=>t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255,t.byteSwapIfBE=t.isLE?t=>t:e=>(0,t.byteSwap)(e),t.byteSwap32=function(e){for(let r=0;r<e.length;r++)e[r]=(0,t.byteSwap)(e[r])};const n=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));t.bytesToHex=function(t){(0,r.bytes)(t);let e="";for(let r=0;r<t.length;r++)e+=n[t[r]];return e};const i={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function o(t){return t>=i._0&&t<=i._9?t-i._0:t>=i._A&&t<=i._F?t-(i._A-10):t>=i._a&&t<=i._f?t-(i._a-10):void 0}t.hexToBytes=function(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let e=0,i=0;e<r;e++,i+=2){const r=o(t.charCodeAt(i)),s=o(t.charCodeAt(i+1));if(void 0===r||void 0===s){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}n[e]=16*r+s}return n};function s(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}function a(t){return"string"==typeof t&&(t=s(t)),(0,r.bytes)(t),t}t.nextTick=async()=>{},t.asyncLoop=async function(e,r,n){let i=Date.now();for(let o=0;o<e;o++){n(o);const e=Date.now()-i;e>=0&&e<r||(await(0,t.nextTick)(),i+=e)}},t.utf8ToBytes=s,t.toBytes=a,t.concatBytes=function(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];(0,r.bytes)(i),e+=i.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n};t.Hash=class{clone(){return this._cloneInto()}};const u={}.toString;t.checkOpts=function(t,e){if(void 0!==e&&"[object Object]"!==u.call(e))throw new Error("Options should be object or undefined");return Object.assign(t,e)},t.wrapConstructor=function(t){const e=e=>t().update(a(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e},t.wrapConstructorWithOpts=function(t){const e=(e,r)=>t(r).update(a(e)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=e=>t(e),e},t.wrapXOFConstructorWithOpts=function(t){const e=(e,r)=>t(r).update(a(e)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=e=>t(e),e},t.randomBytes=function(t=32){if(e.crypto&&"function"==typeof e.crypto.getRandomValues)return e.crypto.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}}(ir),Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.HashMD=Ge.Maj=Ge.Chi=void 0;const sr=Ye,ar=ir;Ge.Chi=(t,e,r)=>t&e^~t&r;Ge.Maj=(t,e,r)=>t&e^t&r^e&r;Ge.HashMD=class extends ar.Hash{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,ar.createView)(this.buffer)}update(t){(0,sr.exists)(this);const{view:e,buffer:r,blockLen:n}=this,i=(t=(0,ar.toBytes)(t)).length;for(let o=0;o<i;){const s=Math.min(n-this.pos,i-o);if(s!==n)r.set(t.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(e,0),this.pos=0);else{const e=(0,ar.createView)(t);for(;n<=i-o;o+=n)this.process(e,o)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){(0,sr.exists)(this),(0,sr.output)(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:n,isLE:i}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(r,0),o=0);for(let t=o;t<n;t++)e[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(r>>i&o),a=Number(r&o),u=n?4:0,c=n?0:4;t.setUint32(e+u,s,n),t.setUint32(e+c,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const s=(0,ar.createView)(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<u;t++)s.setUint32(4*t,c[t],i)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:i,destroyed:o,pos:s}=this;return t.length=n,t.pos=s,t.finished=i,t.destroyed=o,n%e&&t.buffer.set(r),t}},Object.defineProperty(ze,"__esModule",{value:!0}),ze.ripemd160=ze.RIPEMD160=void 0;const ur=Ge,cr=ir,fr=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),hr=new Uint8Array(new Array(16).fill(0).map(((t,e)=>e))),pr=hr.map((t=>(9*t+5)%16));let lr=[hr],dr=[pr];for(let t=0;t<4;t++)for(let e of[lr,dr])e.push(e[t].map((t=>fr[t])));const yr=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((t=>new Uint8Array(t))),wr=lr.map(((t,e)=>t.map((t=>yr[e][t])))),gr=dr.map(((t,e)=>t.map((t=>yr[e][t])))),br=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),mr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]);function Er(t,e,r,n){return 0===t?e^r^n:1===t?e&r|~e&n:2===t?(e|~r)^n:3===t?e&n|r&~n:e^(r|~n)}const vr=new Uint32Array(16);class Sr extends ur.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:t,h1:e,h2:r,h3:n,h4:i}=this;return[t,e,r,n,i]}set(t,e,r,n,i){this.h0=0|t,this.h1=0|e,this.h2=0|r,this.h3=0|n,this.h4=0|i}process(t,e){for(let r=0;r<16;r++,e+=4)vr[r]=t.getUint32(e,!0);let r=0|this.h0,n=r,i=0|this.h1,o=i,s=0|this.h2,a=s,u=0|this.h3,c=u,f=0|this.h4,h=f;for(let t=0;t<5;t++){const e=4-t,p=br[t],l=mr[t],d=lr[t],y=dr[t],w=wr[t],g=gr[t];for(let e=0;e<16;e++){const n=(0,cr.rotl)(r+Er(t,i,s,u)+vr[d[e]]+p,w[e])+f|0;r=f,f=u,u=0|(0,cr.rotl)(s,10),s=i,i=n}for(let t=0;t<16;t++){const r=(0,cr.rotl)(n+Er(e,o,a,c)+vr[y[t]]+l,g[t])+h|0;n=h,h=c,c=0|(0,cr.rotl)(a,10),a=o,o=r}}this.set(this.h1+s+c|0,this.h2+u+h|0,this.h3+f+n|0,this.h4+r+o|0,this.h0+i+a|0)}roundClean(){vr.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}ze.RIPEMD160=Sr,ze.ripemd160=(0,cr.wrapConstructor)((()=>new Sr));var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.sha1=void 0;const Or=Ge,Pr=ir,_r=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),Ir=new Uint32Array(80);class kr extends Or.HashMD{constructor(){super(64,20,8,!1),this.A=0|_r[0],this.B=0|_r[1],this.C=0|_r[2],this.D=0|_r[3],this.E=0|_r[4]}get(){const{A:t,B:e,C:r,D:n,E:i}=this;return[t,e,r,n,i]}set(t,e,r,n,i){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|i}process(t,e){for(let r=0;r<16;r++,e+=4)Ir[r]=t.getUint32(e,!1);for(let t=16;t<80;t++)Ir[t]=(0,Pr.rotl)(Ir[t-3]^Ir[t-8]^Ir[t-14]^Ir[t-16],1);let{A:r,B:n,C:i,D:o,E:s}=this;for(let t=0;t<80;t++){let e,a;t<20?(e=(0,Or.Chi)(n,i,o),a=1518500249):t<40?(e=n^i^o,a=1859775393):t<60?(e=(0,Or.Maj)(n,i,o),a=2400959708):(e=n^i^o,a=3395469782);const u=(0,Pr.rotl)(r,5)+e+s+a+Ir[t]|0;s=o,o=i,i=(0,Pr.rotl)(n,30),n=r,r=u}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,this.set(r,n,i,o,s)}roundClean(){Ir.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}}Tr.sha1=(0,Pr.wrapConstructor)((()=>new kr));var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.sha224=Ar.sha256=void 0;const Br=Ge,xr=ir,Ur=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Cr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Nr=new Uint32Array(64);class Rr extends Br.HashMD{constructor(){super(64,32,8,!1),this.A=0|Cr[0],this.B=0|Cr[1],this.C=0|Cr[2],this.D=0|Cr[3],this.E=0|Cr[4],this.F=0|Cr[5],this.G=0|Cr[6],this.H=0|Cr[7]}get(){const{A:t,B:e,C:r,D:n,E:i,F:o,G:s,H:a}=this;return[t,e,r,n,i,o,s,a]}set(t,e,r,n,i,o,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)Nr[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=Nr[t-15],r=Nr[t-2],n=(0,xr.rotr)(e,7)^(0,xr.rotr)(e,18)^e>>>3,i=(0,xr.rotr)(r,17)^(0,xr.rotr)(r,19)^r>>>10;Nr[t]=i+Nr[t-7]+n+Nr[t-16]|0}let{A:r,B:n,C:i,D:o,E:s,F:a,G:u,H:c}=this;for(let t=0;t<64;t++){const e=c+((0,xr.rotr)(s,6)^(0,xr.rotr)(s,11)^(0,xr.rotr)(s,25))+(0,Br.Chi)(s,a,u)+Ur[t]+Nr[t]|0,f=((0,xr.rotr)(r,2)^(0,xr.rotr)(r,13)^(0,xr.rotr)(r,22))+(0,Br.Maj)(r,n,i)|0;c=u,u=a,a=s,s=o+e|0,o=i,i=n,n=r,r=e+f|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(r,n,i,o,s,a,u,c)}roundClean(){Nr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Lr extends Rr{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Ar.sha256=(0,xr.wrapConstructor)((()=>new Rr)),Ar.sha224=(0,xr.wrapConstructor)((()=>new Lr)),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.taggedHash=t.TAGGED_HASH_PREFIXES=t.TAGS=t.hash256=t.hash160=t.sha256=t.sha1=t.ripemd160=void 0;const e=ze,r=Tr,n=Ar;function i(t){return Buffer.from((0,n.sha256)(Uint8Array.from(t)))}t.ripemd160=function(t){return Buffer.from((0,e.ripemd160)(Uint8Array.from(t)))},t.sha1=function(t){return Buffer.from((0,r.sha1)(Uint8Array.from(t)))},t.sha256=i,t.hash160=function(t){return Buffer.from((0,e.ripemd160)((0,n.sha256)(Uint8Array.from(t))))},t.hash256=function(t){return Buffer.from((0,n.sha256)((0,n.sha256)(Uint8Array.from(t))))},t.TAGS=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],t.TAGGED_HASH_PREFIXES={"BIP0340/challenge":Buffer.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":Buffer.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":Buffer.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:Buffer.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:Buffer.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:Buffer.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:Buffer.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":Buffer.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":Buffer.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])},t.taggedHash=function(e,r){return i(Buffer.concat([t.TAGGED_HASH_PREFIXES[e],r]))}}(qe);var Hr=function(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(255!==e[o])throw new TypeError(i+" is ambiguous");e[o]=n}var s=t.length,a=t.charAt(0),u=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function f(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;for(var r=0,n=0,i=0;t[r]===a;)n++,r++;for(var o=(t.length-r)*u+1>>>0,c=new Uint8Array(o);t[r];){var f=e[t.charCodeAt(r)];if(255===f)return;for(var h=0,p=o-1;(0!==f||h<i)&&-1!==p;p--,h++)f+=s*c[p]>>>0,c[p]=f%256>>>0,f=f/256>>>0;if(0!==f)throw new Error("Non-zero carry");i=h,r++}for(var l=o-i;l!==o&&0===c[l];)l++;for(var d=new Uint8Array(n+(o-l)),y=n;l!==o;)d[y++]=c[l++];return d}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var r=0,n=0,i=0,o=e.length;i!==o&&0===e[i];)i++,r++;for(var u=(o-i)*c+1>>>0,f=new Uint8Array(u);i!==o;){for(var h=e[i],p=0,l=u-1;(0!==h||p<n)&&-1!==l;l--,p++)h+=256*f[l]>>>0,f[l]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");n=p,i++}for(var d=u-n;d!==u&&0===f[d];)d++;for(var y=a.repeat(r);d<u;++d)y+=t.charAt(f[d]);return y},decodeUnsafe:f,decode:function(t){var e=f(t);if(e)return e;throw new Error("Non-base"+s+" character")}}};var Dr=Hr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),{sha256:Mr}=Ar;var Fr=function(t){function e(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(e){var r=Uint8Array.from(e),n=t(r),i=r.length+4,o=new Uint8Array(i);return o.set(r,0),o.set(n.subarray(0,4),r.length),Dr.encode(o,i)},decode:function(t){var r=e(Dr.decode(t));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(t){var r=Dr.decodeUnsafe(t);if(r)return e(r)}}}((function(t){return Mr(Mr(t))}));Object.defineProperty(We,"__esModule",{value:!0}),We.p2pkh=void 0;const jr=qe,Kr=Ht,$r=Pe(),Vr=Xt,Wr=_e,qr=Fr,zr=$r.OPS;We.p2pkh=function(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Vr.typeforce)({network:Vr.typeforce.maybe(Vr.typeforce.Object),address:Vr.typeforce.maybe(Vr.typeforce.String),hash:Vr.typeforce.maybe(Vr.typeforce.BufferN(20)),output:Vr.typeforce.maybe(Vr.typeforce.BufferN(25)),pubkey:Vr.typeforce.maybe(Vr.isPoint),signature:Vr.typeforce.maybe($r.isCanonicalScriptSignature),input:Vr.typeforce.maybe(Vr.typeforce.Buffer)},t);const r=Wr.value((()=>{const e=Buffer.from(qr.decode(t.address));return{version:e.readUInt8(0),hash:e.slice(1)}})),n=Wr.value((()=>$r.decompile(t.input))),i=t.network||Kr.bitcoin,o={name:"p2pkh",network:i};if(Wr.prop(o,"address",(()=>{if(!o.hash)return;const t=Buffer.allocUnsafe(21);return t.writeUInt8(i.pubKeyHash,0),o.hash.copy(t,1),qr.encode(t)})),Wr.prop(o,"hash",(()=>t.output?t.output.slice(3,23):t.address?r().hash:t.pubkey||o.pubkey?jr.hash160(t.pubkey||o.pubkey):void 0)),Wr.prop(o,"output",(()=>{if(o.hash)return $r.compile([zr.OP_DUP,zr.OP_HASH160,o.hash,zr.OP_EQUALVERIFY,zr.OP_CHECKSIG])})),Wr.prop(o,"pubkey",(()=>{if(t.input)return n()[1]})),Wr.prop(o,"signature",(()=>{if(t.input)return n()[0]})),Wr.prop(o,"input",(()=>{if(t.pubkey&&t.signature)return $r.compile([t.signature,t.pubkey])})),Wr.prop(o,"witness",(()=>{if(o.input)return[]})),e.validate){let e=Buffer.from([]);if(t.address){if(r().version!==i.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");e=r().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(25!==t.output.length||t.output[0]!==zr.OP_DUP||t.output[1]!==zr.OP_HASH160||20!==t.output[2]||t.output[23]!==zr.OP_EQUALVERIFY||t.output[24]!==zr.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=t.output.slice(3,23);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.pubkey){const r=jr.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.input){const r=n();if(2!==r.length)throw new TypeError("Input is invalid");if(!$r.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!(0,Vr.isPoint)(r[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&!t.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const i=jr.hash160(r[1]);if(e.length>0&&!e.equals(i))throw new TypeError("Hash mismatch")}}return Object.assign(o,t)};var Gr={};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.p2sh=void 0;const Yr=qe,Xr=Ht,Qr=Pe(),Zr=Xt,Jr=_e,tn=Fr,en=Qr.OPS;Gr.p2sh=function(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,Zr.typeforce)({network:Zr.typeforce.maybe(Zr.typeforce.Object),address:Zr.typeforce.maybe(Zr.typeforce.String),hash:Zr.typeforce.maybe(Zr.typeforce.BufferN(20)),output:Zr.typeforce.maybe(Zr.typeforce.BufferN(23)),redeem:Zr.typeforce.maybe({network:Zr.typeforce.maybe(Zr.typeforce.Object),output:Zr.typeforce.maybe(Zr.typeforce.Buffer),input:Zr.typeforce.maybe(Zr.typeforce.Buffer),witness:Zr.typeforce.maybe(Zr.typeforce.arrayOf(Zr.typeforce.Buffer))}),input:Zr.typeforce.maybe(Zr.typeforce.Buffer),witness:Zr.typeforce.maybe(Zr.typeforce.arrayOf(Zr.typeforce.Buffer))},t);let r=t.network;r||(r=t.redeem&&t.redeem.network||Xr.bitcoin);const n={network:r},i=Jr.value((()=>{const e=Buffer.from(tn.decode(t.address));return{version:e.readUInt8(0),hash:e.slice(1)}})),o=Jr.value((()=>Qr.decompile(t.input))),s=Jr.value((()=>{const e=o(),n=e[e.length-1];return{network:r,output:n===en.OP_FALSE?Buffer.from([]):n,input:Qr.compile(e.slice(0,-1)),witness:t.witness||[]}}));if(Jr.prop(n,"address",(()=>{if(!n.hash)return;const t=Buffer.allocUnsafe(21);return t.writeUInt8(n.network.scriptHash,0),n.hash.copy(t,1),tn.encode(t)})),Jr.prop(n,"hash",(()=>t.output?t.output.slice(2,22):t.address?i().hash:n.redeem&&n.redeem.output?Yr.hash160(n.redeem.output):void 0)),Jr.prop(n,"output",(()=>{if(n.hash)return Qr.compile([en.OP_HASH160,n.hash,en.OP_EQUAL])})),Jr.prop(n,"redeem",(()=>{if(t.input)return s()})),Jr.prop(n,"input",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.output)return Qr.compile([].concat(Qr.decompile(t.redeem.input),t.redeem.output))})),Jr.prop(n,"witness",(()=>n.redeem&&n.redeem.witness?n.redeem.witness:n.input?[]:void 0)),Jr.prop(n,"name",(()=>{const t=["p2sh"];return void 0!==n.redeem&&void 0!==n.redeem.name&&t.push(n.redeem.name),t.join("-")})),e.validate){let e=Buffer.from([]);if(t.address){if(i().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==i().hash.length)throw new TypeError("Invalid address");e=i().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(23!==t.output.length||t.output[0]!==en.OP_HASH160||20!==t.output[1]||t.output[22]!==en.OP_EQUAL)throw new TypeError("Output is invalid");const r=t.output.slice(2,22);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}const n=t=>{if(t.output){const r=Qr.decompile(t.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");if(t.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(Qr.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=Yr.hash160(t.output);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch");e=n}if(t.input){const e=t.input.length>0,r=t.witness&&t.witness.length>0;if(!e&&!r)throw new TypeError("Empty input");if(e&&r)throw new TypeError("Input and witness provided");if(e){const e=Qr.decompile(t.input);if(!Qr.isPushOnly(e))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const t=o();if(!t||t.length<1)throw new TypeError("Input too short");if(!Buffer.isBuffer(s().output))throw new TypeError("Input is invalid");n(s())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==r)throw new TypeError("Network mismatch");if(t.input){const e=s();if(t.redeem.output&&!t.redeem.output.equals(e.output))throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&!t.redeem.input.equals(e.input))throw new TypeError("Redeem.input mismatch")}n(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!(0,Zr.stacksEqual)(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,t)};var rn={},nn={};Object.defineProperty(nn,"__esModule",{value:!0}),nn.bech32m=nn.bech32=void 0;const on="qpzry9x8gf2tvdw0s3jn54khce6mua7l",sn={};for(let t=0;t<32;t++){const e=on.charAt(t);sn[e]=t}function an(t){const e=t>>25;return(33554431&t)<<5^996825010&-(1&e)^642813549&-(e>>1&1)^513874426&-(e>>2&1)^1027748829&-(e>>3&1)^705979059&-(e>>4&1)}function un(t){let e=1;for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+t+")";e=an(e)^n>>5}e=an(e);for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);e=an(e)^31&n}return e}function cn(t,e,r,n){let i=0,o=0;const s=(1<<r)-1,a=[];for(let n=0;n<t.length;++n)for(i=i<<e|t[n],o+=e;o>=r;)o-=r,a.push(i>>o&s);if(n)o>0&&a.push(i<<r-o&s);else{if(o>=e)return"Excess padding";if(i<<r-o&s)return"Non-zero padding"}return a}function fn(t){return cn(t,8,5,!0)}function hn(t){const e=cn(t,5,8,!1);if(Array.isArray(e))return e}function pn(t){const e=cn(t,5,8,!1);if(Array.isArray(e))return e;throw new Error(e)}function ln(t){let e;function r(t,r){if(r=r||90,t.length<8)return t+" too short";if(t.length>r)return"Exceeds length limit";const n=t.toLowerCase(),i=t.toUpperCase();if(t!==n&&t!==i)return"Mixed-case string "+t;const o=(t=n).lastIndexOf("1");if(-1===o)return"No separator character for "+t;if(0===o)return"Missing prefix for "+t;const s=t.slice(0,o),a=t.slice(o+1);if(a.length<6)return"Data too short";let u=un(s);if("string"==typeof u)return u;const c=[];for(let t=0;t<a.length;++t){const e=a.charAt(t),r=sn[e];if(void 0===r)return"Unknown character "+e;u=an(u)^r,t+6>=a.length||c.push(r)}return u!==e?"Invalid checksum for "+t:{prefix:s,words:c}}return e="bech32"===t?1:734539939,{decodeUnsafe:function(t,e){const n=r(t,e);if("object"==typeof n)return n},decode:function(t,e){const n=r(t,e);if("object"==typeof n)return n;throw new Error(n)},encode:function(t,r,n){if(n=n||90,t.length+7+r.length>n)throw new TypeError("Exceeds length limit");let i=un(t=t.toLowerCase());if("string"==typeof i)throw new Error(i);let o=t+"1";for(let t=0;t<r.length;++t){const e=r[t];if(e>>5)throw new Error("Non 5-bit word");i=an(i)^e,o+=on.charAt(e)}for(let t=0;t<6;++t)i=an(i);i^=e;for(let t=0;t<6;++t){o+=on.charAt(i>>5*(5-t)&31)}return o},toWords:fn,fromWordsUnsafe:hn,fromWords:pn}}nn.bech32=ln("bech32"),nn.bech32m=ln("bech32m"),Object.defineProperty(rn,"__esModule",{value:!0}),rn.p2wpkh=void 0;const dn=qe,yn=Ht,wn=Pe(),gn=Xt,bn=_e,mn=nn,En=wn.OPS,vn=Buffer.alloc(0);rn.p2wpkh=function(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,gn.typeforce)({address:gn.typeforce.maybe(gn.typeforce.String),hash:gn.typeforce.maybe(gn.typeforce.BufferN(20)),input:gn.typeforce.maybe(gn.typeforce.BufferN(0)),network:gn.typeforce.maybe(gn.typeforce.Object),output:gn.typeforce.maybe(gn.typeforce.BufferN(22)),pubkey:gn.typeforce.maybe(gn.isPoint),signature:gn.typeforce.maybe(wn.isCanonicalScriptSignature),witness:gn.typeforce.maybe(gn.typeforce.arrayOf(gn.typeforce.Buffer))},t);const r=bn.value((()=>{const e=mn.bech32.decode(t.address),r=e.words.shift(),n=mn.bech32.fromWords(e.words);return{version:r,prefix:e.prefix,data:Buffer.from(n)}})),n=t.network||yn.bitcoin,i={name:"p2wpkh",network:n};if(bn.prop(i,"address",(()=>{if(!i.hash)return;const t=mn.bech32.toWords(i.hash);return t.unshift(0),mn.bech32.encode(n.bech32,t)})),bn.prop(i,"hash",(()=>t.output?t.output.slice(2,22):t.address?r().data:t.pubkey||i.pubkey?dn.hash160(t.pubkey||i.pubkey):void 0)),bn.prop(i,"output",(()=>{if(i.hash)return wn.compile([En.OP_0,i.hash])})),bn.prop(i,"pubkey",(()=>t.pubkey?t.pubkey:t.witness?t.witness[1]:void 0)),bn.prop(i,"signature",(()=>{if(t.witness)return t.witness[0]})),bn.prop(i,"input",(()=>{if(i.witness)return vn})),bn.prop(i,"witness",(()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]})),e.validate){let e=Buffer.from([]);if(t.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(22!==t.output.length||t.output[0]!==En.OP_0||20!==t.output[1])throw new TypeError("Output is invalid");if(e.length>0&&!e.equals(t.output.slice(2)))throw new TypeError("Hash mismatch");e=t.output.slice(2)}if(t.pubkey){const r=dn.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");if(e=r,!(0,gn.isPoint)(t.pubkey)||33!==t.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(2!==t.witness.length)throw new TypeError("Witness is invalid");if(!wn.isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,gn.isPoint)(t.witness[1])||33!==t.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(t.signature&&!t.signature.equals(t.witness[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(t.witness[1]))throw new TypeError("Pubkey mismatch");const r=dn.hash160(t.witness[1]);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(i,t)};var Sn={};Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.p2wsh=void 0;const Tn=qe,On=Ht,Pn=Pe(),_n=Xt,In=_e,kn=nn,An=Pn.OPS,Bn=Buffer.alloc(0);function xn(t){return!(!Buffer.isBuffer(t)||65!==t.length||4!==t[0]||!(0,_n.isPoint)(t))}Sn.p2wsh=function(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),(0,_n.typeforce)({network:_n.typeforce.maybe(_n.typeforce.Object),address:_n.typeforce.maybe(_n.typeforce.String),hash:_n.typeforce.maybe(_n.typeforce.BufferN(32)),output:_n.typeforce.maybe(_n.typeforce.BufferN(34)),redeem:_n.typeforce.maybe({input:_n.typeforce.maybe(_n.typeforce.Buffer),network:_n.typeforce.maybe(_n.typeforce.Object),output:_n.typeforce.maybe(_n.typeforce.Buffer),witness:_n.typeforce.maybe(_n.typeforce.arrayOf(_n.typeforce.Buffer))}),input:_n.typeforce.maybe(_n.typeforce.BufferN(0)),witness:_n.typeforce.maybe(_n.typeforce.arrayOf(_n.typeforce.Buffer))},t);const r=In.value((()=>{const e=kn.bech32.decode(t.address),r=e.words.shift(),n=kn.bech32.fromWords(e.words);return{version:r,prefix:e.prefix,data:Buffer.from(n)}})),n=In.value((()=>Pn.decompile(t.redeem.input)));let i=t.network;i||(i=t.redeem&&t.redeem.network||On.bitcoin);const o={network:i};if(In.prop(o,"address",(()=>{if(!o.hash)return;const t=kn.bech32.toWords(o.hash);return t.unshift(0),kn.bech32.encode(i.bech32,t)})),In.prop(o,"hash",(()=>t.output?t.output.slice(2):t.address?r().data:o.redeem&&o.redeem.output?Tn.sha256(o.redeem.output):void 0)),In.prop(o,"output",(()=>{if(o.hash)return Pn.compile([An.OP_0,o.hash])})),In.prop(o,"redeem",(()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:Bn,witness:t.witness.slice(0,-1)}})),In.prop(o,"input",(()=>{if(o.witness)return Bn})),In.prop(o,"witness",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const e=Pn.toStack(n());return o.redeem=Object.assign({witness:e},t.redeem),o.redeem.input=Bn,[].concat(e,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)})),In.prop(o,"name",(()=>{const t=["p2wsh"];return void 0!==o.redeem&&void 0!==o.redeem.name&&t.push(o.redeem.name),t.join("-")})),e.validate){let e=Buffer.from([]);if(t.address){if(r().prefix!==i.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(34!==t.output.length||t.output[0]!==An.OP_0||32!==t.output[1])throw new TypeError("Output is invalid");const r=t.output.slice(2);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.redeem){if(t.redeem.network&&t.redeem.network!==i)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){const r=Pn.decompile(t.redeem.output);if(!r||r.length<1)throw new TypeError("Redeem.output is invalid");if(t.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(Pn.countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=Tn.sha256(t.redeem.output);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch");e=n}if(t.redeem.input&&!Pn.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!(0,_n.stacksEqual)(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&n().some(xn)||t.redeem.output&&(Pn.decompile(t.redeem.output)||[]).some(xn))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const e=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&!t.redeem.output.equals(e))throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(xn)||(Pn.decompile(e)||[]).some(xn))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(o,t)};var Un={},Cn={};Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.getEccLib=Cn.initEccLib=void 0;const Nn={};Cn.initEccLib=function(t){var e;t?t!==Nn.eccLib&&(Ln("function"==typeof(e=t).isXOnlyPoint),Ln(e.isXOnlyPoint(Rn("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),Ln(e.isXOnlyPoint(Rn("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),Ln(e.isXOnlyPoint(Rn("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),Ln(e.isXOnlyPoint(Rn("0000000000000000000000000000000000000000000000000000000000000001"))),Ln(!e.isXOnlyPoint(Rn("0000000000000000000000000000000000000000000000000000000000000000"))),Ln(!e.isXOnlyPoint(Rn("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),Ln("function"==typeof e.xOnlyPointAddTweak),Hn.forEach((t=>{const r=e.xOnlyPointAddTweak(Rn(t.pubkey),Rn(t.tweak));null===t.result?Ln(null===r):(Ln(null!==r),Ln(r.parity===t.parity),Ln(Buffer.from(r.xOnlyPubkey).equals(Rn(t.result))))})),Nn.eccLib=t):Nn.eccLib=t},Cn.getEccLib=function(){if(!Nn.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return Nn.eccLib};const Rn=t=>Buffer.from(t,"hex");function Ln(t){if(!t)throw new Error("ecc library invalid")}const Hn=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}];var Dn={},Mn={},Fn={exports:{}};
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
!function(t,e){var r=u.default,n=r.Buffer;function i(t,e){for(var r in t)e[r]=t[r]}function o(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=o),o.prototype=Object.create(n.prototype),i(n,o),o.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},o.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}}(Fn,Fn.exports);var jn=Fn.exports.Buffer,Kn=9007199254740991;function $n(t){if(t<0||t>Kn||t%1!=0)throw new RangeError("value out of range")}function Vn(t){return $n(t),t<253?1:t<=65535?3:t<=4294967295?5:9}var Wn={encode:function t(e,r,n){if($n(e),r||(r=jn.allocUnsafe(Vn(e))),!jn.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),e<253?(r.writeUInt8(e,n),t.bytes=1):e<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(e,n+1),t.bytes=3):e<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(e,n+1),t.bytes=5):(r.writeUInt8(255,n),r.writeUInt32LE(e>>>0,n+1),r.writeUInt32LE(e/4294967296|0,n+5),t.bytes=9),r},decode:function t(e,r){if(!jn.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");r||(r=0);var n=e.readUInt8(r);if(n<253)return t.bytes=1,n;if(253===n)return t.bytes=3,e.readUInt16LE(r+1);if(254===n)return t.bytes=5,e.readUInt32LE(r+1);t.bytes=9;var i=e.readUInt32LE(r+1),o=4294967296*e.readUInt32LE(r+5)+i;return $n(o),o},encodingLength:Vn};Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.BufferReader=Mn.BufferWriter=Mn.cloneBuffer=Mn.reverseBuffer=Mn.writeUInt64LE=Mn.readUInt64LE=Mn.varuint=void 0;const qn=Xt,{typeforce:zn}=qn,Gn=Wn;function Yn(t,e){if("number"!=typeof t)throw new Error("cannot write a non-number as a number");if(t<0)throw new Error("specified a negative value for writing an unsigned value");if(t>e)throw new Error("RangeError: value out of range");if(Math.floor(t)!==t)throw new Error("value has a fractional component")}function Xn(t,e){const r=t.readUInt32LE(e);let n=t.readUInt32LE(e+4);return n*=4294967296,Yn(n+r,9007199254740991),n+r}function Qn(t,e,r){return Yn(e,9007199254740991),t.writeInt32LE(-1&e,r),t.writeUInt32LE(Math.floor(e/4294967296),r+4),r+8}Mn.varuint=Gn,Mn.readUInt64LE=Xn,Mn.writeUInt64LE=Qn,Mn.reverseBuffer=function(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t},Mn.cloneBuffer=function(t){const e=Buffer.allocUnsafe(t.length);return t.copy(e),e};class Zn{static withCapacity(t){return new Zn(Buffer.alloc(t))}constructor(t,e=0){this.buffer=t,this.offset=e,zn(qn.tuple(qn.Buffer,qn.UInt32),[t,e])}writeUInt8(t){this.offset=this.buffer.writeUInt8(t,this.offset)}writeInt32(t){this.offset=this.buffer.writeInt32LE(t,this.offset)}writeUInt32(t){this.offset=this.buffer.writeUInt32LE(t,this.offset)}writeUInt64(t){this.offset=Qn(this.buffer,t,this.offset)}writeVarInt(t){Gn.encode(t,this.buffer,this.offset),this.offset+=Gn.encode.bytes}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.offset+=t.copy(this.buffer,this.offset)}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach((t=>this.writeVarSlice(t)))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}Mn.BufferWriter=Zn;var Jn,ti,ei;function ri(){return ti||(ti=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.p2tr=t.p2wsh=t.p2wpkh=t.p2sh=t.p2pkh=t.p2pk=t.p2ms=t.embed=void 0;const e=Mt;Object.defineProperty(t,"embed",{enumerable:!0,get:function(){return e.p2data}});const r=Ue;Object.defineProperty(t,"p2ms",{enumerable:!0,get:function(){return r.p2ms}});const n=Me;Object.defineProperty(t,"p2pk",{enumerable:!0,get:function(){return n.p2pk}});const i=We;Object.defineProperty(t,"p2pkh",{enumerable:!0,get:function(){return i.p2pkh}});const o=Gr;Object.defineProperty(t,"p2sh",{enumerable:!0,get:function(){return o.p2sh}});const s=rn;Object.defineProperty(t,"p2wpkh",{enumerable:!0,get:function(){return s.p2wpkh}});const a=Sn;Object.defineProperty(t,"p2wsh",{enumerable:!0,get:function(){return a.p2wsh}});const c=function(){if(Jn)return Un;Jn=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.p2tr=void 0;const t=u.default,e=Ht,r=Pe(),n=Xt,i=Cn,o=Dn,s=_e,a=nn,c=ni(),f=r.OPS;return Un.p2tr=function(u,h){if(!(u.address||u.output||u.pubkey||u.internalPubkey||u.witness&&u.witness.length>1))throw new TypeError("Not enough data");h=Object.assign({validate:!0},h||{}),(0,n.typeforce)({address:n.typeforce.maybe(n.typeforce.String),input:n.typeforce.maybe(n.typeforce.BufferN(0)),network:n.typeforce.maybe(n.typeforce.Object),output:n.typeforce.maybe(n.typeforce.BufferN(34)),internalPubkey:n.typeforce.maybe(n.typeforce.BufferN(32)),hash:n.typeforce.maybe(n.typeforce.BufferN(32)),pubkey:n.typeforce.maybe(n.typeforce.BufferN(32)),signature:n.typeforce.maybe(n.typeforce.anyOf(n.typeforce.BufferN(64),n.typeforce.BufferN(65))),witness:n.typeforce.maybe(n.typeforce.arrayOf(n.typeforce.Buffer)),scriptTree:n.typeforce.maybe(n.isTaptree),redeem:n.typeforce.maybe({output:n.typeforce.maybe(n.typeforce.Buffer),redeemVersion:n.typeforce.maybe(n.typeforce.Number),witness:n.typeforce.maybe(n.typeforce.arrayOf(n.typeforce.Buffer))}),redeemVersion:n.typeforce.maybe(n.typeforce.Number)},u);const p=s.value((()=>(0,c.fromBech32)(u.address))),l=s.value((()=>{if(u.witness&&u.witness.length)return u.witness.length>=2&&80===u.witness[u.witness.length-1][0]?u.witness.slice(0,-1):u.witness.slice()})),d=s.value((()=>u.scriptTree?(0,o.toHashTree)(u.scriptTree):u.hash?{hash:u.hash}:void 0)),y=u.network||e.bitcoin,w={name:"p2tr",network:y};if(s.prop(w,"address",(()=>{if(!w.pubkey)return;const t=a.bech32m.toWords(w.pubkey);return t.unshift(1),a.bech32m.encode(y.bech32,t)})),s.prop(w,"hash",(()=>{const t=d();if(t)return t.hash;const e=l();if(e&&e.length>1){const t=e[e.length-1],r=t[0]&n.TAPLEAF_VERSION_MASK,i=e[e.length-2],s=(0,o.tapleafHash)({output:i,version:r});return(0,o.rootHashFromPath)(t,s)}return null})),s.prop(w,"output",(()=>{if(w.pubkey)return r.compile([f.OP_1,w.pubkey])})),s.prop(w,"redeemVersion",(()=>u.redeemVersion?u.redeemVersion:u.redeem&&void 0!==u.redeem.redeemVersion&&null!==u.redeem.redeemVersion?u.redeem.redeemVersion:o.LEAF_VERSION_TAPSCRIPT)),s.prop(w,"redeem",(()=>{const t=l();if(t&&!(t.length<2))return{output:t[t.length-2],witness:t.slice(0,-2),redeemVersion:t[t.length-1][0]&n.TAPLEAF_VERSION_MASK}})),s.prop(w,"pubkey",(()=>{if(u.pubkey)return u.pubkey;if(u.output)return u.output.slice(2);if(u.address)return p().data;if(w.internalPubkey){const t=(0,o.tweakKey)(w.internalPubkey,w.hash);if(t)return t.x}})),s.prop(w,"internalPubkey",(()=>{if(u.internalPubkey)return u.internalPubkey;const t=l();return t&&t.length>1?t[t.length-1].slice(1,33):void 0})),s.prop(w,"signature",(()=>{if(u.signature)return u.signature;const t=l();return t&&1===t.length?t[0]:void 0})),s.prop(w,"witness",(()=>{if(u.witness)return u.witness;const e=d();if(e&&u.redeem&&u.redeem.output&&u.internalPubkey){const r=(0,o.tapleafHash)({output:u.redeem.output,version:w.redeemVersion}),n=(0,o.findScriptPath)(e,r);if(!n)return;const i=(0,o.tweakKey)(u.internalPubkey,e.hash);if(!i)return;const s=t.Buffer.concat([t.Buffer.from([w.redeemVersion|i.parity]),u.internalPubkey].concat(n));return[u.redeem.output,s]}return u.signature?[u.signature]:void 0})),h.validate){let e=t.Buffer.from([]);if(u.address){if(y&&y.bech32!==p().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(1!==p().version)throw new TypeError("Invalid address version");if(32!==p().data.length)throw new TypeError("Invalid address data");e=p().data}if(u.pubkey){if(e.length>0&&!e.equals(u.pubkey))throw new TypeError("Pubkey mismatch");e=u.pubkey}if(u.output){if(34!==u.output.length||u.output[0]!==f.OP_1||32!==u.output[1])throw new TypeError("Output is invalid");if(e.length>0&&!e.equals(u.output.slice(2)))throw new TypeError("Pubkey mismatch");e=u.output.slice(2)}if(u.internalPubkey){const t=(0,o.tweakKey)(u.internalPubkey,w.hash);if(e.length>0&&!e.equals(t.x))throw new TypeError("Pubkey mismatch");e=t.x}if(e&&e.length&&!(0,i.getEccLib)().isXOnlyPoint(e))throw new TypeError("Invalid pubkey for p2tr");const s=d();if(u.hash&&s&&!u.hash.equals(s.hash))throw new TypeError("Hash mismatch");if(u.redeem&&u.redeem.output&&s){const t=(0,o.tapleafHash)({output:u.redeem.output,version:w.redeemVersion});if(!(0,o.findScriptPath)(s,t))throw new TypeError("Redeem script not in tree")}const a=l();if(u.redeem&&w.redeem){if(u.redeem.redeemVersion&&u.redeem.redeemVersion!==w.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(u.redeem.output){if(0===r.decompile(u.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(w.redeem.output&&!u.redeem.output.equals(w.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(u.redeem.witness&&w.redeem.witness&&!(0,n.stacksEqual)(u.redeem.witness,w.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(a&&a.length)if(1===a.length){if(u.signature&&!u.signature.equals(a[0]))throw new TypeError("Signature mismatch")}else{const t=a[a.length-1];if(t.length<33)throw new TypeError(`The control-block length is too small. Got ${t.length}, expected min 33.`);if((t.length-33)%32!=0)throw new TypeError(`The control-block length of ${t.length} is incorrect!`);const r=(t.length-33)/32;if(r>128)throw new TypeError(`The script path is too long. Got ${r}, expected max 128.`);const s=t.slice(1,33);if(u.internalPubkey&&!u.internalPubkey.equals(s))throw new TypeError("Internal pubkey mismatch");if(!(0,i.getEccLib)().isXOnlyPoint(s))throw new TypeError("Invalid internalPubkey for p2tr witness");const c=t[0]&n.TAPLEAF_VERSION_MASK,f=a[a.length-2],h=(0,o.tapleafHash)({output:f,version:c}),p=(0,o.rootHashFromPath)(t,h),l=(0,o.tweakKey)(s,p);if(!l)throw new TypeError("Invalid outputKey for p2tr witness");if(e.length&&!e.equals(l.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(l.parity!==(1&t[0]))throw new Error("Incorrect parity")}}return Object.assign(w,u)},Un}();Object.defineProperty(t,"p2tr",{enumerable:!0,get:function(){return c.p2tr}})}(Dt)),Dt}function ni(){if(ei)return Lt;ei=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.toOutputScript=Lt.fromOutputScript=Lt.toBech32=Lt.toBase58Check=Lt.fromBech32=Lt.fromBase58Check=void 0;const t=Ht,e=ri(),r=Pe(),n=Xt,i=nn,o=Fr,s=40,a=2,u=16,c=2,f=80,h="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.";function p(t){const e=Buffer.from(o.decode(t));if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");return{version:e.readUInt8(0),hash:e.slice(1)}}function l(t){let e,r;try{e=i.bech32.decode(t)}catch(t){}if(e){if(r=e.words[0],0!==r)throw new TypeError(t+" uses wrong encoding")}else if(e=i.bech32m.decode(t),r=e.words[0],0===r)throw new TypeError(t+" uses wrong encoding");const n=i.bech32.fromWords(e.words.slice(1));return{version:r,prefix:e.prefix,data:Buffer.from(n)}}function d(t,e,r){const n=i.bech32.toWords(t);return n.unshift(e),0===e?i.bech32.encode(r,n):i.bech32m.encode(r,n)}return Lt.fromBase58Check=p,Lt.fromBech32=l,Lt.toBase58Check=function(t,e){(0,n.typeforce)((0,n.tuple)(n.Hash160bit,n.UInt8),arguments);const r=Buffer.allocUnsafe(21);return r.writeUInt8(e,0),t.copy(r,1),o.encode(r)},Lt.toBech32=d,Lt.fromOutputScript=function(n,i){i=i||t.bitcoin;try{return e.p2pkh({output:n,network:i}).address}catch(t){}try{return e.p2sh({output:n,network:i}).address}catch(t){}try{return e.p2wpkh({output:n,network:i}).address}catch(t){}try{return e.p2wsh({output:n,network:i}).address}catch(t){}try{return e.p2tr({output:n,network:i}).address}catch(t){}try{return function(t,e){const r=t.slice(2);if(r.length<a||r.length>s)throw new TypeError("Invalid program length for segwit address");const n=t[0]-f;if(n<c||n>u)throw new TypeError("Invalid version for segwit address");if(t[1]!==r.length)throw new TypeError("Invalid script for segwit address");return console.warn(h),d(r,n,e.bech32)}(n,i)}catch(t){}throw new Error(r.toASM(n)+" has no matching Address")},Lt.toOutputScript=function(n,i){let o,d;i=i||t.bitcoin;try{o=p(n)}catch(t){}if(o){if(o.version===i.pubKeyHash)return e.p2pkh({hash:o.hash}).output;if(o.version===i.scriptHash)return e.p2sh({hash:o.hash}).output}else{try{d=l(n)}catch(t){}if(d){if(d.prefix!==i.bech32)throw new Error(n+" has an invalid prefix");if(0===d.version){if(20===d.data.length)return e.p2wpkh({hash:d.data}).output;if(32===d.data.length)return e.p2wsh({hash:d.data}).output}else if(1===d.version){if(32===d.data.length)return e.p2tr({pubkey:d.data}).output}else if(d.version>=c&&d.version<=u&&d.data.length>=a&&d.data.length<=s)return console.warn(h),r.compile([d.version+f,d.data])}}throw new Error(n+" has no matching Script")},Lt}Mn.BufferReader=class{constructor(t,e=0){this.buffer=t,this.offset=e,zn(qn.tuple(qn.Buffer,qn.UInt32),[t,e])}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){const t=Xn(this.buffer,this.offset);return this.offset+=8,t}readVarInt(){const t=Gn.decode(this.buffer,this.offset);return this.offset+=Gn.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.tweakKey=t.tapTweakHash=t.tapleafHash=t.findScriptPath=t.toHashTree=t.rootHashFromPath=t.MAX_TAPTREE_DEPTH=t.LEAF_VERSION_TAPSCRIPT=void 0;const e=u.default,r=Cn,n=qe,i=Mn,o=Xt;t.LEAF_VERSION_TAPSCRIPT=192,t.MAX_TAPTREE_DEPTH=128;function s(r){const i=r.version||t.LEAF_VERSION_TAPSCRIPT;return n.taggedHash("TapLeaf",e.Buffer.concat([e.Buffer.from([i]),f(r.output)]))}function a(t,r){return n.taggedHash("TapTweak",e.Buffer.concat(r?[t,r]:[t]))}function c(t,r){return n.taggedHash("TapBranch",e.Buffer.concat([t,r]))}function f(t){const r=i.varuint.encodingLength(t.length),n=e.Buffer.allocUnsafe(r);return i.varuint.encode(t.length,n),e.Buffer.concat([n,t])}t.rootHashFromPath=function(t,e){if(t.length<33)throw new TypeError(`The control-block length is too small. Got ${t.length}, expected min 33.`);const r=(t.length-33)/32;let n=e;for(let e=0;e<r;e++){const r=t.slice(33+32*e,65+32*e);n=n.compare(r)<0?c(n,r):c(r,n)}return n},t.toHashTree=function t(e){if((0,o.isTapleaf)(e))return{hash:s(e)};const r=[t(e[0]),t(e[1])];r.sort(((t,e)=>t.hash.compare(e.hash)));const[n,i]=r;return{hash:c(n.hash,i.hash),left:n,right:i}},t.findScriptPath=function t(e,r){if("left"in(n=e)&&"right"in n){const n=t(e.left,r);if(void 0!==n)return[...n,e.right.hash];const i=t(e.right,r);if(void 0!==i)return[...i,e.left.hash]}else if(e.hash.equals(r))return[];var n},t.tapleafHash=s,t.tapTweakHash=a,t.tweakKey=function(t,n){if(!e.Buffer.isBuffer(t))return null;if(32!==t.length)return null;if(n&&32!==n.length)return null;const i=a(t,n),o=(0,r.getEccLib)().xOnlyPointAddTweak(t,i);return o&&null!==o.xOnlyPubkey?{parity:o.parity,x:e.Buffer.from(o.xOnlyPubkey)}:null}}(Dn);var ii={},oi={};Object.defineProperty(oi,"__esModule",{value:!0}),oi.fastMerkleRoot=void 0,oi.fastMerkleRoot=function(t,e){if(!Array.isArray(t))throw TypeError("Expected values Array");if("function"!=typeof e)throw TypeError("Expected digest Function");let r=t.length;const n=t.concat();for(;r>1;){let t=0;for(let i=0;i<r;i+=2,++t){const o=n[i],s=i+1===r?o:n[i+1],a=Buffer.concat([o,s]);n[t]=e(a)}r=t}return n[0]};var si={};Object.defineProperty(si,"__esModule",{value:!0}),si.Transaction=void 0;const ai=Mn,ui=qe,ci=Pe(),fi=Pe(),hi=Xt,{typeforce:pi}=hi;function li(t){const e=t.length;return ai.varuint.encodingLength(e)+e}const di=Buffer.allocUnsafe(0),yi=[],wi=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),gi=Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),bi=Buffer.from("ffffffffffffffff","hex"),mi={script:di,valueBuffer:bi};class Ei{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,e){const r=new ai.BufferReader(t),n=new Ei;n.version=r.readInt32();const i=r.readUInt8(),o=r.readUInt8();let s=!1;i===Ei.ADVANCED_TRANSACTION_MARKER&&o===Ei.ADVANCED_TRANSACTION_FLAG?s=!0:r.offset-=2;const a=r.readVarInt();for(let t=0;t<a;++t)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:yi});const u=r.readVarInt();for(let t=0;t<u;++t)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(s){for(let t=0;t<a;++t)n.ins[t].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),e)return n;if(r.offset!==t.length)throw new Error("Transaction has unexpected data");return n}static fromHex(t){return Ei.fromBuffer(Buffer.from(t,"hex"),!1)}static isCoinbaseHash(t){pi(hi.Hash256bit,t);for(let e=0;e<32;++e)if(0!==t[e])return!1;return!0}isCoinbase(){return 1===this.ins.length&&Ei.isCoinbaseHash(this.ins[0].hash)}addInput(t,e,r,n){return pi(hi.tuple(hi.Hash256bit,hi.UInt32,hi.maybe(hi.UInt32),hi.maybe(hi.Buffer)),arguments),hi.Null(r)&&(r=Ei.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:e,script:n||di,sequence:r,witness:yi})-1}addOutput(t,e){return pi(hi.tuple(hi.Buffer,hi.Satoshi),arguments),this.outs.push({script:t,value:e})-1}hasWitnesses(){return this.ins.some((t=>0!==t.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){const e=t&&this.hasWitnesses();return(e?10:8)+ai.varuint.encodingLength(this.ins.length)+ai.varuint.encodingLength(this.outs.length)+this.ins.reduce(((t,e)=>t+40+li(e.script)),0)+this.outs.reduce(((t,e)=>t+8+li(e.script)),0)+(e?this.ins.reduce(((t,e)=>t+function(t){const e=t.length;return ai.varuint.encodingLength(e)+t.reduce(((t,e)=>t+li(e)),0)}(e.witness)),0):0)}clone(){const t=new Ei;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map((t=>({hash:t.hash,index:t.index,script:t.script,sequence:t.sequence,witness:t.witness}))),t.outs=this.outs.map((t=>({script:t.script,value:t.value}))),t}hashForSignature(t,e,r){if(pi(hi.tuple(hi.UInt32,hi.Buffer,hi.Number),arguments),t>=this.ins.length)return gi;const n=ci.compile(ci.decompile(e).filter((t=>t!==fi.OPS.OP_CODESEPARATOR))),i=this.clone();if((31&r)===Ei.SIGHASH_NONE)i.outs=[],i.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}));else if((31&r)===Ei.SIGHASH_SINGLE){if(t>=this.outs.length)return gi;i.outs.length=t+1;for(let e=0;e<t;e++)i.outs[e]=mi;i.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}))}r&Ei.SIGHASH_ANYONECANPAY?(i.ins=[i.ins[t]],i.ins[0].script=n):(i.ins.forEach((t=>{t.script=di})),i.ins[t].script=n);const o=Buffer.allocUnsafe(i.byteLength(!1)+4);return o.writeInt32LE(r,o.length-4),i.__toBuffer(o,0,!1),ui.hash256(o)}hashForWitnessV1(t,e,r,n,i,o){if(pi(hi.tuple(hi.UInt32,pi.arrayOf(hi.Buffer),pi.arrayOf(hi.Satoshi),hi.UInt32),arguments),r.length!==this.ins.length||e.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const s=n===Ei.SIGHASH_DEFAULT?Ei.SIGHASH_ALL:n&Ei.SIGHASH_OUTPUT_MASK,a=(n&Ei.SIGHASH_INPUT_MASK)===Ei.SIGHASH_ANYONECANPAY,u=s===Ei.SIGHASH_NONE,c=s===Ei.SIGHASH_SINGLE;let f=di,h=di,p=di,l=di,d=di;if(!a){let t=ai.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach((e=>{t.writeSlice(e.hash),t.writeUInt32(e.index)})),f=ui.sha256(t.end()),t=ai.BufferWriter.withCapacity(8*this.ins.length),r.forEach((e=>t.writeUInt64(e))),h=ui.sha256(t.end()),t=ai.BufferWriter.withCapacity(e.map(li).reduce(((t,e)=>t+e))),e.forEach((e=>t.writeVarSlice(e))),p=ui.sha256(t.end()),t=ai.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach((e=>t.writeUInt32(e.sequence))),l=ui.sha256(t.end())}if(u||c){if(c&&t<this.outs.length){const e=this.outs[t],r=ai.BufferWriter.withCapacity(8+li(e.script));r.writeUInt64(e.value),r.writeVarSlice(e.script),d=ui.sha256(r.end())}}else{const t=this.outs.map((t=>8+li(t.script))).reduce(((t,e)=>t+e)),e=ai.BufferWriter.withCapacity(t);this.outs.forEach((t=>{e.writeUInt64(t.value),e.writeVarSlice(t.script)})),d=ui.sha256(e.end())}const y=(i?2:0)+(o?1:0),w=174-(a?49:0)-(u?32:0)+(o?32:0)+(i?37:0),g=ai.BufferWriter.withCapacity(w);if(g.writeUInt8(n),g.writeInt32(this.version),g.writeUInt32(this.locktime),g.writeSlice(f),g.writeSlice(h),g.writeSlice(p),g.writeSlice(l),u||c||g.writeSlice(d),g.writeUInt8(y),a){const n=this.ins[t];g.writeSlice(n.hash),g.writeUInt32(n.index),g.writeUInt64(r[t]),g.writeVarSlice(e[t]),g.writeUInt32(n.sequence)}else g.writeUInt32(t);if(o){const t=ai.BufferWriter.withCapacity(li(o));t.writeVarSlice(o),g.writeSlice(ui.sha256(t.end()))}return c&&g.writeSlice(d),i&&(g.writeSlice(i),g.writeUInt8(0),g.writeUInt32(4294967295)),ui.taggedHash("TapSighash",Buffer.concat([Buffer.from([0]),g.end()]))}hashForWitnessV0(t,e,r,n){pi(hi.tuple(hi.UInt32,hi.Buffer,hi.Satoshi,hi.UInt32),arguments);let i,o=Buffer.from([]),s=wi,a=wi,u=wi;if(n&Ei.SIGHASH_ANYONECANPAY||(o=Buffer.allocUnsafe(36*this.ins.length),i=new ai.BufferWriter(o,0),this.ins.forEach((t=>{i.writeSlice(t.hash),i.writeUInt32(t.index)})),a=ui.hash256(o)),n&Ei.SIGHASH_ANYONECANPAY||(31&n)===Ei.SIGHASH_SINGLE||(31&n)===Ei.SIGHASH_NONE||(o=Buffer.allocUnsafe(4*this.ins.length),i=new ai.BufferWriter(o,0),this.ins.forEach((t=>{i.writeUInt32(t.sequence)})),u=ui.hash256(o)),(31&n)!==Ei.SIGHASH_SINGLE&&(31&n)!==Ei.SIGHASH_NONE){const t=this.outs.reduce(((t,e)=>t+8+li(e.script)),0);o=Buffer.allocUnsafe(t),i=new ai.BufferWriter(o,0),this.outs.forEach((t=>{i.writeUInt64(t.value),i.writeVarSlice(t.script)})),s=ui.hash256(o)}else if((31&n)===Ei.SIGHASH_SINGLE&&t<this.outs.length){const e=this.outs[t];o=Buffer.allocUnsafe(8+li(e.script)),i=new ai.BufferWriter(o,0),i.writeUInt64(e.value),i.writeVarSlice(e.script),s=ui.hash256(o)}o=Buffer.allocUnsafe(156+li(e)),i=new ai.BufferWriter(o,0);const c=this.ins[t];return i.writeInt32(this.version),i.writeSlice(a),i.writeSlice(u),i.writeSlice(c.hash),i.writeUInt32(c.index),i.writeVarSlice(e),i.writeUInt64(r),i.writeUInt32(c.sequence),i.writeSlice(s),i.writeUInt32(this.locktime),i.writeUInt32(n),ui.hash256(o)}getHash(t){return t&&this.isCoinbase()?Buffer.alloc(32,0):ui.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return(0,ai.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(t,e){return this.__toBuffer(t,e,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,e){pi(hi.tuple(hi.Number,hi.Buffer),arguments),this.ins[t].script=e}setWitness(t,e){pi(hi.tuple(hi.Number,[hi.Buffer]),arguments),this.ins[t].witness=e}__toBuffer(t,e,r=!1){t||(t=Buffer.allocUnsafe(this.byteLength(r)));const n=new ai.BufferWriter(t,e||0);n.writeInt32(this.version);const i=r&&this.hasWitnesses();return i&&(n.writeUInt8(Ei.ADVANCED_TRANSACTION_MARKER),n.writeUInt8(Ei.ADVANCED_TRANSACTION_FLAG)),n.writeVarInt(this.ins.length),this.ins.forEach((t=>{n.writeSlice(t.hash),n.writeUInt32(t.index),n.writeVarSlice(t.script),n.writeUInt32(t.sequence)})),n.writeVarInt(this.outs.length),this.outs.forEach((t=>{void 0!==t.value?n.writeUInt64(t.value):n.writeSlice(t.valueBuffer),n.writeVarSlice(t.script)})),i&&this.ins.forEach((t=>{n.writeVector(t.witness)})),n.writeUInt32(this.locktime),void 0!==e?t.slice(e,n.offset):t}}si.Transaction=Ei,Ei.DEFAULT_SEQUENCE=4294967295,Ei.SIGHASH_DEFAULT=0,Ei.SIGHASH_ALL=1,Ei.SIGHASH_NONE=2,Ei.SIGHASH_SINGLE=3,Ei.SIGHASH_ANYONECANPAY=128,Ei.SIGHASH_OUTPUT_MASK=3,Ei.SIGHASH_INPUT_MASK=128,Ei.ADVANCED_TRANSACTION_MARKER=0,Ei.ADVANCED_TRANSACTION_FLAG=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.Block=void 0;const vi=Mn,Si=qe,Ti=oi,Oi=si,Pi=Xt,{typeforce:_i}=Pi,Ii=new TypeError("Cannot compute merkle root for zero transactions"),ki=new TypeError("Cannot compute witness commit for non-segwit block");class Ai{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");const e=new vi.BufferReader(t),r=new Ai;if(r.version=e.readInt32(),r.prevHash=e.readSlice(32),r.merkleRoot=e.readSlice(32),r.timestamp=e.readUInt32(),r.bits=e.readUInt32(),r.nonce=e.readUInt32(),80===t.length)return r;const n=()=>{const t=Oi.Transaction.fromBuffer(e.buffer.slice(e.offset),!0);return e.offset+=t.byteLength(),t},i=e.readVarInt();r.transactions=[];for(let t=0;t<i;++t){const t=n();r.transactions.push(t)}const o=r.getWitnessCommit();return o&&(r.witnessCommit=o),r}static fromHex(t){return Ai.fromBuffer(Buffer.from(t,"hex"))}static calculateTarget(t){const e=((4278190080&t)>>24)-3,r=8388607&t,n=Buffer.alloc(32,0);return n.writeUIntBE(r,29-e,3),n}static calculateMerkleRoot(t,e){if(_i([{getHash:Pi.Function}],t),0===t.length)throw Ii;if(e&&!Bi(t))throw ki;const r=t.map((t=>t.getHash(e))),n=(0,Ti.fastMerkleRoot)(r,Si.hash256);return e?Si.hash256(Buffer.concat([n,t[0].ins[0].witness[0]])):n}getWitnessCommit(){if(!Bi(this.transactions))return null;const t=this.transactions[0].outs.filter((t=>t.script.slice(0,6).equals(Buffer.from("6a24aa21a9ed","hex")))).map((t=>t.script.slice(6,38)));if(0===t.length)return null;const e=t[t.length-1];return e instanceof Buffer&&32===e.length?e:null}hasWitnessCommit(){return this.witnessCommit instanceof Buffer&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(t=this.transactions)instanceof Array&&t.some((t=>"object"==typeof t&&t.ins instanceof Array&&t.ins.some((t=>"object"==typeof t&&t.witness instanceof Array&&t.witness.length>0))));var t}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(t,e=!0){return t||!this.transactions?80:80+vi.varuint.encodingLength(this.transactions.length)+this.transactions.reduce(((t,r)=>t+r.byteLength(e)),0)}getHash(){return Si.hash256(this.toBuffer(!0))}getId(){return(0,vi.reverseBuffer)(this.getHash()).toString("hex")}getUTCDate(){const t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(t){const e=Buffer.allocUnsafe(this.byteLength(t)),r=new vi.BufferWriter(e);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),t||!this.transactions||(vi.varuint.encode(this.transactions.length,e,r.offset),r.offset+=vi.varuint.encode.bytes,this.transactions.forEach((t=>{const n=t.byteLength();t.toBuffer(e,r.offset),r.offset+=n}))),e}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){const t=this.hasWitnessCommit();return!(!t&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!t||this.__checkWitnessCommit()))}checkProofOfWork(){const t=(0,vi.reverseBuffer)(this.getHash()),e=Ai.calculateTarget(this.bits);return t.compare(e)<=0}__checkMerkleRoot(){if(!this.transactions)throw Ii;const t=Ai.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(t)}__checkWitnessCommit(){if(!this.transactions)throw Ii;if(!this.hasWitnessCommit())throw ki;const t=Ai.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(t)}}function Bi(t){return t instanceof Array&&t[0]&&t[0].ins&&t[0].ins instanceof Array&&t[0].ins[0]&&t[0].ins[0].witness&&t[0].ins[0].witness instanceof Array&&t[0].ins[0].witness.length>0}ii.Block=Ai;var xi={},Ui={},Ci={},Ni={},Ri={},Li={},Hi={};!function(t){var e,r,n;Object.defineProperty(t,"__esModule",{value:!0}),(e=t.GlobalTypes||(t.GlobalTypes={}))[e.UNSIGNED_TX=0]="UNSIGNED_TX",e[e.GLOBAL_XPUB=1]="GLOBAL_XPUB",t.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],(r=t.InputTypes||(t.InputTypes={}))[r.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",r[r.WITNESS_UTXO=1]="WITNESS_UTXO",r[r.PARTIAL_SIG=2]="PARTIAL_SIG",r[r.SIGHASH_TYPE=3]="SIGHASH_TYPE",r[r.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",r[r.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",r[r.BIP32_DERIVATION=6]="BIP32_DERIVATION",r[r.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",r[r.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",r[r.POR_COMMITMENT=9]="POR_COMMITMENT",r[r.TAP_KEY_SIG=19]="TAP_KEY_SIG",r[r.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",r[r.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",r[r.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",r[r.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",r[r.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT",t.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],(n=t.OutputTypes||(t.OutputTypes={}))[n.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",n[n.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",n[n.BIP32_DERIVATION=2]="BIP32_DERIVATION",n[n.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",n[n.TAP_TREE=6]="TAP_TREE",n[n.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION",t.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]}(Hi);var Di={};Object.defineProperty(Di,"__esModule",{value:!0});const Mi=Hi;Di.decode=function(t){if(t.key[0]!==Mi.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+t.key.toString("hex"));if(79!==t.key.length||![2,3].includes(t.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+t.key.toString("hex"));if(t.value.length/4%1!=0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const e=t.key.slice(1),r={masterFingerprint:t.value.slice(0,4),extendedPubkey:e,path:"m"};for(const e of(t=>[...Array(t).keys()])(t.value.length/4-1)){const n=t.value.readUInt32LE(4*e+4),i=!!(2147483648&n),o=2147483647&n;r.path+="/"+o.toString(10)+(i?"'":"")}return r},Di.encode=function(t){const e=Buffer.from([Mi.GlobalTypes.GLOBAL_XPUB]),r=Buffer.concat([e,t.extendedPubkey]),n=t.path.split("/"),i=Buffer.allocUnsafe(4*n.length);t.masterFingerprint.copy(i,0);let o=4;return n.slice(1).forEach((t=>{const e="'"===t.slice(-1);let r=2147483647&parseInt(e?t.slice(0,-1):t,10);e&&(r+=2147483648),i.writeUInt32LE(r,o),o+=4})),{key:r,value:i}},Di.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",Di.check=function(t){const e=t.extendedPubkey,r=t.masterFingerprint,n=t.path;return Buffer.isBuffer(e)&&78===e.length&&[2,3].indexOf(e[45])>-1&&Buffer.isBuffer(r)&&4===r.length&&"string"==typeof n&&!!n.match(/^m(\/\d+'?)*$/)},Di.canAddToArray=function(t,e,r){const n=e.extendedPubkey.toString("hex");return!r.has(n)&&(r.add(n),0===t.filter((t=>t.extendedPubkey.equals(e.extendedPubkey))).length)};var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});const ji=Hi;Fi.encode=function(t){return{key:Buffer.from([ji.GlobalTypes.UNSIGNED_TX]),value:t.toBuffer()}};var Ki={};Object.defineProperty(Ki,"__esModule",{value:!0});const $i=Hi;Ki.decode=function(t){if(t.key[0]!==$i.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+t.key.toString("hex"));return t.value},Ki.encode=function(t){return{key:Buffer.from([$i.InputTypes.FINAL_SCRIPTSIG]),value:t}},Ki.expected="Buffer",Ki.check=function(t){return Buffer.isBuffer(t)},Ki.canAdd=function(t,e){return!!t&&!!e&&void 0===t.finalScriptSig};var Vi={};Object.defineProperty(Vi,"__esModule",{value:!0});const Wi=Hi;Vi.decode=function(t){if(t.key[0]!==Wi.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+t.key.toString("hex"));return t.value},Vi.encode=function(t){return{key:Buffer.from([Wi.InputTypes.FINAL_SCRIPTWITNESS]),value:t}},Vi.expected="Buffer",Vi.check=function(t){return Buffer.isBuffer(t)},Vi.canAdd=function(t,e){return!!t&&!!e&&void 0===t.finalScriptWitness};var qi={};Object.defineProperty(qi,"__esModule",{value:!0});const zi=Hi;qi.decode=function(t){if(t.key[0]!==zi.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+t.key.toString("hex"));return t.value},qi.encode=function(t){return{key:Buffer.from([zi.InputTypes.NON_WITNESS_UTXO]),value:t}},qi.expected="Buffer",qi.check=function(t){return Buffer.isBuffer(t)},qi.canAdd=function(t,e){return!!t&&!!e&&void 0===t.nonWitnessUtxo};var Gi={};Object.defineProperty(Gi,"__esModule",{value:!0});const Yi=Hi;Gi.decode=function(t){if(t.key[0]!==Yi.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+t.key.toString("hex"));if(34!==t.key.length&&66!==t.key.length||![2,3,4].includes(t.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+t.key.toString("hex"));return{pubkey:t.key.slice(1),signature:t.value}},Gi.encode=function(t){const e=Buffer.from([Yi.InputTypes.PARTIAL_SIG]);return{key:Buffer.concat([e,t.pubkey]),value:t.signature}},Gi.expected="{ pubkey: Buffer; signature: Buffer; }",Gi.check=function(t){return Buffer.isBuffer(t.pubkey)&&Buffer.isBuffer(t.signature)&&[33,65].includes(t.pubkey.length)&&[2,3,4].includes(t.pubkey[0])&&function(t){if(!Buffer.isBuffer(t)||t.length<9)return!1;if(48!==t[0])return!1;if(t.length!==t[1]+3)return!1;if(2!==t[2])return!1;const e=t[3];if(e>33||e<1)return!1;if(2!==t[3+e+1])return!1;const r=t[3+e+2];return!(r>33||r<1)&&t.length===3+e+2+r+2}(t.signature)},Gi.canAddToArray=function(t,e,r){const n=e.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===t.filter((t=>t.pubkey.equals(e.pubkey))).length)};var Xi={};Object.defineProperty(Xi,"__esModule",{value:!0});const Qi=Hi;Xi.decode=function(t){if(t.key[0]!==Qi.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+t.key.toString("hex"));return t.value.toString("utf8")},Xi.encode=function(t){return{key:Buffer.from([Qi.InputTypes.POR_COMMITMENT]),value:Buffer.from(t,"utf8")}},Xi.expected="string",Xi.check=function(t){return"string"==typeof t},Xi.canAdd=function(t,e){return!!t&&!!e&&void 0===t.porCommitment};var Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});const Ji=Hi;Zi.decode=function(t){if(t.key[0]!==Ji.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+t.key.toString("hex"));return t.value.readUInt32LE(0)},Zi.encode=function(t){const e=Buffer.from([Ji.InputTypes.SIGHASH_TYPE]),r=Buffer.allocUnsafe(4);return r.writeUInt32LE(t,0),{key:e,value:r}},Zi.expected="number",Zi.check=function(t){return"number"==typeof t},Zi.canAdd=function(t,e){return!!t&&!!e&&void 0===t.sighashType};var to={};Object.defineProperty(to,"__esModule",{value:!0});const eo=Hi;function ro(t){return Buffer.isBuffer(t)&&(64===t.length||65===t.length)}to.decode=function(t){if(t.key[0]!==eo.InputTypes.TAP_KEY_SIG||1!==t.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+t.key.toString("hex"));if(!ro(t.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return t.value},to.encode=function(t){return{key:Buffer.from([eo.InputTypes.TAP_KEY_SIG]),value:t}},to.expected="Buffer",to.check=ro,to.canAdd=function(t,e){return!!t&&!!e&&void 0===t.tapKeySig};var no={};Object.defineProperty(no,"__esModule",{value:!0});const io=Hi;no.decode=function(t){if(t.key[0]!==io.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+t.key.toString("hex"));if((t.key.length-2)%32!=0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+t.key.toString("hex"));const e=t.value[t.value.length-1];if((254&t.key[1])!==e)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+t.key.toString("hex"));const r=t.value.slice(0,-1);return{controlBlock:t.key.slice(1),script:r,leafVersion:e}},no.encode=function(t){const e=Buffer.from([io.InputTypes.TAP_LEAF_SCRIPT]),r=Buffer.from([t.leafVersion]);return{key:Buffer.concat([e,t.controlBlock]),value:Buffer.concat([t.script,r])}},no.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",no.check=function(t){return Buffer.isBuffer(t.controlBlock)&&(t.controlBlock.length-1)%32==0&&(254&t.controlBlock[0])===t.leafVersion&&Buffer.isBuffer(t.script)},no.canAddToArray=function(t,e,r){const n=e.controlBlock.toString("hex");return!r.has(n)&&(r.add(n),0===t.filter((t=>t.controlBlock.equals(e.controlBlock))).length)};var oo={};Object.defineProperty(oo,"__esModule",{value:!0});const so=Hi;function ao(t){return Buffer.isBuffer(t)&&32===t.length}oo.decode=function(t){if(t.key[0]!==so.InputTypes.TAP_MERKLE_ROOT||1!==t.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+t.key.toString("hex"));if(!ao(t.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return t.value},oo.encode=function(t){return{key:Buffer.from([so.InputTypes.TAP_MERKLE_ROOT]),value:t}},oo.expected="Buffer",oo.check=ao,oo.canAdd=function(t,e){return!!t&&!!e&&void 0===t.tapMerkleRoot};var uo={};Object.defineProperty(uo,"__esModule",{value:!0});const co=Hi;uo.decode=function(t){if(t.key[0]!==co.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+t.key.toString("hex"));if(65!==t.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+t.key.toString("hex"));if(64!==t.value.length&&65!==t.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+t.key.toString("hex"));return{pubkey:t.key.slice(1,33),leafHash:t.key.slice(33),signature:t.value}},uo.encode=function(t){const e=Buffer.from([co.InputTypes.TAP_SCRIPT_SIG]);return{key:Buffer.concat([e,t.pubkey,t.leafHash]),value:t.signature}},uo.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",uo.check=function(t){return Buffer.isBuffer(t.pubkey)&&Buffer.isBuffer(t.leafHash)&&Buffer.isBuffer(t.signature)&&32===t.pubkey.length&&32===t.leafHash.length&&(64===t.signature.length||65===t.signature.length)},uo.canAddToArray=function(t,e,r){const n=e.pubkey.toString("hex")+e.leafHash.toString("hex");return!r.has(n)&&(r.add(n),0===t.filter((t=>t.pubkey.equals(e.pubkey)&&t.leafHash.equals(e.leafHash))).length)};var fo={},ho={},po={};Object.defineProperty(po,"__esModule",{value:!0});const lo=9007199254740991;function yo(t){if(t<0||t>lo||t%1!=0)throw new RangeError("value out of range")}function wo(t){return yo(t),t<253?1:t<=65535?3:t<=4294967295?5:9}po.encode=function t(e,r,n){if(yo(e),r||(r=Buffer.allocUnsafe(wo(e))),!Buffer.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return n||(n=0),e<253?(r.writeUInt8(e,n),Object.assign(t,{bytes:1})):e<=65535?(r.writeUInt8(253,n),r.writeUInt16LE(e,n+1),Object.assign(t,{bytes:3})):e<=4294967295?(r.writeUInt8(254,n),r.writeUInt32LE(e,n+1),Object.assign(t,{bytes:5})):(r.writeUInt8(255,n),r.writeUInt32LE(e>>>0,n+1),r.writeUInt32LE(e/4294967296|0,n+5),Object.assign(t,{bytes:9})),r},po.decode=function t(e,r){if(!Buffer.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");r||(r=0);const n=e.readUInt8(r);if(n<253)return Object.assign(t,{bytes:1}),n;if(253===n)return Object.assign(t,{bytes:3}),e.readUInt16LE(r+1);if(254===n)return Object.assign(t,{bytes:5}),e.readUInt32LE(r+1);{Object.assign(t,{bytes:9});const n=e.readUInt32LE(r+1),i=4294967296*e.readUInt32LE(r+5)+n;return yo(i),i}},po.encodingLength=wo,Object.defineProperty(ho,"__esModule",{value:!0});const go=po;function bo(t){const e=t.key.length,r=t.value.length,n=go.encodingLength(e),i=go.encodingLength(r),o=Buffer.allocUnsafe(n+e+i+r);return go.encode(e,o,0),t.key.copy(o,n),go.encode(r,o,n+e),t.value.copy(o,n+e+i),o}function mo(t,e){if("number"!=typeof t)throw new Error("cannot write a non-number as a number");if(t<0)throw new Error("specified a negative value for writing an unsigned value");if(t>e)throw new Error("RangeError: value out of range");if(Math.floor(t)!==t)throw new Error("value has a fractional component")}ho.range=t=>[...Array(t).keys()],ho.reverseBuffer=function(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t},ho.keyValsToBuffer=function(t){const e=t.map(bo);return e.push(Buffer.from([0])),Buffer.concat(e)},ho.keyValToBuffer=bo,ho.readUInt64LE=function(t,e){const r=t.readUInt32LE(e);let n=t.readUInt32LE(e+4);return n*=4294967296,mo(n+r,9007199254740991),n+r},ho.writeUInt64LE=function(t,e,r){return mo(e,9007199254740991),t.writeInt32LE(-1&e,r),t.writeUInt32LE(Math.floor(e/4294967296),r+4),r+8},Object.defineProperty(fo,"__esModule",{value:!0});const Eo=Hi,vo=ho,So=po;fo.decode=function(t){if(t.key[0]!==Eo.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+t.key.toString("hex"));const e=vo.readUInt64LE(t.value,0);let r=8;const n=So.decode(t.value,r);r+=So.encodingLength(n);const i=t.value.slice(r);if(i.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:i,value:e}},fo.encode=function(t){const{script:e,value:r}=t,n=So.encodingLength(e.length),i=Buffer.allocUnsafe(8+n+e.length);return vo.writeUInt64LE(i,r,0),So.encode(e.length,i,8),e.copy(i,8+n),{key:Buffer.from([Eo.InputTypes.WITNESS_UTXO]),value:i}},fo.expected="{ script: Buffer; value: number; }",fo.check=function(t){return Buffer.isBuffer(t.script)&&"number"==typeof t.value},fo.canAdd=function(t,e){return!!t&&!!e&&void 0===t.witnessUtxo};var To={};Object.defineProperty(To,"__esModule",{value:!0});const Oo=Hi,Po=po;To.decode=function(t){if(t.key[0]!==Oo.OutputTypes.TAP_TREE||1!==t.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+t.key.toString("hex"));let e=0;const r=[];for(;e<t.value.length;){const n=t.value[e++],i=t.value[e++],o=Po.decode(t.value,e);e+=Po.encodingLength(o),r.push({depth:n,leafVersion:i,script:t.value.slice(e,e+o)}),e+=o}return{leaves:r}},To.encode=function(t){const e=Buffer.from([Oo.OutputTypes.TAP_TREE]),r=[].concat(...t.leaves.map((t=>[Buffer.of(t.depth,t.leafVersion),Po.encode(t.script.length),t.script])));return{key:e,value:Buffer.concat(r)}},To.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",To.check=function(t){return Array.isArray(t.leaves)&&t.leaves.every((t=>t.depth>=0&&t.depth<=128&&(254&t.leafVersion)===t.leafVersion&&Buffer.isBuffer(t.script)))},To.canAdd=function(t,e){return!!t&&!!e&&void 0===t.tapTree};var _o={};Object.defineProperty(_o,"__esModule",{value:!0});const Io=t=>33===t.length&&[2,3].includes(t[0])||65===t.length&&4===t[0];_o.makeConverter=function(t,e=Io){return{decode:function(r){if(r.key[0]!==t)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+r.key.toString("hex"));const n=r.key.slice(1);if(!e(n))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+r.key.toString("hex"));if(r.value.length/4%1!=0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const i={masterFingerprint:r.value.slice(0,4),pubkey:n,path:"m"};for(const t of(t=>[...Array(t).keys()])(r.value.length/4-1)){const e=r.value.readUInt32LE(4*t+4),n=!!(2147483648&e),o=2147483647&e;i.path+="/"+o.toString(10)+(n?"'":"")}return i},encode:function(e){const r=Buffer.from([t]),n=Buffer.concat([r,e.pubkey]),i=e.path.split("/"),o=Buffer.allocUnsafe(4*i.length);e.masterFingerprint.copy(o,0);let s=4;return i.slice(1).forEach((t=>{const e="'"===t.slice(-1);let r=2147483647&parseInt(e?t.slice(0,-1):t,10);e&&(r+=2147483648),o.writeUInt32LE(r,s),s+=4})),{key:n,value:o}},check:function(t){return Buffer.isBuffer(t.pubkey)&&Buffer.isBuffer(t.masterFingerprint)&&"string"==typeof t.path&&e(t.pubkey)&&4===t.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(t,e,r){const n=e.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===t.filter((t=>t.pubkey.equals(e.pubkey))).length)}}};var ko={};Object.defineProperty(ko,"__esModule",{value:!0}),ko.makeChecker=function(t){return function(e){let r;if(t.includes(e.key[0])&&(r=e.key.slice(1),33!==r.length&&65!==r.length||![2,3,4].includes(r[0])))throw new Error("Format Error: invalid pubkey in key 0x"+e.key.toString("hex"));return r}};var Ao={};Object.defineProperty(Ao,"__esModule",{value:!0}),Ao.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t)throw new Error("Decode Error: could not decode redeemScript with key 0x"+e.key.toString("hex"));return e.value},encode:function(e){return{key:Buffer.from([t]),value:e}},check:function(t){return Buffer.isBuffer(t)},expected:"Buffer",canAdd:function(t,e){return!!t&&!!e&&void 0===t.redeemScript}}};var Bo={};Object.defineProperty(Bo,"__esModule",{value:!0});const xo=po,Uo=_o,Co=t=>32===t.length;Bo.makeConverter=function(t){const e=Uo.makeConverter(t,Co);return{decode:function(t){const r=xo.decode(t.value),n=xo.encodingLength(r),i=e.decode({key:t.key,value:t.value.slice(n+32*r)}),o=new Array(r);for(let e=0,i=n;e<r;e++,i+=32)o[e]=t.value.slice(i,i+32);return Object.assign({},i,{leafHashes:o})},encode:function(t){const r=e.encode(t),n=xo.encodingLength(t.leafHashes.length),i=Buffer.allocUnsafe(n);xo.encode(t.leafHashes.length,i);const o=Buffer.concat([i,...t.leafHashes,r.value]);return Object.assign({},r,{value:o})},check:function(t){return Array.isArray(t.leafHashes)&&t.leafHashes.every((t=>Buffer.isBuffer(t)&&32===t.length))&&e.check(t)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:e.canAddToArray}};var No={};Object.defineProperty(No,"__esModule",{value:!0}),No.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t||1!==e.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+e.key.toString("hex"));if(32!==e.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return e.value},encode:function(e){return{key:Buffer.from([t]),value:e}},check:function(t){return Buffer.isBuffer(t)&&32===t.length},expected:"Buffer",canAdd:function(t,e){return!!t&&!!e&&void 0===t.tapInternalKey}}};var Ro={};Object.defineProperty(Ro,"__esModule",{value:!0}),Ro.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t)throw new Error("Decode Error: could not decode witnessScript with key 0x"+e.key.toString("hex"));return e.value},encode:function(e){return{key:Buffer.from([t]),value:e}},check:function(t){return Buffer.isBuffer(t)},expected:"Buffer",canAdd:function(t,e){return!!t&&!!e&&void 0===t.witnessScript}}},Object.defineProperty(Li,"__esModule",{value:!0});const Lo=Hi,Ho=Ki,Do=Vi,Mo=qi,Fo=Gi,jo=Xi,Ko=Zi,$o=to,Vo=no,Wo=oo,qo=uo,zo=fo,Go=To,Yo=_o,Xo=ko,Qo=Ao,Zo=Bo,Jo=No,ts=Ro,es={unsignedTx:Fi,globalXpub:Di,checkPubkey:Xo.makeChecker([])};Li.globals=es;const rs={nonWitnessUtxo:Mo,partialSig:Fo,sighashType:Ko,finalScriptSig:Ho,finalScriptWitness:Do,porCommitment:jo,witnessUtxo:zo,bip32Derivation:Yo.makeConverter(Lo.InputTypes.BIP32_DERIVATION),redeemScript:Qo.makeConverter(Lo.InputTypes.REDEEM_SCRIPT),witnessScript:ts.makeConverter(Lo.InputTypes.WITNESS_SCRIPT),checkPubkey:Xo.makeChecker([Lo.InputTypes.PARTIAL_SIG,Lo.InputTypes.BIP32_DERIVATION]),tapKeySig:$o,tapScriptSig:qo,tapLeafScript:Vo,tapBip32Derivation:Zo.makeConverter(Lo.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:Jo.makeConverter(Lo.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:Wo};Li.inputs=rs;const ns={bip32Derivation:Yo.makeConverter(Lo.OutputTypes.BIP32_DERIVATION),redeemScript:Qo.makeConverter(Lo.OutputTypes.REDEEM_SCRIPT),witnessScript:ts.makeConverter(Lo.OutputTypes.WITNESS_SCRIPT),checkPubkey:Xo.makeChecker([Lo.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:Zo.makeConverter(Lo.OutputTypes.TAP_BIP32_DERIVATION),tapTree:Go,tapInternalKey:Jo.makeConverter(Lo.OutputTypes.TAP_INTERNAL_KEY)};Li.outputs=ns,Object.defineProperty(Ri,"__esModule",{value:!0});const is=Li,os=ho,ss=po,as=Hi;function us(t,e,r){if(!e.equals(Buffer.from([r])))throw new Error(`Format Error: Invalid ${t} key: ${e.toString("hex")}`)}function cs(t,{globalMapKeyVals:e,inputKeyVals:r,outputKeyVals:n}){const i={unsignedTx:t};let o=0;for(const t of e)switch(t.key[0]){case as.GlobalTypes.UNSIGNED_TX:if(us("global",t.key,as.GlobalTypes.UNSIGNED_TX),o>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");o++;break;case as.GlobalTypes.GLOBAL_XPUB:void 0===i.globalXpub&&(i.globalXpub=[]),i.globalXpub.push(is.globals.globalXpub.decode(t));break;default:i.unknownKeyVals||(i.unknownKeyVals=[]),i.unknownKeyVals.push(t)}const s=r.length,a=n.length,u=[],c=[];for(const t of os.range(s)){const e={};for(const n of r[t])switch(is.inputs.checkPubkey(n),n.key[0]){case as.InputTypes.NON_WITNESS_UTXO:if(us("input",n.key,as.InputTypes.NON_WITNESS_UTXO),void 0!==e.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");e.nonWitnessUtxo=is.inputs.nonWitnessUtxo.decode(n);break;case as.InputTypes.WITNESS_UTXO:if(us("input",n.key,as.InputTypes.WITNESS_UTXO),void 0!==e.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");e.witnessUtxo=is.inputs.witnessUtxo.decode(n);break;case as.InputTypes.PARTIAL_SIG:void 0===e.partialSig&&(e.partialSig=[]),e.partialSig.push(is.inputs.partialSig.decode(n));break;case as.InputTypes.SIGHASH_TYPE:if(us("input",n.key,as.InputTypes.SIGHASH_TYPE),void 0!==e.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");e.sighashType=is.inputs.sighashType.decode(n);break;case as.InputTypes.REDEEM_SCRIPT:if(us("input",n.key,as.InputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");e.redeemScript=is.inputs.redeemScript.decode(n);break;case as.InputTypes.WITNESS_SCRIPT:if(us("input",n.key,as.InputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");e.witnessScript=is.inputs.witnessScript.decode(n);break;case as.InputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(is.inputs.bip32Derivation.decode(n));break;case as.InputTypes.FINAL_SCRIPTSIG:us("input",n.key,as.InputTypes.FINAL_SCRIPTSIG),e.finalScriptSig=is.inputs.finalScriptSig.decode(n);break;case as.InputTypes.FINAL_SCRIPTWITNESS:us("input",n.key,as.InputTypes.FINAL_SCRIPTWITNESS),e.finalScriptWitness=is.inputs.finalScriptWitness.decode(n);break;case as.InputTypes.POR_COMMITMENT:us("input",n.key,as.InputTypes.POR_COMMITMENT),e.porCommitment=is.inputs.porCommitment.decode(n);break;case as.InputTypes.TAP_KEY_SIG:us("input",n.key,as.InputTypes.TAP_KEY_SIG),e.tapKeySig=is.inputs.tapKeySig.decode(n);break;case as.InputTypes.TAP_SCRIPT_SIG:void 0===e.tapScriptSig&&(e.tapScriptSig=[]),e.tapScriptSig.push(is.inputs.tapScriptSig.decode(n));break;case as.InputTypes.TAP_LEAF_SCRIPT:void 0===e.tapLeafScript&&(e.tapLeafScript=[]),e.tapLeafScript.push(is.inputs.tapLeafScript.decode(n));break;case as.InputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(is.inputs.tapBip32Derivation.decode(n));break;case as.InputTypes.TAP_INTERNAL_KEY:us("input",n.key,as.InputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=is.inputs.tapInternalKey.decode(n);break;case as.InputTypes.TAP_MERKLE_ROOT:us("input",n.key,as.InputTypes.TAP_MERKLE_ROOT),e.tapMerkleRoot=is.inputs.tapMerkleRoot.decode(n);break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(n)}u.push(e)}for(const t of os.range(a)){const e={};for(const r of n[t])switch(is.outputs.checkPubkey(r),r.key[0]){case as.OutputTypes.REDEEM_SCRIPT:if(us("output",r.key,as.OutputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");e.redeemScript=is.outputs.redeemScript.decode(r);break;case as.OutputTypes.WITNESS_SCRIPT:if(us("output",r.key,as.OutputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");e.witnessScript=is.outputs.witnessScript.decode(r);break;case as.OutputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(is.outputs.bip32Derivation.decode(r));break;case as.OutputTypes.TAP_INTERNAL_KEY:us("output",r.key,as.OutputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=is.outputs.tapInternalKey.decode(r);break;case as.OutputTypes.TAP_TREE:us("output",r.key,as.OutputTypes.TAP_TREE),e.tapTree=is.outputs.tapTree.decode(r);break;case as.OutputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(is.outputs.tapBip32Derivation.decode(r));break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(r)}c.push(e)}return{globalMap:i,inputs:u,outputs:c}}Ri.psbtFromBuffer=function(t,e){let r=0;function n(){const e=ss.decode(t,r);r+=ss.encodingLength(e);const n=t.slice(r,r+e);return r+=e,n}function i(){return{key:n(),value:n()}}function o(){if(r>=t.length)throw new Error("Format Error: Unexpected End of PSBT");const e=0===t.readUInt8(r);return e&&r++,e}if(1886610036!==function(){const e=t.readUInt32BE(r);return r+=4,e}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const e=t.readUInt8(r);return r+=1,e}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const s=[],a={};for(;!o();){const t=i(),e=t.key.toString("hex");if(a[e])throw new Error("Format Error: Keys must be unique for global keymap: key "+e);a[e]=1,s.push(t)}const u=s.filter((t=>t.key[0]===as.GlobalTypes.UNSIGNED_TX));if(1!==u.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const c=e(u[0].value),{inputCount:f,outputCount:h}=c.getInputOutputCounts(),p=[],l=[];for(const t of os.range(f)){const e={},r=[];for(;!o();){const n=i(),o=n.key.toString("hex");if(e[o])throw new Error("Format Error: Keys must be unique for each input: input index "+t+" key "+o);e[o]=1,r.push(n)}p.push(r)}for(const t of os.range(h)){const e={},r=[];for(;!o();){const n=i(),o=n.key.toString("hex");if(e[o])throw new Error("Format Error: Keys must be unique for each output: output index "+t+" key "+o);e[o]=1,r.push(n)}l.push(r)}return cs(c,{globalMapKeyVals:s,inputKeyVals:p,outputKeyVals:l})},Ri.checkKeyBuffer=us,Ri.psbtFromKeyVals=cs;var fs={};Object.defineProperty(fs,"__esModule",{value:!0});const hs=Li,ps=ho;fs.psbtToBuffer=function({globalMap:t,inputs:e,outputs:r}){const{globalKeyVals:n,inputKeyVals:i,outputKeyVals:o}=ys({globalMap:t,inputs:e,outputs:r}),s=ps.keyValsToBuffer(n),a=t=>0===t.length?[Buffer.from([0])]:t.map(ps.keyValsToBuffer),u=a(i),c=a(o),f=Buffer.allocUnsafe(5);return f.writeUIntBE(482972169471,0,5),Buffer.concat([f,s].concat(u,c))};const ls=(t,e)=>t.key.compare(e.key);function ds(t,e){const r=new Set,n=Object.entries(t).reduce(((t,[n,i])=>{if("unknownKeyVals"===n)return t;const o=e[n];if(void 0===o)return t;const s=(Array.isArray(i)?i:[i]).map(o.encode);return s.map((t=>t.key.toString("hex"))).forEach((t=>{if(r.has(t))throw new Error("Serialize Error: Duplicate key: "+t);r.add(t)})),t.concat(s)}),[]),i=t.unknownKeyVals?t.unknownKeyVals.filter((t=>!r.has(t.key.toString("hex")))):[];return n.concat(i).sort(ls)}function ys({globalMap:t,inputs:e,outputs:r}){return{globalKeyVals:ds(t,hs.globals),inputKeyVals:e.map((t=>ds(t,hs.inputs))),outputKeyVals:r.map((t=>ds(t,hs.outputs)))}}fs.psbtToKeyVals=ys,function(t){function e(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),e(Ri),e(fs)}(Ni),Object.defineProperty(Ci,"__esModule",{value:!0});const ws=Ni;function gs(t,e,r){return n=>{if(t.has(n))return;const i=r.filter((t=>t.key.toString("hex")===n))[0];e.push(i),t.add(n)}}function bs(t){return t.globalMap.unsignedTx}function ms(t){const e=new Set;return t.forEach((t=>{const r=t.key.toString("hex");if(e.has(r))throw new Error("Combine: KeyValue Map keys should be unique");e.add(r)})),e}Ci.combine=function(t){const e=t[0],r=ws.psbtToKeyVals(e),n=t.slice(1);if(0===n.length)throw new Error("Combine: Nothing to combine");const i=bs(e);if(void 0===i)throw new Error("Combine: Self missing transaction");const o=ms(r.globalKeyVals),s=r.inputKeyVals.map(ms),a=r.outputKeyVals.map(ms);for(const t of n){const e=bs(t);if(void 0===e||!e.toBuffer().equals(i.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const n=ws.psbtToKeyVals(t);ms(n.globalKeyVals).forEach(gs(o,r.globalKeyVals,n.globalKeyVals));n.inputKeyVals.map(ms).forEach(((t,e)=>t.forEach(gs(s[e],r.inputKeyVals[e],n.inputKeyVals[e]))));n.outputKeyVals.map(ms).forEach(((t,e)=>t.forEach(gs(a[e],r.outputKeyVals[e],n.outputKeyVals[e]))))}return ws.psbtFromKeyVals(i,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})};var Es={};!function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Li;function r(t,e){const r=t[e];if(void 0===r)throw new Error(`No input #${e}`);return r}function n(t,e){const r=t[e];if(void 0===r)throw new Error(`No output #${e}`);return r}function i(t,e,r,n){throw new Error(`Data for ${t} key ${e} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function o(t){return(r,n)=>{for(const o of Object.keys(r)){const s=r[o],{canAdd:a,canAddToArray:u,check:c,expected:f}=e[t+"s"][o]||{};if(c)if(!!u){if(!Array.isArray(s)||n[o]&&!Array.isArray(n[o]))throw new Error(`Key type ${o} must be an array`);s.every(c)||i(t,o,f,s);const e=n[o]||[],r=new Set;if(!s.every((t=>u(e,t,r))))throw new Error("Can not add duplicate data to array");n[o]=e.concat(s)}else{if(c(s)||i(t,o,f,s),!a(n,s))throw new Error(`Can not add duplicate data to ${t}`);n[o]=s}}}}t.checkForInput=r,t.checkForOutput=n,t.checkHasKey=function(t,e,r){if(t.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(e&&0!==e.filter((e=>e.key.equals(t.key))).length)throw new Error(`Duplicate Key: ${t.key.toString("hex")}`)},t.getEnumLength=function(t){let e=0;return Object.keys(t).forEach((t=>{Number(isNaN(Number(t)))&&e++})),e},t.inputCheckUncleanFinalized=function(t,e){let r=!1;if(e.nonWitnessUtxo||e.witnessUtxo){const t=!!e.redeemScript,n=!!e.witnessScript,i=!t||!!e.finalScriptSig,o=!n||!!e.finalScriptWitness,s=!!e.finalScriptSig||!!e.finalScriptWitness;r=i&&o&&s}if(!1===r)throw new Error(`Input #${t} has too much or too little data to clean`)},t.updateGlobal=o("global"),t.updateInput=o("input"),t.updateOutput=o("output"),t.addInputAttributes=function(e,n){const i=r(e,e.length-1);t.updateInput(n,i)},t.addOutputAttributes=function(e,r){const i=n(e,e.length-1);t.updateOutput(r,i)},t.defaultVersionSetter=function(t,e){if(!Buffer.isBuffer(e)||e.length<4)throw new Error("Set Version: Invalid Transaction");return e.writeUInt32LE(t,0),e},t.defaultLocktimeSetter=function(t,e){if(!Buffer.isBuffer(e)||e.length<4)throw new Error("Set Locktime: Invalid Transaction");return e.writeUInt32LE(t,e.length-4),e}}(Es),Object.defineProperty(Ui,"__esModule",{value:!0});const vs=Ci,Ss=Ni,Ts=Hi,Os=Es;Ui.Psbt=class{constructor(t){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:t}}static fromBase64(t,e){const r=Buffer.from(t,"base64");return this.fromBuffer(r,e)}static fromHex(t,e){const r=Buffer.from(t,"hex");return this.fromBuffer(r,e)}static fromBuffer(t,e){const r=Ss.psbtFromBuffer(t,e),n=new this(r.globalMap.unsignedTx);return Object.assign(n,r),n}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return Ss.psbtToBuffer(this)}updateGlobal(t){return Os.updateGlobal(t,this.globalMap),this}updateInput(t,e){const r=Os.checkForInput(this.inputs,t);return Os.updateInput(e,r),this}updateOutput(t,e){const r=Os.checkForOutput(this.outputs,t);return Os.updateOutput(e,r),this}addUnknownKeyValToGlobal(t){return Os.checkHasKey(t,this.globalMap.unknownKeyVals,Os.getEnumLength(Ts.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(t),this}addUnknownKeyValToInput(t,e){const r=Os.checkForInput(this.inputs,t);return Os.checkHasKey(e,r.unknownKeyVals,Os.getEnumLength(Ts.InputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(e),this}addUnknownKeyValToOutput(t,e){const r=Os.checkForOutput(this.outputs,t);return Os.checkHasKey(e,r.unknownKeyVals,Os.getEnumLength(Ts.OutputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(e),this}addInput(t){this.globalMap.unsignedTx.addInput(t),this.inputs.push({unknownKeyVals:[]});const e=t.unknownKeyVals||[],r=this.inputs.length-1;if(!Array.isArray(e))throw new Error("unknownKeyVals must be an Array");return e.forEach((t=>this.addUnknownKeyValToInput(r,t))),Os.addInputAttributes(this.inputs,t),this}addOutput(t){this.globalMap.unsignedTx.addOutput(t),this.outputs.push({unknownKeyVals:[]});const e=t.unknownKeyVals||[],r=this.outputs.length-1;if(!Array.isArray(e))throw new Error("unknownKeyVals must be an Array");return e.forEach((t=>this.addUnknownKeyValToOutput(r,t))),Os.addOutputAttributes(this.outputs,t),this}clearFinalizedInput(t){const e=Os.checkForInput(this.inputs,t);Os.inputCheckUncleanFinalized(t,e);for(const t of Object.keys(e))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(t)||delete e[t];return this}combine(...t){const e=vs.combine([this].concat(t));return Object.assign(this,e),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};var Ps={},_s={};Object.defineProperty(_s,"__esModule",{value:!0}),_s.signatureBlocksAction=_s.checkInputForSig=_s.pubkeyInScript=_s.pubkeyPositionInScript=_s.witnessStackToScriptWitness=_s.isP2TR=_s.isP2SHScript=_s.isP2WSHScript=_s.isP2WPKH=_s.isP2PKH=_s.isP2PK=_s.isP2MS=void 0;const Is=po,ks=Pe(),As=si,Bs=qe,xs=ri();function Us(t){return e=>{try{return t({output:e}),!0}catch(t){return!1}}}function Cs(t,e){const r=(0,Bs.hash160)(t),n=t.slice(1,33),i=ks.decompile(e);if(null===i)throw new Error("Unknown script error");return i.findIndex((e=>"number"!=typeof e&&(e.equals(t)||e.equals(r)||e.equals(n))))}function Ns(t,e,r){const{hashType:n}=e(t),i=[];n&As.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput");switch(31&n){case As.Transaction.SIGHASH_ALL:break;case As.Transaction.SIGHASH_SINGLE:case As.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}return-1===i.indexOf(r)}_s.isP2MS=Us(xs.p2ms),_s.isP2PK=Us(xs.p2pk),_s.isP2PKH=Us(xs.p2pkh),_s.isP2WPKH=Us(xs.p2wpkh),_s.isP2WSHScript=Us(xs.p2wsh),_s.isP2SHScript=Us(xs.p2sh),_s.isP2TR=Us(xs.p2tr),_s.witnessStackToScriptWitness=function(t){let e=Buffer.allocUnsafe(0);function r(t){const r=e.length,n=Is.encodingLength(t);e=Buffer.concat([e,Buffer.allocUnsafe(n)]),Is.encode(t,e,r)}function n(t){r(t.length),function(t){e=Buffer.concat([e,Buffer.from(t)])}(t)}var i;return r((i=t).length),i.forEach(n),e},_s.pubkeyPositionInScript=Cs,_s.pubkeyInScript=function(t,e){return-1!==Cs(t,e)},_s.checkInputForSig=function(t,e){const r=function(t){let e=[];if(0===(t.partialSig||[]).length){if(!t.finalScriptSig&&!t.finalScriptWitness)return[];e=function(t){const e=t.finalScriptSig&&ks.decompile(t.finalScriptSig)||[],r=t.finalScriptWitness&&ks.decompile(t.finalScriptWitness)||[];return e.concat(r).filter((t=>Buffer.isBuffer(t)&&ks.isCanonicalScriptSignature(t))).map((t=>({signature:t})))}(t)}else e=t.partialSig;return e.map((t=>t.signature))}(t);return r.some((t=>Ns(t,ks.signature.decode,e)))},_s.signatureBlocksAction=Ns,Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.checkTaprootInputForSigs=Ps.tapTreeFromList=Ps.tapTreeToList=Ps.tweakInternalPubKey=Ps.checkTaprootOutputFields=Ps.checkTaprootInputFields=Ps.isTaprootOutput=Ps.isTaprootInput=Ps.serializeTaprootSignature=Ps.tapScriptFinalizer=Ps.toXOnly=void 0;const Rs=Xt,Ls=si,Hs=_s,Ds=Dn,Ms=ri(),Fs=_s;function js(t){return t&&!!(t.tapInternalKey||t.tapMerkleRoot||t.tapLeafScript&&t.tapLeafScript.length||t.tapBip32Derivation&&t.tapBip32Derivation.length||t.witnessUtxo&&(0,Hs.isP2TR)(t.witnessUtxo.script))}function Ks(t,e){return t&&!!(t.tapInternalKey||t.tapTree||t.tapBip32Derivation&&t.tapBip32Derivation.length||e&&(0,Hs.isP2TR)(e))}function $s(t=[]){return 1===t.length&&0===t[0].depth?{output:t[0].script,version:t[0].leafVersion}:function(t){let e;for(const r of t)if(e=qs(r,e),!e)throw new Error("No room left to insert tapleaf in tree");return e}(t)}function Vs(t){return{signature:t.slice(0,64),hashType:t.slice(64)[0]||Ls.Transaction.SIGHASH_DEFAULT}}function Ws(t,e=[],r=0){if(r>Ds.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");return t?(0,Rs.isTapleaf)(t)?(e.push({depth:r,leafVersion:t.version||Ds.LEAF_VERSION_TAPSCRIPT,script:t.output}),e):(t[0]&&Ws(t[0],e,r+1),t[1]&&Ws(t[1],e,r+1),e):[]}function qs(t,e,r=0){if(r>Ds.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(t.depth===r)return e?void 0:{output:t.script,version:t.leafVersion};if((0,Rs.isTapleaf)(e))return;const n=qs(t,e&&e[0],r+1);if(n)return[n,e&&e[1]];const i=qs(t,e&&e[1],r+1);return i?[e&&e[0],i]:void 0}function zs(t,e){if(!e)return!0;const r=(0,Ds.tapleafHash)({output:t.script,version:t.leafVersion});return(0,Ds.rootHashFromPath)(t.controlBlock,r).equals(e)}function Gs(t){return t&&!!(t.redeemScript||t.witnessScript||t.bip32Derivation&&t.bip32Derivation.length)}Ps.toXOnly=t=>32===t.length?t:t.slice(1,33),Ps.tapScriptFinalizer=function(t,e,r){const n=function(t,e,r){if(!t.tapScriptSig||!t.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${e}. No tapleaf script signature provided.`);const n=(t.tapLeafScript||[]).sort(((t,e)=>t.controlBlock.length-e.controlBlock.length)).find((e=>function(t,e,r){const n=(0,Ds.tapleafHash)({output:t.script,version:t.leafVersion}),i=!r||r.equals(n);return i&&void 0!==e.find((t=>t.leafHash.equals(n)))}(e,t.tapScriptSig,r)));if(!n)throw new Error(`Can not finalize taproot input #${e}. Signature for tapleaf script not found.`);return n}(e,t,r);try{const t=function(t,e){const r=(0,Ds.tapleafHash)({output:e.script,version:e.leafVersion});return(t.tapScriptSig||[]).filter((t=>t.leafHash.equals(r))).map((t=>function(t,e){return Object.assign({positionInScript:(0,Hs.pubkeyPositionInScript)(e.pubkey,t)},e)}(e.script,t))).sort(((t,e)=>e.positionInScript-t.positionInScript)).map((t=>t.signature))}(e,n),r=t.concat(n.script).concat(n.controlBlock);return{finalScriptWitness:(0,Hs.witnessStackToScriptWitness)(r)}}catch(e){throw new Error(`Can not finalize taproot input #${t}: ${e}`)}},Ps.serializeTaprootSignature=function(t,e){const r=e?Buffer.from([e]):Buffer.from([]);return Buffer.concat([t,r])},Ps.isTaprootInput=js,Ps.isTaprootOutput=Ks,Ps.checkTaprootInputFields=function(t,e,r){!function(t,e,r){const n=js(t)&&Gs(e),i=Gs(t)&&js(e),o=t===e&&js(e)&&Gs(e);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(t,e,r),function(t,e,r){if(e.tapMerkleRoot){const n=(e.tapLeafScript||[]).every((t=>zs(t,e.tapMerkleRoot))),i=(t.tapLeafScript||[]).every((t=>zs(t,e.tapMerkleRoot)));if(!n||!i)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(t.tapMerkleRoot){const n=(e.tapLeafScript||[]).every((e=>zs(e,t.tapMerkleRoot)));if(!n)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}}(t,e,r)},Ps.checkTaprootOutputFields=function(t,e,r){!function(t,e,r){const n=Ks(t)&&Gs(e),i=Gs(t)&&Ks(e),o=t===e&&Ks(e)&&Gs(e);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(t,e,r),function(t,e){if(!e.tapTree&&!e.tapInternalKey)return;const r=e.tapInternalKey||t.tapInternalKey,n=e.tapTree||t.tapTree;if(r){const{script:e}=t,i=function(t,e){const r=e&&$s(e.leaves),{output:n}=(0,Ms.p2tr)({internalPubkey:t,scriptTree:r});return n}(r,n);if(e&&!e.equals(i))throw new Error("Error adding output. Script or address missmatch.")}}(t,e)},Ps.tweakInternalPubKey=function(t,e){const r=e.tapInternalKey,n=r&&(0,Ds.tweakKey)(r,e.tapMerkleRoot);if(!n)throw new Error(`Cannot tweak tap internal key for input #${t}. Public key: ${r&&r.toString("hex")}`);return n.x},Ps.tapTreeToList=function(t){if(!(0,Rs.isTaptree)(t))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return Ws(t)},Ps.tapTreeFromList=$s,Ps.checkTaprootInputForSigs=function(t,e){const r=function(t){const e=[];t.tapKeySig&&e.push(t.tapKeySig);t.tapScriptSig&&e.push(...t.tapScriptSig.map((t=>t.signature)));if(!e.length){const r=function(t){if(!t)return;const e=t.slice(2);if(64===e.length||65===e.length)return e}(t.finalScriptWitness);r&&e.push(r)}return e}(t);return r.some((t=>(0,Fs.signatureBlocksAction)(t,Vs,e)))},Object.defineProperty(xi,"__esModule",{value:!0}),xi.Psbt=void 0;const Ys=Ui,Xs=po,Qs=Es,Zs=ni(),Js=Mn,ta=Ht,ea=ri(),ra=Dn,na=Pe(),ia=si,oa=Ps,sa=_s,aa={network:ta.bitcoin,maximumFeeRate:5e3};class ua{static fromBase64(t,e={}){const r=Buffer.from(t,"base64");return this.fromBuffer(r,e)}static fromHex(t,e={}){const r=Buffer.from(t,"hex");return this.fromBuffer(r,e)}static fromBuffer(t,e={}){const r=Ys.Psbt.fromBuffer(t,ca),n=new ua(e,r);var i,o;return i=n.__CACHE.__TX,o=n.__CACHE,i.ins.forEach((t=>{ba(o,t)})),n}constructor(t={},e=new Ys.Psbt(new fa)){this.data=e,this.opts=Object.assign({},aa,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(t,e,r,n)=>Object.defineProperty(t,e,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map((t=>({hash:(0,Js.cloneBuffer)(t.hash),index:t.index,sequence:t.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((t=>{let e;try{e=(0,Zs.fromOutputScript)(t.script,this.opts.network)}catch(t){}return{script:(0,Js.cloneBuffer)(t.script),value:t.value,address:e}}))}combine(...t){return this.data.combine(...t.map((t=>t.data))),this}clone(){const t=ua.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){ya(t),this.opts.maximumFeeRate=t}setVersion(t){ya(t),wa(this.data.inputs,"setVersion");const e=this.__CACHE;return e.__TX.version=t,e.__EXTRACTED_TX=void 0,this}setLocktime(t){ya(t),wa(this.data.inputs,"setLocktime");const e=this.__CACHE;return e.__TX.locktime=t,e.__EXTRACTED_TX=void 0,this}setInputSequence(t,e){ya(e),wa(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=t)throw new Error("Input index too high");return r.__TX.ins[t].sequence=e,r.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach((t=>this.addInput(t))),this}addInput(t){if(arguments.length>1||!t||void 0===t.hash||void 0===t.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,oa.checkTaprootInputFields)(t,t,"addInput"),wa(this.data.inputs,"addInput"),t.witnessScript&&Ma(t.witnessScript);const e=this.__CACHE;this.data.addInput(t);ba(e,e.__TX.ins[e.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&Ua(this.__CACHE,n,r),e.__FEE=void 0,e.__FEE_RATE=void 0,e.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach((t=>this.addOutput(t))),this}addOutput(t){if(arguments.length>1||!t||void 0===t.value||void 0===t.address&&void 0===t.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");wa(this.data.inputs,"addOutput");const{address:e}=t;if("string"==typeof e){const{network:r}=this.opts,n=(0,Zs.toOutputScript)(e,r);t=Object.assign({},t,{script:n})}(0,oa.checkTaprootOutputFields)(t,t,"addOutput");const r=this.__CACHE;return this.data.addOutput(t),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(la))throw new Error("Not finalized");const e=this.__CACHE;if(t||function(t,e,r){const n=e.__FEE_RATE||t.getFeeRate(),i=e.__EXTRACTED_TX.virtualSize(),o=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(o/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,e,this.opts),e.__EXTRACTED_TX)return e.__EXTRACTED_TX;const r=e.__TX.clone();return Ca(this.data.inputs,r,e,!0),r}getFeeRate(){return Sa("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return Sa("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,Qs.checkForInput)(this.data.inputs,0),ja(this.data.inputs.length).forEach((t=>this.finalizeInput(t))),this}finalizeInput(t,e){const r=(0,Qs.checkForInput)(this.data.inputs,t);return(0,oa.isTaprootInput)(r)?this._finalizeTaprootInput(t,r,void 0,e):this._finalizeInput(t,r,e)}finalizeTaprootInput(t,e,r=oa.tapScriptFinalizer){const n=(0,Qs.checkForInput)(this.data.inputs,t);if((0,oa.isTaprootInput)(n))return this._finalizeTaprootInput(t,n,e,r);throw new Error(`Cannot finalize input #${t}. Not Taproot.`)}_finalizeInput(t,e,r=Ta){const{script:n,isP2SH:i,isP2WSH:o,isSegwit:s}=function(t,e,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!e.redeemScript,i.isP2WSH=!!e.witnessScript,e.witnessScript)i.script=e.witnessScript;else if(e.redeemScript)i.script=e.redeemScript;else if(e.nonWitnessUtxo){const o=Na(r,e,t),s=n.ins[t].index;i.script=o.outs[s].script}else e.witnessUtxo&&(i.script=e.witnessUtxo.script);(e.witnessScript||(0,sa.isP2WPKH)(i.script))&&(i.isSegwit=!0);return i}(t,e,this.__CACHE);if(!n)throw new Error(`No script found for input #${t}`);!function(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:r}=t;e.forEach((t=>{const{hashType:e}=na.signature.decode(t.signature);if(r!==e)throw new Error("Signature sighash does not match input sighash type")}))}(e);const{finalScriptSig:a,finalScriptWitness:u}=r(t,e,n,s,i,o);if(a&&this.data.updateInput(t,{finalScriptSig:a}),u&&this.data.updateInput(t,{finalScriptWitness:u}),!a&&!u)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}_finalizeTaprootInput(t,e,r,n=oa.tapScriptFinalizer){if(!e.witnessUtxo)throw new Error(`Cannot finalize input #${t}. Missing withness utxo.`);if(e.tapKeySig){const r=ea.p2tr({output:e.witnessUtxo.script,signature:e.tapKeySig}),n=(0,sa.witnessStackToScriptWitness)(r.witness);this.data.updateInput(t,{finalScriptWitness:n})}else{const{finalScriptWitness:i}=n(t,e,r);this.data.updateInput(t,{finalScriptWitness:i})}return this.data.clearFinalizedInput(t),this}getInputType(t){const e=(0,Qs.checkForInput)(this.data.inputs,t),r=Da(Ra(t,e,this.__CACHE),t,"input",e.redeemScript||function(t){if(!t)return;const e=na.decompile(t);if(!e)return;const r=e[e.length-1];if(!Buffer.isBuffer(r)||Ha(r)||(n=r,na.isCanonicalScriptSignature(n)))return;var n;if(!na.decompile(r))return;return r}(e.finalScriptSig),e.witnessScript||function(t){if(!t)return;const e=xa(t),r=e[e.length-1];if(Ha(r))return;if(!na.decompile(r))return;return r}(e.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+Fa(r.meaningfulScript)}inputHasPubkey(t,e){return function(t,e,r,n){const i=Ra(r,e,n),{meaningfulScript:o}=Da(i,r,"input",e.redeemScript,e.witnessScript);return(0,sa.pubkeyInScript)(t,o)}(e,(0,Qs.checkForInput)(this.data.inputs,t),t,this.__CACHE)}inputHasHDKey(t,e){const r=(0,Qs.checkForInput)(this.data.inputs,t),n=da(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(t,e){return function(t,e,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:o}=Da(i,r,"output",e.redeemScript,e.witnessScript);return(0,sa.pubkeyInScript)(t,o)}(e,(0,Qs.checkForOutput)(this.data.outputs,t),t,this.__CACHE)}outputHasHDKey(t,e){const r=(0,Qs.checkForOutput)(this.data.outputs,t),n=da(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(t){(0,Qs.checkForInput)(this.data.inputs,0);return ja(this.data.inputs.length).map((e=>this.validateSignaturesOfInput(e,t))).reduce(((t,e)=>!0===e&&t),!0)}validateSignaturesOfInput(t,e,r){const n=this.data.inputs[t];return(0,oa.isTaprootInput)(n)?this.validateSignaturesOfTaprootInput(t,e,r):this._validateSignaturesOfInput(t,e,r)}_validateSignaturesOfInput(t,e,r){const n=this.data.inputs[t],i=(n||{}).partialSig;if(!n||!i||i.length<1)throw new Error("No signatures to validate");if("function"!=typeof e)throw new Error("Need validator function to validate signatures");const o=r?i.filter((t=>t.pubkey.equals(r))):i;if(o.length<1)throw new Error("No signatures for this pubkey");const s=[];let a,u,c;for(const r of o){const i=na.signature.decode(r.signature),{hash:o,script:f}=c!==i.hashType?Pa(t,Object.assign({},n,{sighashType:i.hashType}),this.__CACHE,!0):{hash:a,script:u};c=i.hashType,a=o,u=f,ga(r.pubkey,f,"verify"),s.push(e(r.pubkey,o,i.signature))}return s.every((t=>!0===t))}validateSignaturesOfTaprootInput(t,e,r){const n=this.data.inputs[t],i=(n||{}).tapKeySig,o=(n||{}).tapScriptSig;if(!n&&!i&&(!o||o.length))throw new Error("No signatures to validate");if("function"!=typeof e)throw new Error("Need validator function to validate signatures");const s=(r=r&&(0,oa.toXOnly)(r))?ka(t,n,this.data.inputs,r,this.__CACHE):function(t,e,r,n){const i=[];if(e.tapInternalKey){const r=_a(t,e,n);r&&i.push(r)}if(e.tapScriptSig){const t=e.tapScriptSig.map((t=>t.pubkey));i.push(...t)}const o=i.map((i=>ka(t,e,r,i,n)));return o.flat()}(t,n,this.data.inputs,this.__CACHE);if(!s.length)throw new Error("No signatures for this pubkey");const a=s.find((t=>!t.leafHash));let u=0;if(i&&a){if(!e(a.pubkey,a.hash,Ia(i)))return!1;u++}if(o)for(const t of o){const r=s.find((e=>t.pubkey.equals(e.pubkey)));if(r){if(!e(t.pubkey,r.hash,Ia(t.signature)))return!1;u++}}return u>0}signAllInputsHD(t,e=[ia.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const n of ja(this.data.inputs.length))try{this.signInputHD(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,e=[ia.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!t||!t.publicKey||!t.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],o=[];for(const r of ja(this.data.inputs.length))o.push(this.signInputHDAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(o).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(t,e,r=[ia.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");return Ba(t,this.data.inputs,e).forEach((e=>this.signInput(t,e,r))),this}signInputHDAsync(t,e,r=[ia.Transaction.SIGHASH_ALL]){return new Promise(((n,i)=>{if(!e||!e.publicKey||!e.fingerprint)return i(new Error("Need HDSigner to sign input"));const o=Ba(t,this.data.inputs,e).map((e=>this.signInputAsync(t,e,r)));return Promise.all(o).then((()=>{n()})).catch(i)}))}signAllInputs(t,e){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const n of ja(this.data.inputs.length))try{this.signInput(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,e){return new Promise(((r,n)=>{if(!t||!t.publicKey)return n(new Error("Need Signer to sign input"));const i=[],o=[];for(const[r]of this.data.inputs.entries())o.push(this.signInputAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(o).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInput(t,e,r){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=(0,Qs.checkForInput)(this.data.inputs,t);return(0,oa.isTaprootInput)(n)?this._signTaprootInput(t,n,e,void 0,r):this._signInput(t,e,r)}signTaprootInput(t,e,r,n){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const i=(0,Qs.checkForInput)(this.data.inputs,t);if((0,oa.isTaprootInput)(i))return this._signTaprootInput(t,i,e,r,n);throw new Error(`Input #${t} is not of type Taproot.`)}_signInput(t,e,r=[ia.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:i}=Oa(this.data.inputs,t,e.publicKey,this.__CACHE,r),o=[{pubkey:e.publicKey,signature:na.signature.encode(e.sign(n),i)}];return this.data.updateInput(t,{partialSig:o}),this}_signTaprootInput(t,e,r,n,i=[ia.Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(t,e,r,n,i),s=o.filter((t=>!t.leafHash)).map((t=>(0,oa.serializeTaprootSignature)(r.signSchnorr(t.hash),e.sighashType)))[0],a=o.filter((t=>!!t.leafHash)).map((t=>({pubkey:(0,oa.toXOnly)(r.publicKey),signature:(0,oa.serializeTaprootSignature)(r.signSchnorr(t.hash),e.sighashType),leafHash:t.leafHash})));return s&&this.data.updateInput(t,{tapKeySig:s}),a.length&&this.data.updateInput(t,{tapScriptSig:a}),this}signInputAsync(t,e,r){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=(0,Qs.checkForInput)(this.data.inputs,t);return(0,oa.isTaprootInput)(n)?this._signTaprootInputAsync(t,n,e,void 0,r):this._signInputAsync(t,e,r)}))}signTaprootInputAsync(t,e,r,n){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const i=(0,Qs.checkForInput)(this.data.inputs,t);if((0,oa.isTaprootInput)(i))return this._signTaprootInputAsync(t,i,e,r,n);throw new Error(`Input #${t} is not of type Taproot.`)}))}_signInputAsync(t,e,r=[ia.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:i}=Oa(this.data.inputs,t,e.publicKey,this.__CACHE,r);return Promise.resolve(e.sign(n)).then((r=>{const n=[{pubkey:e.publicKey,signature:na.signature.encode(r,i)}];this.data.updateInput(t,{partialSig:n})}))}async _signTaprootInputAsync(t,e,r,n,i=[ia.Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(t,e,r,n,i),s=[],a=o.filter((t=>!t.leafHash))[0];if(a){const t=Promise.resolve(r.signSchnorr(a.hash)).then((t=>({tapKeySig:(0,oa.serializeTaprootSignature)(t,e.sighashType)})));s.push(t)}const u=o.filter((t=>!!t.leafHash));if(u.length){const t=u.map((t=>Promise.resolve(r.signSchnorr(t.hash)).then((n=>({tapScriptSig:[{pubkey:(0,oa.toXOnly)(r.publicKey),signature:(0,oa.serializeTaprootSignature)(n,e.sighashType),leafHash:t.leafHash}]})))));s.push(...t)}return Promise.all(s).then((e=>{e.forEach((e=>this.data.updateInput(t,e)))}))}checkTaprootHashesForSig(t,e,r,n,i){if("function"!=typeof r.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${t}.`);const o=ka(t,e,this.data.inputs,r.publicKey,this.__CACHE,n,i);if(!o||!o.length)throw new Error(`Can not sign for input #${t} with the key ${r.publicKey.toString("hex")}`);return o}toBuffer(){return ha(this.__CACHE),this.data.toBuffer()}toHex(){return ha(this.__CACHE),this.data.toHex()}toBase64(){return ha(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,e){return e.witnessScript&&Ma(e.witnessScript),(0,oa.checkTaprootInputFields)(this.data.inputs[t],e,"updateInput"),this.data.updateInput(t,e),e.nonWitnessUtxo&&Ua(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,e){const r=this.data.outputs[t];return(0,oa.checkTaprootOutputFields)(r,e,"updateOutput"),this.data.updateOutput(t,e),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,e){return this.data.addUnknownKeyValToInput(t,e),this}addUnknownKeyValToOutput(t,e){return this.data.addUnknownKeyValToOutput(t,e),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}}xi.Psbt=ua;const ca=t=>new fa(t);class fa{constructor(t=Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=ia.Transaction.fromBuffer(t),function(t){if(!t.ins.every((t=>t.script&&0===t.script.length&&t.witness&&0===t.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(void 0===t.hash||void 0===t.index||!Buffer.isBuffer(t.hash)&&"string"!=typeof t.hash||"number"!=typeof t.index)throw new Error("Error adding input.");const e="string"==typeof t.hash?(0,Js.reverseBuffer)(Buffer.from(t.hash,"hex")):t.hash;this.tx.addInput(e,t.index,t.sequence)}addOutput(t){if(void 0===t.script||void 0===t.value||!Buffer.isBuffer(t.script)||"number"!=typeof t.value)throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}}function ha(t){if(!1!==t.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function pa(t,e,r){if(!e)return!1;let n;if(n=r?r.map((t=>{const r=function(t){if(65===t.length){const e=1&t[64],r=t.slice(0,33);return r[0]=2|e,r}return t.slice()}(t);return e.find((t=>t.pubkey.equals(r)))})).filter((t=>!!t)):e,n.length>t)throw new Error("Too many signatures");return n.length===t}function la(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function da(t){return e=>!!e.masterFingerprint.equals(t.fingerprint)&&!!t.derivePath(e.path).publicKey.equals(e.pubkey)}function ya(t){if("number"!=typeof t||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function wa(t,e){t.forEach((t=>{if((0,oa.isTaprootInput)(t)?(0,oa.checkTaprootInputForSigs)(t,e):(0,sa.checkInputForSig)(t,e))throw new Error("Can not modify transaction, signatures exist.")}))}function ga(t,e,r){if(!(0,sa.pubkeyInScript)(t,e))throw new Error(`Can not ${r} for this input with the key ${t.toString("hex")}`)}function ba(t,e){const r=(0,Js.reverseBuffer)(Buffer.from(e.hash)).toString("hex")+":"+e.index;if(t.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[r]=1}function ma(t,e){return(r,n,i,o)=>{const s=t({redeem:{output:i}}).output;if(!n.equals(s))throw new Error(`${e} for ${o} #${r} doesn't match the scriptPubKey in the prevout`)}}const Ea=ma(ea.p2sh,"Redeem script"),va=ma(ea.p2wsh,"Witness script");function Sa(t,e,r,n){if(!r.every(la))throw new Error(`PSBT must be finalized to calculate ${e}`);if("__FEE_RATE"===t&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===t&&n.__FEE)return n.__FEE;let i,o=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,o=!1):i=n.__TX.clone(),Ca(r,i,n,o),"__FEE_RATE"===t?n.__FEE_RATE:"__FEE"===t?n.__FEE:void 0}function Ta(t,e,r,n,i,o){const s=Fa(r);if(!function(t,e,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return pa(1,t.partialSig);case"multisig":const r=ea.p2ms({output:e});return pa(r.m,t.partialSig,r.pubkeys);default:return!1}}(e,r,s))throw new Error(`Can not finalize input #${t}`);return function(t,e,r,n,i,o){let s,a;const u=function(t,e,r){let n;switch(e){case"multisig":const e=function(t,e){const r=ea.p2ms({output:t});return r.pubkeys.map((t=>(e.filter((e=>e.pubkey.equals(t)))[0]||{}).signature)).filter((t=>!!t))}(t,r);n=ea.p2ms({output:t,signatures:e});break;case"pubkey":n=ea.p2pk({output:t,signature:r[0].signature});break;case"pubkeyhash":n=ea.p2pkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=ea.p2wpkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(t,e,r),c=o?ea.p2wsh({redeem:u}):null,f=i?ea.p2sh({redeem:c||u}):null;n?(a=c?(0,sa.witnessStackToScriptWitness)(c.witness):(0,sa.witnessStackToScriptWitness)(u.witness),f&&(s=f.input)):s=f?f.input:u.input;return{finalScriptSig:s,finalScriptWitness:a}}(r,s,e.partialSig,n,i,o)}function Oa(t,e,r,n,i){const o=(0,Qs.checkForInput)(t,e),{hash:s,sighashType:a,script:u}=Pa(e,o,n,!1,i);return ga(r,u,"sign"),{hash:s,sighashType:a}}function Pa(t,e,r,n,i){const o=r.__TX,s=e.sighashType||ia.Transaction.SIGHASH_ALL;let a,u;if(Aa(s,i),e.nonWitnessUtxo){const n=Na(r,e,t),i=o.ins[t].hash,s=n.getHash();if(!i.equals(s))throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const a=o.ins[t].index;u=n.outs[a]}else{if(!e.witnessUtxo)throw new Error("Need a Utxo input item for signing");u=e.witnessUtxo}const{meaningfulScript:c,type:f}=Da(u.script,t,"input",e.redeemScript,e.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(f)>=0)a=o.hashForWitnessV0(t,c,u.value,s);else if((0,sa.isP2WPKH)(c)){const e=ea.p2pkh({hash:c.slice(2)}).output;a=o.hashForWitnessV0(t,e,u.value,s)}else{if(void 0===e.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${t} has witnessUtxo but non-segwit script: ${c.toString("hex")}`);n||!1===r.__UNSAFE_SIGN_NONSEGWIT||console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as Psbt's predecessor (TransactionBuilder - now removed) when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),a=o.hashForSignature(t,c,s)}return{script:c,sighashType:s,hash:a}}function _a(t,e,r){const{script:n}=La(t,e,r);return(0,sa.isP2TR)(n)?n.subarray(2,34):null}function Ia(t){return 64===t.length?t:t.subarray(0,64)}function ka(t,e,r,n,i,o,s){const a=i.__TX,u=e.sighashType||ia.Transaction.SIGHASH_DEFAULT;Aa(u,s);const c=r.map(((t,e)=>La(e,t,i))),f=c.map((t=>t.script)),h=c.map((t=>t.value)),p=[];if(e.tapInternalKey&&!o){const r=_a(t,e,i)||Buffer.from([]);if((0,oa.toXOnly)(n).equals(r)){const e=a.hashForWitnessV1(t,f,h,u);p.push({pubkey:n,hash:e})}}const l=(e.tapLeafScript||[]).filter((t=>(0,sa.pubkeyInScript)(n,t.script))).map((t=>{const e=(0,ra.tapleafHash)({output:t.script,version:t.leafVersion});return Object.assign({hash:e},t)})).filter((t=>!o||o.equals(t.hash))).map((e=>{const r=a.hashForWitnessV1(t,f,h,u,e.hash);return{pubkey:n,hash:r,leafHash:e.hash}}));return p.concat(l)}function Aa(t,e){if(e&&e.indexOf(t)<0){const e=function(t){let e=t&ia.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&t){case ia.Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case ia.Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case ia.Transaction.SIGHASH_NONE:e+="SIGHASH_NONE"}return e}(t);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${e}`)}}function Ba(t,e,r){const n=(0,Qs.checkForInput)(e,t);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map((t=>t.masterFingerprint.equals(r.fingerprint)?t:void 0)).filter((t=>!!t));if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map((t=>{const e=r.derivePath(t.path);if(!t.pubkey.equals(e.publicKey))throw new Error("pubkey did not match bip32Derivation");return e}))}function xa(t){let e=0;function r(){const r=Xs.decode(t,e);return e+=Xs.decode.bytes,r}function n(){return function(r){return e+=r,t.slice(e-r,e)}(r())}return function(){const t=r(),e=[];for(let r=0;r<t;r++)e.push(n());return e}()}function Ua(t,e,r){t.__NON_WITNESS_UTXO_BUF_CACHE[r]=e.nonWitnessUtxo;const n=ia.Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=t,o=r;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const t=i.__NON_WITNESS_UTXO_BUF_CACHE[o],e=i.__NON_WITNESS_UTXO_TX_CACHE[o];if(void 0!==t)return t;{const t=e.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[o]=t,t}},set(t){i.__NON_WITNESS_UTXO_BUF_CACHE[o]=t}})}function Ca(t,e,r,n){let i=0;t.forEach(((t,o)=>{if(n&&t.finalScriptSig&&(e.ins[o].script=t.finalScriptSig),n&&t.finalScriptWitness&&(e.ins[o].witness=xa(t.finalScriptWitness)),t.witnessUtxo)i+=t.witnessUtxo.value;else if(t.nonWitnessUtxo){const n=Na(r,t,o),s=e.ins[o].index,a=n.outs[s];i+=a.value}}));const o=e.outs.reduce(((t,e)=>t+e.value),0),s=i-o;if(s<0)throw new Error("Outputs are spending more than Inputs");const a=e.virtualSize();r.__FEE=s,r.__EXTRACTED_TX=e,r.__FEE_RATE=Math.floor(s/a)}function Na(t,e,r){const n=t.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Ua(t,e,r),n[r]}function Ra(t,e,r){const{script:n}=La(t,e,r);return n}function La(t,e,r){if(void 0!==e.witnessUtxo)return{script:e.witnessUtxo.script,value:e.witnessUtxo.value};if(void 0!==e.nonWitnessUtxo){const n=Na(r,e,t).outs[r.__TX.ins[t].index];return{script:n.script,value:n.value}}throw new Error("Can't find pubkey in input without Utxo data")}function Ha(t){return 33===t.length&&na.isCanonicalPubKey(t)}function Da(t,e,r,n,i){const o=(0,sa.isP2SHScript)(t),s=o&&n&&(0,sa.isP2WSHScript)(n),a=(0,sa.isP2WSHScript)(t);if(o&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((a||s)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let u;return s?(u=i,Ea(e,t,n,r),va(e,n,i,r),Ma(u)):a?(u=i,va(e,t,i,r),Ma(u)):o?(u=n,Ea(e,t,n,r)):u=t,{meaningfulScript:u,type:s?"p2sh-p2wsh":o?"p2sh":a?"p2wsh":"raw"}}function Ma(t){if((0,sa.isP2WPKH)(t)||(0,sa.isP2SHScript)(t))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Fa(t){return(0,sa.isP2WPKH)(t)?"witnesspubkeyhash":(0,sa.isP2PKH)(t)?"pubkeyhash":(0,sa.isP2MS)(t)?"multisig":(0,sa.isP2PK)(t)?"pubkey":"nonstandard"}function ja(t){return[...Array(t).keys()]}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.initEccLib=t.Transaction=t.opcodes=t.Psbt=t.Block=t.script=t.payments=t.networks=t.crypto=t.address=void 0;const e=ni();t.address=e;const r=qe;t.crypto=r;const n=Ht;t.networks=n;const i=ri();t.payments=i;const o=Pe();t.script=o;var s=ii;Object.defineProperty(t,"Block",{enumerable:!0,get:function(){return s.Block}});var a=xi;Object.defineProperty(t,"Psbt",{enumerable:!0,get:function(){return a.Psbt}});var u=Kt;Object.defineProperty(t,"opcodes",{enumerable:!0,get:function(){return u.OPS}});var c=si;Object.defineProperty(t,"Transaction",{enumerable:!0,get:function(){return c.Transaction}});var f=Cn;Object.defineProperty(t,"initEccLib",{enumerable:!0,get:function(){return f.initEccLib}})}(Rt);var Ka={},$a={};!function(t){function e(t){return t.map((t=>Buffer.from(t,"hex").reverse().toString("hex"))).join("")}Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultEsploraClient=t.REGTEST_ESPLORA_BASE_PATH=t.TESTNET_ESPLORA_BASE_PATH=t.MAINNET_ESPLORA_BASE_PATH=void 0,t.MAINNET_ESPLORA_BASE_PATH="https://btc-mainnet.gobob.xyz",t.TESTNET_ESPLORA_BASE_PATH="https://btc-testnet.gobob.xyz",t.REGTEST_ESPLORA_BASE_PATH="http://localhost:3003";t.DefaultEsploraClient=class{constructor(e="mainnet"){switch(e){case"mainnet":this.basePath=t.MAINNET_ESPLORA_BASE_PATH;break;case"testnet":this.basePath=t.TESTNET_ESPLORA_BASE_PATH;break;case"regtest":this.basePath=t.REGTEST_ESPLORA_BASE_PATH;break;default:this.basePath=e}}async getLatestHeight(){return parseInt(await this.getText(`${this.basePath}/blocks/tip/height`),10)}async getBlock(t){return this.getJson(`${this.basePath}/block/${t}`)}async getBlockHash(t){return this.getText(`${this.basePath}/block-height/${t}`)}async getBlockHeader(t){return this.getText(`${this.basePath}/block/${t}/header`)}async getBlockHeaderAt(t){const e=await this.getBlockHash(t);return await this.getBlockHeader(e)}async getTransaction(t){return this.getJson(`${this.basePath}/tx/${t}`)}async getTransactionHex(t){return this.getText(`${this.basePath}/tx/${t}/hex`)}async getMerkleProof(t){const r=await this.getJson(`${this.basePath}/tx/${t}/merkle-proof`);return{blockHeight:r.block_height,merkle:e(r.merkle),pos:r.pos}}async getFeeEstimate(t){return(await this.getJson(`${this.basePath}/fee-estimates`))[t]}async getAddressUtxos(t,e){return(await this.getJson(`${this.basePath}/address/${t}/utxo`)).filter((t=>void 0===e||e===t.status.confirmed)).map((t=>({txid:t.txid,vout:t.vout,value:t.value,confirmed:t.status.confirmed,height:t.status.block_height})))}async broadcastTx(t){const e=await fetch(`${this.basePath}/tx`,{method:"POST",body:t});return await e.text()}async getJson(t){const e=await fetch(t);if(!e.ok)throw new Error(e.statusText);return await e.json()}async getText(t){const e=await fetch(t);if(!e.ok)throw new Error(e.statusText);return await e.text()}}}($a);var Va={},Wa={},qa=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),za=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ga=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&qa(e,t,r);return za(e,t),e};Object.defineProperty(Wa,"__esModule",{value:!0}),Wa.encodeRawInput=function(t){const e=Ya.varuint.encodingLength(t.ins.length)+t.ins.reduce(((t,e)=>t+40+Za(e.script)),0),r=Buffer.allocUnsafe(e),n=new Ya.BufferWriter(r,0);return n.writeVarInt(t.ins.length),t.ins.forEach((t=>{n.writeSlice(t.hash),n.writeUInt32(t.index),n.writeVarSlice(t.script),n.writeUInt32(t.sequence)})),r},Wa.encodeRawOutput=function(t){const e=Ya.varuint.encodingLength(t.outs.length)+t.outs.reduce(((t,e)=>t+8+Za(e.script)),0),r=Buffer.allocUnsafe(e),n=new Ya.BufferWriter(r,0);return n.writeVarInt(t.outs.length),t.outs.forEach((t=>{void 0!==t.value?n.writeUInt64(t.value):n.writeSlice(t.valueBuffer),n.writeVarSlice(t.script)})),r},Wa.encodeRawWitness=function(t){const e=t.ins.reduce(((t,e)=>t+function(t){const e=t.length;return Ya.varuint.encodingLength(e)+t.reduce(((t,e)=>t+Za(e)),0)}(e.witness)),0),r=Buffer.allocUnsafe(e),n=new Ya.BufferWriter(r,0);return t.ins.forEach((t=>{n.writeVector(t.witness)})),r},Wa.getMerkleProof=function(t,e,r){const n=t.transactions.map((t=>t.getHash(r))),i=n.map((t=>t.toString("hex"))).indexOf(e),o=function(t,e){let r=[];for(;t.length>1;){if(t.length%2!=0){let e=t[t.length-1];t.push(e)}e%2==0?e++:e--,r.push(t[e]),e=Math.floor(e/2),t=Ja(t,2).map((t=>(0,Xa.hash256)(Buffer.concat([t[0],t[1]]))))}return{merkle:r,root:t[0]}}(n,i);return{pos:i,proof:o.merkle.map((t=>t.toString("hex"))).join(""),root:o.root.toString("hex")}},Wa.estimateTxFee=function(t,e=1){const r=new Qa.Transaction;for(let t=0;t<e;t++)r.addInput(Buffer.alloc(32,0),0,4294967293,Buffer.alloc(0));r.ins.map((t=>t.witness=[Buffer.alloc(72,0),Buffer.alloc(33,0)])),r.addOutput(Buffer.alloc(22,0),1e3),r.addOutput(Buffer.alloc(22,0),1e3),r.addOutput(Qa.script.compile([Qa.opcodes.OP_RETURN,Buffer.alloc(20,0)]),0);const n=r.virtualSize();return t*n};const Ya=Mn,Xa=qe,Qa=Ga(Rt);function Za(t){const e=t.length;return Ya.varuint.encodingLength(e)+e}function Ja(t,e){const r=[];let n=0;for(;n<t.length;)r.push(t.slice(n,n+e)),n+=e;return r}Object.defineProperty(Va,"__esModule",{value:!0}),Va.getBitcoinTxInfo=async function(t,e,r){const n=await t.getTransactionHex(e),i=tu.Transaction.fromHex(n),o=Buffer.allocUnsafe(4);o.writeInt32LE(i.version);const s=Buffer.allocUnsafe(4);return s.writeInt32LE(i.locktime),{version:o.toString("hex"),inputVector:(0,eu.encodeRawInput)(i).toString("hex"),outputVector:(0,eu.encodeRawOutput)(i).toString("hex"),locktime:s.toString("hex"),witnessVector:r?(0,eu.encodeRawWitness)(i).toString("hex"):void 0,witnessVector:r?(0,eu.encodeRawWitness)(i).toString("hex"):void 0}},Va.getBitcoinTxProof=async function(t,e,r){const n=await t.getMerkleProof(e),i=await ru(t,n.blockHeight,r);return{merkleProof:n.merkle,txIndexInBlock:n.pos,bitcoinHeaders:i}},Va.getBitcoinHeaders=ru;const tu=Rt,eu=Wa;async function ru(t,e,r){const n=(i=e,o=e+r,Array.from({length:o-i},((t,e)=>e+i)));var i,o;const s=await Promise.all(n.map((async e=>{const r=await t.getBlockHash(e);return t.getBlockHeader(r)})));return s.join("")}var nu={},iu={};Object.defineProperty(iu,"__esModule",{value:!0}),iu.DummySigner=void 0;iu.DummySigner=class{constructor(t){this.publicKey=t}sign(t,e){return Buffer.alloc(64,0)}signSchnorr(t){return Buffer.alloc(64,0)}};var ou={},su=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),au=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),uu=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&su(e,t,r);return au(e,t),e};Object.defineProperty(ou,"__esModule",{value:!0}),ou.createCommitTxData=function(t,e,r){const n=(f=e,f.subarray(1,33)),i=r.toScript(n),o=cu.script.compile(i),s={output:o,redeemVersion:192},a=cu.payments.p2tr({internalPubkey:n,scriptTree:s,redeem:s,network:t}),u=a.witness?.[a.witness.length-1],c={leafVersion:a.redeemVersion,script:o,controlBlock:u};var f;return{scriptTaproot:a,tapLeafScript:c}};const cu=uu(Rt);var fu={};!function(t){var e=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&e(n,t,i);return r(n,t),n};Object.defineProperty(t,"__esModule",{value:!0}),t.customFinalizer=void 0,t.createRevealTx=function(t,e,r,n,o){const{scriptTaproot:s,tapLeafScript:a}=e,u=new i.Psbt({network:t});return u.addInput({hash:r.tx.getId(),index:r.outputIndex,witnessUtxo:{value:r.outputAmount,script:s.output},nonWitnessUtxo:r.tx.toBuffer(),tapLeafScript:[a]}),u.addOutput({value:o,address:n}),u},t.signRevealTx=async function(e,r,n){return n=await e.signInput(0,n),n.finalizeInput(0,(0,t.customFinalizer)(r)),n.extractTransaction()};const i=n(Rt),o=n(_s),{witnessStackToScriptWitness:s}=o;t.customFinalizer=t=>{const{tapLeafScript:e}=t;return(t,r)=>{const n=[r.tapScriptSig[t].signature].concat(e.script).concat(e.controlBlock);return{finalScriptWitness:s(n)}}}}(fu);var hu=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),pu=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),lu=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&hu(e,t,r);return pu(e,t),e};Object.defineProperty(nu,"__esModule",{value:!0}),nu.inscribeData=async function(t,e,r,n,i=1e4){const o=await t.getNetwork(),s=Buffer.from(await t.getPublicKey(),"hex"),a=(0,wu.createCommitTxData)(o,s,n),u=function(t,e,r,n,i){const o=new du.Psbt({network:t}),{scriptTaproot:s,tapLeafScript:a}=r;o.addInput({hash:Buffer.alloc(32,0),index:0,witnessUtxo:{value:i,script:s.output},tapLeafScript:[a]}),o.addOutput({value:i,address:n}),o.signInput(0,new yu.DummySigner(e)),o.finalizeInput(0,(0,gu.customFinalizer)(r));const u=o.extractTransaction();return u.virtualSize()}(o,s,a,e,i),c=u*r+i,f=a.scriptTaproot.address,h=await t.sendToAddress(f,c),p=await t.getTransaction(h),l=du.address.toOutputScript(f,o),d=p.outs.findIndex((t=>t.script.equals(l))),y={tx:p,outputIndex:d,outputAmount:c},w=(0,gu.createRevealTx)(o,a,y,e,i),g=await(0,gu.signRevealTx)(t,a,w);return g};const du=lu(Rt),yu=iu,wu=ou,gu=fu;var bu={},mu={},Eu={};!function(t){var e,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultOrdinalsClient=t.SatPoint=t.OutPoint=t.InscriptionId=t.TESTNET_ORD_BASE_PATH=t.MAINNET_ORD_BASE_PATH=t.REGTEST_ORD_BASE_PATH=void 0,t.REGTEST_ORD_BASE_PATH="http://0.0.0.0:3003",t.MAINNET_ORD_BASE_PATH="https://ordinals-mainnet.gobob.xyz",t.TESTNET_ORD_BASE_PATH="https://ordinals-testnet.gobob.xyz",function(t){t.toString=function(t){return`${t.txid}i${t.index}`},t.fromString=function(t){const[e,r]=t.split("i");return{txid:e,index:parseInt(r,10)}}}(e||(t.InscriptionId=e={})),function(t){t.toString=function(t){return`${t.txid}:${t.vout}`},t.fromString=function(t){const[e,r]=t.split(":");return{txid:e,vout:parseInt(r,10)}}}(r||(t.OutPoint=r={})),function(t){t.toString=function(t){return`${r.toString(t.outpoint)}:${t.offset}`},t.fromString=function(t){const[e,r,n]=t.split(":");return{outpoint:{txid:e,vout:parseInt(r,10)},offset:parseInt(n,10)}}}(n||(t.SatPoint=n={}));t.DefaultOrdinalsClient=class{constructor(e="mainnet"){switch(e){case"mainnet":this.basePath=t.MAINNET_ORD_BASE_PATH;break;case"testnet":this.basePath=t.TESTNET_ORD_BASE_PATH;break;case"regtest":this.basePath=t.REGTEST_ORD_BASE_PATH;break;default:this.basePath=e}}async getInscriptionFromId(t){console.log(`${this.basePath}/inscription/${e.toString(t)}`);const r=await this.getJson(`${this.basePath}/inscription/${e.toString(t)}`);return{...r,children:r.children.map(e.fromString),id:e.fromString(r.id),next:null!=r.next?e.fromString(r.next):null,parent:null!=r.parent?e.fromString(r.parent):null,previous:null!=r.previous?e.fromString(r.previous):null,satpoint:n.fromString(r.satpoint)}}async getInscriptions(){const t=await this.getJson(`${this.basePath}/inscriptions`);return this.parseInscriptionsJson(t)}async getInscriptionsFromBlock(t){const e=await this.getJson(`${this.basePath}/inscriptions/block/${t}`);return this.parseInscriptionsJson(e)}async getInscriptionsFromOutPoint(t){return await this.getJson(`${this.basePath}/output/${r.toString(t)}`)}async getInscriptionsFromSat(t){const r=await this.getJson(`${this.basePath}/sat/${t}`);return{...r,inscriptions:r.inscriptions.map((t=>e.fromString(t)))}}async getInscriptionsFromStartBlock(t){const e=await this.getJson(`${this.basePath}/inscriptions/${t}`);return this.parseInscriptionsJson(e)}async getJson(t){const e=await fetch(t,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(e.statusText);return await e.json()}parseInscriptionsJson(t){const r=t.ids.map((t=>e.fromString(t)));return{...t,ids:r}}}}(Eu),function(t){var e=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&e(n,t,i);return r(n,t),n};Object.defineProperty(t,"__esModule",{value:!0}),t.Inscription=t.MAX_CHUNK_SIZE=t.PROTOCOL_ID=void 0,t.chunkContent=h,t.parseInscriptions=y,t.getTxInscriptions=w,t.getInscriptionFromId=async function(t,e){const{txid:r,index:n}=o.InscriptionId.fromString(e);return(await w(t,r))[n]};const i=n(Rt),o=Eu,s=new TextEncoder,a=i.opcodes.OP_RESERVED,u=80;t.PROTOCOL_ID=Buffer.from("6f7264","hex");const c=i.opcodes.OP_1,f=i.opcodes.OP_9;function h(e){const r=[];let n=0;for(;n<e.length;)r.push(e.subarray(n,n+t.MAX_CHUNK_SIZE)),n+=t.MAX_CHUNK_SIZE;return r}function p(t){return t>=i.opcodes.OP_1&&t<=i.opcodes.OP_16?t-a:t}t.MAX_CHUNK_SIZE=520;class l{constructor(t,e){this.tags=t??new Map,this.body=e}getContentType(){const t=this.tags[c];return Buffer.isBuffer(t)?t.toString("utf-8"):null}getContentEncoding(){const t=this.tags[f];return Buffer.isBuffer(t)?t.toString("utf-8"):null}setContentType(t){this.tags[c]=Buffer.from(s.encode(t))}setContentEncoding(t){this.tags[f]=Buffer.from(s.encode(t))}getTags(){const t=this.tags;return Object.keys(this.tags).map((function(e){return[p(Number(e)),t[e]]}))}toScript(e){return[e,i.opcodes.OP_CHECKSIG,i.opcodes.OP_0,i.opcodes.OP_IF,t.PROTOCOL_ID,...this.getTags().map((([t,e])=>[1,t,e])).flat(),i.opcodes.OP_0,...h(this.body),i.opcodes.OP_ENDIF]}}function d(t){const e=t.length,r=t[e-1];if(void 0===r)return null;let n=2;return e>=2&&r[0]==u&&(n=3),void 0===t[e-n]?null:i.script.decompile(t[e-n])}function y(e){let r=[];for(const n of e.ins){const e=d(n.witness);if(null==e)continue;const o=e.values();for(let e=o.next();!e.done;e=o.next()){if(e.value!=i.opcodes.OP_FALSE)continue;if(o.next().value!=i.opcodes.OP_IF)continue;const n=o.next().value;if(!Buffer.isBuffer(n)&&!n.equals(t.PROTOCOL_ID))continue;let s=new Map,a=[],u=!1;for(let t=o.next();!t.done;t=o.next()){if(t.value==i.opcodes.OP_ENDIF){r.push(new l(s,Buffer.concat(a)));break}if(t.value!=i.opcodes.OP_0)if(u)Buffer.isBuffer(t.value)&&a.push(t.value);else{const e=o.next().value;"number"==typeof t.value&&Buffer.isBuffer(e)&&(s[t.value]=e)}else u=!0}}}return r}async function w(t,e){const r=await t.getTransactionHex(e);return y(i.Transaction.fromHex(r))}t.Inscription=l,function(t){t.createTextInscription=function(e){return t.createInscription("text/plain;charset=utf-8",Buffer.from(s.encode(e)))},t.createInscription=function(e,r){const n=new t;return n.setContentType(e),n.body=r,n}}(l||(t.Inscription=l={}))}(mu);var vu=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),Su=It&&It.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Tu=It&&It.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&vu(e,t,r);return Su(e,t),e};Object.defineProperty(bu,"__esModule",{value:!0}),bu.getInscriptionIds=async function(t,e,r){const n=await t.getAddressUtxos(r),i=await Promise.all(n.sort(((t,e)=>(t.height||Number.MAX_SAFE_INTEGER)-(e.height||Number.MAX_SAFE_INTEGER))).map((r=>async function(t,e,r){if(r.confirmed){return(await e.getInscriptionsFromOutPoint(r)).inscriptions}const n=await t.getTransactionHex(r.txid),i=_u.Transaction.fromHex(n);if(0==r.vout){const t=(await Promise.all(i.ins.map((async t=>{const r=t.hash.reverse().toString("hex");return(await e.getInscriptionsFromOutPoint({txid:r,vout:t.index})).inscriptions})))).flat();if(t.length>0)return t}const o=(0,Ou.parseInscriptions)(i);return 0!=r.vout?[]:o.map(((t,e)=>Pu.InscriptionId.toString({txid:r.txid,index:e})))}(t,e,r))));return i.flat()};const Ou=mu,Pu=Eu,_u=Tu(Rt);var Iu={},ku={};Object.defineProperty(ku,"__esModule",{value:!0}),ku.isValidBtcAddress=void 0;const Au=new RegExp(/\b([13][a-km-zA-HJ-NP-Z1-9]{25,34}|bc1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})\b/),Bu=new RegExp(/\b([2mn][a-km-zA-HJ-NP-Z1-9]{25,34}|tb1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})\b/);ku.isValidBtcAddress=(t,e)=>{switch(t){case"mainnet":return Au.test(e);case"testnet":return Bu.test(e);default:throw new Error(`Invalid bitcoin network configured: ${t}. Valid values are: mainnet | testnet.`)}};var xu={},Uu={},Cu={},Nu={},Ru={};!function(t){function e(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function r(...t){const e=t=>t,r=(t,e)=>r=>t(e(r)),n=t.map((t=>t.encode)).reduceRight(r,e),i=t.map((t=>t.decode)).reduce(r,e);return{encode:n,decode:i}}function n(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const r=t.indexOf(e);if(-1===r)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return r}))}}}function i(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function o(t,e="="){if("string"!=typeof e)throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;r.length*t%8;)r.push(e);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw new Error("padding.encode input should be array of strings");for(let t of r)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let n=r.length;if(n*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if(!((n-1)*t%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function s(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function a(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let n=0;const i=[],o=Array.from(t);for(o.forEach((t=>{if(t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,s=!0;for(let i=n;i<o.length;i++){const a=o[i],u=e*t+a;if(!Number.isSafeInteger(u)||e*t/e!==t||u-a!=e*t)throw new Error("convertRadix: carry overflow");t=u%r;const c=Math.floor(u/r);if(o[i]=c,!Number.isSafeInteger(c)||c*r+t!==u)throw new Error("convertRadix: carry overflow");s&&(c?s=!1:n=i)}if(i.push(t),s)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.createBase58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64urlnopad=t.base64url=t.base64nopad=t.base64=t.base32crockford=t.base32hexnopad=t.base32hex=t.base32nopad=t.base32=t.base16=t.utils=t.assertNumber=void 0,t.assertNumber=function(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)};const u=(t,e)=>e?u(e,t%e):t,c=(t,e)=>t+(e-u(t,e));function f(t,e,r,n){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(c(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${c(e,r)}`);let i=0,o=0;const s=2**r-1,a=[];for(const n of t){if(n>=2**e)throw new Error(`convertRadix2: invalid data word=${n} from=${e}`);if(i=i<<e|n,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)a.push((i>>o-r&s)>>>0);i&=2**o-1}if(i=i<<r-o&s,!n&&o>=e)throw new Error("Excess padding");if(!n&&i)throw new Error(`Non-zero padding: ${i}`);return n&&o>0&&a.push(i>>>0),a}function h(t){return{encode:r=>{if(!e(r))throw new Error("radix.encode input should be Uint8Array");return a(Array.from(r),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(a(e,t,256))}}}function p(t,r=!1){if(t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(c(8,t)>32||c(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!e(n))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(n),8,t,!r)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(f(e,t,8,r))}}}function l(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}function d(t,r){if("function"!=typeof r)throw new Error("checksum fn should be function");return{encode(n){if(!e(n))throw new Error("checksum.encode: input should be Uint8Array");const i=r(n).slice(0,t),o=new Uint8Array(n.length+t);return o.set(n),o.set(i,n.length),o},decode(n){if(!e(n))throw new Error("checksum.decode: input should be Uint8Array");const i=n.slice(0,-t),o=r(i).slice(0,t),s=n.slice(-t);for(let e=0;e<t;e++)if(o[e]!==s[e])throw new Error("Invalid checksum");return i}}}t.utils={alphabet:n,chain:r,checksum:d,convertRadix:a,convertRadix2:f,radix:h,radix2:p,join:i,padding:o},t.base16=r(p(4),n("0123456789ABCDEF"),i("")),t.base32=r(p(5),n("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),i("")),t.base32nopad=r(p(5),n("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),i("")),t.base32hex=r(p(5),n("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),i("")),t.base32hexnopad=r(p(5),n("0123456789ABCDEFGHIJKLMNOPQRSTUV"),i("")),t.base32crockford=r(p(5),n("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),i(""),s((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),t.base64=r(p(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),i("")),t.base64nopad=r(p(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i("")),t.base64url=r(p(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),i("")),t.base64urlnopad=r(p(6),n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),i(""));const y=t=>r(h(58),n(t),i(""));t.base58=y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let r="";for(let n=0;n<e.length;n+=8){const i=e.subarray(n,n+8);r+=t.base58.encode(i).padStart(w[i.length],"1")}return r},decode(e){let r=[];for(let n=0;n<e.length;n+=11){const i=e.slice(n,n+11),o=w.indexOf(i.length),s=t.base58.decode(i);for(let t=0;t<s.length-o;t++)if(0!==s[t])throw new Error("base58xmr: wrong padding");r=r.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(r)}};t.createBase58check=e=>r(d(4,(t=>e(e(t)))),t.base58),t.base58check=t.createBase58check;const g=r(n("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),i("")),b=[996825010,642813549,513874426,1027748829,705979059];function m(t){const e=t>>25;let r=(33554431&t)<<5;for(let t=0;t<b.length;t++)1==(e>>t&1)&&(r^=b[t]);return r}function E(t,e,r=1){const n=t.length;let i=1;for(let e=0;e<n;e++){const r=t.charCodeAt(e);if(r<33||r>126)throw new Error(`Invalid prefix (${t})`);i=m(i)^r>>5}i=m(i);for(let e=0;e<n;e++)i=m(i)^31&t.charCodeAt(e);for(let t of e)i=m(i)^t;for(let t=0;t<6;t++)i=m(i);return i^=r,g.encode(f([i%2**30],30,5,!1))}function v(t){const e="bech32"===t?1:734539939,r=p(5),n=r.decode,i=r.encode,o=l(n);function s(t,r=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==r&&t.length>r)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${r})`);const n=t.toLowerCase();if(t!==n&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=n.lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const o=n.slice(0,i),s=n.slice(i+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=g.decode(s).slice(0,-6),u=E(o,a,e);if(!s.endsWith(u))throw new Error(`Invalid checksum in ${t}: expected "${u}"`);return{prefix:o,words:a}}return{encode:function(t,r,n=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof r);if(0===t.length)throw new TypeError(`Invalid prefix length ${t.length}`);const i=t.length+7+r.length;if(!1!==n&&i>n)throw new TypeError(`Length ${i} exceeds limit ${n}`);const o=t.toLowerCase(),s=E(o,r,e);return`${o}1${g.encode(r)}${s}`},decode:s,decodeToBytes:function(t){const{prefix:e,words:r}=s(t,!1);return{prefix:e,words:r,bytes:n(r)}},decodeUnsafe:l(s),fromWords:n,fromWordsUnsafe:o,toWords:i}}t.bech32=v("bech32"),t.bech32m=v("bech32m"),t.utf8={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},t.hex=r(p(4),n("0123456789abcdef"),i(""),s((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const S={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},T="Invalid encoding type. Available types: utf8, hex, base16, base32, base64, base64url, base58, base58xmr";t.bytesToString=(t,r)=>{if("string"!=typeof t||!S.hasOwnProperty(t))throw new TypeError(T);if(!e(r))throw new TypeError("bytesToString() expects Uint8Array");return S[t].encode(r)},t.str=t.bytesToString;t.stringToBytes=(t,e)=>{if(!S.hasOwnProperty(t))throw new TypeError(T);if("string"!=typeof e)throw new TypeError("stringToBytes() expects string");return S[t].decode(e)},t.bytes=t.stringToBytes}(Ru),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.constant=t.magicBytes=t.magic=t.optional=t.flagged=t.flag=t.lazy=t.apply=t.hex=t.cstring=t.string=t.prefix=t.bytes=t.bool=t.F64LE=t.F64BE=t.F32LE=t.F32BE=t.I8=t.U8=t.I16BE=t.I16LE=t.U16BE=t.U16LE=t.I32BE=t.I32LE=t.U32BE=t.U32LE=t.int=t.I64BE=t.I64LE=t.U64BE=t.U64LE=t.I128BE=t.I128LE=t.U128BE=t.U128LE=t.I256BE=t.I256LE=t.U256BE=t.U256LE=t.bigint=t.bits=t.coders=t.isCoder=t.wrap=t.validate=t.utils=t.NULL=t.EMPTY=void 0,t._TEST=t.pointer=t.padRight=t.padLeft=t.ZeroPad=t.bitset=t.mappedTag=t.tag=t.map=t.array=t.tuple=t.struct=void 0;const e=Ru;function r(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function n(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}t.EMPTY=new Uint8Array,t.NULL=new Uint8Array([0]);const i=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function o(t){return"[object Object]"===Object.prototype.toString.call(t)}function s(t){return Number.isSafeInteger(t)}t.utils={equalBytes:r,isBytes:n,isCoder:g,checkBounds:l,concatBytes:function(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];if(!n(i))throw new Error("Uint8Array expected");e+=i.length}const r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const i=t[e];r.set(i,n),n+=i.length}return r},createView:i,isPlainObject:o};const a=t=>{if(null!==t&&"string"!=typeof t&&!g(t)&&!n(t)&&!s(t))throw new Error(`lengthCoder: expected null | number | Uint8Array | CoderType, got ${t} (${typeof t})`);return{encodeStream(e,r){if(null===t)return;if(g(t))return t.encodeStream(e,r);let n;if("number"==typeof t?n=t:"string"==typeof t&&(n=c.resolve(e.stack,t)),"bigint"==typeof n&&(n=Number(n)),void 0===n||n!==r)throw e.err(`Wrong length: ${n} len=${t} exp=${r} (${typeof r})`)},decodeStream(e){let r;if(g(t)?r=Number(t.decodeStream(e)):"number"==typeof t?r=t:"string"==typeof t&&(r=c.resolve(e.stack,t)),"bigint"==typeof r&&(r=Number(r)),"number"!=typeof r)throw e.err(`Wrong length: ${r}`);return r}}},u={BITS:32,FULL_MASK:-1>>>0,len:t=>Math.ceil(t/32),create:t=>new Uint32Array(u.len(t)),clean:t=>t.fill(0),debug:t=>Array.from(t).map((t=>(t>>>0).toString(2).padStart(32,"0"))),checkLen:(t,e)=>{if(u.len(e)!==t.length)throw new Error(`wrong length=${t.length}. Expected: ${u.len(e)}`)},chunkLen:(t,e,r)=>{if(e<0)throw new Error(`wrong pos=${e}`);if(e+r>t)throw new Error(`wrong range=${e}/${r} of ${t}`)},set:(t,e,r,n=!0)=>!(!n&&t[e]&r)&&(t[e]|=r,!0),pos:(t,e)=>({chunk:Math.floor((t+e)/32),mask:1<<32-(t+e)%32-1}),indices:(t,e,r=!1)=>{u.checkLen(t,e);const{FULL_MASK:n,BITS:i}=u,o=i-e%i,s=o?n>>>o<<o:n,a=[];for(let e=0;e<t.length;e++){let n=t[e];if(r&&(n=~n),e===t.length-1&&(n&=s),0!==n)for(let t=0;t<i;t++){n&1<<i-t-1&&a.push(e*i+t)}}return a},range:t=>{const e=[];let r;for(const n of t)void 0===r||n!==r.pos+r.length?e.push(r={pos:n,length:1}):r.length+=1;return e},rangeDebug:(t,e,r=!1)=>`[${u.range(u.indices(t,e,r)).map((t=>`(${t.pos}/${t.length})`)).join(", ")}]`,setRange:(t,e,r,n,i=!0)=>{u.chunkLen(e,r,n);const{FULL_MASK:o,BITS:s}=u,a=r%s?Math.floor(r/s):void 0,c=r+n,f=c%s?Math.floor(c/s):void 0;if(void 0!==a&&a===f)return u.set(t,a,o>>>s-n<<s-n-r,i);if(void 0!==a&&!u.set(t,a,o>>>r%s,i))return!1;const h=void 0!==f?f:c/s;for(let e=void 0!==a?a+1:r/s;e<h;e++)if(!u.set(t,e,o,i))return!1;return!(void 0!==f&&a!==f&&!u.set(t,f,o<<s-c%s,i))}},c={pushObj:(t,e,r)=>{const n={obj:e};t.push(n),r(((t,e)=>{n.field=t,e(),n.field=void 0})),t.pop()},path:t=>{const e=[];for(const r of t)void 0!==r.field&&e.push(r.field);return e.join("/")},err(t,e,r){const n=new Error(`${t}(${c.path(e)}): ${"string"==typeof r?r:r.message}`);return r instanceof Error&&r.stack&&(n.stack=r.stack),n},resolve:(t,e)=>{const r=e.split("/"),n=t.map((t=>t.obj));let i=0;for(;i<r.length&&".."===r[i];i++)n.pop();let o=n.pop();for(;i<r.length;i++){if(!o||void 0===o[r[i]])return;o=o[r[i]]}return o}};class f{constructor(t,e={},r=[],n=void 0,o=0){this.data=t,this.opts=e,this.stack=r,this.parent=n,this.parentOffset=o,this.pos=0,this.bitBuf=0,this.bitPos=0,this.view=i(t)}_enablePointers(){if(this.parent)return this.parent._enablePointers();this.bs||(this.bs=u.create(this.data.length),u.setRange(this.bs,this.data.length,0,this.pos,this.opts.allowMultipleReads))}markBytesBS(t,e){return this.parent?this.parent.markBytesBS(this.parentOffset+t,e):!e||(!this.bs||u.setRange(this.bs,this.data.length,t,e,!1))}markBytes(t){const e=this.pos;this.pos+=t;const r=this.markBytesBS(e,t);if(!this.opts.allowMultipleReads&&!r)throw this.err(`multiple read pos=${this.pos} len=${t}`);return r}pushObj(t,e){return c.pushObj(this.stack,t,e)}readView(t,e){if(!Number.isFinite(t))throw this.err(`readView: wrong length=${t}`);if(this.pos+t>this.data.length)throw this.err("readView: Unexpected end of buffer");const r=e(this.view,this.pos);return this.markBytes(t),r}absBytes(t){if(t>this.data.length)throw new Error("Unexpected end of buffer");return this.data.subarray(t)}finish(){if(!this.opts.allowUnreadBytes){if(this.bitPos)throw this.err(`${this.bitPos} bits left after unpack: ${e.hex.encode(this.data.slice(this.pos))}`);if(!this.bs||this.parent){if(!this.isEnd())throw this.err(`${this.leftBytes} bytes ${this.bitPos} bits left after unpack: ${e.hex.encode(this.data.slice(this.pos))}`)}else{const t=u.indices(this.bs,this.data.length,!0);if(t.length){const r=u.range(t).map((({pos:t,length:r})=>`(${t}/${r})[${e.hex.encode(this.data.subarray(t,t+r))}]`)).join(", ");throw this.err(`unread byte ranges: ${r} (total=${this.data.length})`)}}}}err(t){return c.err("Reader",this.stack,t)}offsetReader(t){if(t>this.data.length)throw this.err("offsetReader: Unexpected end of buffer");return new f(this.absBytes(t),this.opts,this.stack,this,t)}bytes(t,e=!1){if(this.bitPos)throw this.err("readBytes: bitPos not empty");if(!Number.isFinite(t))throw this.err(`readBytes: wrong length=${t}`);if(this.pos+t>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const r=this.data.subarray(this.pos,this.pos+t);return e||this.markBytes(t),r}byte(t=!1){if(this.bitPos)throw this.err("readByte: bitPos not empty");if(this.pos+1>this.data.length)throw this.err("readBytes: Unexpected end of buffer");const e=this.data[this.pos];return t||this.markBytes(1),e}get leftBytes(){return this.data.length-this.pos}get totalBytes(){return this.data.length}isEnd(){return this.pos>=this.data.length&&!this.bitPos}bits(t){if(t>32)throw this.err("BitReader: cannot read more than 32 bits in single call");let e=0;for(;t;){this.bitPos||(this.bitBuf=this.byte(),this.bitPos=8);const r=Math.min(t,this.bitPos);this.bitPos-=r,e=e<<r|this.bitBuf>>this.bitPos&2**r-1,this.bitBuf&=2**this.bitPos-1,t-=r}return e>>>0}find(t,e=this.pos){if(!n(t))throw this.err(`find: needle is not bytes! ${t}`);if(this.bitPos)throw this.err("findByte: bitPos not empty");if(!t.length)throw this.err("find: needle is empty");for(let n=e;-1!==(n=this.data.indexOf(t[0],n));n++){if(-1===n)return;if(this.data.length-n<t.length)return;if(r(t,this.data.subarray(n,n+t.length)))return n}}}class h{constructor(t=[]){this.stack=t,this.pos=0,this.buffers=[],this.ptrs=[],this.bitBuf=0,this.bitPos=0,this.viewBuf=new Uint8Array(8),this.finished=!1,this.view=i(this.viewBuf)}pushObj(t,e){return c.pushObj(this.stack,t,e)}writeView(t,e){if(this.finished)throw this.err("buffer: finished");if(!s(t)||t>8)throw new Error(`wrong writeView length=${t}`);e(this.view),this.bytes(this.viewBuf.slice(0,t)),this.viewBuf.fill(0)}err(t){if(this.finished)throw this.err("buffer: finished");return c.err("Reader",this.stack,t)}bytes(t){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeBytes: ends with non-empty bit buffer");this.buffers.push(t),this.pos+=t.length}byte(t){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeByte: ends with non-empty bit buffer");this.buffers.push(new Uint8Array([t])),this.pos++}finish(t=!0){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("buffer: ends with non-empty bit buffer");const e=this.buffers.concat(this.ptrs.map((t=>t.buffer))),r=e.map((t=>t.length)).reduce(((t,e)=>t+e),0),n=new Uint8Array(r);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}for(let t=this.pos,e=0;e<this.ptrs.length;e++){const r=this.ptrs[e];n.set(r.ptr.encode(t),r.pos),t+=r.buffer.length}if(t){this.buffers=[];for(const t of this.ptrs)t.buffer.fill(0);this.ptrs=[],this.finished=!0,this.bitBuf=0}return n}bits(t,e){if(e>32)throw this.err("writeBits: cannot write more than 32 bits in single call");if(t>=2**e)throw this.err(`writeBits: value (${t}) >= 2**bits (${e})`);for(;e;){const r=Math.min(e,8-this.bitPos);this.bitBuf=this.bitBuf<<r|t>>e-r,this.bitPos+=r,t&=2**(e-=r)-1,8===this.bitPos&&(this.bitPos=0,this.buffers.push(new Uint8Array([this.bitBuf])),this.pos++)}}}const p=t=>Uint8Array.from(t).reverse();function l(t,e,r){if(r){const r=2n**(e-1n);if(t<-r||t>=r)throw new Error(`value out of signed bounds. Expected ${-r} <= ${t} < ${r}`)}else if(0n>t||t>=2n**e)throw new Error(`value out of unsigned bounds. Expected 0 <= ${t} < ${2n**e}`)}function d(t){return{encodeStream:t.encodeStream,decodeStream:t.decodeStream,size:t.size,encode:e=>{const r=new h;return t.encodeStream(r,e),r.finish()},decode:(e,r={})=>{const n=new f(e,r),i=t.decodeStream(n);return n.finish(),i}}}function y(t,e){if(!g(t))throw new Error(`validate: invalid inner value ${t}`);if("function"!=typeof e)throw new Error("validate: fn should be function");return d({size:t.size,encodeStream:(r,n)=>{let i;try{i=e(n)}catch(t){throw r.err(t)}t.encodeStream(r,i)},decodeStream:r=>{const n=t.decodeStream(r);try{return e(n)}catch(t){throw r.err(t)}}})}t.validate=y;t.wrap=t=>{const e=d(t);return t.validate?y(e,t.validate):e};const w=t=>o(t)&&"function"==typeof t.decode&&"function"==typeof t.encode;function g(t){return o(t)&&w(t)&&"function"==typeof t.encodeStream&&"function"==typeof t.decodeStream&&(void 0===t.size||s(t.size))}t.isCoder=g;const b={encode:t=>{if("bigint"!=typeof t)throw new Error("expected bigint, got "+typeof t);if(t>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`element bigger than MAX_SAFE_INTEGER=${t}`);return Number(t)},decode:t=>{if(!s(t))throw new Error("element is not a safe integer");return BigInt(t)}};const m=t=>{if(!w(t))throw new Error("BaseCoder expected");return{encode:t.decode,decode:t.encode}};t.coders={dict:function(){return{encode:t=>{if(!Array.isArray(t))throw new Error("array expected");const e={};for(const r of t){if(!Array.isArray(r)||2!==r.length)throw new Error("array of two elements expected");const t=r[0],n=r[1];if(void 0!==e[t])throw new Error(`key(${t}) appears twice in struct`);e[t]=n}return e},decode:t=>{if(!o(t))throw new Error(`expected plain object, got ${t}`);return Object.entries(t)}}},numberBigint:b,tsEnum:function(t){if(!o(t))throw new Error("plain object expected");return{encode:e=>{if(!s(e)||!(e in t))throw new Error(`wrong value ${e}`);return t[e]},decode:e=>{if("string"!=typeof e)throw new Error("wrong value "+typeof e);return t[e]}}},decimal:function(t,e=!1){if(!s(t))throw new Error(`decimal/precision: wrong value ${t}`);if("boolean"!=typeof e)throw new Error("decimal/round: expected boolean, got "+typeof e);const r=10n**BigInt(t);return{encode:e=>{if("bigint"!=typeof e)throw new Error("expected bigint, got "+typeof e);let r=(e<0n?-e:e).toString(10),n=r.length-t;n<0&&(r=r.padStart(r.length-n,"0"),n=0);let i=r.length-1;for(;i>=n&&"0"===r[i];i--);let o=r.slice(0,n),s=r.slice(n,i+1);return o||(o="0"),e<0n&&(o="-"+o),s?`${o}.${s}`:o},decode:n=>{if("string"!=typeof n)throw new Error("expected string, got "+typeof n);if("-0"===n)throw new Error("negative zero is not allowed");let i=!1;if(n.startsWith("-")&&(i=!0,n=n.slice(1)),!/^(0|[1-9]\d*)(\.\d+)?$/.test(n))throw new Error(`wrong string value=${n}`);let o=n.indexOf(".");o=-1===o?n.length:o;const s=n.slice(0,o),a=n.slice(o+1).replace(/0+$/,""),u=BigInt(s)*r;if(!e&&a.length>t)throw new Error(`fractional part cannot be represented with this precision (num=${n}, prec=${t})`);const c=Math.min(a.length,t),f=u+BigInt(a.slice(0,c))*10n**BigInt(t-c);return i?-f:f}}},match:function(t){if(!Array.isArray(t))throw new Error("expected array, got "+typeof t);for(const e of t)if(!w(e))throw new Error(`wrong base coder ${e}`);return{encode:e=>{for(const r of t){const t=r.encode(e);if(void 0!==t)return t}throw new Error(`match/encode: cannot find match in ${e}`)},decode:e=>{for(const r of t){const t=r.decode(e);if(void 0!==t)return t}throw new Error(`match/decode: cannot find match in ${e}`)}}},reverse:m};t.bits=e=>{if(!s(e))throw new Error(`bits: wrong length ${e} (${typeof e})`);return(0,t.wrap)({encodeStream:(t,r)=>t.bits(r,e),decodeStream:t=>t.bits(e),validate:t=>{if(!s(t))throw new Error(`bits: wrong value ${t}`);return t}})};t.bigint=(e,r=!1,n=!1,i=!0)=>{if(!s(e))throw new Error(`bigint/size: wrong value ${e}`);if("boolean"!=typeof r)throw new Error("bigint/le: expected boolean, got "+typeof r);if("boolean"!=typeof n)throw new Error("bigint/signed: expected boolean, got "+typeof n);if("boolean"!=typeof i)throw new Error("bigint/sized: expected boolean, got "+typeof i);const o=BigInt(e),a=2n**(8n*o-1n);return(0,t.wrap)({size:i?e:void 0,encodeStream:(t,o)=>{n&&o<0&&(o|=a);const s=[];for(let t=0;t<e;t++)s.push(Number(255n&o)),o>>=8n;let u=new Uint8Array(s).reverse();if(!i){let t=0;for(t=0;t<u.length&&0===u[t];t++);u=u.subarray(t)}t.bytes(r?u.reverse():u)},decodeStream:t=>{const o=t.bytes(i?e:Math.min(e,t.leftBytes)),s=r?o:p(o);let u=0n;for(let t=0;t<s.length;t++)u|=BigInt(s[t])<<8n*BigInt(t);return n&&u&a&&(u=(u^a)-a),u},validate:t=>{if("bigint"!=typeof t)throw new Error(`bigint: invalid value: ${t}`);return l(t,8n*o,!!n),t}})},t.U256LE=(0,t.bigint)(32,!0),t.U256BE=(0,t.bigint)(32,!1),t.I256LE=(0,t.bigint)(32,!0,!0),t.I256BE=(0,t.bigint)(32,!1,!0),t.U128LE=(0,t.bigint)(16,!0),t.U128BE=(0,t.bigint)(16,!1),t.I128LE=(0,t.bigint)(16,!0,!0),t.I128BE=(0,t.bigint)(16,!1,!0),t.U64LE=(0,t.bigint)(8,!0),t.U64BE=(0,t.bigint)(8,!1),t.I64LE=(0,t.bigint)(8,!0,!0),t.I64BE=(0,t.bigint)(8,!1,!0);t.int=(e,r=!1,n=!1,i=!0)=>{if(!s(e))throw new Error(`int/size: wrong value ${e}`);if("boolean"!=typeof r)throw new Error("int/le: expected boolean, got "+typeof r);if("boolean"!=typeof n)throw new Error("int/signed: expected boolean, got "+typeof n);if("boolean"!=typeof i)throw new Error("int/sized: expected boolean, got "+typeof i);if(e>6)throw new Error("int supports size up to 6 bytes (48 bits): use bigints instead");return O((0,t.bigint)(e,r,n,i),t.coders.numberBigint)};const E=(e,r)=>(0,t.wrap)({size:e,encodeStream:(t,n)=>t.writeView(e,(t=>r.write(t,n))),decodeStream:t=>t.readView(e,r.read),validate:t=>{if("number"!=typeof t)throw new Error("viewCoder: expected number, got "+typeof t);return r.validate&&r.validate(t),t}}),v=(t,e,r)=>{const n=8*t,i=2**(n-1),o=2**n;return E(t,{write:r.write,read:r.read,validate:e?t=>{if(!s(t))throw new Error(`sintView: value is not safe integer: ${t}`);if(t<-i||t>=i)throw new Error(`sintView: value out of bounds. Expected ${-i} <= ${t} < ${i}`)}:t=>{if(!s(t))throw new Error(`uintView: value is not safe integer: ${t}`);if(0>t||t>=o)throw new Error(`uintView: value out of bounds. Expected 0 <= ${t} < ${o}`)}})};t.U32LE=v(4,!1,{read:(t,e)=>t.getUint32(e,!0),write:(t,e)=>t.setUint32(0,e,!0)}),t.U32BE=v(4,!1,{read:(t,e)=>t.getUint32(e,!1),write:(t,e)=>t.setUint32(0,e,!1)}),t.I32LE=v(4,!0,{read:(t,e)=>t.getInt32(e,!0),write:(t,e)=>t.setInt32(0,e,!0)}),t.I32BE=v(4,!0,{read:(t,e)=>t.getInt32(e,!1),write:(t,e)=>t.setInt32(0,e,!1)}),t.U16LE=v(2,!1,{read:(t,e)=>t.getUint16(e,!0),write:(t,e)=>t.setUint16(0,e,!0)}),t.U16BE=v(2,!1,{read:(t,e)=>t.getUint16(e,!1),write:(t,e)=>t.setUint16(0,e,!1)}),t.I16LE=v(2,!0,{read:(t,e)=>t.getInt16(e,!0),write:(t,e)=>t.setInt16(0,e,!0)}),t.I16BE=v(2,!0,{read:(t,e)=>t.getInt16(e,!1),write:(t,e)=>t.setInt16(0,e,!1)}),t.U8=v(1,!1,{read:(t,e)=>t.getUint8(e),write:(t,e)=>t.setUint8(0,e)}),t.I8=v(1,!0,{read:(t,e)=>t.getInt8(e),write:(t,e)=>t.setInt8(0,e)});const S=t=>E(4,{read:(e,r)=>e.getFloat32(r,t),write:(e,r)=>e.setFloat32(0,r,t),validate:t=>{if(Math.fround(t)!==t&&!Number.isNaN(t))throw new Error(`f32: wrong value=${t}`)}}),T=t=>E(8,{read:(e,r)=>e.getFloat64(r,t),write:(e,r)=>e.setFloat64(0,r,t)});t.F32BE=S(!1),t.F32LE=S(!0),t.F64BE=T(!1),t.F64LE=T(!0),t.bool=(0,t.wrap)({size:1,encodeStream:(t,e)=>t.byte(e?1:0),decodeStream:t=>{const e=t.byte();if(0!==e&&1!==e)throw t.err(`bool: invalid value ${e}`);return 1===e},validate:t=>{if("boolean"!=typeof t)throw new Error(`bool: invalid value ${t}`);return t}});t.bytes=(e,r=!1)=>{if("boolean"!=typeof r)throw new Error("bytes/le: expected boolean, got "+typeof r);const i=a(e),o=n(e);return(0,t.wrap)({size:"number"==typeof e?e:void 0,encodeStream:(t,n)=>{o||i.encodeStream(t,n.length),t.bytes(r?p(n):n),o&&t.bytes(e)},decodeStream:t=>{let n;if(o){const r=t.find(e);if(!r)throw t.err("bytes: cannot find terminator");n=t.bytes(r-t.pos),t.bytes(e.length)}else n=t.bytes(null===e?t.leftBytes:i.decodeStream(t));return r?p(n):n},validate:t=>{if(!n(t))throw new Error(`bytes: invalid value ${t}`);return t}})},t.prefix=function(e,r){if(!g(r))throw new Error(`prefix: invalid inner value ${r}`);return O((0,t.bytes)(e),m(r))};t.string=(r,n=!1)=>y(O((0,t.bytes)(r,n),e.utf8),(t=>{if("string"!=typeof t)throw new Error("expected string, got "+typeof t);return t})),t.cstring=(0,t.string)(t.NULL);function O(e,r){if(!g(e))throw new Error(`apply: invalid inner value ${e}`);if(!w(r))throw new Error(`apply: invalid base value ${e}`);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>{let i;try{i=r.decode(n)}catch(e){throw t.err(""+e)}return e.encodeStream(t,i)},decodeStream:t=>{const n=e.decodeStream(t);try{return r.encode(n)}catch(e){throw t.err(""+e)}}})}t.hex=(r,n={isLE:!1,with0x:!1})=>{let i=O((0,t.bytes)(r,n.isLE),e.hex);if("boolean"!=typeof n.with0x)throw new Error("hex/with0x: expected boolean, got "+typeof n.with0x);return n.with0x&&(i=O(i,{encode:t=>`0x${t}`,decode:t=>{if(!t.startsWith("0x"))throw new Error("hex(with0x=true).encode input should start with 0x");return t.slice(2)}})),i},t.apply=O,t.lazy=function(e){if("function"!=typeof e)throw new Error("lazy: expected function, got "+typeof e);return(0,t.wrap)({encodeStream:(t,r)=>e().encodeStream(t,r),decodeStream:t=>e().decodeStream(t)})};function P(e,i,o=!0){if(!g(e))throw new Error(`magic: invalid inner value ${e}`);if("boolean"!=typeof o)throw new Error("magic: expected boolean, got "+typeof o);return(0,t.wrap)({size:e.size,encodeStream:(t,r)=>e.encodeStream(t,i),decodeStream:t=>{const s=e.decodeStream(t);if(o&&"object"!=typeof s&&s!==i||n(i)&&!r(i,s))throw t.err(`magic: invalid value: ${s} !== ${i}`)},validate:t=>{if(void 0!==t)throw new Error("magic: wrong value="+typeof t);return t}})}t.flag=(e,i=!1)=>{if(!n(e))throw new Error("flag/flagValue: expected Uint8Array, got "+typeof e);if("boolean"!=typeof i)throw new Error("flag/xor: expected boolean, got "+typeof i);return(0,t.wrap)({size:e.length,encodeStream:(t,r)=>{!!r!==i&&t.bytes(e)},decodeStream:t=>{let n=t.leftBytes>=e.length;return n&&(n=r(t.bytes(e.length,!0),e),n&&t.bytes(e.length)),n!==i},validate:t=>{if(void 0!==t&&"boolean"!=typeof t)throw new Error("flag: expected boolean value or undefined, got "+typeof t);return t}})},t.flagged=function(e,r,n){if(!g(r))throw new Error(`flagged: invalid inner value ${r}`);if("string"!=typeof e&&!g(r))throw new Error(`flagged: wrong path=${e}`);return(0,t.wrap)({encodeStream:(t,i)=>{"string"==typeof e?c.resolve(t.stack,e)?r.encodeStream(t,i):n&&r.encodeStream(t,n):(e.encodeStream(t,!!i),i?r.encodeStream(t,i):n&&r.encodeStream(t,n))},decodeStream:t=>{let i=!1;if(i="string"==typeof e?!!c.resolve(t.stack,e):e.decodeStream(t),i)return r.decodeStream(t);n&&r.decodeStream(t)}})},t.optional=function(e,r,n){if(!g(e)||!g(r))throw new Error(`optional: invalid flag or inner value flag=${e} inner=${r}`);return(0,t.wrap)({size:void 0!==n&&e.size&&r.size?e.size+r.size:void 0,encodeStream:(t,i)=>{e.encodeStream(t,!!i),i?r.encodeStream(t,i):void 0!==n&&r.encodeStream(t,n)},decodeStream:t=>{if(e.decodeStream(t))return r.decodeStream(t);void 0!==n&&r.decodeStream(t)}})},t.magic=P;function _(t){let e=0;for(const r of t){if(void 0===r.size)return;if(!s(r.size))throw new Error(`sizeof: wrong element size=${e}`);e+=r.size}return e}function I(e,r){if(!g(e))throw new Error(`map: invalid inner value ${e}`);if(!o(r))throw new Error("map: variants should be plain object");const n=new Map;for(const t in r)n.set(r[t],t);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>e.encodeStream(t,r[n]),decodeStream:t=>{const r=e.decodeStream(t),i=n.get(r);if(void 0===i)throw t.err(`Enum: unknown value: ${r} ${Array.from(n.keys())}`);return i},validate:t=>{if("string"!=typeof t)throw new Error(`map: invalid value ${t}`);if(!(t in r))throw new Error(`Map: unknown variant: ${t}`);return t}})}function k(e,r){if(!g(e))throw new Error(`tag: invalid tag value ${e}`);if(!o(r))throw new Error("tag: variants should be plain object");for(const t in r)if(!g(r[t]))throw new Error(`tag: variant ${t} is not CoderType`);return(0,t.wrap)({size:e.size,encodeStream:(t,n)=>{const{TAG:i,data:o}=n,s=r[i];e.encodeStream(t,i),s.encodeStream(t,o)},decodeStream:t=>{const n=e.decodeStream(t),i=r[n];if(!i)throw t.err(`Tag: invalid tag ${n}`);return{TAG:n,data:i.decodeStream(t)}},validate:t=>{const{TAG:e}=t;if(!r[e])throw new Error(`Tag: invalid tag ${e.toString()}`);return t}})}t.magicBytes=r=>{const n="string"==typeof r?e.utf8.decode(r):r;return P((0,t.bytes)(n.length),n)},t.constant=function(e){return(0,t.wrap)({encodeStream:(t,r)=>{if(r!==e)throw new Error(`constant: invalid value ${r} (exp: ${e})`)},decodeStream:t=>e})},t.struct=function(e){if(!o(e))throw new Error(`struct: expected plain object, got ${e}`);for(const t in e)if(!g(e[t]))throw new Error(`struct: field ${t} is not CoderType`);return(0,t.wrap)({size:_(Object.values(e)),encodeStream:(t,r)=>{t.pushObj(r,(n=>{for(const i in e)n(i,(()=>e[i].encodeStream(t,r[i])))}))},decodeStream:t=>{const r={};return t.pushObj(r,(n=>{for(const i in e)n(i,(()=>r[i]=e[i].decodeStream(t)))})),r},validate:t=>{if("object"!=typeof t||null===t)throw new Error(`struct: invalid value ${t}`);return t}})},t.tuple=function(e){if(!Array.isArray(e))throw new Error(`Packed.Tuple: got ${typeof e} instead of array`);for(let t=0;t<e.length;t++)if(!g(e[t]))throw new Error(`tuple: field ${t} is not CoderType`);return(0,t.wrap)({size:_(e),encodeStream:(t,r)=>{if(!Array.isArray(r))throw t.err(`tuple: invalid value ${r}`);t.pushObj(r,(n=>{for(let i=0;i<e.length;i++)n(`${i}`,(()=>e[i].encodeStream(t,r[i])))}))},decodeStream:t=>{const r=[];return t.pushObj(r,(n=>{for(let i=0;i<e.length;i++)n(`${i}`,(()=>r.push(e[i].decodeStream(t))))})),r},validate:t=>{if(!Array.isArray(t))throw new Error(`tuple: invalid value ${t}`);if(t.length!==e.length)throw new Error(`tuple: wrong length=${t.length}, expected ${e.length}`);return t}})},t.array=function(e,i){if(!g(i))throw new Error(`array: invalid inner value ${i}`);const o=a("string"==typeof e?`../${e}`:e);return(0,t.wrap)({size:"number"==typeof e&&i.size?e*i.size:void 0,encodeStream:(t,s)=>{const a=t;a.pushObj(s,(u=>{n(e)||o.encodeStream(t,s.length);for(let o=0;o<s.length;o++)u(`${o}`,(()=>{const u=s[o],c=t.pos;if(i.encodeStream(t,u),n(e)){if(e.length>a.pos-c)return;const t=a.finish(!1).subarray(c,a.pos);if(r(t.subarray(0,e.length),e))throw a.err(`array: inner element encoding same as separator. elm=${u} data=${t}`)}}))})),n(e)&&t.bytes(e)},decodeStream:t=>{const s=[];return t.pushObj(s,(a=>{if(null===e)for(let e=0;!t.isEnd()&&(a(`${e}`,(()=>s.push(i.decodeStream(t)))),!(i.size&&t.leftBytes<i.size));e++);else if(n(e))for(let n=0;;n++){if(r(t.bytes(e.length,!0),e)){t.bytes(e.length);break}a(`${n}`,(()=>s.push(i.decodeStream(t))))}else{let e;a("arrayLen",(()=>e=o.decodeStream(t)));for(let r=0;r<e;r++)a(`${r}`,(()=>s.push(i.decodeStream(t))))}})),s},validate:t=>{if(!Array.isArray(t))throw new Error(`array: invalid value ${t}`);return t}})},t.map=I,t.tag=k,t.mappedTag=function(t,e){if(!g(t))throw new Error(`mappedTag: invalid tag value ${k}`);if(!o(e))throw new Error("mappedTag: variants should be plain object");const r={},n={};for(const t in e){const i=e[t];r[t]=i[0],n[t]=i[1]}return k(I(t,r),n)},t.bitset=function(e,r=!1){if("boolean"!=typeof r)throw new Error("bitset/pad: expected boolean, got "+typeof r);if(!Array.isArray(e))throw new Error("bitset/names: expected array");for(const t of e)if("string"!=typeof t)throw new Error("bitset/names: expected array of strings");return(0,t.wrap)({encodeStream:(t,n)=>{for(let r=0;r<e.length;r++)t.bits(+n[e[r]],1);r&&e.length%8&&t.bits(0,8-e.length%8)},decodeStream:t=>{const n={};for(let r=0;r<e.length;r++)n[e[r]]=!!t.bits(1);return r&&e.length%8&&t.bits(8-e.length%8),n},validate:t=>{if(!o(t))throw new Error(`bitset: invalid value ${t}`);for(const e of Object.values(t))if("boolean"!=typeof e)throw new Error("expected boolean");return t}})};function A(t,e){return e%t==0?0:t-e%t}t.ZeroPad=t=>0,t.padLeft=function(e,r,n){if(!s(e)||e<=0)throw new Error(`padLeft: wrong blockSize=${e}`);if(!g(r))throw new Error(`padLeft: invalid inner value ${r}`);if(void 0!==n&&"function"!=typeof n)throw new Error("padLeft: wrong padFn="+typeof n);const i=n||t.ZeroPad;if(!r.size)throw new Error("padLeft cannot have dynamic size");return(0,t.wrap)({size:r.size+A(e,r.size),encodeStream:(t,n)=>{const o=A(e,r.size);for(let e=0;e<o;e++)t.byte(i(e));r.encodeStream(t,n)},decodeStream:t=>(t.bytes(A(e,r.size)),r.decodeStream(t))})},t.padRight=function(e,r,n){if(!g(r))throw new Error(`padRight: invalid inner value ${r}`);if(!s(e)||e<=0)throw new Error(`padLeft: wrong blockSize=${e}`);if(void 0!==n&&"function"!=typeof n)throw new Error("padRight: wrong padFn="+typeof n);const i=n||t.ZeroPad;return(0,t.wrap)({size:r.size?r.size+A(e,r.size):void 0,encodeStream:(t,n)=>{const o=t,s=o.pos;r.encodeStream(t,n);const a=A(e,o.pos-s);for(let e=0;e<a;e++)t.byte(i(e))},decodeStream:t=>{const n=t.pos,i=r.decodeStream(t);return t.bytes(A(e,t.pos-n)),i}})},t.pointer=function(e,r,n=!1){if(!g(e))throw new Error(`pointer: invalid ptr value ${e}`);if(!g(r))throw new Error(`pointer: invalid inner value ${r}`);if("boolean"!=typeof n)throw new Error("pointer/sized: expected boolean, got "+typeof n);if(!e.size)throw new Error("unsized pointer");return(0,t.wrap)({size:n?e.size:void 0,encodeStream:(t,n)=>{const i=t,o=i.pos;e.encodeStream(t,0),i.ptrs.push({pos:o,ptr:e,buffer:r.encode(n)})},decodeStream:t=>{const n=e.decodeStream(t);return t._enablePointers(),r.decodeStream(t.offsetReader(n))}})},t._TEST={_bitset:u,_Reader:f,_Writer:h,Path:c}}(Nu);var Lu={},Hu={},Du={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.hmac=t.HMAC=void 0;const e=Ye,r=ir;class n extends r.Hash{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,(0,e.hash)(t);const i=(0,r.toBytes)(n);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?t.create().update(i).digest():i);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return(0,e.exists)(this),this.iHash.update(t),this}digestInto(t){(0,e.exists)(this),(0,e.bytes)(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:s}=this;return t.finished=n,t.destroyed=i,t.blockLen=o,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}t.HMAC=n;t.hmac=(t,e,r)=>new n(t,e).update(r).digest(),t.hmac.create=(t,e)=>new n(t,e)}(Du);var Mu={},Fu={},ju={},Ku={};Object.defineProperty(Ku,"__esModule",{value:!0}),Ku.bitMask=void 0,Ku.isBytes=qu,Ku.abytes=zu,Ku.bytesToHex=Yu,Ku.numberToHexUnpadded=Xu,Ku.hexToNumber=Qu,Ku.hexToBytes=tc,Ku.bytesToNumberBE=function(t){return Qu(Yu(t))},Ku.bytesToNumberLE=function(t){return zu(t),Qu(Yu(Uint8Array.from(t).reverse()))},Ku.numberToBytesBE=ec,Ku.numberToBytesLE=function(t,e){return ec(t,e).reverse()},Ku.numberToVarBytesBE=function(t){return tc(Xu(t))},Ku.ensureBytes=function(t,e,r){let n;if("string"==typeof e)try{n=tc(e)}catch(r){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${r}`)}else{if(!qu(e))throw new Error(`${t} must be hex string or Uint8Array`);n=Uint8Array.from(e)}const i=n.length;if("number"==typeof r&&i!==r)throw new Error(`${t} expected ${r} bytes, got ${i}`);return n},Ku.concatBytes=rc,Ku.equalBytes=function(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return 0===r},Ku.utf8ToBytes=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))},Ku.bitLen=function(t){let e;for(e=0;t>$u;t>>=Vu,e+=1);return e},Ku.bitGet=function(t,e){return t>>BigInt(e)&Vu},Ku.bitSet=function(t,e,r){return t|(r?Vu:$u)<<BigInt(e)},Ku.createHmacDrbg=function(t,e,r){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let n=nc(t),i=nc(t),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...t)=>r(i,n,...t),u=(t=nc())=>{i=a(ic([0]),t),n=a(),0!==t.length&&(i=a(ic([1]),t),n=a())},c=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const r=[];for(;t<e;){n=a();const e=n.slice();r.push(e),t+=n.length}return rc(...r)};return(t,e)=>{let r;for(s(),u(t);!(r=e(c()));)u();return s(),r}},Ku.validateObject=function(t,e,r={}){const n=(e,r,n)=>{const i=oc[r];if("function"!=typeof i)throw new Error(`Invalid validator "${r}", expected function`);const o=t[e];if(!(n&&void 0===o||i(o,t)))throw new Error(`Invalid param ${String(e)}=${o} (${typeof o}), expected ${r}`)};for(const[t,r]of Object.entries(e))n(t,r,!1);for(const[t,e]of Object.entries(r))n(t,e,!0);return t};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const $u=BigInt(0),Vu=BigInt(1),Wu=BigInt(2);function qu(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function zu(t){if(!qu(t))throw new Error("Uint8Array expected")}const Gu=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Yu(t){zu(t);let e="";for(let r=0;r<t.length;r++)e+=Gu[t[r]];return e}function Xu(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function Qu(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}const Zu={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Ju(t){return t>=Zu._0&&t<=Zu._9?t-Zu._0:t>=Zu._A&&t<=Zu._F?t-(Zu._A-10):t>=Zu._a&&t<=Zu._f?t-(Zu._a-10):void 0}function tc(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let e=0,i=0;e<r;e++,i+=2){const r=Ju(t.charCodeAt(i)),o=Ju(t.charCodeAt(i+1));if(void 0===r||void 0===o){const e=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+i)}n[e]=16*r+o}return n}function ec(t,e){return tc(t.toString(16).padStart(2*e,"0"))}function rc(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];zu(n),e+=n.length}const r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const i=t[e];r.set(i,n),n+=i.length}return r}Ku.bitMask=t=>(Wu<<BigInt(t-1))-Vu;const nc=t=>new Uint8Array(t),ic=t=>Uint8Array.from(t);const oc={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||qu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};Object.defineProperty(ju,"__esModule",{value:!0}),ju.isNegativeLE=void 0,ju.mod=dc,ju.pow=yc,ju.pow2=function(t,e,r){let n=t;for(;e-- >ac;)n*=n,n%=r;return n},ju.invert=wc,ju.tonelliShanks=gc,ju.FpSqrt=bc,ju.validateField=function(t){const e=mc.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,sc.validateObject)(t,e)},ju.FpPow=Ec,ju.FpInvertBatch=vc,ju.FpDiv=function(t,e,r){return t.mul(e,"bigint"==typeof r?wc(r,t.ORDER):t.inv(r))},ju.FpIsSquare=function(t){const e=(t.ORDER-uc)/cc;return r=>{const n=t.pow(r,e);return t.eql(n,t.ZERO)||t.eql(n,t.ONE)}},ju.nLength=Sc,ju.Field=function(t,e,r=!1,n={}){if(t<=ac)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:o}=Sc(t,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=bc(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:o,MASK:(0,sc.bitMask)(i),ZERO:ac,ONE:uc,create:e=>dc(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return ac<=e&&e<t},is0:t=>t===ac,isOdd:t=>(t&uc)===uc,neg:e=>dc(-e,t),eql:(t,e)=>t===e,sqr:e=>dc(e*e,t),add:(e,r)=>dc(e+r,t),sub:(e,r)=>dc(e-r,t),mul:(e,r)=>dc(e*r,t),pow:(t,e)=>Ec(a,t,e),div:(e,r)=>dc(e*wc(r,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>wc(e,t),sqrt:n.sqrt||(t=>s(a,t)),invertBatch:t=>vc(a,t),cmov:(t,e,r)=>r?e:t,toBytes:t=>r?(0,sc.numberToBytesLE)(t,o):(0,sc.numberToBytesBE)(t,o),fromBytes:t=>{if(t.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${t.length}`);return r?(0,sc.bytesToNumberLE)(t):(0,sc.bytesToNumberBE)(t)}});return Object.freeze(a)},ju.FpSqrtOdd=function(t,e){if(!t.isOdd)throw new Error("Field doesn't have isOdd");const r=t.sqrt(e);return t.isOdd(r)?r:t.neg(r)},ju.FpSqrtEven=function(t,e){if(!t.isOdd)throw new Error("Field doesn't have isOdd");const r=t.sqrt(e);return t.isOdd(r)?t.neg(r):r},ju.hashToPrivateScalar=function(t,e,r=!1){t=(0,sc.ensureBytes)("privateHash",t);const n=t.length,i=Sc(e).nByteLength+8;if(i<24||n<i||n>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${n}`);const o=r?(0,sc.bytesToNumberLE)(t):(0,sc.bytesToNumberBE)(t);return dc(o,e-uc)+uc},ju.getFieldBytesLength=Tc,ju.getMinHashLength=Oc,ju.mapHashToField=function(t,e,r=!1){const n=t.length,i=Tc(e),o=Oc(e);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=dc(r?(0,sc.bytesToNumberBE)(t):(0,sc.bytesToNumberLE)(t),e-uc)+uc;return r?(0,sc.numberToBytesLE)(s,i):(0,sc.numberToBytesBE)(s,i)};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const sc=Ku,ac=BigInt(0),uc=BigInt(1),cc=BigInt(2),fc=BigInt(3),hc=BigInt(4),pc=BigInt(5),lc=BigInt(8);function dc(t,e){const r=t%e;return r>=ac?r:e+r}function yc(t,e,r){if(r<=ac||e<ac)throw new Error("Expected power/modulo > 0");if(r===uc)return ac;let n=uc;for(;e>ac;)e&uc&&(n=n*t%r),t=t*t%r,e>>=uc;return n}function wc(t,e){if(t===ac||e<=ac)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=dc(t,e),n=e,i=ac,o=uc;for(;r!==ac;){const t=n%r,e=i-o*(n/r);n=r,r=t,i=o,o=e}if(n!==uc)throw new Error("invert: does not exist");return dc(i,e)}function gc(t){const e=(t-uc)/cc;let r,n,i;for(r=t-uc,n=0;r%cc===ac;r/=cc,n++);for(i=cc;i<t&&yc(i,e,t)!==t-uc;i++);if(1===n){const e=(t+uc)/hc;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}const o=(r+uc)/cc;return function(t,s){if(t.pow(s,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=n,u=t.pow(t.mul(t.ONE,i),r),c=t.pow(s,o),f=t.pow(s,r);for(;!t.eql(f,t.ONE);){if(t.eql(f,t.ZERO))return t.ZERO;let e=1;for(let r=t.sqr(f);e<a&&!t.eql(r,t.ONE);e++)r=t.sqr(r);const r=t.pow(u,uc<<BigInt(a-e-1));u=t.sqr(r),c=t.mul(c,r),f=t.mul(f,u),a=e}return c}}function bc(t){if(t%hc===fc){const e=(t+uc)/hc;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw new Error("Cannot find square root");return n}}if(t%lc===pc){const e=(t-pc)/lc;return function(t,r){const n=t.mul(r,cc),i=t.pow(n,e),o=t.mul(r,i),s=t.mul(t.mul(o,cc),i),a=t.mul(o,t.sub(s,t.ONE));if(!t.eql(t.sqr(a),r))throw new Error("Cannot find square root");return a}}return gc(t)}BigInt(9),BigInt(16);ju.isNegativeLE=(t,e)=>(dc(t,e)&uc)===uc;const mc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ec(t,e,r){if(r<ac)throw new Error("Expected power > 0");if(r===ac)return t.ONE;if(r===uc)return e;let n=t.ONE,i=e;for(;r>ac;)r&uc&&(n=t.mul(n,i)),i=t.sqr(i),r>>=uc;return n}function vc(t,e){const r=new Array(e.length),n=e.reduce(((e,n,i)=>t.is0(n)?e:(r[i]=e,t.mul(e,n))),t.ONE),i=t.inv(n);return e.reduceRight(((e,n,i)=>t.is0(n)?e:(r[i]=t.mul(e,r[i]),t.mul(e,n))),i),r}function Sc(t,e){const r=void 0!==e?e:t.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function Tc(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Oc(t){const e=Tc(t);return e+Math.ceil(e/2)}Object.defineProperty(Fu,"__esModule",{value:!0}),Fu.wNAF=function(t,e){const r=(t,e)=>{const r=e.negate();return t?r:e},n=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:r,unsafeLadder(e,r){let n=t.ZERO,i=e;for(;r>Ic;)r&kc&&(n=n.add(i)),i=i.double(),r>>=kc;return n},precomputeWindow(t,e){const{windows:r,windowSize:i}=n(e),o=[];let s=t,a=s;for(let t=0;t<r;t++){a=s,o.push(a);for(let t=1;t<i;t++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(e,i,o){const{windows:s,windowSize:a}=n(e);let u=t.ZERO,c=t.BASE;const f=BigInt(2**e-1),h=2**e,p=BigInt(e);for(let t=0;t<s;t++){const e=t*a;let n=Number(o&f);o>>=p,n>a&&(n-=h,o+=kc);const s=e,l=e+Math.abs(n)-1,d=t%2!=0,y=n<0;0===n?c=c.add(r(d,i[s])):u=u.add(r(y,i[l]))}return{p:u,f:c}},wNAFCached(t,e,r,n){const i=t._WINDOW_SIZE||1;let o=e.get(t);return o||(o=this.precomputeWindow(t,i),1!==i&&e.set(t,n(o))),this.wNAF(i,o,r)}}},Fu.validateBasic=function(t){return(0,Pc.validateField)(t.Fp),(0,_c.validateObject)(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,Pc.nLength)(t.n,t.nBitLength),...t,p:t.Fp.ORDER})};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Pc=ju,_c=Ku,Ic=BigInt(0),kc=BigInt(1);!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DER=void 0,t.weierstrassPoints=p,t.weierstrass=function(o){const s=function(t){const r=(0,e.validateBasic)(t);return n.validateObject(r,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...r})}(o),{Fp:c,n:f}=s,h=c.BYTES+1,l=2*c.BYTES+1;function d(t){return r.mod(t,f)}function y(t){return r.invert(t,f)}const{ProjectivePoint:w,normPrivateKeyToScalar:g,weierstrassEquation:b,isWithinCurveOrder:m}=p({...s,toBytes(t,e,r){const i=e.toAffine(),o=c.toBytes(i.x),s=n.concatBytes;return r?s(Uint8Array.from([e.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,c.toBytes(i.y))},fromBytes(t){const e=t.length,r=t[0],i=t.subarray(1);if(e!==h||2!==r&&3!==r){if(e===l&&4===r){return{x:c.fromBytes(i.subarray(0,c.BYTES)),y:c.fromBytes(i.subarray(c.BYTES,2*c.BYTES))}}throw new Error(`Point of length ${e} was invalid. Expected ${h} compressed bytes or ${l} uncompressed bytes`)}{const t=n.bytesToNumberBE(i);if(!(a<(o=t)&&o<c.ORDER))throw new Error("Point is not on curve");const e=b(t);let s;try{s=c.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw new Error("Point is not on curve"+e)}return!(1&~r)!==((s&u)===u)&&(s=c.neg(s)),{x:t,y:s}}var o}}),E=t=>n.bytesToHex(n.numberToBytesBE(t,s.nByteLength));function v(t){return t>f>>u}const S=(t,e,r)=>n.bytesToNumberBE(t.slice(e,r));class T{constructor(t,e,r){this.r=t,this.s=e,this.recovery=r,this.assertValidity()}static fromCompact(t){const e=s.nByteLength;return t=(0,i.ensureBytes)("compactSignature",t,2*e),new T(S(t,0,e),S(t,e,2*e))}static fromDER(e){const{r:r,s:n}=t.DER.toSig((0,i.ensureBytes)("DER",e));return new T(r,n)}assertValidity(){if(!m(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!m(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new T(this.r,this.s,t)}recoverPublicKey(t){const{r:e,s:r,recovery:n}=this,o=I((0,i.ensureBytes)("msgHash",t));if(null==n||![0,1,2,3].includes(n))throw new Error("recovery id invalid");const a=2===n||3===n?e+s.n:e;if(a>=c.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&n?"03":"02",f=w.fromHex(u+E(a)),h=y(a),p=d(-o*h),l=d(r*h),g=w.BASE.multiplyAndAddUnsafe(f,p,l);if(!g)throw new Error("point at infinify");return g.assertValidity(),g}hasHighS(){return v(this.s)}normalizeS(){return this.hasHighS()?new T(this.r,d(-this.s),this.recovery):this}toDERRawBytes(){return n.hexToBytes(this.toDERHex())}toDERHex(){return t.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return n.hexToBytes(this.toCompactHex())}toCompactHex(){return E(this.r)+E(this.s)}}const O={isValidPrivateKey(t){try{return g(t),!0}catch(t){return!1}},normPrivateKeyToScalar:g,randomPrivateKey:()=>{const t=r.getMinHashLength(s.n);return r.mapHashToField(s.randomBytes(t),s.n)},precompute:(t=8,e=w.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function P(t){const e=n.isBytes(t),r="string"==typeof t,i=(e||r)&&t.length;return e?i===h||i===l:r?i===2*h||i===2*l:t instanceof w}const _=s.bits2int||function(t){const e=n.bytesToNumberBE(t),r=8*t.length-s.nBitLength;return r>0?e>>BigInt(r):e},I=s.bits2int_modN||function(t){return d(_(t))},k=n.bitMask(s.nBitLength);function A(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(a<=t&&t<k))throw new Error(`bigint expected < 2^${s.nBitLength}`);return n.numberToBytesBE(t,s.nByteLength)}function B(t,e,r=x){if(["recovered","canonical"].some((t=>t in r)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:f}=s;let{lowS:h,prehash:p,extraEntropy:l}=r;null==h&&(h=!0),t=(0,i.ensureBytes)("msgHash",t),p&&(t=(0,i.ensureBytes)("prehashed msgHash",o(t)));const b=I(t),E=g(e),S=[A(E),A(b)];if(null!=l&&!1!==l){const t=!0===l?f(c.BYTES):l;S.push((0,i.ensureBytes)("extraEntropy",t))}const O=n.concatBytes(...S),P=b;return{seed:O,k2sig:function(t){const e=_(t);if(!m(e))return;const r=y(e),n=w.BASE.multiply(e).toAffine(),i=d(n.x);if(i===a)return;const o=d(r*d(P+i*E));if(o===a)return;let s=(n.x===i?0:2)|Number(n.y&u),c=o;return h&&v(o)&&(c=function(t){return v(t)?d(-t):t}(o),s^=1),new T(i,c,s)}}}const x={lowS:s.lowS,prehash:!1},U={lowS:s.lowS,prehash:!1};return w.BASE._setWindowSize(8),{CURVE:s,getPublicKey:function(t,e=!0){return w.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,r=!0){if(P(t))throw new Error("first arg must be private key");if(!P(e))throw new Error("second arg must be public key");const n=w.fromHex(e);return n.multiply(g(t)).toRawBytes(r)},sign:function(t,e,r=x){const{seed:i,k2sig:o}=B(t,e,r),a=s,u=n.createHmacDrbg(a.hash.outputLen,a.nByteLength,a.hmac);return u(i,o)},verify:function(e,r,o,a=U){const u=e;if(r=(0,i.ensureBytes)("msgHash",r),o=(0,i.ensureBytes)("publicKey",o),"strict"in a)throw new Error("options.strict was renamed to lowS");const{lowS:c,prehash:f}=a;let h,p;try{if("string"==typeof u||n.isBytes(u))try{h=T.fromDER(u)}catch(e){if(!(e instanceof t.DER.Err))throw e;h=T.fromCompact(u)}else{if("object"!=typeof u||"bigint"!=typeof u.r||"bigint"!=typeof u.s)throw new Error("PARSE");{const{r:t,s:e}=u;h=new T(t,e)}}p=w.fromHex(o)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(c&&h.hasHighS())return!1;f&&(r=s.hash(r));const{r:l,s:g}=h,b=I(r),m=y(g),E=d(b*m),v=d(l*m),S=w.BASE.multiplyAndAddUnsafe(p,E,v)?.toAffine();if(!S)return!1;const O=d(S.x);return O===l},ProjectivePoint:w,Signature:T,utils:O}},t.SWUFpSqrtRatio=l,t.mapToCurveSimpleSWU=function(t,e){if(r.validateField(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const n=l(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return r=>{let i,o,s,a,u,c,f,h;i=t.sqr(r),i=t.mul(i,e.Z),o=t.sqr(i),o=t.add(o,i),s=t.add(o,t.ONE),s=t.mul(s,e.B),a=t.cmov(e.Z,t.neg(o),!t.eql(o,t.ZERO)),a=t.mul(a,e.A),o=t.sqr(s),c=t.sqr(a),u=t.mul(c,e.A),o=t.add(o,u),o=t.mul(o,s),c=t.mul(c,a),u=t.mul(c,e.B),o=t.add(o,u),f=t.mul(i,s);const{isValid:p,value:l}=n(o,c);h=t.mul(i,r),h=t.mul(h,l),f=t.cmov(f,s,p),h=t.cmov(h,l,p);const d=t.isOdd(r)===t.isOdd(h);return h=t.cmov(t.neg(h),h,d),f=t.div(f,a),{x:f,y:h}}};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const e=Fu,r=ju,n=Ku,i=Ku;const{bytesToNumberBE:o,hexToBytes:s}=n;t.DER={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:r}=t.DER;if(e.length<2||2!==e[0])throw new r("Invalid signature integer tag");const n=e[1],i=e.subarray(2,n+2);if(!n||i.length!==n)throw new r("Invalid signature integer: wrong length");if(128&i[0])throw new r("Invalid signature integer: negative");if(0===i[0]&&!(128&i[1]))throw new r("Invalid signature integer: unnecessary leading zero");return{d:o(i),l:e.subarray(n+2)}},toSig(e){const{Err:r}=t.DER,i="string"==typeof e?s(e):e;n.abytes(i);let o=i.length;if(o<2||48!=i[0])throw new r("Invalid signature tag");if(i[1]!==o-2)throw new r("Invalid signature: incorrect length");const{d:a,l:u}=t.DER._parseInt(i.subarray(2)),{d:c,l:f}=t.DER._parseInt(u);if(f.length)throw new r("Invalid signature: left bytes after parsing");return{r:a,s:c}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,r=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},n=e(r(t.s)),i=e(r(t.r)),o=n.length/2,s=i.length/2,a=r(o),u=r(s);return`30${r(s+o+4)}02${u}${i}02${a}${n}`}};const a=BigInt(0),u=BigInt(1),c=BigInt(2),f=BigInt(3),h=BigInt(4);function p(t){const o=function(t){const r=(0,e.validateBasic)(t);n.validateObject(r,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:i,Fp:o,a:s}=r;if(i){if(!o.eql(s,o.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof i||"bigint"!=typeof i.beta||"function"!=typeof i.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...r})}(t),{Fp:s}=o,c=o.toBytes||((t,e,r)=>{const i=e.toAffine();return n.concatBytes(Uint8Array.from([4]),s.toBytes(i.x),s.toBytes(i.y))}),h=o.fromBytes||(t=>{const e=t.subarray(1);return{x:s.fromBytes(e.subarray(0,s.BYTES)),y:s.fromBytes(e.subarray(s.BYTES,2*s.BYTES))}});function p(t){const{a:e,b:r}=o,n=s.sqr(t),i=s.mul(n,t);return s.add(s.add(i,s.mul(t,e)),r)}if(!s.eql(s.sqr(o.Gy),p(o.Gx)))throw new Error("bad generator point: equation left != right");function l(t){return"bigint"==typeof t&&a<t&&t<o.n}function d(t){if(!l(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function y(t){const{allowedPrivateKeyLengths:e,nByteLength:s,wrapPrivateKey:a,n:u}=o;if(e&&"bigint"!=typeof t){if(n.isBytes(t)&&(t=n.bytesToHex(t)),"string"!=typeof t||!e.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*s,"0")}let c;try{c="bigint"==typeof t?t:n.bytesToNumberBE((0,i.ensureBytes)("private key",t,s))}catch(e){throw new Error(`private key must be ${s} bytes, hex or bigint, not ${typeof t}`)}return a&&(c=r.mod(c,u)),d(c),c}const w=new Map;function g(t){if(!(t instanceof b))throw new Error("ProjectivePoint expected")}class b{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!s.isValid(t))throw new Error("x required");if(null==e||!s.isValid(e))throw new Error("y required");if(null==r||!s.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!s.isValid(e)||!s.isValid(r))throw new Error("invalid affine point");if(t instanceof b)throw new Error("projective point not allowed");const n=t=>s.eql(t,s.ZERO);return n(e)&&n(r)?b.ZERO:new b(e,r,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=s.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(b.fromAffine)}static fromHex(t){const e=b.fromAffine(h((0,i.ensureBytes)("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return b.BASE.multiply(y(t))}_setWindowSize(t){this._WINDOW_SIZE=t,w.delete(this)}assertValidity(){if(this.is0()){if(o.allowInfinityPoint&&!s.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:e}=this.toAffine();if(!s.isValid(t)||!s.isValid(e))throw new Error("bad point: x or y not FE");const r=s.sqr(e),n=p(t);if(!s.eql(r,n))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(s.isOdd)return!s.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){g(t);const{px:e,py:r,pz:n}=this,{px:i,py:o,pz:a}=t,u=s.eql(s.mul(e,a),s.mul(i,n)),c=s.eql(s.mul(r,a),s.mul(o,n));return u&&c}negate(){return new b(this.px,s.neg(this.py),this.pz)}double(){const{a:t,b:e}=o,r=s.mul(e,f),{px:n,py:i,pz:a}=this;let u=s.ZERO,c=s.ZERO,h=s.ZERO,p=s.mul(n,n),l=s.mul(i,i),d=s.mul(a,a),y=s.mul(n,i);return y=s.add(y,y),h=s.mul(n,a),h=s.add(h,h),u=s.mul(t,h),c=s.mul(r,d),c=s.add(u,c),u=s.sub(l,c),c=s.add(l,c),c=s.mul(u,c),u=s.mul(y,u),h=s.mul(r,h),d=s.mul(t,d),y=s.sub(p,d),y=s.mul(t,y),y=s.add(y,h),h=s.add(p,p),p=s.add(h,p),p=s.add(p,d),p=s.mul(p,y),c=s.add(c,p),d=s.mul(i,a),d=s.add(d,d),p=s.mul(d,y),u=s.sub(u,p),h=s.mul(d,l),h=s.add(h,h),h=s.add(h,h),new b(u,c,h)}add(t){g(t);const{px:e,py:r,pz:n}=this,{px:i,py:a,pz:u}=t;let c=s.ZERO,h=s.ZERO,p=s.ZERO;const l=o.a,d=s.mul(o.b,f);let y=s.mul(e,i),w=s.mul(r,a),m=s.mul(n,u),E=s.add(e,r),v=s.add(i,a);E=s.mul(E,v),v=s.add(y,w),E=s.sub(E,v),v=s.add(e,n);let S=s.add(i,u);return v=s.mul(v,S),S=s.add(y,m),v=s.sub(v,S),S=s.add(r,n),c=s.add(a,u),S=s.mul(S,c),c=s.add(w,m),S=s.sub(S,c),p=s.mul(l,v),c=s.mul(d,m),p=s.add(c,p),c=s.sub(w,p),p=s.add(w,p),h=s.mul(c,p),w=s.add(y,y),w=s.add(w,y),m=s.mul(l,m),v=s.mul(d,v),w=s.add(w,m),m=s.sub(y,m),m=s.mul(l,m),v=s.add(v,m),y=s.mul(w,v),h=s.add(h,y),y=s.mul(S,v),c=s.mul(E,c),c=s.sub(c,y),y=s.mul(E,w),p=s.mul(S,p),p=s.add(p,y),new b(c,h,p)}subtract(t){return this.add(t.negate())}is0(){return this.equals(b.ZERO)}wNAF(t){return E.wNAFCached(this,w,t,(t=>{const e=s.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(b.fromAffine)}))}multiplyUnsafe(t){const e=b.ZERO;if(t===a)return e;if(d(t),t===u)return this;const{endo:r}=o;if(!r)return E.unsafeLadder(this,t);let{k1neg:n,k1:i,k2neg:c,k2:f}=r.splitScalar(t),h=e,p=e,l=this;for(;i>a||f>a;)i&u&&(h=h.add(l)),f&u&&(p=p.add(l)),l=l.double(),i>>=u,f>>=u;return n&&(h=h.negate()),c&&(p=p.negate()),p=new b(s.mul(p.px,r.beta),p.py,p.pz),h.add(p)}multiply(t){d(t);let e,r,n=t;const{endo:i}=o;if(i){const{k1neg:t,k1:o,k2neg:a,k2:u}=i.splitScalar(n);let{p:c,f:f}=this.wNAF(o),{p:h,f:p}=this.wNAF(u);c=E.constTimeNegate(t,c),h=E.constTimeNegate(a,h),h=new b(s.mul(h.px,i.beta),h.py,h.pz),e=c.add(h),r=f.add(p)}else{const{p:t,f:i}=this.wNAF(n);e=t,r=i}return b.normalizeZ([e,r])[0]}multiplyAndAddUnsafe(t,e,r){const n=b.BASE,i=(t,e)=>e!==a&&e!==u&&t.equals(n)?t.multiply(e):t.multiplyUnsafe(e),o=i(this,e).add(i(t,r));return o.is0()?void 0:o}toAffine(t){const{px:e,py:r,pz:n}=this,i=this.is0();null==t&&(t=i?s.ONE:s.inv(n));const o=s.mul(e,t),a=s.mul(r,t),u=s.mul(n,t);if(i)return{x:s.ZERO,y:s.ZERO};if(!s.eql(u,s.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:t,isTorsionFree:e}=o;if(t===u)return!0;if(e)return e(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:e}=o;return t===u?this:e?e(b,this):this.multiplyUnsafe(o.h)}toRawBytes(t=!0){return this.assertValidity(),c(b,this,t)}toHex(t=!0){return n.bytesToHex(this.toRawBytes(t))}}b.BASE=new b(o.Gx,o.Gy,s.ONE),b.ZERO=new b(s.ZERO,s.ONE,s.ZERO);const m=o.nBitLength,E=(0,e.wNAF)(b,o.endo?Math.ceil(m/2):m);return{CURVE:o,ProjectivePoint:b,normPrivateKeyToScalar:y,weierstrassEquation:p,isWithinCurveOrder:l}}function l(t,e){const r=t.ORDER;let n=a;for(let t=r-u;t%c===a;t/=c)n+=u;const i=n,o=c<<i-u-u,s=o*c,p=(r-u)/s,l=(p-u)/c,d=s-u,y=o,w=t.pow(e,p),g=t.pow(e,(p+u)/c);let b=(e,r)=>{let n=w,o=t.pow(r,d),s=t.sqr(o);s=t.mul(s,r);let a=t.mul(e,s);a=t.pow(a,l),a=t.mul(a,o),o=t.mul(a,r),s=t.mul(a,e);let f=t.mul(s,o);a=t.pow(f,y);let h=t.eql(a,t.ONE);o=t.mul(s,g),a=t.mul(f,n),s=t.cmov(o,s,h),f=t.cmov(a,f,h);for(let e=i;e>u;e--){let r=e-c;r=c<<r-u;let i=t.pow(f,r);const a=t.eql(i,t.ONE);o=t.mul(s,n),n=t.mul(n,n),i=t.mul(f,n),s=t.cmov(o,s,a),f=t.cmov(i,f,a)}return{isValid:h,value:s}};if(t.ORDER%h===f){const r=(t.ORDER-f)/h,n=t.sqrt(t.neg(e));b=(e,i)=>{let o=t.sqr(i);const s=t.mul(e,i);o=t.mul(o,s);let a=t.pow(o,r);a=t.mul(a,s);const u=t.mul(a,n),c=t.mul(t.sqr(a),i),f=t.eql(c,e);return{isValid:f,value:t.cmov(u,a,f)}}}return b}}(Mu),Object.defineProperty(Hu,"__esModule",{value:!0}),Hu.getHash=Uc,Hu.createCurve=function(t,e){const r=e=>(0,xc.weierstrass)({...t,...Uc(e)});return Object.freeze({...r(e),create:r})};
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Ac=Du,Bc=ir,xc=Mu;function Uc(t){return{hash:t,hmac:(e,...r)=>(0,Ac.hmac)(t,e,(0,Bc.concatBytes)(...r)),randomBytes:Bc.randomBytes}}var Cc={};Object.defineProperty(Cc,"__esModule",{value:!0}),Cc.expand_message_xmd=Fc,Cc.expand_message_xof=jc,Cc.hash_to_field=Kc,Cc.isogenyMap=function(t,e){const r=e.map((t=>Array.from(t).reverse()));return(e,n)=>{const[i,o,s,a]=r.map((r=>r.reduce(((r,n)=>t.add(t.mul(r,e),n)))));return e=t.div(i,o),n=t.mul(n,t.div(s,a)),{x:e,y:n}}},Cc.createHasher=function(t,e,r){if("function"!=typeof e)throw new Error("mapToCurve() must be defined");return{hashToCurve(n,i){const o=Kc(n,2,{...r,DST:r.DST,...i}),s=t.fromAffine(e(o[0])),a=t.fromAffine(e(o[1])),u=s.add(a).clearCofactor();return u.assertValidity(),u},encodeToCurve(n,i){const o=Kc(n,1,{...r,DST:r.encodeDST,...i}),s=t.fromAffine(e(o[0])).clearCofactor();return s.assertValidity(),s},mapToCurve(r){if(!Array.isArray(r))throw new Error("mapToCurve: expected array of bigints");for(const t of r)if("bigint"!=typeof t)throw new Error(`mapToCurve: expected array of bigints, got ${t} in array`);const n=t.fromAffine(e(r)).clearCofactor();return n.assertValidity(),n}}};const Nc=ju,Rc=Ku,Lc=Rc.bytesToNumberBE;function Hc(t,e){if(t<0||t>=1<<8*e)throw new Error(`bad I2OSP call: value=${t} length=${e}`);const r=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)r[n]=255&t,t>>>=8;return new Uint8Array(r)}function Dc(t,e){const r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}function Mc(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function Fc(t,e,r,n){(0,Rc.abytes)(t),(0,Rc.abytes)(e),Mc(r),e.length>255&&(e=n((0,Rc.concatBytes)((0,Rc.utf8ToBytes)("H2C-OVERSIZE-DST-"),e)));const{outputLen:i,blockLen:o}=n,s=Math.ceil(r/i);if(s>255)throw new Error("Invalid xmd length");const a=(0,Rc.concatBytes)(e,Hc(e.length,1)),u=Hc(0,o),c=Hc(r,2),f=new Array(s),h=n((0,Rc.concatBytes)(u,t,c,Hc(0,1),a));f[0]=n((0,Rc.concatBytes)(h,Hc(1,1),a));for(let t=1;t<=s;t++){const e=[Dc(h,f[t-1]),Hc(t+1,1),a];f[t]=n((0,Rc.concatBytes)(...e))}return(0,Rc.concatBytes)(...f).slice(0,r)}function jc(t,e,r,n,i){if((0,Rc.abytes)(t),(0,Rc.abytes)(e),Mc(r),e.length>255){const t=Math.ceil(2*n/8);e=i.create({dkLen:t}).update((0,Rc.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:r}).update(t).update(Hc(r,2)).update(e).update(Hc(e.length,1)).digest()}function Kc(t,e,r){(0,Rc.validateObject)(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:n,k:i,m:o,hash:s,expand:a,DST:u}=r;(0,Rc.abytes)(t),Mc(e);const c="string"==typeof u?(0,Rc.utf8ToBytes)(u):u,f=n.toString(2).length,h=Math.ceil((f+i)/8),p=e*o*h;let l;if("xmd"===a)l=Fc(t,c,p,s);else if("xof"===a)l=jc(t,c,p,i,s);else{if("_internal_pass"!==a)throw new Error('expand must be "xmd" or "xof"');l=t}const d=new Array(e);for(let t=0;t<e;t++){const e=new Array(o);for(let r=0;r<o;r++){const i=h*(r+t*o),s=l.subarray(i,i+h);e[r]=(0,Nc.mod)(Lc(s),n)}d[t]=e}return d}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeToCurve=t.hashToCurve=t.schnorr=t.secp256k1=void 0;
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const e=Ar,r=ir,n=Hu,i=Cc,o=ju,s=Ku,a=Mu,u=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),c=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),f=BigInt(1),h=BigInt(2),p=(t,e)=>(t+e/h)/e;function l(t){const e=u,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),a=BigInt(23),c=BigInt(44),f=BigInt(88),p=t*t*t%e,l=p*p*t%e,y=(0,o.pow2)(l,r,e)*l%e,w=(0,o.pow2)(y,r,e)*l%e,g=(0,o.pow2)(w,h,e)*p%e,b=(0,o.pow2)(g,i,e)*g%e,m=(0,o.pow2)(b,s,e)*b%e,E=(0,o.pow2)(m,c,e)*m%e,v=(0,o.pow2)(E,f,e)*E%e,S=(0,o.pow2)(v,c,e)*m%e,T=(0,o.pow2)(S,r,e)*l%e,O=(0,o.pow2)(T,a,e)*b%e,P=(0,o.pow2)(O,n,e)*p%e,_=(0,o.pow2)(P,h,e);if(!d.eql(d.sqr(_),t))throw new Error("Cannot find square root");return _}const d=(0,o.Field)(u,void 0,void 0,{sqrt:l});t.secp256k1=(0,n.createCurve)({a:BigInt(0),b:BigInt(7),Fp:d,n:c,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=c,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-f*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,a=BigInt("0x100000000000000000000000000000000"),u=p(s*t,e),h=p(-n*t,e);let l=(0,o.mod)(t-u*r-h*i,e),d=(0,o.mod)(-u*n-h*s,e);const y=l>a,w=d>a;if(y&&(l=e-l),w&&(d=e-d),l>a||d>a)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:y,k1:l,k2neg:w,k2:d}}}},e.sha256);const y=BigInt(0),w=t=>"bigint"==typeof t&&y<t&&t<u,g=t=>"bigint"==typeof t&&y<t&&t<c,b={};function m(t,...r){let n=b[t];if(void 0===n){const r=(0,e.sha256)(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=(0,s.concatBytes)(r,r),b[t]=n}return(0,e.sha256)((0,s.concatBytes)(n,...r))}const E=t=>t.toRawBytes(!0).slice(1),v=t=>(0,s.numberToBytesBE)(t,32),S=t=>(0,o.mod)(t,u),T=t=>(0,o.mod)(t,c),O=t.secp256k1.ProjectivePoint,P=(t,e,r)=>O.BASE.multiplyAndAddUnsafe(t,e,r);function _(e){let r=t.secp256k1.utils.normPrivateKeyToScalar(e),n=O.fromPrivateKey(r);return{scalar:n.hasEvenY()?r:T(-r),bytes:E(n)}}function I(t){if(!w(t))throw new Error("bad x: need 0 < x < p");const e=S(t*t);let r=l(S(e*t+BigInt(7)));r%h!==y&&(r=S(-r));const n=new O(t,r,f);return n.assertValidity(),n}function k(...t){return T((0,s.bytesToNumberBE)(m("BIP0340/challenge",...t)))}function A(t){return _(t).bytes}function B(t,e,n=(0,r.randomBytes)(32)){const i=(0,s.ensureBytes)("message",t),{bytes:o,scalar:a}=_(e),u=(0,s.ensureBytes)("auxRand",n,32),c=v(a^(0,s.bytesToNumberBE)(m("BIP0340/aux",u))),f=m("BIP0340/nonce",c,o,i),h=T((0,s.bytesToNumberBE)(f));if(h===y)throw new Error("sign failed: k is zero");const{bytes:p,scalar:l}=_(h),d=k(p,o,i),w=new Uint8Array(64);if(w.set(p,0),w.set(v(T(l+d*a)),32),!x(w,i,o))throw new Error("sign: Invalid signature produced");return w}function x(t,e,r){const n=(0,s.ensureBytes)("signature",t,64),i=(0,s.ensureBytes)("message",e),o=(0,s.ensureBytes)("publicKey",r,32);try{const t=I((0,s.bytesToNumberBE)(o)),e=(0,s.bytesToNumberBE)(n.subarray(0,32));if(!w(e))return!1;const r=(0,s.bytesToNumberBE)(n.subarray(32,64));if(!g(r))return!1;const a=k(v(e),E(t),i),u=P(t,r,T(-a));return!(!u||!u.hasEvenY()||u.toAffine().x!==e)}catch(t){return!1}}t.schnorr={getPublicKey:A,sign:B,verify:x,utils:{randomPrivateKey:t.secp256k1.utils.randomPrivateKey,lift_x:I,pointToBytes:E,numberToBytesBE:s.numberToBytesBE,bytesToNumberBE:s.bytesToNumberBE,taggedHash:m,mod:o.mod}};const U=(()=>(0,i.isogenyMap)(d,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map((t=>t.map((t=>BigInt(t)))))))(),C=(()=>(0,a.mapToCurveSimpleSWU)(d,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:d.create(BigInt("-11"))}))(),N=(()=>(0,i.createHasher)(t.secp256k1.ProjectivePoint,(t=>{const{x:e,y:r}=C(d.create(t[0]));return U(e,r)}),{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:d.ORDER,m:1,k:128,expand:"xmd",hash:e.sha256}))();t.hashToCurve=N.hashToCurve,t.encodeToCurve=N.encodeToCurve}(Lu),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.compareBytes=t.TEST_NETWORK=t.NETWORK=t.TAPROOT_UNSPENDABLE_KEY=t.taprootTweakPubkey=t.taprootTweakPrivKey=t.tapTweak=t.validatePubkey=t.PubT=t.tagSchnorr=t.signSchnorr=t.signECDSA=t.pubECDSA=t.pubSchnorr=t.randomPrivateKeyBytes=t.sha256x2=t.hash160=t.equalBytes=t.concatBytes=t.isBytes=t.sha256=void 0;const e=Nu,r=ze,n=Ar;Object.defineProperty(t,"sha256",{enumerable:!0,get:function(){return n.sha256}});const i=Lu,o=i.secp256k1.ProjectivePoint,s=i.secp256k1.CURVE.n,{isBytes:a,concatBytes:u,equalBytes:c}=e.utils;t.isBytes=a,t.concatBytes=u,t.equalBytes=c;t.hash160=t=>(0,r.ripemd160)((0,n.sha256)(t));t.sha256x2=(...t)=>(0,n.sha256)((0,n.sha256)(u(...t))),t.randomPrivateKeyBytes=i.schnorr.utils.randomPrivateKey,t.pubSchnorr=i.schnorr.getPublicKey,t.pubECDSA=i.secp256k1.getPublicKey;const f=t=>t.r<s/2n;var h;function p(t,e){const r=i.schnorr.utils,n=r.taggedHash("TapTweak",t,e),o=r.bytesToNumberBE(n);if(o>=s)throw new Error("tweak higher than curve order");return o}t.signECDSA=function(t,r,n=!1){let o=i.secp256k1.sign(t,r);if(n&&!f(o)){const n=new Uint8Array(32);let s=0;for(;!f(o);)if(n.set(e.U32LE.encode(s++)),o=i.secp256k1.sign(t,r,{extraEntropy:n}),s>4294967295)throw new Error("lowR counter overflow: report the error")}return o.toDERRawBytes()},t.signSchnorr=i.schnorr.sign,t.tagSchnorr=i.schnorr.utils.taggedHash,function(t){t[t.ecdsa=0]="ecdsa",t[t.schnorr=1]="schnorr"}(h||(t.PubT=h={})),t.validatePubkey=function(t,e){const r=t.length;if(e===h.ecdsa){if(32===r)throw new Error("Expected non-Schnorr key");return o.fromHex(t),t}if(e===h.schnorr){if(32!==r)throw new Error("Expected 32-byte Schnorr key");return i.schnorr.utils.lift_x(i.schnorr.utils.bytesToNumberBE(t)),t}throw new Error("Unknown key type")},t.tapTweak=p,t.taprootTweakPrivKey=function(t,e=new Uint8Array){const r=i.schnorr.utils,n=r.bytesToNumberBE(t),a=o.fromPrivateKey(n),u=a.hasEvenY()?n:r.mod(-n,s),c=p(r.pointToBytes(a),e);return r.numberToBytesBE(r.mod(u+c,s),32)},t.taprootTweakPubkey=function(t,e){const r=i.schnorr.utils,n=p(t,e),s=r.lift_x(r.bytesToNumberBE(t)).add(o.fromPrivateKey(n)),a=s.hasEvenY()?0:1;return[r.pointToBytes(s),a]},t.TAPROOT_UNSPENDABLE_KEY=(0,n.sha256)(o.BASE.toRawBytes(!1)),t.NETWORK={bech32:"bc",pubKeyHash:0,scriptHash:5,wif:128},t.TEST_NETWORK={bech32:"tb",pubKeyHash:111,scriptHash:196,wif:239},t.compareBytes=function(t,e){if(!a(t)||!a(e))throw new Error(`cmp: wrong type a=${typeof t} b=${typeof e}`);const r=Math.min(t.length,e.length);for(let n=0;n<r;n++)if(t[n]!=e[n])return Math.sign(t[n]-e[n]);return Math.sign(t.length-e.length)}}(Cu);var $c={},Vc={},Wc={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RawTx=t.RawOutput=t.RawInput=t.BTCArray=t.RawWitness=t.VarBytes=t.CompactSizeLen=t.CompactSize=t.Script=t.OpToNum=t.ScriptNum=t.OP=t.MAX_SCRIPT_BYTE_LENGTH=void 0;const e=Nu,r=Cu;var n;function i(t=6,r=!1){return e.wrap({encodeStream:(t,e)=>{if(0n===e)return;const r=e<0,n=BigInt(e),i=[];for(let t=r?-n:n;t;t>>=8n)i.push(Number(0xffn&t));i[i.length-1]>=128?i.push(r?128:0):r&&(i[i.length-1]|=128),t.bytes(new Uint8Array(i))},decodeStream:e=>{const n=e.leftBytes;if(n>t)throw new Error(`ScriptNum: number (${n}) bigger than limit=${t}`);if(0===n)return 0n;if(r){const t=e.bytes(n,!0);if(!(127&t[t.length-1]||!(n<=1)&&128&t[t.length-2]))throw new Error("Non-minimally encoded ScriptNum")}let i=0,o=0n;for(let t=0;t<n;++t)i=e.byte(),o|=BigInt(i)<<8n*BigInt(t);return i>=128&&(o&=2n**BigInt(8*n)-1n>>1n,o=-o),o}})}t.MAX_SCRIPT_BYTE_LENGTH=520,function(t){t[t.OP_0=0]="OP_0",t[t.PUSHDATA1=76]="PUSHDATA1",t[t.PUSHDATA2=77]="PUSHDATA2",t[t.PUSHDATA4=78]="PUSHDATA4",t[t["1NEGATE"]=79]="1NEGATE",t[t.RESERVED=80]="RESERVED",t[t.OP_1=81]="OP_1",t[t.OP_2=82]="OP_2",t[t.OP_3=83]="OP_3",t[t.OP_4=84]="OP_4",t[t.OP_5=85]="OP_5",t[t.OP_6=86]="OP_6",t[t.OP_7=87]="OP_7",t[t.OP_8=88]="OP_8",t[t.OP_9=89]="OP_9",t[t.OP_10=90]="OP_10",t[t.OP_11=91]="OP_11",t[t.OP_12=92]="OP_12",t[t.OP_13=93]="OP_13",t[t.OP_14=94]="OP_14",t[t.OP_15=95]="OP_15",t[t.OP_16=96]="OP_16",t[t.NOP=97]="NOP",t[t.VER=98]="VER",t[t.IF=99]="IF",t[t.NOTIF=100]="NOTIF",t[t.VERIF=101]="VERIF",t[t.VERNOTIF=102]="VERNOTIF",t[t.ELSE=103]="ELSE",t[t.ENDIF=104]="ENDIF",t[t.VERIFY=105]="VERIFY",t[t.RETURN=106]="RETURN",t[t.TOALTSTACK=107]="TOALTSTACK",t[t.FROMALTSTACK=108]="FROMALTSTACK",t[t["2DROP"]=109]="2DROP",t[t["2DUP"]=110]="2DUP",t[t["3DUP"]=111]="3DUP",t[t["2OVER"]=112]="2OVER",t[t["2ROT"]=113]="2ROT",t[t["2SWAP"]=114]="2SWAP",t[t.IFDUP=115]="IFDUP",t[t.DEPTH=116]="DEPTH",t[t.DROP=117]="DROP",t[t.DUP=118]="DUP",t[t.NIP=119]="NIP",t[t.OVER=120]="OVER",t[t.PICK=121]="PICK",t[t.ROLL=122]="ROLL",t[t.ROT=123]="ROT",t[t.SWAP=124]="SWAP",t[t.TUCK=125]="TUCK",t[t.CAT=126]="CAT",t[t.SUBSTR=127]="SUBSTR",t[t.LEFT=128]="LEFT",t[t.RIGHT=129]="RIGHT",t[t.SIZE=130]="SIZE",t[t.INVERT=131]="INVERT",t[t.AND=132]="AND",t[t.OR=133]="OR",t[t.XOR=134]="XOR",t[t.EQUAL=135]="EQUAL",t[t.EQUALVERIFY=136]="EQUALVERIFY",t[t.RESERVED1=137]="RESERVED1",t[t.RESERVED2=138]="RESERVED2",t[t["1ADD"]=139]="1ADD",t[t["1SUB"]=140]="1SUB",t[t["2MUL"]=141]="2MUL",t[t["2DIV"]=142]="2DIV",t[t.NEGATE=143]="NEGATE",t[t.ABS=144]="ABS",t[t.NOT=145]="NOT",t[t["0NOTEQUAL"]=146]="0NOTEQUAL",t[t.ADD=147]="ADD",t[t.SUB=148]="SUB",t[t.MUL=149]="MUL",t[t.DIV=150]="DIV",t[t.MOD=151]="MOD",t[t.LSHIFT=152]="LSHIFT",t[t.RSHIFT=153]="RSHIFT",t[t.BOOLAND=154]="BOOLAND",t[t.BOOLOR=155]="BOOLOR",t[t.NUMEQUAL=156]="NUMEQUAL",t[t.NUMEQUALVERIFY=157]="NUMEQUALVERIFY",t[t.NUMNOTEQUAL=158]="NUMNOTEQUAL",t[t.LESSTHAN=159]="LESSTHAN",t[t.GREATERTHAN=160]="GREATERTHAN",t[t.LESSTHANOREQUAL=161]="LESSTHANOREQUAL",t[t.GREATERTHANOREQUAL=162]="GREATERTHANOREQUAL",t[t.MIN=163]="MIN",t[t.MAX=164]="MAX",t[t.WITHIN=165]="WITHIN",t[t.RIPEMD160=166]="RIPEMD160",t[t.SHA1=167]="SHA1",t[t.SHA256=168]="SHA256",t[t.HASH160=169]="HASH160",t[t.HASH256=170]="HASH256",t[t.CODESEPARATOR=171]="CODESEPARATOR",t[t.CHECKSIG=172]="CHECKSIG",t[t.CHECKSIGVERIFY=173]="CHECKSIGVERIFY",t[t.CHECKMULTISIG=174]="CHECKMULTISIG",t[t.CHECKMULTISIGVERIFY=175]="CHECKMULTISIGVERIFY",t[t.NOP1=176]="NOP1",t[t.CHECKLOCKTIMEVERIFY=177]="CHECKLOCKTIMEVERIFY",t[t.CHECKSEQUENCEVERIFY=178]="CHECKSEQUENCEVERIFY",t[t.NOP4=179]="NOP4",t[t.NOP5=180]="NOP5",t[t.NOP6=181]="NOP6",t[t.NOP7=182]="NOP7",t[t.NOP8=183]="NOP8",t[t.NOP9=184]="NOP9",t[t.NOP10=185]="NOP10",t[t.CHECKSIGADD=186]="CHECKSIGADD",t[t.INVALID=255]="INVALID"}(n||(t.OP=n={})),t.ScriptNum=i,t.OpToNum=function(t,e=4,n=!0){if("number"==typeof t)return t;if((0,r.isBytes)(t))try{const r=i(e,n).decode(t);if(r>Number.MAX_SAFE_INTEGER)return;return Number(r)}catch(t){return}},t.Script=e.wrap({encodeStream:(t,o)=>{for(let s of o){if("string"==typeof s){if(void 0===n[s])throw new Error(`Unknown opcode=${s}`);t.byte(n[s]);continue}if("number"==typeof s){if(0===s){t.byte(0);continue}if(1<=s&&s<=16){t.byte(n.OP_1-1+s);continue}}if("number"==typeof s&&(s=i().encode(BigInt(s))),!(0,r.isBytes)(s))throw new Error(`Wrong Script OP=${s} (${typeof s})`);const o=s.length;o<n.PUSHDATA1?t.byte(o):o<=255?(t.byte(n.PUSHDATA1),t.byte(o)):o<=65535?(t.byte(n.PUSHDATA2),t.bytes(e.U16LE.encode(o))):(t.byte(n.PUSHDATA4),t.bytes(e.U32LE.encode(o))),t.bytes(s)}},decodeStream:t=>{const r=[];for(;!t.isEnd();){const i=t.byte();if(n.OP_0<i&&i<=n.PUSHDATA4){let o;if(i<n.PUSHDATA1)o=i;else if(i===n.PUSHDATA1)o=e.U8.decodeStream(t);else if(i===n.PUSHDATA2)o=e.U16LE.decodeStream(t);else{if(i!==n.PUSHDATA4)throw new Error("Should be not possible");o=e.U32LE.decodeStream(t)}r.push(t.bytes(o))}else if(0===i)r.push(0);else if(n.OP_1<=i&&i<=n.OP_16)r.push(i-(n.OP_1-1));else{const t=n[i];if(void 0===t)throw new Error(`Unknown opcode=${i.toString(16)}`);r.push(t)}}return r}});const o={253:[253,2,253n,65535n],254:[254,4,65536n,4294967295n],255:[255,8,4294967296n,18446744073709551615n]};t.CompactSize=e.wrap({encodeStream:(t,e)=>{if("number"==typeof e&&(e=BigInt(e)),0n<=e&&e<=252n)return t.byte(Number(e));for(const[r,n,i,s]of Object.values(o))if(!(i>e||e>s)){t.byte(r);for(let r=0;r<n;r++)t.byte(Number(e>>8n*BigInt(r)&0xffn));return}throw t.err(`VarInt too big: ${e}`)},decodeStream:t=>{const e=t.byte();if(e<=252)return BigInt(e);const[r,n,i]=o[e];let s=0n;for(let e=0;e<n;e++)s|=BigInt(t.byte())<<8n*BigInt(e);if(s<i)throw t.err(`Wrong CompactSize(${8*n})`);return s}}),t.CompactSizeLen=e.apply(t.CompactSize,e.coders.numberBigint),t.VarBytes=e.bytes(t.CompactSize),t.RawWitness=e.array(t.CompactSizeLen,t.VarBytes);t.BTCArray=r=>e.array(t.CompactSize,r),t.RawInput=e.struct({txid:e.bytes(32,!0),index:e.U32LE,finalScriptSig:t.VarBytes,sequence:e.U32LE}),t.RawOutput=e.struct({amount:e.U64LE,script:t.VarBytes});const s=e.struct({version:e.I32LE,segwitFlag:e.flag(new Uint8Array([0,1])),inputs:(0,t.BTCArray)(t.RawInput),outputs:(0,t.BTCArray)(t.RawOutput),witnesses:e.flagged("segwitFlag",e.array("inputs/length",t.RawWitness)),lockTime:e.U32LE});t.RawTx=e.validate(s,(function(t){if(t.segwitFlag&&t.witnesses&&!t.witnesses.length)throw new Error("Segwit flag with empty witnesses array");return t}))}(Wc);var qc,zc,Gc,Yc,Xc={},Qc={};function Zc(){return qc||(qc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.selectUTXO=t._Estimator=t._cmpBig=t.toVsize=t.getInputType=t.normalizeInput=t.getPrevOut=void 0;const e=Ru,r=Nu,n=ef(),i=tf(),o=Wc,s=Jc(),a=Cu,u=Cu;function c(t){if(t.nonWitnessUtxo){if(void 0===t.index)throw new Error("Unknown input index");return t.nonWitnessUtxo.outputs[t.index]}if(t.witnessUtxo)return t.witnessUtxo;throw new Error("Cannot find previous output info")}function f(t,r,u,c=!1){let{nonWitnessUtxo:f,txid:h}=t;"string"==typeof f&&(f=e.hex.decode(f)),(0,a.isBytes)(f)&&(f=o.RawTx.decode(f)),"nonWitnessUtxo"in t||void 0!==f||(f=r?.nonWitnessUtxo),"string"==typeof h&&(h=e.hex.decode(h)),void 0===h&&(h=r?.txid);let p,l={...r,...t,nonWitnessUtxo:f,txid:h};return"nonWitnessUtxo"in t||void 0!==l.nonWitnessUtxo||delete l.nonWitnessUtxo,void 0===l.sequence&&(l.sequence=s.DEFAULT_SEQUENCE),null===l.tapMerkleRoot&&delete l.tapMerkleRoot,l=i.mergeKeyMap(i.PSBTInput,l,r,u),i.PSBTInputCoder.encode(l),l.nonWitnessUtxo&&void 0!==l.index?p=l.nonWitnessUtxo.outputs[l.index]:l.witnessUtxo&&(p=l.witnessUtxo),p&&!c&&(0,n.checkScript)(p&&p.script,l.redeemScript,l.witnessScript),l}function h(t,e=!1){let r="legacy",i=s.SignatureHash.ALL;const o=c(t),a=n.OutScript.decode(o.script);let u=a.type,f=a;const h=[a];if("tr"===a.type)return i=s.SignatureHash.DEFAULT,{txType:"taproot",type:"tr",last:a,lastScript:o.script,defaultSighash:i,sighash:t.sighashType||i};{if("wpkh"!==a.type&&"wsh"!==a.type||(r="segwit"),"sh"===a.type){if(!t.redeemScript)throw new Error("inputType: sh without redeemScript");let e=n.OutScript.decode(t.redeemScript);"wpkh"!==e.type&&"wsh"!==e.type||(r="segwit"),h.push(e),f=e,u+=`-${e.type}`}if("wsh"===f.type){if(!t.witnessScript)throw new Error("inputType: wsh without witnessScript");let e=n.OutScript.decode(t.witnessScript);"wsh"===e.type&&(r="segwit"),h.push(e),f=e,u+=`-${e.type}`}const o=h[h.length-1];if("sh"===o.type||"wsh"===o.type)throw new Error("inputType: sh/wsh cannot be terminal type");const s={type:u,txType:r,last:o,lastScript:n.OutScript.encode(o),defaultSighash:i,sighash:t.sighashType||i};if("legacy"===r&&!e&&!t.nonWitnessUtxo)throw new Error("Transaction/sign: legacy input without nonWitnessUtxo, can result in attack that forces paying higher fees. Pass allowLegacyWitnessUtxo=true, if you sure");return s}}t.getPrevOut=c,t.normalizeInput=f,t.getInputType=h;t.toVsize=t=>Math.ceil(t/4);const p=t=>i.TaprootControlBlock.encode(t);function l(t,e,i){let c,f=r.EMPTY;if("taproot"===t.txType){const f=t.sighash!==s.SignatureHash.DEFAULT?65:64;if(e.tapInternalKey&&!(0,a.equalBytes)(e.tapInternalKey,a.TAPROOT_UNSPENDABLE_KEY))c=[new Uint8Array(f)];else{if(!e.tapLeafScript)throw new Error("estimateInput/taproot: unknown input");c=function(t,e,i){if(!t||!t.length)throw new Error("no leafs");const s=()=>new Uint8Array(e),c=t.sort(((t,e)=>p(t[0]).length-p(e[0]).length));for(const[t,e]of c){const c=e.slice(0,-1),f=e[e.length-1],h=n.OutScript.decode(c);let l=[];if("tr_ms"===h.type){const t=h.m,e=h.pubkeys.length-t;for(let e=0;e<t;e++)l.push(s());for(let t=0;t<e;t++)l.push(r.EMPTY)}else if("tr_ns"===h.type)for(const t of h.pubkeys)l.push(s());else{if(!i)throw new Error("Finalize: Unknown tapLeafScript");const e=(0,n.tapLeafHash)(c,f);for(const r of i){if(!r.finalizeTaproot)continue;const n=o.Script.decode(c),i=r.encode(n);if(void 0===i)continue;const f=n.filter((t=>{if(!(0,a.isBytes)(t))return!1;try{return(0,u.validatePubkey)(t,u.PubT.schnorr),!0}catch(t){return!1}})),h=r.finalizeTaproot(c,i,f.map((t=>[{pubKey:t,leafHash:e},s()])));if(h)return h.concat(p(t))}}return l.reverse().concat([c,p(t)])}throw new Error("there was no witness")}(e.tapLeafScript,f,i.customScripts)}}else{const e=()=>new Uint8Array(72),n=()=>new Uint8Array(33);let s=r.EMPTY,u=[];const h=t.last.type;if("ms"===h){const r=t.last.m,n=[0];for(let t=0;t<r;t++)n.push(e());s=o.Script.encode(n)}else if("pk"===h)s=o.Script.encode([e()]);else if("pkh"===h)s=o.Script.encode([e(),n()]);else if("wpkh"===h)s=r.EMPTY,u=[e(),n()];else if("unknown"===h&&!i.allowUnknownInputs)throw new Error("Unknown inputs are not allowed");t.type.includes("wsh-")&&(s.length&&t.lastScript.length&&(u=o.Script.decode(s).map((t=>{if(0===t)return r.EMPTY;if((0,a.isBytes)(t))return t;throw new Error(`Wrong witness op=${t}`)}))),u=u.concat(t.lastScript)),"segwit"===t.txType&&(c=u),t.type.startsWith("sh-wsh-")?f=o.Script.encode([o.Script.encode([0,new Uint8Array(a.sha256.outputLen)])]):t.type.startsWith("sh-")?f=o.Script.encode([...o.Script.decode(s),t.lastScript]):t.type.startsWith("wsh-")||"segwit"!==t.txType&&(f=s)}let h=160+4*o.VarBytes.encode(f).length,l=!1;return c&&(h+=o.RawWitness.encode(c).length,l=!0),{weight:h,hasWitnesses:l}}function d(t,e={},r=a.NETWORK){let i;if("script"in t&&t.script instanceof Uint8Array&&(i=t.script),"address"in t){if("string"!=typeof t.address)throw new Error(`Estimator: wrong output address=${t.address}`);i=n.OutScript.encode((0,n.Address)(r).decode(t.address))}if(!i)throw new Error("Estimator: wrong output script");if("bigint"!=typeof t.amount)throw new Error(`Estimator: wrong output amount=${t.amount}`);if(i&&!e.allowUnknownOutputs&&"unknown"===n.OutScript.decode(i).type)throw new Error("Estimator: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownOutputs=true, if you sure");return e.disableScriptCheck||(0,n.checkScript)(i),i}t._cmpBig=(t,e)=>{const r=t-e;return r<0n?-1:r>0n?1:0};class y{constructor(e,r,i){if(this.inputs=e,this.outputs=r,this.opts=i,this.dust=148n,"bigint"!=typeof i.feePerByte)throw new Error(`Estimator: wrong feePerByte=${i.feePerByte}`);if(i.dust){if("bigint"!=typeof i.dust)throw new Error(`Estimator: wrong dust=${i.dust}`);this.dust=i.dust}const u=i.network||a.NETWORK;let p=0n,y=32;for(const t of r){const e=d(t,i,i.network);y+=32+4*o.VarBytes.encode(e).length,p+=t.amount}if("string"!=typeof i.changeAddress)throw new Error(`Estimator: wrong change address=${i.changeAddress}`);let w=y+32+4*o.VarBytes.encode(n.OutScript.encode((0,n.Address)(u).decode(i.changeAddress))).length;y+=4*o.CompactSizeLen.encode(r.length).length,w+=4*o.CompactSizeLen.encode(r.length+1).length,this.baseWeight=y,this.changeWeight=w,this.amount=p,this.normalizedInputs=this.inputs.map((e=>{const r=f(e,void 0,void 0,i.disableScriptCheck);(0,s.inputBeforeSign)(r);const n=h(r,i.allowLegacyWitnessUtxo),o=c(r),a=l(n,r,this.opts),u=o.amount-i.feePerByte*BigInt((0,t.toVsize)(a.weight));return{inputType:n,normalized:r,amount:o.amount,value:u,estimate:a}}))}checkInputIdx(t){if(!Number.isSafeInteger(t)||0>t||t>=this.inputs.length)throw new Error(`Wrong input index=${t}`);return t}sortIndices(t){return t.slice().sort(((t,e)=>{const r=this.normalizedInputs[this.checkInputIdx(t)],n=this.normalizedInputs[this.checkInputIdx(e)],i=(0,a.compareBytes)(r.normalized.txid,n.normalized.txid);return 0!==i?i:r.normalized.index-n.normalized.index}))}sortOutputs(e){const r=e.map((t=>d(t,this.opts,this.opts.network)));return e.map(((t,e)=>e)).sort(((n,i)=>{const o=e[n].amount,s=e[i].amount,u=(0,t._cmpBig)(o,s);return 0!==u?u:(0,a.compareBytes)(r[n],r[i])}))}getSatoshi(e){return this.opts.feePerByte*BigInt((0,t.toVsize)(e))}get biggest(){return this.inputs.map(((t,e)=>e)).sort(((e,r)=>(0,t._cmpBig)(this.normalizedInputs[r].value,this.normalizedInputs[e].value)))}get smallest(){return this.biggest.reverse()}get oldest(){return this.inputs.map(((t,e)=>e))}get newest(){return this.oldest.reverse()}accumulate(t,e=!1,r=!0,n=!1){const{feePerByte:i}=this.opts;let s=this.opts.alwaysChange?this.changeWeight:this.baseWeight,a=!1,u=0,c=0n;const f=this.amount,h=[];let p;for(const l of t){this.checkInputIdx(l);const{estimate:t,amount:d,value:y}=this.normalizedInputs[l];let w=s+t.weight;!a&&t.hasWitnesses&&(w+=2);const g=w+4*o.CompactSizeLen.encode(u).length;if(p=this.getSatoshi(g),e){if(d+c>f+p+this.dust*i)continue}if(!(r&&y<=0n)&&(s=w,t.hasWitnesses&&(a=!0),u++,c+=d,h.push(l),!n&&f+p<c))return{indices:h,fee:p,weight:g,total:c}}if(n){return{indices:h,fee:p,weight:s+4*o.CompactSizeLen.encode(u).length,total:c}}}default(){const{biggest:t}=this,e=this.accumulate(t,!0,!1);return e||this.accumulate(t)}select(t){if("all"===t)return this.accumulate(this.inputs.map(((t,e)=>e)),!1,!0,!0);if("default"===t)return this.default();const e={Oldest:()=>this.oldest,Newest:()=>this.newest,Smallest:()=>this.smallest,Biggest:()=>this.biggest};if(t.startsWith("exact")){const[r,n]=t.slice(5).split("/");if(!e[r])throw new Error(`Estimator.select: wrong strategy=${t}`);t=n;const i=this.accumulate(e[r](),!0,!0);if(i)return i}if(t.startsWith("accum")){const r=t.slice(5);if(!e[r])throw new Error(`Estimator.select: wrong strategy=${t}`);return this.accumulate(e[r]())}throw new Error(`Estimator.select: wrong strategy=${t}`)}result(t){const e=this.select(t);if(!e)return;const{indices:r,weight:n,total:i}=e;let o=this.opts.alwaysChange;const a=this.opts.alwaysChange?n:n+(this.changeWeight-this.baseWeight),u=this.getSatoshi(a);let c=e.fee;const f=i-this.amount-u;f>this.dust&&(o=!0);let h=r,p=Array.from(this.outputs);if(o){if(c=u,f<0n)throw new Error(`Estimator.result: negative change=${f}`);p.push({address:this.opts.changeAddress,amount:f})}this.opts.bip69&&(h=this.sortIndices(h),p=this.sortOutputs(p).map((t=>p[t])));const l={inputs:h.map((t=>this.inputs[t])),outputs:p,fee:c,weight:this.opts.alwaysChange?e.weight:a,change:!!o};let y;if(this.opts.createTx){const{inputs:t,outputs:e}=l;y=new s.Transaction(this.opts);for(const e of t)y.addInput(e);for(const t of e)y.addOutput({...t,script:d(t,this.opts,this.opts.network)})}return{...l,tx:y}}}t._Estimator=y,t.selectUTXO=function(t,e,r,n){const i={createTx:!0,bip69:!0,...n};return new y(t,e,i).result(r)}}(Qc)),Qc}function Jc(){return zc||(zc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.bip32Path=t.PSBTCombine=t.Transaction=t.inputBeforeSign=t.SigHash=t.SignatureHash=t.cloneDeep=t.def=t.Decimal=t.DEFAULT_SEQUENCE=t.DEFAULT_LOCKTIME=t.DEFAULT_VERSION=t.PRECISION=void 0;const e=Nu,r=Ru,n=ef(),i=tf(),o=Wc,s=Cu,a=Cu,u=Zc(),c=new Uint8Array(32),f={amount:0xffffffffffffffffn,script:e.EMPTY};t.PRECISION=8,t.DEFAULT_VERSION=2,t.DEFAULT_LOCKTIME=0,t.DEFAULT_SEQUENCE=4294967295,t.Decimal=e.coders.decimal(t.PRECISION);function h(t){if(Array.isArray(t))return t.map((t=>h(t)));if(t instanceof Uint8Array)return Uint8Array.from(t);if(["number","bigint","boolean","string","undefined"].includes(typeof t))return t;if(null===t)return t;if("object"==typeof t)return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,h(e)])));throw new Error(`cloneDeep: unknown type=${t} (${typeof t})`)}var p,l;function d(t){if(void 0===t.script||void 0===t.amount)throw new Error("Transaction/output: script and amount required");return{script:t.script,amount:t.amount}}function y(r){if(void 0===r.txid||void 0===r.index)throw new Error("Transaction/input: txid and index required");return{txid:r.txid,index:r.index,sequence:(0,t.def)(r.sequence,t.DEFAULT_SEQUENCE),finalScriptSig:(0,t.def)(r.finalScriptSig,e.EMPTY)}}function w(t){for(const e in t){const r=e;i.PSBTInputFinalKeys.includes(r)||delete t[r]}}t.def=(t,e)=>void 0===t?e:t,t.cloneDeep=h,function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.ANYONECANPAY=128]="ANYONECANPAY"}(p||(t.SignatureHash=p={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.DEFAULT_ANYONECANPAY=128]="DEFAULT_ANYONECANPAY",t[t.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",t[t.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",t[t.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY"}(l||(t.SigHash=l={})),t.inputBeforeSign=y;const g=e.struct({txid:e.bytes(32,!0),index:e.U32LE});function b(t){if("number"!=typeof t||"string"!=typeof l[t])throw new Error(`Invalid SigHash=${t}`);return t}function m(t){const e=31&t;return{isAny:!!(t&p.ANYONECANPAY),isNone:e===p.NONE,isSingle:e===p.SINGLE}}class E{constructor(r={}){this.global={},this.inputs=[],this.outputs=[];const n=this.opts=function(r){if(void 0!==r&&"[object Object]"!=={}.toString.call(r))throw new Error(`Wrong object type for transaction options: ${r}`);const n={...r,version:(0,t.def)(r.version,t.DEFAULT_VERSION),lockTime:(0,t.def)(r.lockTime,0),PSBTVersion:(0,t.def)(r.PSBTVersion,0)};if(void 0!==n.allowUnknowInput&&(r.allowUnknownInputs=n.allowUnknowInput),void 0!==n.allowUnknowOutput&&(r.allowUnknownOutputs=n.allowUnknowOutput),![-1,0,1,2].includes(n.version))throw new Error(`Unknown version: ${n.version}`);if("number"!=typeof n.lockTime)throw new Error("Transaction lock time should be number");if(e.U32LE.encode(n.lockTime),0!==n.PSBTVersion&&2!==n.PSBTVersion)throw new Error(`Unknown PSBT version ${n.PSBTVersion}`);for(const t of["allowUnknownOutputs","allowUnknownInputs","disableScriptCheck","bip174jsCompat","allowLegacyWitnessUtxo","lowR"]){const e=n[t];if(void 0!==e&&"boolean"!=typeof e)throw new Error(`Transation options wrong type: ${t}=${e} (${typeof e})`)}if(void 0!==n.customScripts){const t=n.customScripts;if(!Array.isArray(t))throw new Error(`wrong custom scripts type (expected array): customScripts=${t} (${typeof t})`);for(const e of t){if("function"!=typeof e.encode||"function"!=typeof e.decode)throw new Error(`wrong script=${e} (${typeof e})`);if(void 0!==e.finalizeTaproot&&"function"!=typeof e.finalizeTaproot)throw new Error(`wrong script=${e} (${typeof e})`)}}return Object.freeze(n)}(r);n.lockTime!==t.DEFAULT_LOCKTIME&&(this.global.fallbackLocktime=n.lockTime),this.global.txVersion=n.version}static fromRaw(t,e={}){const r=o.RawTx.decode(t),n=new E({...e,version:r.version,lockTime:r.lockTime});for(const t of r.outputs)n.addOutput(t);if(n.outputs=r.outputs,n.inputs=r.inputs,r.witnesses)for(let t=0;t<r.witnesses.length;t++)n.inputs[t].finalScriptWitness=r.witnesses[t];return n}static fromPSBT(r,n={}){let o;try{o=i.RawPSBTV0.decode(r)}catch(t){try{o=i.RawPSBTV2.decode(r)}catch(e){throw t}}const s=o.global.version||0;if(0!==s&&2!==s)throw new Error(`Wrong PSBT version=${s}`);const a=o.global.unsignedTx,u=0===s?a?.version:o.global.txVersion,c=0===s?a?.lockTime:o.global.fallbackLocktime,f=new E({...n,version:u,lockTime:c,PSBTVersion:s}),h=0===s?a?.inputs.length:o.global.inputCount;f.inputs=o.inputs.slice(0,h).map(((t,r)=>({finalScriptSig:e.EMPTY,...o.global.unsignedTx?.inputs[r],...t})));const p=0===s?a?.outputs.length:o.global.outputCount;return f.outputs=o.outputs.slice(0,p).map(((t,e)=>({...t,...o.global.unsignedTx?.outputs[e]}))),f.global={...o.global,txVersion:u},c!==t.DEFAULT_LOCKTIME&&(f.global.fallbackLocktime=c),f}toPSBT(e=this.opts.PSBTVersion){if(0!==e&&2!==e)throw new Error(`Wrong PSBT version=${e}`);const r=this.inputs.map((t=>i.cleanPSBTFields(e,i.PSBTInput,t)));for(const t of r)t.partialSig&&!t.partialSig.length&&delete t.partialSig,t.finalScriptSig&&!t.finalScriptSig.length&&delete t.finalScriptSig,t.finalScriptWitness&&!t.finalScriptWitness.length&&delete t.finalScriptWitness;const n=this.outputs.map((t=>i.cleanPSBTFields(e,i.PSBTOutput,t))),s={...this.global};return 0===e?(s.unsignedTx=o.RawTx.decode(this.unsignedTx),delete s.fallbackLocktime,delete s.txVersion):(s.version=e,s.txVersion=this.version,s.inputCount=this.inputs.length,s.outputCount=this.outputs.length,s.fallbackLocktime&&s.fallbackLocktime===t.DEFAULT_LOCKTIME&&delete s.fallbackLocktime),this.opts.bip174jsCompat&&(r.length||r.push({}),n.length||n.push({})),(0===e?i.RawPSBTV0:i.RawPSBTV2).encode({global:s,inputs:r,outputs:n})}get lockTime(){let e=t.DEFAULT_LOCKTIME,r=0,n=t.DEFAULT_LOCKTIME,i=0;for(const t of this.inputs)t.requiredHeightLocktime&&(e=Math.max(e,t.requiredHeightLocktime),r++),t.requiredTimeLocktime&&(n=Math.max(n,t.requiredTimeLocktime),i++);return r&&r>=i?e:n!==t.DEFAULT_LOCKTIME?n:this.global.fallbackLocktime||t.DEFAULT_LOCKTIME}get version(){if(void 0===this.global.txVersion)throw new Error("No global.txVersion");return this.global.txVersion}inputStatus(t){this.checkInputIdx(t);const e=this.inputs[t];return e.finalScriptSig&&e.finalScriptSig.length||e.finalScriptWitness&&e.finalScriptWitness.length?"finalized":e.tapKeySig||e.tapScriptSig&&e.tapScriptSig.length||e.partialSig&&e.partialSig.length?"signed":"unsigned"}inputSighash(t){this.checkInputIdx(t);const e=(0,u.getInputType)(this.inputs[t],this.opts.allowLegacyWitnessUtxo).sighash,r=e===p.DEFAULT?p.ALL:3&e;return{sigInputs:e&p.ANYONECANPAY,sigOutputs:r}}signStatus(){let t=!0,e=!0,r=[],n=[];for(let i=0;i<this.inputs.length;i++){if("unsigned"===this.inputStatus(i))continue;const{sigInputs:o,sigOutputs:s}=this.inputSighash(i);if(o===p.ANYONECANPAY?r.push(i):t=!1,s===p.ALL)e=!1;else if(s===p.SINGLE)n.push(i);else if(s!==p.NONE)throw new Error(`Wrong signature hash output type: ${s}`)}return{addInput:t,addOutput:e,inputs:r,outputs:n}}get isFinal(){for(let t=0;t<this.inputs.length;t++)if("finalized"!==this.inputStatus(t))return!1;return!0}get hasWitnesses(){let t=!1;for(const e of this.inputs)e.finalScriptWitness&&e.finalScriptWitness.length&&(t=!0);return t}get weight(){if(!this.isFinal)throw new Error("Transaction is not finalized");let t=32;const r=this.outputs.map(d);t+=4*o.CompactSizeLen.encode(this.outputs.length).length;for(const e of r)t+=32+4*o.VarBytes.encode(e.script).length;this.hasWitnesses&&(t+=2),t+=4*o.CompactSizeLen.encode(this.inputs.length).length;for(const r of this.inputs)t+=160+4*o.VarBytes.encode(r.finalScriptSig||e.EMPTY).length,this.hasWitnesses&&r.finalScriptWitness&&(t+=o.RawWitness.encode(r.finalScriptWitness).length);return t}get vsize(){return(0,u.toVsize)(this.weight)}toBytes(t=!1,r=!1){return o.RawTx.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(y).map((r=>({...r,finalScriptSig:t&&r.finalScriptSig||e.EMPTY}))),outputs:this.outputs.map(d),witnesses:this.inputs.map((t=>t.finalScriptWitness||[])),segwitFlag:r&&this.hasWitnesses})}get unsignedTx(){return this.toBytes(!1,!1)}get hex(){return r.hex.encode(this.toBytes(!0,this.hasWitnesses))}get hash(){if(!this.isFinal)throw new Error("Transaction is not finalized");return r.hex.encode(a.sha256x2(this.toBytes(!0)))}get id(){if(!this.isFinal)throw new Error("Transaction is not finalized");return r.hex.encode(a.sha256x2(this.toBytes(!0)).reverse())}checkInputIdx(t){if(!Number.isSafeInteger(t)||0>t||t>=this.inputs.length)throw new Error(`Wrong input index=${t}`)}getInput(t){return this.checkInputIdx(t),h(this.inputs[t])}get inputsLength(){return this.inputs.length}addInput(t,e=!1){if(!e&&!this.signStatus().addInput)throw new Error("Tx has signed inputs, cannot add new one");return this.inputs.push((0,u.normalizeInput)(t,void 0,void 0,this.opts.disableScriptCheck)),this.inputs.length-1}updateInput(t,e,r=!1){let n;if(this.checkInputIdx(t),!r){const e=this.signStatus();e.addInput&&!e.inputs.includes(t)||(n=i.PSBTInputUnsignedKeys)}this.inputs[t]=(0,u.normalizeInput)(e,this.inputs[t],n,this.opts.disableScriptCheck)}checkOutputIdx(t){if(!Number.isSafeInteger(t)||0>t||t>=this.outputs.length)throw new Error(`Wrong output index=${t}`)}getOutput(t){return this.checkOutputIdx(t),h(this.outputs[t])}get outputsLength(){return this.outputs.length}normalizeOutput(t,e,o){let{amount:s,script:a}=t;if(void 0===s&&(s=e?.amount),"bigint"!=typeof s)throw new Error("amount must be bigint sats");"string"==typeof a&&(a=r.hex.decode(a)),void 0===a&&(a=e?.script);let u={...e,...t,amount:s,script:a};if(void 0===u.amount&&delete u.amount,u=i.mergeKeyMap(i.PSBTOutput,u,e,o),i.PSBTOutputCoder.encode(u),u.script&&!this.opts.allowUnknownOutputs&&"unknown"===n.OutScript.decode(u.script).type)throw new Error("Transaction/output: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownOutputs=true, if you sure");return this.opts.disableScriptCheck||(0,n.checkScript)(u.script,u.redeemScript,u.witnessScript),u}addOutput(t,e=!1){if(!e&&!this.signStatus().addOutput)throw new Error("Tx has signed outputs, cannot add new one");return this.outputs.push(this.normalizeOutput(t)),this.outputs.length-1}updateOutput(t,e,r=!1){let n;if(this.checkOutputIdx(t),!r){const e=this.signStatus();e.addOutput&&!e.outputs.includes(t)||(n=i.PSBTOutputUnsignedKeys)}this.outputs[t]=this.normalizeOutput(e,this.outputs[t],n)}addOutputAddress(t,e,r=s.NETWORK){return this.addOutput({script:n.OutScript.encode((0,n.Address)(r).decode(t)),amount:e})}get fee(){let t=0n;for(const e of this.inputs){const r=(0,u.getPrevOut)(e);if(!r)throw new Error("Empty input amount");t+=r.amount}const e=this.outputs.map(d);for(const r of e)t-=r.amount;return t}preimageLegacy(t,r,n){const{isAny:i,isNone:s,isSingle:u}=m(n);if(t<0||!Number.isSafeInteger(t))throw new Error(`Invalid input idx=${t}`);if(u&&t>=this.outputs.length||t>=this.inputs.length)return e.U256BE.encode(1n);r=o.Script.encode(o.Script.decode(r).filter((t=>"CODESEPARATOR"!==t)));let c=this.inputs.map(y).map(((n,i)=>({...n,finalScriptSig:i===t?r:e.EMPTY})));i?c=[c[t]]:(s||u)&&(c=c.map(((e,r)=>({...e,sequence:r===t?e.sequence:0}))));let h=this.outputs.map(d);s?h=[]:u&&(h=h.slice(0,t).fill(f).concat([h[t]]));const p=o.RawTx.encode({lockTime:this.lockTime,version:this.version,segwitFlag:!1,inputs:c,outputs:h});return a.sha256x2(p,e.I32LE.encode(n))}preimageWitnessV0(t,r,n,i){const{isAny:s,isNone:u,isSingle:f}=m(n);let h=c,p=c,l=c;const w=this.inputs.map(y),b=this.outputs.map(d);s||(h=a.sha256x2(...w.map(g.encode))),s||f||u||(p=a.sha256x2(...w.map((t=>e.U32LE.encode(t.sequence))))),f||u?f&&t<b.length&&(l=a.sha256x2(o.RawOutput.encode(b[t]))):l=a.sha256x2(...b.map(o.RawOutput.encode));const E=w[t];return a.sha256x2(e.I32LE.encode(this.version),h,p,e.bytes(32,!0).encode(E.txid),e.U32LE.encode(E.index),o.VarBytes.encode(r),e.U64LE.encode(i),e.U32LE.encode(E.sequence),l,e.U32LE.encode(this.lockTime),e.U32LE.encode(n))}preimageWitnessV1(t,r,i,u,f=-1,h,l=192,w){if(!Array.isArray(u)||this.inputs.length!==u.length)throw new Error(`Invalid amounts array=${u}`);if(!Array.isArray(r)||this.inputs.length!==r.length)throw new Error(`Invalid prevOutScript array=${r}`);const b=[e.U8.encode(0),e.U8.encode(i),e.I32LE.encode(this.version),e.U32LE.encode(this.lockTime)],m=i===p.DEFAULT?p.ALL:3&i,E=i&p.ANYONECANPAY,v=this.inputs.map(y),S=this.outputs.map(d);E!==p.ANYONECANPAY&&b.push(...[v.map(g.encode),u.map(e.U64LE.encode),r.map(o.VarBytes.encode),v.map((t=>e.U32LE.encode(t.sequence)))].map((t=>a.sha256((0,s.concatBytes)(...t))))),m===p.ALL&&b.push(a.sha256((0,s.concatBytes)(...S.map(o.RawOutput.encode))));const T=(w?1:0)|(h?2:0);if(b.push(new Uint8Array([T])),E===p.ANYONECANPAY){const n=v[t];b.push(g.encode(n),e.U64LE.encode(u[t]),o.VarBytes.encode(r[t]),e.U32LE.encode(n.sequence))}else b.push(e.U32LE.encode(t));return 1&T&&b.push(a.sha256(o.VarBytes.encode(w||e.EMPTY))),m===p.SINGLE&&b.push(t<S.length?a.sha256(o.RawOutput.encode(S[t])):c),h&&b.push((0,n.tapLeafHash)(h,l),e.U8.encode(0),e.I32LE.encode(f)),a.tagSchnorr("TapSighash",...b)}signIdx(t,r,i,c){this.checkInputIdx(r);const f=this.inputs[r],h=(0,u.getInputType)(f,this.opts.allowLegacyWitnessUtxo);if(!(0,s.isBytes)(t)){if(!f.bip32Derivation||!f.bip32Derivation.length)throw new Error("bip32Derivation: empty");const e=f.bip32Derivation.filter((e=>e[1].fingerprint==t.fingerprint)).map((([e,{path:r}])=>{let n=t;for(const t of r)n=n.deriveChild(t);if(!(0,s.equalBytes)(n.publicKey,e))throw new Error("bip32Derivation: wrong pubKey");if(!n.privateKey)throw new Error("bip32Derivation: no privateKey");return n}));if(!e.length)throw new Error(`bip32Derivation: no items with fingerprint=${t.fingerprint}`);let n=!1;for(const t of e)this.signIdx(t.privateKey,r)&&(n=!0);return n}i?i.forEach(b):i=[h.defaultSighash];const l=h.sighash;if(!i.includes(l))throw new Error(`Input with not allowed sigHash=${l}. Allowed: ${i.join(", ")}`);const{sigOutputs:d}=this.inputSighash(r);if(d===p.SINGLE&&r>=this.outputs.length)throw new Error(`Input with sighash SINGLE, but there is no output with corresponding index=${r}`);const y=(0,u.getPrevOut)(f);if("taproot"===h.txType){if(f.tapBip32Derivation)throw new Error("tapBip32Derivation unsupported");const i=this.inputs.map(u.getPrevOut),h=i.map((t=>t.script)),d=i.map((t=>t.amount));let y=!1,w=a.pubSchnorr(t),g=f.tapMerkleRoot||e.EMPTY;if(f.tapInternalKey){const{pubKey:n,privKey:i}=function(t,r,n,i=e.EMPTY){return(0,s.equalBytes)(n,r)&&(t=a.taprootTweakPrivKey(t,i),r=a.pubSchnorr(t)),{privKey:t,pubKey:r}}(t,w,f.tapInternalKey,g),[o,u]=a.taprootTweakPubkey(f.tapInternalKey,g);if((0,s.equalBytes)(o,n)){const t=this.preimageWitnessV1(r,h,l,d),n=(0,s.concatBytes)(a.signSchnorr(t,i,c),l!==p.DEFAULT?new Uint8Array([l]):e.EMPTY);this.updateInput(r,{tapKeySig:n},!0),y=!0}}if(f.tapLeafScript){f.tapScriptSig=f.tapScriptSig||[];for(const[i,u]of f.tapLeafScript){const i=u.subarray(0,-1),f=o.Script.decode(i),g=u[u.length-1],b=(0,n.tapLeafHash)(i,g),m=f.findIndex((t=>(0,s.isBytes)(t)&&(0,s.equalBytes)(t,w)));if(-1===m)continue;const E=this.preimageWitnessV1(r,h,l,d,void 0,i,g),v=(0,s.concatBytes)(a.signSchnorr(E,t,c),l!==p.DEFAULT?new Uint8Array([l]):e.EMPTY);this.updateInput(r,{tapScriptSig:[[{pubKey:w,leafHash:b},v]]},!0),y=!0}}if(!y)throw new Error("No taproot scripts signed");return!0}{const e=a.pubECDSA(t);let i=!1;const u=a.hash160(e);for(const t of o.Script.decode(h.lastScript))(0,s.isBytes)(t)&&((0,s.equalBytes)(t,e)||(0,s.equalBytes)(t,u))&&(i=!0);if(!i)throw new Error(`Input script doesn't have pubKey: ${h.lastScript}`);let c;if("legacy"===h.txType)c=this.preimageLegacy(r,h.lastScript,l);else{if("segwit"!==h.txType)throw new Error(`Transaction/sign: unknown tx type: ${h.txType}`);{let t=h.lastScript;"wpkh"===h.last.type&&(t=n.OutScript.encode({type:"pkh",hash:h.last.hash})),c=this.preimageWitnessV0(r,t,l,y.amount)}}const f=a.signECDSA(c,t,this.opts.lowR);this.updateInput(r,{partialSig:[[e,(0,s.concatBytes)(f,new Uint8Array([l]))]]},!0)}return!0}sign(t,e,r){let n=0;for(let i=0;i<this.inputs.length;i++)try{this.signIdx(t,i,e,r)&&n++}catch(t){}if(!n)throw new Error("No inputs signed");return n}finalizeIdx(t){if(this.checkInputIdx(t),this.fee<0n)throw new Error("Outputs spends more than inputs amount");const r=this.inputs[t],c=(0,u.getInputType)(r,this.opts.allowLegacyWitnessUtxo);if("taproot"===c.txType){if(r.tapKeySig)r.finalScriptWitness=[r.tapKeySig];else{if(!r.tapLeafScript||!r.tapScriptSig)throw new Error("finalize/taproot: unknown input");{const t=r.tapLeafScript.sort(((t,e)=>i.TaprootControlBlock.encode(t[0]).length-i.TaprootControlBlock.encode(e[0]).length));for(const[a,u]of t){const t=u.slice(0,-1),c=u[u.length-1],f=n.OutScript.decode(t),h=(0,n.tapLeafHash)(t,c),p=r.tapScriptSig.filter((t=>(0,s.equalBytes)(t[0].leafHash,h)));let l=[];if("tr_ms"===f.type){const t=f.m,r=f.pubkeys;let n=0;for(const i of r){const r=p.findIndex((t=>(0,s.equalBytes)(t[0].pubKey,i)));n!==t&&-1!==r?(l.push(p[r][1]),n++):l.push(e.EMPTY)}if(n!==t)continue}else if("tr_ns"===f.type){for(const t of f.pubkeys){const e=p.findIndex((e=>(0,s.equalBytes)(e[0].pubKey,t)));-1!==e&&l.push(p[e][1])}if(l.length!==f.pubkeys.length)continue}else{if("unknown"!==f.type||!this.opts.allowUnknownInputs){const n=this.opts.customScripts;if(n)for(const s of n){if(!s.finalizeTaproot)continue;const n=o.Script.decode(t),u=s.encode(n);if(void 0===u)continue;const c=s.finalizeTaproot(t,u,p);if(c)return r.finalScriptWitness=c.concat(i.TaprootControlBlock.encode(a)),r.finalScriptSig=e.EMPTY,void w(r)}throw new Error("Finalize: Unknown tapLeafScript")}{const e=o.Script.decode(t);if(l=p.map((([{pubKey:t},r])=>{const n=e.findIndex((e=>(0,s.isBytes)(e)&&(0,s.equalBytes)(e,t)));if(-1===n)throw new Error("finalize/taproot: cannot find position of pubkey in script");return{signature:r,pos:n}})).sort(((t,e)=>t.pos-e.pos)).map((t=>t.signature)),!l.length)continue}}r.finalScriptWitness=l.reverse().concat([t,i.TaprootControlBlock.encode(a)]);break}if(!r.finalScriptWitness)throw new Error("finalize/taproot: empty witness")}}return r.finalScriptSig=e.EMPTY,void w(r)}if(!r.partialSig||!r.partialSig.length)throw new Error("Not enough partial sign");let f,h,p=e.EMPTY,l=[];if("ms"===c.last.type){const t=c.last.m,e=c.last.pubkeys;let n=[];for(const t of e){const e=r.partialSig.find((e=>(0,s.equalBytes)(t,e[0])));e&&n.push(e[1])}if(n=n.slice(0,t),n.length!==t)throw new Error(`Multisig: wrong signatures count, m=${t} n=${e.length} signatures=${n.length}`);p=o.Script.encode([0,...n])}else if("pk"===c.last.type)p=o.Script.encode([r.partialSig[0][1]]);else if("pkh"===c.last.type)p=o.Script.encode([r.partialSig[0][1],r.partialSig[0][0]]);else if("wpkh"===c.last.type)p=e.EMPTY,l=[r.partialSig[0][1],r.partialSig[0][0]];else if("unknown"===c.last.type&&!this.opts.allowUnknownInputs)throw new Error("Unknown inputs not allowed");if(c.type.includes("wsh-")&&(p.length&&c.lastScript.length&&(l=o.Script.decode(p).map((t=>{if(0===t)return e.EMPTY;if((0,s.isBytes)(t))return t;throw new Error(`Wrong witness op=${t}`)}))),l=l.concat(c.lastScript)),"segwit"===c.txType&&(h=l),c.type.startsWith("sh-wsh-")?f=o.Script.encode([o.Script.encode([0,a.sha256(c.lastScript)])]):c.type.startsWith("sh-")?f=o.Script.encode([...o.Script.decode(p),c.lastScript]):c.type.startsWith("wsh-")||"segwit"!==c.txType&&(f=p),!f&&!h)throw new Error("Unknown error finalizing input");f&&(r.finalScriptSig=f),h&&(r.finalScriptWitness=h),w(r)}finalize(){for(let t=0;t<this.inputs.length;t++)this.finalizeIdx(t)}extract(){if(!this.isFinal)throw new Error("Transaction has unfinalized inputs");if(!this.outputs.length)throw new Error("Transaction has no outputs");if(this.fee<0n)throw new Error("Outputs spends more than inputs amount");return this.toBytes(!0,!0)}combine(t){for(const e of["PSBTVersion","version","lockTime"])if(this.opts[e]!==t.opts[e])throw new Error(`Transaction/combine: different ${e} this=${this.opts[e]} other=${t.opts[e]}`);for(const e of["inputs","outputs"])if(this[e].length!==t[e].length)throw new Error(`Transaction/combine: different ${e} length this=${this[e].length} other=${t[e].length}`);const r=this.global.unsignedTx?o.RawTx.encode(this.global.unsignedTx):e.EMPTY,n=t.global.unsignedTx?o.RawTx.encode(t.global.unsignedTx):e.EMPTY;if(!(0,s.equalBytes)(r,n))throw new Error("Transaction/combine: different unsigned tx");this.global=i.mergeKeyMap(i.PSBTGlobal,this.global,t.global);for(let e=0;e<this.inputs.length;e++)this.updateInput(e,t.inputs[e],!0);for(let e=0;e<this.outputs.length;e++)this.updateOutput(e,t.outputs[e],!0);return this}clone(){return E.fromPSBT(this.toPSBT(this.opts.PSBTVersion),this.opts)}}t.Transaction=E,t.PSBTCombine=function(t){if(!t||!Array.isArray(t)||!t.length)throw new Error("PSBTCombine: wrong PSBT list");const e=E.fromPSBT(t[0]);for(let r=1;r<t.length;r++)e.combine(E.fromPSBT(t[r]));return e.toPSBT()};const v=2147483648;t.bip32Path=function(t){const e=[];if(!/^[mM]'?/.test(t))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(t))return e;const r=t.replace(/^[mM]'?\//,"").split("/");for(const t of r){const r=/^(\d+)('?)$/.exec(t);if(!r||3!==r.length)throw new Error(`Invalid child index: ${t}`);let n=+r[1];if(!Number.isSafeInteger(n)||n>=v)throw new Error("Invalid index");"'"===r[2]&&(n+=v),e.push(n)}return e}}(Xc)),Xc}function tf(){return Gc||(Gc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RawPSBTV2=t.RawPSBTV0=t.mergeKeyMap=t.cleanPSBTFields=t._DebugPSBT=t._RawPSBTV2=t._RawPSBTV0=t.PSBTOutputCoder=t.PSBTInputCoder=t.PSBTOutputUnsignedKeys=t.PSBTOutput=t.PSBTInputUnsignedKeys=t.PSBTInputFinalKeys=t.PSBTInput=t.PSBTGlobal=t.TaprootControlBlock=void 0;const e=Ru,r=Nu,n=Wc,i=Jc(),o=Cu,s=r.validate(r.bytes(null),(t=>(0,o.validatePubkey)(t,o.PubT.ecdsa))),a=r.validate(r.bytes(32),(t=>(0,o.validatePubkey)(t,o.PubT.schnorr))),u=r.validate(r.bytes(null),(t=>{if(64!==t.length&&65!==t.length)throw new Error("Schnorr signature should be 64 or 65 bytes long");return t})),c=r.struct({fingerprint:r.U32BE,path:r.array(null,r.U32LE)}),f=r.struct({hashes:r.array(n.CompactSizeLen,r.bytes(32)),der:c}),h=r.bytes(78),p=r.struct({pubKey:a,leafHash:r.bytes(32)}),l=r.struct({version:r.U8,internalKey:r.bytes(32),merklePath:r.array(null,r.bytes(32))});t.TaprootControlBlock=r.validate(l,(t=>{if(t.merklePath.length>128)throw new Error("TaprootControlBlock: merklePath should be of length 0..128 (inclusive)");return t}));const d=r.array(null,r.struct({depth:r.U8,version:r.U8,script:n.VarBytes})),y=r.bytes(null),w=r.bytes(20),g=r.bytes(32);t.PSBTGlobal={unsignedTx:[0,!1,n.RawTx,[0],[0],!1],xpub:[1,h,c,[],[0,2],!1],txVersion:[2,!1,r.U32LE,[2],[2],!1],fallbackLocktime:[3,!1,r.U32LE,[],[2],!1],inputCount:[4,!1,n.CompactSizeLen,[2],[2],!1],outputCount:[5,!1,n.CompactSizeLen,[2],[2],!1],txModifiable:[6,!1,r.U8,[],[2],!1],version:[251,!1,r.U32LE,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTInput={nonWitnessUtxo:[0,!1,n.RawTx,[],[0,2],!1],witnessUtxo:[1,!1,n.RawOutput,[],[0,2],!1],partialSig:[2,s,y,[],[0,2],!1],sighashType:[3,!1,r.U32LE,[],[0,2],!1],redeemScript:[4,!1,y,[],[0,2],!1],witnessScript:[5,!1,y,[],[0,2],!1],bip32Derivation:[6,s,c,[],[0,2],!1],finalScriptSig:[7,!1,y,[],[0,2],!1],finalScriptWitness:[8,!1,n.RawWitness,[],[0,2],!1],porCommitment:[9,!1,y,[],[0,2],!1],ripemd160:[10,w,y,[],[0,2],!1],sha256:[11,g,y,[],[0,2],!1],hash160:[12,w,y,[],[0,2],!1],hash256:[13,g,y,[],[0,2],!1],txid:[14,!1,g,[2],[2],!0],index:[15,!1,r.U32LE,[2],[2],!0],sequence:[16,!1,r.U32LE,[],[2],!0],requiredTimeLocktime:[17,!1,r.U32LE,[],[2],!1],requiredHeightLocktime:[18,!1,r.U32LE,[],[2],!1],tapKeySig:[19,!1,u,[],[0,2],!1],tapScriptSig:[20,p,u,[],[0,2],!1],tapLeafScript:[21,t.TaprootControlBlock,y,[],[0,2],!1],tapBip32Derivation:[22,g,f,[],[0,2],!1],tapInternalKey:[23,!1,a,[],[0,2],!1],tapMerkleRoot:[24,!1,g,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTInputFinalKeys=["txid","sequence","index","witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknown"],t.PSBTInputUnsignedKeys=["partialSig","finalScriptSig","finalScriptWitness","tapKeySig","tapScriptSig"],t.PSBTOutput={redeemScript:[0,!1,y,[],[0,2],!1],witnessScript:[1,!1,y,[],[0,2],!1],bip32Derivation:[2,s,c,[],[0,2],!1],amount:[3,!1,r.I64LE,[2],[2],!0],script:[4,!1,y,[2],[2],!0],tapInternalKey:[5,!1,a,[],[0,2],!1],tapTree:[6,!1,d,[],[0,2],!1],tapBip32Derivation:[7,a,f,[],[0,2],!1],proprietary:[252,y,y,[],[0,2],!1]},t.PSBTOutputUnsignedKeys=[];const b=r.array(r.NULL,r.struct({key:r.prefix(n.CompactSizeLen,r.struct({type:n.CompactSizeLen,key:r.bytes(null)})),value:r.bytes(n.CompactSizeLen)}));function m(t){const[e,r,n,i,o,s]=t;return{type:e,kc:r,vc:n,reqInc:i,allowInc:o,silentIgnore:s}}function E(t){const n={};for(const e in t){const[r,i,o]=t[e];n[r]=[e,i,o]}return r.wrap({encodeStream:(e,n)=>{let i=[];for(const e in t){const s=n[e];if(void 0===s)continue;const[a,u,c]=t[e];if(u){const t=s.map((([t,e])=>[u.encode(t),c.encode(e)]));t.sort(((t,e)=>(0,o.compareBytes)(t[0],e[0])));for(const[e,r]of t)i.push({key:{key:e,type:a},value:r})}else i.push({key:{type:a,key:r.EMPTY},value:c.encode(s)})}if(n.unknown){n.unknown.sort(((t,e)=>(0,o.compareBytes)(t[0].key,e[0].key)));for(const[t,e]of n.unknown)i.push({key:t,value:e})}b.encodeStream(e,i)},decodeStream:t=>{const r=b.decodeStream(t),i={},o={};for(const t of r){let r="unknown",s=t.key.key,a=t.value;if(n[t.key.type]){const[u,c,f]=n[t.key.type];if(r=u,!c&&s.length)throw new Error(`PSBT: Non-empty key for ${r} (key=${e.hex.encode(s)} value=${e.hex.encode(a)}`);if(s=c?c.decode(s):void 0,a=f.decode(a),!c){if(i[r])throw new Error(`PSBT: Same keys: ${r} (key=${s} value=${a})`);i[r]=a,o[r]=!0;continue}}else s={type:t.key.type,key:t.key.key};if(o[r])throw new Error(`PSBT: Key type with empty key and no key=${r} val=${a}`);i[r]||(i[r]=[]),i[r].push([s,a])}return i}})}r.struct({type:n.CompactSizeLen,key:r.bytes(null)}),t.PSBTInputCoder=r.validate(E(t.PSBTInput),(t=>{if(t.finalScriptWitness&&!t.finalScriptWitness.length)throw new Error("validateInput: wmpty finalScriptWitness");if(t.partialSig&&!t.partialSig.length)throw new Error("Empty partialSig");if(t.partialSig)for(const[e]of t.partialSig)(0,o.validatePubkey)(e,o.PubT.ecdsa);if(t.bip32Derivation)for(const[e]of t.bip32Derivation)(0,o.validatePubkey)(e,o.PubT.ecdsa);if(void 0!==t.requiredTimeLocktime&&t.requiredTimeLocktime<5e8)throw new Error(`validateInput: wrong timeLocktime=${t.requiredTimeLocktime}`);if(void 0!==t.requiredHeightLocktime&&(t.requiredHeightLocktime<=0||t.requiredHeightLocktime>=5e8))throw new Error(`validateInput: wrong heighLocktime=${t.requiredHeightLocktime}`);if(t.nonWitnessUtxo&&void 0!==t.index){const e=t.nonWitnessUtxo.outputs.length-1;if(t.index>e)throw new Error(`validateInput: index(${t.index}) not in nonWitnessUtxo`);const r=t.nonWitnessUtxo.outputs[t.index];if(t.witnessUtxo&&(!(0,o.equalBytes)(t.witnessUtxo.script,r.script)||t.witnessUtxo.amount!==r.amount))throw new Error("validateInput: witnessUtxo different from nonWitnessUtxo")}if(t.tapLeafScript)for(const[e,r]of t.tapLeafScript){if((254&e.version)!==r[r.length-1])throw new Error("validateInput: tapLeafScript version mimatch");if(1&r[r.length-1])throw new Error("validateInput: tapLeafScript version has parity bit!")}if(t.nonWitnessUtxo&&void 0!==t.index&&t.txid){if(t.nonWitnessUtxo.outputs.length-1<t.index)throw new Error("nonWitnessUtxo: incorect output index");const r=i.Transaction.fromRaw(n.RawTx.encode(t.nonWitnessUtxo),{allowUnknownOutputs:!0,disableScriptCheck:!0,allowUnknownInputs:!0}),o=e.hex.encode(t.txid);if(r.isFinal&&r.id!==o)throw new Error(`nonWitnessUtxo: wrong txid, exp=${o} got=${r.id}`)}return t})),t.PSBTOutputCoder=r.validate(E(t.PSBTOutput),(t=>{if(t.bip32Derivation)for(const[e]of t.bip32Derivation)(0,o.validatePubkey)(e,o.PubT.ecdsa);return t}));const v=r.validate(E(t.PSBTGlobal),(t=>{if(0===(t.version||0)){if(!t.unsignedTx)throw new Error("PSBTv0: missing unsignedTx");if(t.unsignedTx.segwitFlag||t.unsignedTx.witnesses)throw new Error("PSBTv0: witness in unsingedTx");for(const e of t.unsignedTx.inputs)if(e.finalScriptSig&&e.finalScriptSig.length)throw new Error("PSBTv0: input scriptSig found in unsignedTx")}return t}));function S(t,e,r){for(const n in r){if("unknown"===n)continue;if(!e[n])continue;const{allowInc:r}=m(e[n]);if(!r.includes(t))throw new Error(`PSBTv${t}: field ${n} is not allowed`)}for(const n in e){const{reqInc:i}=m(e[n]);if(i.includes(t)&&void 0===r[n])throw new Error(`PSBTv${t}: missing required field ${n}`)}}function T(e){const r=e&&e.global&&e.global.version||0;S(r,t.PSBTGlobal,e.global);for(const n of e.inputs)S(r,t.PSBTInput,n);for(const n of e.outputs)S(r,t.PSBTOutput,n);const n=r?e.global.inputCount:e.global.unsignedTx.inputs.length;if(e.inputs.length<n)throw new Error("Not enough inputs");const i=e.inputs.slice(n);if(i.length>1||i.length&&Object.keys(i[0]).length)throw new Error(`Unexpected inputs left in tx=${i}`);const o=r?e.global.outputCount:e.global.unsignedTx.outputs.length;if(e.outputs.length<o)throw new Error("Not outputs inputs");const s=e.outputs.slice(o);if(s.length>1||s.length&&Object.keys(s[0]).length)throw new Error(`Unexpected outputs left in tx=${s}`);return e}t._RawPSBTV0=r.struct({magic:r.magic(r.string(new Uint8Array([255])),"psbt"),global:v,inputs:r.array("global/unsignedTx/inputs/length",t.PSBTInputCoder),outputs:r.array(null,t.PSBTOutputCoder)}),t._RawPSBTV2=r.struct({magic:r.magic(r.string(new Uint8Array([255])),"psbt"),global:v,inputs:r.array("global/inputCount",t.PSBTInputCoder),outputs:r.array("global/outputCount",t.PSBTOutputCoder)}),t._DebugPSBT=r.struct({magic:r.magic(r.string(new Uint8Array([255])),"psbt"),items:r.array(null,r.apply(r.array(r.NULL,r.tuple([r.hex(n.CompactSizeLen),r.bytes(n.CompactSize)])),r.coders.dict()))}),t.cleanPSBTFields=function(t,e,r){const n={};for(const i in r){const o=i;if("unknown"!==o){if(!e[o])continue;const{allowInc:r,silentIgnore:n}=m(e[o]);if(!r.includes(t)){if(n)continue;throw new Error(`Failed to serialize in PSBTv${t}: ${o} but versions allows inclusion=${r}`)}}n[o]=r[o]}return n},t.mergeKeyMap=function(t,r,n,i){const s={...n,...r};for(const a in t){const u=a,[c,f,h]=t[u],p=i&&!i.includes(a);if(void 0===r[a]&&a in r){if(p)throw new Error(`Cannot remove signed field=${a}`);delete s[a]}else if(f){const t=n&&n[a]?n[a]:[];let i=r[u];if(i){if(!Array.isArray(i))throw new Error(`keyMap(${a}): KV pairs should be [k, v][]`);i=i.map((t=>{if(2!==t.length)throw new Error(`keyMap(${a}): KV pairs should be [k, v][]`);return["string"==typeof t[0]?f.decode(e.hex.decode(t[0])):t[0],"string"==typeof t[1]?h.decode(e.hex.decode(t[1])):t[1]]}));const r={},n=(t,n,i)=>{if(void 0===r[t])return void(r[t]=[n,i]);const o=e.hex.encode(h.encode(r[t][1])),s=e.hex.encode(h.encode(i));if(o!==s)throw new Error(`keyMap(${u}): same key=${t} oldVal=${o} newVal=${s}`)};for(const[r,i]of t){n(e.hex.encode(f.encode(r)),r,i)}for(const[t,o]of i){const i=e.hex.encode(f.encode(t));if(void 0===o){if(p)throw new Error(`Cannot remove signed field=${u}/${t}`);delete r[i]}else n(i,t,o)}s[u]=Object.values(r)}}else if("string"==typeof s[a])s[a]=h.decode(e.hex.decode(s[a]));else if(p&&a in r&&n&&void 0!==n[a]&&!(0,o.equalBytes)(h.encode(r[a]),h.encode(n[a])))throw new Error(`Cannot change signed field=${a}`)}for(const e in s)t[e]||delete s[e];return s},t.RawPSBTV0=r.validate(t._RawPSBTV0,T),t.RawPSBTV2=r.validate(t._RawPSBTV2,T)}(Vc)),Vc}function ef(){return Yc||(Yc=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Address=t.WIF=t.sortedMultisig=t.multisig=t._sortPubkeys=t.getAddress=t.p2tr_ms=t.p2tr_pk=t.p2tr_ns=t.combinations=t.p2tr=t.tapLeafHash=t.TAP_LEAF_VERSION=t.taprootListToTree=t.p2ms=t.p2wpkh=t.p2wsh=t.p2sh=t.p2pkh=t.p2pk=t.checkScript=t.OutScript=void 0;const e=Ru,r=Nu,n=tf(),i=Wc,o=Cu,s=Cu;function a(t,e){try{return s.validatePubkey(t,e),!0}catch(t){return!1}}const u={encode(t){if(2===t.length&&s.isBytes(t[0])&&a(t[0],s.PubT.ecdsa)&&"CHECKSIG"===t[1])return{type:"pk",pubkey:t[0]}},decode:t=>"pk"===t.type?[t.pubkey,"CHECKSIG"]:void 0},c={encode(t){if(5===t.length&&"DUP"===t[0]&&"HASH160"===t[1]&&s.isBytes(t[2])&&"EQUALVERIFY"===t[3]&&"CHECKSIG"===t[4])return{type:"pkh",hash:t[2]}},decode:t=>"pkh"===t.type?["DUP","HASH160",t.hash,"EQUALVERIFY","CHECKSIG"]:void 0},f={encode(t){if(3===t.length&&"HASH160"===t[0]&&s.isBytes(t[1])&&"EQUAL"===t[2])return{type:"sh",hash:t[1]}},decode:t=>"sh"===t.type?["HASH160",t.hash,"EQUAL"]:void 0},h={encode(t){if(2===t.length&&0===t[0]&&s.isBytes(t[1])&&32===t[1].length)return{type:"wsh",hash:t[1]}},decode:t=>"wsh"===t.type?[0,t.hash]:void 0},p={encode(t){if(2===t.length&&0===t[0]&&s.isBytes(t[1])&&20===t[1].length)return{type:"wpkh",hash:t[1]}},decode:t=>"wpkh"===t.type?[0,t.hash]:void 0},l={encode(t){const e=t.length-1;if("CHECKMULTISIG"!==t[e])return;const r=t[0],n=t[e-1];if("number"!=typeof r||"number"!=typeof n)return;const i=t.slice(1,-2);if(n===i.length){for(const t of i)if(!s.isBytes(t))return;return{type:"ms",m:r,pubkeys:i}}},decode:t=>"ms"===t.type?[t.m,...t.pubkeys,t.pubkeys.length,"CHECKMULTISIG"]:void 0},d={encode(t){if(2===t.length&&1===t[0]&&s.isBytes(t[1]))return{type:"tr",pubkey:t[1]}},decode:t=>"tr"===t.type?[1,t.pubkey]:void 0},y={encode(t){const e=t.length-1;if("CHECKSIG"!==t[e])return;const r=[];for(let n=0;n<e;n++){const i=t[n];if(1&n){if("CHECKSIGVERIFY"!==i||n===e-1)return}else{if(!s.isBytes(i))return;r.push(i)}}return{type:"tr_ns",pubkeys:r}},decode:t=>{if("tr_ns"!==t.type)return;const e=[];for(let r=0;r<t.pubkeys.length-1;r++)e.push(t.pubkeys[r],"CHECKSIGVERIFY");return e.push(t.pubkeys[t.pubkeys.length-1],"CHECKSIG"),e}},w={encode(t){const e=t.length-1;if("NUMEQUAL"!==t[e]||"CHECKSIG"!==t[1])return;const r=[],n=(0,i.OpToNum)(t[e-1]);if("number"==typeof n){for(let n=0;n<e-1;n++){const e=t[n];if(1&n){if(e!==(1===n?"CHECKSIG":"CHECKSIGADD"))throw new Error("OutScript.encode/tr_ms: wrong element")}else{if(!s.isBytes(e))throw new Error("OutScript.encode/tr_ms: wrong key element");r.push(e)}}return{type:"tr_ms",pubkeys:r,m:n}}},decode:t=>{if("tr_ms"!==t.type)return;const e=[t.pubkeys[0],"CHECKSIG"];for(let r=1;r<t.pubkeys.length;r++)e.push(t.pubkeys[r],"CHECKSIGADD");return e.push(t.m,"NUMEQUAL"),e}},g=[u,c,f,h,p,l,d,y,w,{encode:t=>({type:"unknown",script:i.Script.encode(t)}),decode:t=>"unknown"===t.type?i.Script.decode(t.script):void 0}],b=r.apply(i.Script,r.coders.match(g));function m(e,r){if(!s.equalBytes(e.hash,s.sha256(r)))throw new Error("checkScript: wsh wrong witnessScript hash");const n=t.OutScript.decode(r);if("tr"===n.type||"tr_ns"===n.type||"tr_ms"===n.type)throw new Error(`checkScript: P2${n.type} cannot be wrapped in P2SH`);if("wpkh"===n.type||"sh"===n.type)throw new Error(`checkScript: P2${n.type} cannot be wrapped in P2WSH`)}function E(e,r,n){if(e){const i=t.OutScript.decode(e);if("tr_ns"===i.type||"tr_ms"===i.type||"ms"===i.type||"pk"==i.type)throw new Error(`checkScript: non-wrapped ${i.type}`);if("sh"===i.type&&r){if(!s.equalBytes(i.hash,s.hash160(r)))throw new Error("checkScript: sh wrong redeemScript hash");const e=t.OutScript.decode(r);if("tr"===e.type||"tr_ns"===e.type||"tr_ms"===e.type)throw new Error(`checkScript: P2${e.type} cannot be wrapped in P2SH`);if("sh"===e.type)throw new Error("checkScript: P2SH cannot be wrapped in P2SH")}"wsh"===i.type&&n&&m(i,n)}if(r){const e=t.OutScript.decode(r);"wsh"===e.type&&n&&m(e,n)}}function v(t){const r={};for(const n of t){const i=e.hex.encode(n);if(r[i])throw new Error(`Multisig: non-uniq pubkey: ${t.map(e.hex.encode)}`);r[i]=!0}}t.OutScript=r.validate(b,(t=>{if("pk"===t.type&&!a(t.pubkey,s.PubT.ecdsa))throw new Error("OutScript/pk: wrong key");if(!("pkh"!==t.type&&"sh"!==t.type&&"wpkh"!==t.type||s.isBytes(t.hash)&&20===t.hash.length))throw new Error(`OutScript/${t.type}: wrong hash`);if("wsh"===t.type&&(!s.isBytes(t.hash)||32!==t.hash.length))throw new Error("OutScript/wsh: wrong hash");if(!("tr"!==t.type||s.isBytes(t.pubkey)&&a(t.pubkey,s.PubT.schnorr)))throw new Error("OutScript/tr: wrong taproot public key");if(("ms"===t.type||"tr_ns"===t.type||"tr_ms"===t.type)&&!Array.isArray(t.pubkeys))throw new Error("OutScript/multisig: wrong pubkeys array");if("ms"===t.type){const e=t.pubkeys.length;for(const e of t.pubkeys)if(!a(e,s.PubT.ecdsa))throw new Error("OutScript/multisig: wrong pubkey");if(t.m<=0||e>16||t.m>e)throw new Error("OutScript/multisig: invalid params")}if("tr_ns"===t.type||"tr_ms"===t.type)for(const e of t.pubkeys)if(!a(e,s.PubT.schnorr))throw new Error(`OutScript/${t.type}: wrong pubkey`);if("tr_ms"===t.type){const e=t.pubkeys.length;if(t.m<=0||e>999||t.m>e)throw new Error("OutScript/tr_ms: invalid params")}return t})),t.checkScript=E;t.p2pk=(e,r=o.NETWORK)=>{if(!a(e,s.PubT.ecdsa))throw new Error("P2PK: invalid publicKey");return{type:"pk",script:t.OutScript.encode({type:"pk",pubkey:e})}};t.p2pkh=(e,r=o.NETWORK)=>{if(!a(e,s.PubT.ecdsa))throw new Error("P2PKH: invalid publicKey");const n=s.hash160(e);return{type:"pkh",script:t.OutScript.encode({type:"pkh",hash:n}),address:C(r).encode({type:"pkh",hash:n})}};t.p2sh=(e,r=o.NETWORK)=>{const n=e.script;if(!s.isBytes(n))throw new Error(`Wrong script: ${typeof e.script}, expected Uint8Array`);const i=s.hash160(n);E(t.OutScript.encode({type:"sh",hash:i}),n,e.witnessScript);const a={type:"sh",redeemScript:n,script:t.OutScript.encode({type:"sh",hash:i}),address:C(r).encode({type:"sh",hash:i})};return e.witnessScript&&(a.witnessScript=e.witnessScript),a};t.p2wsh=(e,r=o.NETWORK)=>{const n=e.script;if(!s.isBytes(n))throw new Error(`Wrong script: ${typeof n}, expected Uint8Array`);const i=s.sha256(n);return E(t.OutScript.encode({type:"wsh",hash:i}),void 0,n),{type:"wsh",witnessScript:n,script:t.OutScript.encode({type:"wsh",hash:i}),address:C(r).encode({type:"wsh",hash:i})}};t.p2wpkh=(e,r=o.NETWORK)=>{if(!a(e,s.PubT.ecdsa))throw new Error("P2WPKH: invalid publicKey");if(65===e.length)throw new Error("P2WPKH: uncompressed public key");const n=s.hash160(e);return{type:"wpkh",script:t.OutScript.encode({type:"wpkh",hash:n}),address:C(r).encode({type:"wpkh",hash:n})}};function S(t){const e=Array.from(t);for(;e.length>=2;){e.sort(((t,e)=>(e.weight||1)-(t.weight||1)));const t=e.pop(),r=e.pop(),n=(r?.weight||1)+(t?.weight||1);e.push({weight:n,childs:[r?.childs||r,t?.childs||t]})}const r=e[0];return r?.childs||r}function T(t,e=[]){if(!t)throw new Error("taprootAddPath: empty tree");if("leaf"===t.type)return{...t,path:e};if("branch"!==t.type)throw new Error(`taprootAddPath: wrong type=${t}`);return{...t,path:e,left:T(t.left,[t.right.hash,...e]),right:T(t.right,[t.left.hash,...e])}}function O(t){if(!t)throw new Error("taprootAddPath: empty tree");if("leaf"===t.type)return[t];if("branch"!==t.type)throw new Error(`taprootWalkTree: wrong type=${t}`);return[...O(t.left),...O(t.right)]}function P(n,o,a=!1,u){if(!n)throw new Error("taprootHashTree: empty tree");if(Array.isArray(n)&&1===n.length&&(n=n[0]),!Array.isArray(n)){const{leafVersion:c,script:f}=n;if(n.tapLeafScript||n.tapMerkleRoot&&!s.equalBytes(n.tapMerkleRoot,r.EMPTY))throw new Error("P2TR: tapRoot leafScript cannot have tree");const h="string"==typeof f?e.hex.decode(f):f;if(!s.isBytes(h))throw new Error(`checkScript: wrong script type=${h}`);return function(e,n,o=!1,a){const u=t.OutScript.decode(e);if("unknown"===u.type){if(a){const t=r.apply(i.Script,r.coders.match(a)).decode(e);if(void 0!==t){if("string"!=typeof t.type||!t.type.startsWith("tr_"))throw new Error(`P2TR: invalid custom type=${t.type}`);return}}if(o)return}if(!["tr_ns","tr_ms"].includes(u.type))throw new Error(`P2TR: invalid leaf script=${u.type}`);const c=u;if(!o&&c.pubkeys)for(const t of c.pubkeys){if(s.equalBytes(t,s.TAPROOT_UNSPENDABLE_KEY))throw new Error("Unspendable taproot key in leaf script");if(s.equalBytes(t,n))throw new Error("Using P2TR with leaf script with same key as internal key is not supported")}}(h,o,a,u),{type:"leaf",version:c,script:h,hash:(0,t.tapLeafHash)(h,c)}}if(2!==n.length&&(n=S(n)),2!==n.length)throw new Error("hashTree: non binary tree!");const c=P(n[0],o,a,u),f=P(n[1],o,a,u);let[h,p]=[c.hash,f.hash];return-1===s.compareBytes(p,h)&&([h,p]=[p,h]),{type:"branch",left:c,right:f,hash:s.tagSchnorr("TapBranch",h,p)}}t.p2ms=(e,r,n=!1)=>(n||v(r),{type:"ms",script:t.OutScript.encode({type:"ms",pubkeys:r,m:e})}),t.taprootListToTree=S,t.TAP_LEAF_VERSION=192;function _(i,u,c=o.NETWORK,f=!1,h){if(!i&&!u)throw new Error("p2tr: should have pubKey or scriptTree (or both)");const p="string"==typeof i?e.hex.decode(i):i||s.TAPROOT_UNSPENDABLE_KEY;if(!a(p,s.PubT.schnorr))throw new Error("p2tr: non-schnorr pubkey");let l=u?T(P(u,p,f,h)):void 0;const d=l?l.hash:void 0,[y,w]=s.taprootTweakPubkey(p,d||r.EMPTY);let g,b;l&&(g=O(l).map((e=>({...e,controlBlock:n.TaprootControlBlock.encode({version:(e.version||t.TAP_LEAF_VERSION)+w,internalKey:p,merklePath:e.path})})))),g&&(b=g.map((e=>[n.TaprootControlBlock.decode(e.controlBlock),s.concatBytes(e.script,new Uint8Array([e.version||t.TAP_LEAF_VERSION]))])));const m={type:"tr",script:t.OutScript.encode({type:"tr",pubkey:y}),address:C(c).encode({type:"tr",pubkey:y}),tweakedPubkey:y,tapInternalKey:p};return g&&(m.leaves=g),b&&(m.tapLeafScript=b),d&&(m.tapMerkleRoot=d),m}function I(t,e){const r=[];if(!Array.isArray(e))throw new Error("combinations: lst arg should be array");const n=e.length;if(t>n)throw new Error("combinations: m > lst.length, no combinations possible");const i=Array.from({length:t},((t,e)=>e)),o=i.length-1;t:for(;;){r.push(i.map((t=>e[t]))),i[o]+=1;let s=o;for(;s>=0&&i[s]>n-t+s;s--){if(i[s]=0,0===s)break t;i[s-1]+=1}for(s+=1;s<i.length;s++)i[s]=i[s-1]+1}return r}t.tapLeafHash=(e,r=t.TAP_LEAF_VERSION)=>s.tagSchnorr("TapLeaf",new Uint8Array([r]),i.VarBytes.encode(e)),t.p2tr=_,t.combinations=I;t.p2tr_ns=(e,r,n=!1)=>(n||v(r),I(e,r).map((e=>({type:"tr_ns",script:t.OutScript.encode({type:"tr_ns",pubkeys:e})}))));t.p2tr_pk=e=>(0,t.p2tr_ns)(1,[e],void 0)[0],t.p2tr_ms=function(e,r,n=!1){return n||v(r),{type:"tr_ms",script:t.OutScript.encode({type:"tr_ms",pubkeys:r,m:e})}},t.getAddress=function(e,r,n=o.NETWORK){if("tr"===e)return _(s.pubSchnorr(r),void 0,n).address;const i=s.pubECDSA(r);if("pkh"===e)return(0,t.p2pkh)(i,n).address;if("wpkh"===e)return(0,t.p2wpkh)(i,n).address;throw new Error(`getAddress: unknown type=${e}`)};function k(e,r,n=!1,i=!1,s=o.NETWORK){const a=(0,t.p2ms)(e,n?(0,t._sortPubkeys)(r):r);return i?(0,t.p2wsh)(a,s):(0,t.p2sh)(a,s)}t._sortPubkeys=t=>Array.from(t).sort(s.compareBytes),t.multisig=k,t.sortedMultisig=function(t,e,r=!1,n=o.NETWORK){return k(t,e,!0,r,n)};const A=(0,e.createBase58check)(s.sha256);function B(t,e){if(e.length<2||e.length>40)throw new Error("Witness: invalid length");if(t>16)throw new Error("Witness: invalid version");if(0===t&&20!==e.length&&32!==e.length)throw new Error("Witness: invalid length for version")}function x(t,r,n=o.NETWORK){B(t,r);const i=0===t?e.bech32:e.bech32m;return i.encode(n.bech32,[t].concat(i.toWords(r)))}function U(t,e){return A.encode(s.concatBytes(Uint8Array.from(e),t))}function C(t=o.NETWORK){return{encode(e){const{type:r}=e;if("wpkh"===r)return x(0,e.hash,t);if("wsh"===r)return x(0,e.hash,t);if("tr"===r)return x(1,e.pubkey,t);if("pkh"===r)return U(e.hash,[t.pubKeyHash]);if("sh"===r)return U(e.hash,[t.scriptHash]);throw new Error(`Unknown address type=${r}`)},decode(r){if(r.length<14||r.length>74)throw new Error("Invalid address length");if(t.bech32&&r.toLowerCase().startsWith(t.bech32)){let n;try{if(n=e.bech32.decode(r),0!==n.words[0])throw new Error(`bech32: wrong version=${n.words[0]}`)}catch(t){if(n=e.bech32m.decode(r),0===n.words[0])throw new Error(`bech32m: wrong version=${n.words[0]}`)}if(n.prefix!==t.bech32)throw new Error(`wrong bech32 prefix=${n.prefix}`);const[i,...o]=n.words,s=e.bech32.fromWords(o);if(B(i,s),0===i&&32===s.length)return{type:"wsh",hash:s};if(0===i&&20===s.length)return{type:"wpkh",hash:s};if(1===i&&32===s.length)return{type:"tr",pubkey:s};throw new Error("Unknown witness program")}const n=A.decode(r);if(21!==n.length)throw new Error("Invalid base58 address");if(n[0]===t.pubKeyHash)return{type:"pkh",hash:n.slice(1)};if(n[0]===t.scriptHash)return{type:"sh",hash:n.slice(1)};throw new Error(`Invalid address prefix=${n[0]}`)}}}t.WIF=function(t=o.NETWORK){return{encode:e=>U(s.concatBytes(e,new Uint8Array([1])).subarray(0,33),[t.wif]),decode(e){let r=A.decode(e);if(r[0]!==t.wif)throw new Error("Wrong WIF prefix");if(r=r.subarray(1),33!==r.length)throw new Error("Wrong WIF length");if(1!==r[32])throw new Error("Wrong WIF postfix");return r.subarray(0,-1)}}},t.Address=C}($c)),$c}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._Estimator=t._cmpBig=t.DEFAULT_SEQUENCE=t.PSBTCombine=t.SigHash=t.bip32Path=t.Decimal=t.TaprootControlBlock=t._DebugPSBT=t.combinations=t.sortedMultisig=t._sortPubkeys=t.OutScript=t.taprootListToTree=t.WIF=t.getAddress=t.Address=t.utils=t.TAPROOT_UNSPENDABLE_KEY=t.TEST_NETWORK=t.NETWORK=t.selectUTXO=t.getInputType=t.Transaction=t.MAX_SCRIPT_BYTE_LENGTH=t.ScriptNum=t.Script=t.CompactSize=t.RawTx=t.OP=t.multisig=t.p2tr_pk=t.p2tr_ms=t.p2tr_ns=t.p2tr=t.p2wpkh=t.p2wsh=t.p2ms=t.p2sh=t.p2pkh=t.p2pk=void 0;
/*! scure-btc-signer - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const e=Cu;var r=ef();Object.defineProperty(t,"p2pk",{enumerable:!0,get:function(){return r.p2pk}}),Object.defineProperty(t,"p2pkh",{enumerable:!0,get:function(){return r.p2pkh}}),Object.defineProperty(t,"p2sh",{enumerable:!0,get:function(){return r.p2sh}}),Object.defineProperty(t,"p2ms",{enumerable:!0,get:function(){return r.p2ms}}),Object.defineProperty(t,"p2wsh",{enumerable:!0,get:function(){return r.p2wsh}}),Object.defineProperty(t,"p2wpkh",{enumerable:!0,get:function(){return r.p2wpkh}}),Object.defineProperty(t,"p2tr",{enumerable:!0,get:function(){return r.p2tr}}),Object.defineProperty(t,"p2tr_ns",{enumerable:!0,get:function(){return r.p2tr_ns}}),Object.defineProperty(t,"p2tr_ms",{enumerable:!0,get:function(){return r.p2tr_ms}}),Object.defineProperty(t,"p2tr_pk",{enumerable:!0,get:function(){return r.p2tr_pk}}),Object.defineProperty(t,"multisig",{enumerable:!0,get:function(){return r.multisig}});var n=Wc;Object.defineProperty(t,"OP",{enumerable:!0,get:function(){return n.OP}}),Object.defineProperty(t,"RawTx",{enumerable:!0,get:function(){return n.RawTx}}),Object.defineProperty(t,"CompactSize",{enumerable:!0,get:function(){return n.CompactSize}}),Object.defineProperty(t,"Script",{enumerable:!0,get:function(){return n.Script}}),Object.defineProperty(t,"ScriptNum",{enumerable:!0,get:function(){return n.ScriptNum}}),Object.defineProperty(t,"MAX_SCRIPT_BYTE_LENGTH",{enumerable:!0,get:function(){return n.MAX_SCRIPT_BYTE_LENGTH}});var i=Jc();Object.defineProperty(t,"Transaction",{enumerable:!0,get:function(){return i.Transaction}});var o=Zc();Object.defineProperty(t,"getInputType",{enumerable:!0,get:function(){return o.getInputType}}),Object.defineProperty(t,"selectUTXO",{enumerable:!0,get:function(){return o.selectUTXO}});var s=Cu;Object.defineProperty(t,"NETWORK",{enumerable:!0,get:function(){return s.NETWORK}}),Object.defineProperty(t,"TEST_NETWORK",{enumerable:!0,get:function(){return s.TEST_NETWORK}}),Object.defineProperty(t,"TAPROOT_UNSPENDABLE_KEY",{enumerable:!0,get:function(){return s.TAPROOT_UNSPENDABLE_KEY}}),t.utils={isBytes:e.isBytes,concatBytes:e.concatBytes,compareBytes:e.compareBytes,pubSchnorr:e.pubSchnorr,randomPrivateKeyBytes:e.randomPrivateKeyBytes,taprootTweakPubkey:e.taprootTweakPubkey};var a=ef();Object.defineProperty(t,"Address",{enumerable:!0,get:function(){return a.Address}}),Object.defineProperty(t,"getAddress",{enumerable:!0,get:function(){return a.getAddress}}),Object.defineProperty(t,"WIF",{enumerable:!0,get:function(){return a.WIF}}),Object.defineProperty(t,"taprootListToTree",{enumerable:!0,get:function(){return a.taprootListToTree}}),Object.defineProperty(t,"OutScript",{enumerable:!0,get:function(){return a.OutScript}}),Object.defineProperty(t,"_sortPubkeys",{enumerable:!0,get:function(){return a._sortPubkeys}}),Object.defineProperty(t,"sortedMultisig",{enumerable:!0,get:function(){return a.sortedMultisig}}),Object.defineProperty(t,"combinations",{enumerable:!0,get:function(){return a.combinations}});var u=tf();Object.defineProperty(t,"_DebugPSBT",{enumerable:!0,get:function(){return u._DebugPSBT}}),Object.defineProperty(t,"TaprootControlBlock",{enumerable:!0,get:function(){return u.TaprootControlBlock}});var c=Jc();Object.defineProperty(t,"Decimal",{enumerable:!0,get:function(){return c.Decimal}}),Object.defineProperty(t,"bip32Path",{enumerable:!0,get:function(){return c.bip32Path}}),Object.defineProperty(t,"SigHash",{enumerable:!0,get:function(){return c.SigHash}}),Object.defineProperty(t,"PSBTCombine",{enumerable:!0,get:function(){return c.PSBTCombine}}),Object.defineProperty(t,"DEFAULT_SEQUENCE",{enumerable:!0,get:function(){return c.DEFAULT_SEQUENCE}});var f=Zc();Object.defineProperty(t,"_cmpBig",{enumerable:!0,get:function(){return f._cmpBig}}),Object.defineProperty(t,"_Estimator",{enumerable:!0,get:function(){return f._Estimator}})}(Uu);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var rf=function(){return rf=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},rf.apply(this,arguments)},nf="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";(()=>{const t=Array(256).fill(-1);for(let e=0;e<58;++e)t[nf.charCodeAt(e)]=e})();var of,sf,af,uf=t=>{if(!t||"string"!=typeof t)throw new Error(`Expected base58 string but got “${t}”`);if(t.match(/[IOl0]/gmu))throw new Error(`Invalid base58 character “${t.match(/[IOl0]/gmu)}”`);const e=t.match(/^1+/gmu),r=e?e[0].length:0,n=(t.length-r)*(Math.log(58)/Math.log(256))+1>>>0;return new Uint8Array([...new Uint8Array(r),...t.match(/.{1}/gmu).map((t=>nf.indexOf(t))).reduce(((t,e)=>t.map((t=>{const r=58*t+e;return e=r>>8,r}))),new Uint8Array(n)).reverse().filter((i=!1,t=>i=i||t))]);var i},cf=(of=function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.bech32m=e.bech32=void 0;const r="qpzry9x8gf2tvdw0s3jn54khce6mua7l",n={};for(let t=0;t<32;t++){const e=r.charAt(t);n[e]=t}function i(t){const e=t>>25;return(33554431&t)<<5^996825010&-(1&e)^642813549&-(e>>1&1)^513874426&-(e>>2&1)^1027748829&-(e>>3&1)^705979059&-(e>>4&1)}function o(t){let e=1;for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+t+")";e=i(e)^n>>5}e=i(e);for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);e=i(e)^31&n}return e}function s(t,e,r,n){let i=0,o=0;const s=(1<<r)-1,a=[];for(let n=0;n<t.length;++n)for(i=i<<e|t[n],o+=e;o>=r;)o-=r,a.push(i>>o&s);if(n)o>0&&a.push(i<<r-o&s);else{if(o>=e)return"Excess padding";if(i<<r-o&s)return"Non-zero padding"}return a}function a(t){return s(t,8,5,!0)}function u(t){const e=s(t,5,8,!1);if(Array.isArray(e))return e}function c(t){const e=s(t,5,8,!1);if(Array.isArray(e))return e;throw new Error(e)}function f(t){let e;function s(t,r){if(r=r||90,t.length<8)return t+" too short";if(t.length>r)return"Exceeds length limit";const s=t.toLowerCase(),a=t.toUpperCase();if(t!==s&&t!==a)return"Mixed-case string "+t;const u=(t=s).lastIndexOf("1");if(-1===u)return"No separator character for "+t;if(0===u)return"Missing prefix for "+t;const c=t.slice(0,u),f=t.slice(u+1);if(f.length<6)return"Data too short";let h=o(c);if("string"==typeof h)return h;const p=[];for(let t=0;t<f.length;++t){const e=f.charAt(t),r=n[e];if(void 0===r)return"Unknown character "+e;h=i(h)^r,t+6>=f.length||p.push(r)}return h!==e?"Invalid checksum for "+t:{prefix:c,words:p}}return e="bech32"===t?1:734539939,{decodeUnsafe:function(t,e){const r=s(t,e);if("object"==typeof r)return r},decode:function(t,e){const r=s(t,e);if("object"==typeof r)return r;throw new Error(r)},encode:function(t,n,s){if(s=s||90,t.length+7+n.length>s)throw new TypeError("Exceeds length limit");let a=o(t=t.toLowerCase());if("string"==typeof a)throw new Error(a);let u=t+"1";for(let t=0;t<n.length;++t){const e=n[t];if(e>>5)throw new Error("Non 5-bit word");a=i(a)^e,u+=r.charAt(e)}for(let t=0;t<6;++t)a=i(a);a^=e;for(let t=0;t<6;++t)u+=r.charAt(a>>5*(5-t)&31);return u},toWords:a,fromWordsUnsafe:u,fromWords:c}}e.bech32=f("bech32"),e.bech32m=f("bech32m")},of(sf={exports:{}},sf.exports),sf.exports);(af=cf)&&af.__esModule&&Object.prototype.hasOwnProperty.call(af,"default")&&af.default;var ff=cf.bech32m,hf=cf.bech32;const pf=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class lf{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!yf||wf>=8e3)&&(yf=new ArrayBuffer(8e3),wf=0),this._byte=new Uint8Array(yf,wf,80),this._word=new Int32Array(yf,wf,20),wf+=80}update(t){if("string"==typeof t)return this._utf8(t);if(null==t)throw new TypeError("Invalid type: "+typeof t);const e=t.byteOffset,r=t.byteLength;let n=r/64|0,i=0;if(n&&!(3&e)&&!(this._size%64)){const r=new Int32Array(t.buffer,e,16*n);for(;n--;)this._int32(r,i>>2),i+=64;this._size+=i}if(1!==t.BYTES_PER_ELEMENT&&t.buffer){const n=new Uint8Array(t.buffer,e+i,r-i);return this._uint8(n)}return i===r?this:this._uint8(t,i)}_uint8(t,e){const{_byte:r,_word:n}=this,i=t.length;for(e|=0;e<i;){const o=this._size%64;let s=o;for(;e<i&&s<64;)r[s++]=t[e++];s>=64&&this._int32(n),this._size+=s-o}return this}_utf8(t){const{_byte:e,_word:r}=this,n=t.length;let i=this._sp;for(let o=0;o<n;){const s=this._size%64;let a=s;for(;o<n&&a<64;){let r=0|t.charCodeAt(o++);r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<55296||r>57343?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):i?(r=((1023&i)<<10)+(1023&r)+65536,e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r,i=0):i=r}a>=64&&(this._int32(r),r[0]=r[16]),this._size+=a-s}return this._sp=i,this}_int32(t,e){let{A:r,B:n,C:i,D:o,E:s,F:a,G:u,H:c}=this,f=0;for(e|=0;f<16;)df[f++]=bf(t[e++]);for(f=16;f<64;f++)df[f]=Of(df[f-2])+df[f-7]+Tf(df[f-15])+df[f-16]|0;for(f=0;f<64;f++){const t=c+Sf(s)+mf(s,a,u)+pf[f]+df[f]|0,e=vf(r)+Ef(r,n,i)|0;c=u,u=a,a=s,s=o+t|0,o=i,i=n,n=r,r=t+e|0}this.A=r+this.A|0,this.B=n+this.B|0,this.C=i+this.C|0,this.D=o+this.D|0,this.E=s+this.E|0,this.F=a+this.F|0,this.G=u+this.G|0,this.H=c+this.H|0}digest(t){const{_byte:e,_word:r}=this;let n=this._size%64|0;for(e[n++]=128;3&n;)e[n++]=0;if(n>>=2,n>14){for(;n<16;)r[n++]=0;n=0,this._int32(r)}for(;n<16;)r[n++]=0;const i=8*this._size,o=(4294967295&i)>>>0,s=(i-o)/4294967296;return s&&(r[14]=bf(s)),o&&(r[15]=bf(o)),this._int32(r),"hex"===t?this._hex():this._bin()}_hex(){const{A:t,B:e,C:r,D:n,E:i,F:o,G:s,H:a}=this;return gf(t)+gf(e)+gf(r)+gf(n)+gf(i)+gf(o)+gf(s)+gf(a)}_bin(){const{A:t,B:e,C:r,D:n,E:i,F:o,G:s,H:a,_byte:u,_word:c}=this;return c[0]=bf(t),c[1]=bf(e),c[2]=bf(r),c[3]=bf(n),c[4]=bf(i),c[5]=bf(o),c[6]=bf(s),c[7]=bf(a),u.slice(0,32)}}const df=new Int32Array(64);let yf,wf=0;const gf=t=>(t+4294967296).toString(16).substr(-8),bf=254===new Uint8Array(new Uint16Array([65279]).buffer)[0]?t=>t:t=>t<<24&4278190080|t<<8&16711680|t>>8&65280|t>>24&255,mf=(t,e,r)=>r^t&(e^r),Ef=(t,e,r)=>t&e|r&(t|e),vf=t=>(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),Sf=t=>(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7),Tf=t=>(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3,Of=t=>(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10;var Pf,_f,If=function(t){return(new lf).update(t).digest()};!function(t){t.mainnet="mainnet",t.testnet="testnet",t.regtest="regtest"}(Pf||(Pf={})),function(t){t.p2pkh="p2pkh",t.p2sh="p2sh",t.p2wpkh="p2wpkh",t.p2wsh="p2wsh",t.p2tr="p2tr"}(_f||(_f={}));var kf={0:{type:_f.p2pkh,network:Pf.mainnet},111:{type:_f.p2pkh,network:Pf.testnet},5:{type:_f.p2sh,network:Pf.mainnet},196:{type:_f.p2sh,network:Pf.testnet}},Af=function(t){var e,r=t.substr(0,2).toLowerCase();if("bc"===r||"tb"===r)return function(t){var e;try{e=t.startsWith("bc1p")||t.startsWith("tb1p")||t.startsWith("bcrt1p")?ff.decode(t):hf.decode(t)}catch(t){throw new Error("Invalid address")}var r={bc:Pf.mainnet,tb:Pf.testnet,bcrt:Pf.regtest}[e.prefix];if(void 0===r)throw new Error("Invalid address");var n=e.words[0];if(n<0||n>16)throw new Error("Invalid address");return{bech32:!0,network:r,address:t,type:20===hf.fromWords(e.words.slice(1)).length?_f.p2wpkh:1===n?_f.p2tr:_f.p2wsh}}(t);try{e=uf(t)}catch(t){throw new Error("Invalid address")}var n=e.length;if(25!==n)throw new Error("Invalid address");var i=e[0],o=e.slice(n-4,n),s=e.slice(0,n-4),a=If(If(s)).slice(0,4);if(o.some((function(t,e){return t!==a[e]})))throw new Error("Invalid address");if(!Object.keys(kf).map(Number).includes(i))throw new Error("Invalid address");return rf(rf({},kf[i]),{address:t,bech32:!1})},Bf=function(t,e){try{var r=Af(t);return!e||e===r.network}catch(t){return!1}},xf=At(Object.freeze({__proto__:null,get AddressType(){return _f},get Network(){return Pf},default:Bf,getAddressInfo:Af,validate:Bf}));!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getBtcNetwork=void 0,t.createTransfer=async function(n,o,a,u,c,f,h,p=3){const l=new i.DefaultEsploraClient(n),[d,y]=await Promise.all([l.getAddressUtxos(a),l.getFeeEstimate(p)]);if(0===d.length)throw new Error("No confirmed UTXOs");let w=[];await Promise.all(d.map((async t=>{const r=await l.getTransactionHex(t.txid),i=e.Transaction.fromRaw(Buffer.from(r,"hex"),{allowUnknownOutputs:!0}),a=s(n,t,i,o,f);w.push(a)})));const g=[{address:u,amount:BigInt(c)}];h&&(h.startsWith("0x")&&(h=h.slice(2)),g.push({script:e.Script.encode(["RETURN",r.hex.decode(h)]),amount:BigInt(0)}));const b=(0,e.selectUTXO)(w,g,"default",{changeAddress:a,feePerByte:BigInt(Math.ceil(y)),bip69:!0,createTx:!0,network:(0,t.getBtcNetwork)(n),allowUnknownOutputs:!0,allowLegacyWitnessUtxo:!0});if(!b||!b.tx)throw new Error("Failed to create transaction. Do you have enough funds?");return b.tx},t.getInputFromUtxoAndTx=s;const e=Uu,r=Ru,n=xf,i=$a,o={mainnet:e.NETWORK,testnet:e.TEST_NETWORK};function s(r,i,o,s,a){const u=o.getOutput(i.vout);let c={};if(s===n.AddressType.p2sh){const n=(0,e.p2wpkh)(Buffer.from(a,"hex"),(0,t.getBtcNetwork)(r));c=(0,e.p2sh)(n)}const f={...c},h={nonWitnessUtxo:Buffer.from(o.hex,"hex")},p={witnessUtxo:{script:u.script,amount:u.amount}},l=o.hasWitnesses?p:h;return{txid:i.txid,index:i.vout,...f,...l}}t.getBtcNetwork=t=>o[t]}(xu),function(t){var e=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=It&&It.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(ku,t),r(xu,t)}(Iu);var Uf={};Object.defineProperty(Uf,"__esModule",{value:!0}),Uf.GatewayApiClient=void 0;function Cf(t,e){const r=new Rt.Transaction;return r.addInput(Buffer.alloc(32,0),0),r.ins[0].witness=[Buffer.alloc(71,0),Buffer.alloc(33,0)],r.addOutput(Rt.address.toOutputScript(e,t),0),r.virtualSize()}Uf.GatewayApiClient=class{constructor(t){this.baseUrl=t}async getQuote(t,e){const r=await fetch(`${this.baseUrl}/quote/${t}/${e||""}`,{headers:{"Content-Type":"application/json",Accept:"application/json"}});return await r.json()}async createOrder(t,e,r){const n=await fetch(`${this.baseUrl}/order`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({onramp_address:t,user_address:e,satoshis:r})});if(!n.ok)throw new Error("Failed to create order");return await n.json()}async updateOrder(t,e){if(!(await fetch(`${this.baseUrl}/order/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({bitcoin_tx:e})})).ok)throw new Error("Failed to update order")}async getOrders(t){return(await fetch(`${this.baseUrl}/orders/${t}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}})).json()}},function(t){var e=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=It&&It.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r($a,t),r(Va,t),r(Wa,t),r(nu,t),r(bu,t),r(Iu,t),r(Uf,t)}(Ka);var Nf=80,Rf=Buffer.from("6f7264","hex"),Lf=Rt.opcodes.OP_1;function Hf(t){const e=t.length,r=t[e-1];if(void 0===r)return null;let n=2;return e>=2&&r[0]==Nf&&(n=3),void 0===t[e-n]?null:Rt.script.decompile(t[e-n])}function Df(t){let e=[];for(const r of t.ins){const t=Hf(r.witness);if(null==t)continue;const n=t.values();for(let t=n.next();!t.done;t=n.next()){if(t.value!=Rt.opcodes.OP_FALSE)continue;if(n.next().value!=Rt.opcodes.OP_IF)continue;const r=n.next().value;if(!Buffer.isBuffer(r)&&!r.equals(Rf))continue;let i={},o=[],s=!1;for(let t=n.next();!t.done;t=n.next()){if(t.value==Rt.opcodes.OP_ENDIF){e.push({tags:i,body:o});break}if(t.value!=Rt.opcodes.OP_0)if(s)Buffer.isBuffer(t.value)&&o.push(t.value);else{const e=n.next().value;"number"==typeof t.value&&Buffer.isBuffer(e)&&(i[t.value]=e)}else s=!0}}}return e}async function Mf(t,e){const r=await t.getTransactionHex(e);return Df(Rt.Transaction.fromHex(r))}function Ff(t){const[e,r]=t.split("i");return{txid:e,index:parseInt(r,10)}}var jf=new TextEncoder;function Kf(t){return{contentType:Buffer.from(jf.encode("image/jpg")),content:t}}async function $f(t,e,r){const{txid:n,index:i}=Ff(r);for(const o of e)if(o.confirmed){const t=await fetch(`${Eu.TESTNET_ORD_BASE_PATH}/output/${o.txid}:${o.vout}`,{headers:{Accept:"application/json"}}),e=await t.json();if(e.inscriptions&&e.inscriptions.includes(r))return o}else if(n==o.txid){if(void 0!==(await Mf(t,o.txid))[i])return o}}var Vf=/^(0x[a-zA-Z0-9]{4})[a-zA-Z0-9]+([a-zA-Z0-9]{4})$/,Wf=new RegExp(/\b([2mn][a-km-zA-HJ-NP-Z1-9]{25,34}|tb1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})\b/),qf=new RegExp(/\b([2mn][a-km-zA-HJ-NP-Z1-9]{25,34}|bcrt1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})\b/),zf=new RegExp(/\b([13][a-km-zA-HJ-NP-Z1-9]{25,34}|bc1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})\b/),Gf=(t,e)=>{switch(t){case"mainnet":return zf.test(e);case"testnet":return Wf.test(e);case"regtest":return qf.test(e);default:throw new Error(`Invalid bitcoin network configured: ${t}. Valid values are: testnet | regtest | mainnet.`)}},Yf=new TextEncoder,Xf=function(){function t(t){this.ready=!1,this.accounts=[],this.address="",this.network=t}return t.prototype.switchNetwork=function(t){this.network=t},t.prototype.disconnect=function(){this.accounts=[],this.address=void 0,this.publicKey=void 0},t.prototype.getAccount=function(){return this.address},t.prototype.getAccounts=function(){return this.accounts},t.prototype.isAuthorized=function(){return!!this.getAccount()},t.prototype.getNetwork=function(){return Pt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(this.network){case"mainnet":return[2,Rt.networks.bitcoin];case"testnet":return[2,Rt.networks.testnet];default:throw new Error("Unknown network")}}))}))},t.prototype.getPublicKey=function(){return Pt(this,void 0,void 0,(function(){return _t(this,(function(t){if(!this.publicKey)throw new Error("Something went wrong while connecting");return[2,this.publicKey]}))}))},t.prototype.sendInscription=function(t,e){return Pt(this,arguments,void 0,(function(t,e,r){var n,i,o,s,a,u,c,f,h,p,l;return void 0===r&&(r=1),_t(this,(function(d){switch(d.label){case 0:if(!this.address||!this.publicKey)throw new Error("Connect wallet");return[4,this.getNetwork()];case 1:return n=d.sent(),[4,(i=new Ka.DefaultEsploraClient(this.network)).getAddressUtxos(this.address)];case 2:return o=d.sent(),[4,$f(i,o,e)];case 3:if(void 0===(s=d.sent()))throw Error("Unable to find utxo owned by address [".concat(this.address,"] containing inscription id [").concat(e,"]"));return[4,i.getTransactionHex(s.txid)];case 4:return a=d.sent(),u=Rt.Transaction.fromHex(a),c={script:u.outs[s.vout].script,value:s.value},f=u.toBuffer(),(h=new Rt.Psbt({network:n})).addInput({hash:s.txid,index:s.vout,witnessUtxo:c,nonWitnessUtxo:f,tapInternalKey:(y=Buffer.from(this.publicKey,"hex"),32===y.length?y:y.subarray(1,33))}),p=Cf(n,t),l=p*r,h.addOutput({address:t,value:s.value-l}),[4,this.signInput(0,h)];case 5:return(h=d.sent()).finalizeAllInputs(),[2,i.broadcastTx(h.extractTransaction().toHex())]}var y}))}))},t.prototype.getTransaction=function(t){return Pt(this,void 0,void 0,(function(){var e,r=this;return _t(this,(function(n){return e=new Ka.DefaultEsploraClient(this.network),[2,Nt((function(n){return Pt(r,void 0,void 0,(function(){var r;return _t(this,(function(i){switch(i.label){case 0:return[4,e.getTransactionHex(t)];case 1:return(r=i.sent())||n(new Error("Failed")),[2,Rt.Transaction.fromHex(r)]}}))}))}),{retries:20,minTimeout:2e3,maxTimeout:5e3})]}))}))},t.prototype.inscribe=function(t,e){return Pt(this,void 0,void 0,(function(){var r,n,i,o,s;return _t(this,(function(a){switch(a.label){case 0:if(!this.address)throw new Error("Something went wrong while connecting");return r=new Ka.DefaultEsploraClient(this.network),"image"===t?(i=Buffer.from(e,"base64"),n=Kf(i)):(u=e,n={contentType:Buffer.from(Yf.encode("text/plain;charset=utf-8")),content:Buffer.from(Yf.encode(u))}),[4,r.getFeeEstimate(6)];case 1:return o=a.sent(),[4,Ka.inscribeData(this.getSigner(),this.address,o,n)];case 2:return s=a.sent(),[2,r.broadcastTx(s.toHex())]}var u}))}))},t.prototype.getSigner=function(){return this},t}(),Qf=function(t){switch(t){case"livenet":return"mainnet";case"testnet":return"testnet"}},Zf=function(t){switch(t){default:case"mainnet":return"livenet";case"testnet":return"testnet"}},Jf=function(t){function e(e){var r=t.call(this,e)||this;return r.id="bitget",r.name="Bitget",r.homepage="https://web3.bitget.com/",r}return St(e,t),e.prototype.connect=function(){return Pt(this,void 0,void 0,(function(){var t,e,r,n,i;return _t(this,(function(o){switch(o.label){case 0:return[4,window.bitkeep.unisat.getNetwork()];case 1:return t=o.sent(),Qf(t)===this.network?[3,3]:(e=Zf(this.network),[4,window.bitkeep.unisat.switchNetwork(e)]);case 2:o.sent(),o.label=3;case 3:return[4,Promise.all([window.bitkeep.unisat.requestAccounts(),window.bitkeep.unisat.getPublicKey()])];case 4:return r=o.sent(),n=r[0],i=r[1],this.accounts=n,this.address=n[0],this.publicKey=i,window.bitkeep.unisat.on("accountsChanged",this.changeAccount),[2]}}))}))},e.prototype.switchNetwork=function(e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return t.prototype.switchNetwork.call(this,e),this.address?[4,window.bitkeep.unisat.getNetwork()]:[2];case 1:return r=i.sent(),Qf(r)===this.network?[3,3]:(n=Zf(this.network),[4,window.bitkeep.unisat.switchNetwork(n)]);case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.disconnect=function(){t.prototype.disconnect.call(this),window.bitkeep.unisat.removeListener("accountsChanged",this.changeAccount)},e.prototype.changeAccount=function(t){return Pt(this,void 0,void 0,(function(){var e;return _t(this,(function(r){switch(r.label){case 0:return this.accounts=t,this.address=t[0],e=this,[4,window.bitkeep.unisat.getPublicKey()];case 1:return e.publicKey=r.sent(),[2]}}))}))},e.prototype.isReady=function(){return Pt(this,void 0,void 0,(function(){var t;return _t(this,(function(e){return this.ready=void 0!==(null===(t=window.bitkeep)||void 0===t?void 0:t.unisat),[2,this.ready]}))}))},e.prototype.signMessage=function(t){return Pt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,window.bitkeep.unisat.signMessage(t)]}))}))},e.prototype.sendToAddress=function(t,e){return Pt(this,void 0,void 0,(function(){return _t(this,(function(r){return[2,window.bitkeep.unisat.sendBitcoin(t,e)]}))}))},e.prototype.signInput=function(t,e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return[4,this.getPublicKey()];case 1:return r=i.sent(),[4,window.bitkeep.unisat.signPsbt(e.toHex(),{autoFinalized:!1,toSignInputs:[{index:t,publicKey:r,disableTweakSigner:!0}]})];case 2:return n=i.sent(),[2,Rt.Psbt.fromHex(n)]}}))}))},e.prototype.sendInscription=function(t,e,r){return Pt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,window.bitkeep.unisat.sendInscription(t,e,r?{feeRate:r}:void 0)];case 1:return[2,n.sent().txid]}}))}))},e}(Xf),th=function(t){function e(e){var r=t.call(this,e)||this;return r.id="leather",r.name="Leather",r.homepage="https://leather.io/",r}return St(e,t),e.prototype.connect=function(){return Pt(this,void 0,void 0,(function(){var t,e;return _t(this,(function(r){switch(r.label){case 0:return[4,window.btc.request("getAddresses")];case 1:if(t=r.sent(),!(e=t.result.addresses.find((function(t){return"p2tr"===t.type}))))throw new Error("Failed to connect wallet");if(!Gf(this.network,e.address))throw new Error("Invalid Network. Please switch to bitcoin ".concat(this.network,"."));return this.accounts=t.result.addresses.map((function(t){return t.address})),this.address=e.address,this.publicKey=e.publicKey,this.derivationPath=e.derivationPath,[2]}}))}))},e.prototype.isReady=function(){return Pt(this,void 0,void 0,(function(){return _t(this,(function(t){return this.ready=!!window.LeatherProvider,[2,this.ready]}))}))},e.prototype.signMessage=function(t){return Pt(this,void 0,void 0,(function(){return _t(this,(function(e){switch(e.label){case 0:return[4,window.btc.request("signMessage",{message:t,network:this.network})];case 1:return[2,e.sent().result.signature]}}))}))},e.prototype.sendToAddress=function(t,e){return Pt(this,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return[4,window.btc.request("sendTransfer",{address:t,amount:e.toString(),network:this.network})];case 1:return[2,r.sent().result.txid]}}))}))},e.prototype.signInput=function(t,e){return Pt(this,void 0,void 0,(function(){var r;return _t(this,(function(n){switch(n.label){case 0:return[4,window.btc.request("signPsbt",{hex:e.toHex(),signAtIndex:t,network:this.network,broadcast:!1})];case 1:return r=n.sent(),[2,Rt.Psbt.fromHex(r.result.hex)]}}))}))},e}(Xf),eh=function(t){switch(t){case"livenet":return"mainnet";case"testnet":return"testnet"}},rh=function(t){switch(t){default:case"mainnet":return"livenet";case"testnet":return"testnet"}},nh=function(t){function e(e){var r=t.call(this,e)||this;return r.id="okx",r.name="OKX",r.homepage="https://okx.com/",r}return St(e,t),e.prototype.connect=function(){return Pt(this,void 0,void 0,(function(){var t,e,r,n,i,o;return _t(this,(function(s){switch(s.label){case 0:return[4,window.okxwallet.bitcoin.getNetwork()];case 1:return t=s.sent(),eh(t)===this.network?[3,3]:(e=rh(this.network),[4,window.okxwallet.bitcoin.switchNetwork(e)]);case 2:s.sent(),s.label=3;case 3:return[4,window.okxwallet.bitcoin.connect()];case 4:return r=s.sent(),n=r.address,i=r.publicKey,[4,window.okxwallet.bitcoin.getAccounts()];case 5:return o=s.sent(),this.accounts=o,this.address=n,this.publicKey=i,window.okxwallet.bitcoin.on("accountChanged",this.changeAccount),[2]}}))}))},e.prototype.switchNetwork=function(e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return t.prototype.switchNetwork.call(this,e),this.address?[4,window.okxwallet.bitcoin.getNetwork()]:[2];case 1:return r=i.sent(),eh(r)===this.network?[3,3]:(n=rh(this.network),[4,window.okxwallet.bitcoin.switchNetwork(n)]);case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.disconnect=function(){t.prototype.disconnect.call(this),window.okxwallet.bitcoin.removeListener("accountChanged",this.changeAccount)},e.prototype.changeAccount=function(t){return Pt(this,void 0,void 0,(function(){var e;return _t(this,(function(r){switch(r.label){case 0:return this.address=t.address,this.publicKey=t.publicKey,e=this,[4,window.okxwallet.bitcoin.getAccounts()];case 1:return e.accounts=r.sent(),[2]}}))}))},e.prototype.isReady=function(){return Pt(this,void 0,void 0,(function(){var t;return _t(this,(function(e){return this.ready=void 0!==(null===(t=window.okxwallet)||void 0===t?void 0:t.bitcoin),[2,this.ready]}))}))},e.prototype.signMessage=function(t){return Pt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,window.okxwallet.bitcoin.signMessage(t)]}))}))},e.prototype.sendToAddress=function(t,e){return Pt(this,void 0,void 0,(function(){return _t(this,(function(r){return[2,window.okxwallet.bitcoin.sendBitcoin(t,e)]}))}))},e.prototype.signInput=function(t,e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return[4,this.getPublicKey()];case 1:return r=i.sent(),[4,window.okxwallet.bitcoin.signPsbt(e.toHex(),{autoFinalized:!1,toSignInputs:[{index:t,publicKey:r,disableTweakSigner:!0}]})];case 2:return n=i.sent(),[2,Rt.Psbt.fromHex(n)]}}))}))},e.prototype.sendInscription=function(t,e,r){return Pt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,window.okxwallet.bitcoin.sendInscription(t,e,r?{feeRate:r}:void 0)];case 1:return[2,n.sent().txid]}}))}))},e}(Xf),ih=function(t){switch(t){case"livenet":return"mainnet";case"testnet":return"testnet"}},oh=function(t){switch(t){default:case"mainnet":return"livenet";case"testnet":return"testnet"}},sh=function(t){function e(e){var r=t.call(this,e)||this;return r.id="unisat",r.name="Unisat",r.homepage="https://unisat.io/",r}return St(e,t),e.prototype.connect=function(){return Pt(this,void 0,void 0,(function(){var t,e,r,n,i;return _t(this,(function(o){switch(o.label){case 0:return[4,window.unisat.getNetwork()];case 1:return t=o.sent(),ih(t)===this.network?[3,3]:(e=oh(this.network),[4,window.unisat.switchNetwork(e)]);case 2:o.sent(),o.label=3;case 3:return[4,Promise.all([window.unisat.requestAccounts(),window.unisat.getPublicKey()])];case 4:return r=o.sent(),n=r[0],i=r[1],this.accounts=n,this.address=n[0],this.publicKey=i,window.unisat.on("accountsChanged",this.changeAccount),[2]}}))}))},e.prototype.switchNetwork=function(e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return t.prototype.switchNetwork.call(this,e),this.address?[4,window.unisat.getNetwork()]:[2];case 1:return r=i.sent(),ih(r)===this.network?[3,3]:(n=oh(this.network),[4,window.unisat.switchNetwork(n)]);case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.disconnect=function(){t.prototype.disconnect.call(this),window.unisat.removeListener("accountsChanged",this.changeAccount)},e.prototype.changeAccount=function(t){return Pt(this,arguments,void 0,(function(t){var e,r=t[0];return _t(this,(function(t){switch(t.label){case 0:return this.address=r,e=this,[4,window.unisat.getPublicKey()];case 1:return e.publicKey=t.sent(),[2]}}))}))},e.prototype.isReady=function(){return Pt(this,void 0,void 0,(function(){return _t(this,(function(t){return this.ready=void 0!==window.unisat,[2,this.ready]}))}))},e.prototype.signMessage=function(t){return Pt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,window.unisat.signMessage(t)]}))}))},e.prototype.sendToAddress=function(t,e){return Pt(this,void 0,void 0,(function(){return _t(this,(function(r){return[2,window.unisat.sendBitcoin(t,e)]}))}))},e.prototype.signInput=function(t,e){return Pt(this,void 0,void 0,(function(){var r,n;return _t(this,(function(i){switch(i.label){case 0:return[4,this.getPublicKey()];case 1:return r=i.sent(),[4,window.unisat.signPsbt(e.toHex(),{autoFinalized:!1,toSignInputs:[{index:t,publicKey:r,disableTweakSigner:!0}]})];case 2:return n=i.sent(),[2,Rt.Psbt.fromHex(n)]}}))}))},e.prototype.sendInscription=function(t,e,r){return Pt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,window.unisat.sendInscription(t,e,r?{feeRate:r}:void 0)];case 1:return[2,n.sent().txid]}}))}))},e}(Xf),ah="[object Function]",uh="[object GeneratorFunction]",ch=/^\[object .+?Constructor\]$/,fh="object"==typeof It&&It&&It.Object===Object&&It,hh="object"==typeof self&&self&&self.Object===Object&&self,ph=fh||hh||Function("return this")();var lh,dh=Function.prototype,yh=Object.prototype,wh=ph["__core-js_shared__"],gh=(lh=/[^.]+$/.exec(wh&&wh.keys&&wh.keys.IE_PROTO||""))?"Symbol(src)_1."+lh:"",bh=dh.toString,mh=yh.hasOwnProperty,Eh=yh.toString,vh=RegExp("^"+bh.call(mh).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sh=ph.Symbol;function Th(t){if(!Ph(t)||(e=t,gh&&gh in e))return!1;var e,r=function(t){var e=Ph(t)?Eh.call(t):"";return e==ah||e==uh}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?vh:ch;return r.test(function(t){if(null!=t){try{return bh.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function Oh(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Th(r)?r:void 0}function Ph(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}Sh&&Sh.isConcatSpreadable,Oh(ph,"Map"),Oh(Object,"create");for(var _h={},Ih={},kh={},Ah={byteLength:function(t){var e=Rh(t),r=e[0],n=e[1];return 3*(r+n)/4-n},toByteArray:function(t){var e,r,n=Rh(t),i=n[0],o=n[1],s=new Uh(function(t,e,r){return 3*(e+r)/4-r}(0,i,o)),a=0,u=o>0?i-4:i;for(r=0;r<u;r+=4)e=xh[t.charCodeAt(r)]<<18|xh[t.charCodeAt(r+1)]<<12|xh[t.charCodeAt(r+2)]<<6|xh[t.charCodeAt(r+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;2===o&&(e=xh[t.charCodeAt(r)]<<2|xh[t.charCodeAt(r+1)]>>4,s[a++]=255&e);1===o&&(e=xh[t.charCodeAt(r)]<<10|xh[t.charCodeAt(r+1)]<<4|xh[t.charCodeAt(r+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e);return s},fromByteArray:function(t){for(var e,r=t.length,n=r%3,i=[],o=16383,s=0,a=r-n;s<a;s+=o)i.push(Lh(t,s,s+o>a?a:s+o));1===n?(e=t[r-1],i.push(Bh[e>>2]+Bh[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],i.push(Bh[e>>10]+Bh[e>>4&63]+Bh[e<<2&63]+"="));return i.join("")}},Bh=[],xh=[],Uh="undefined"!=typeof Uint8Array?Uint8Array:Array,Ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nh=0;Nh<64;++Nh)Bh[Nh]=Ch[Nh],xh[Ch.charCodeAt(Nh)]=Nh;function Rh(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function Lh(t,e,r){for(var n,i,o=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),o.push(Bh[(i=n)>>18&63]+Bh[i>>12&63]+Bh[i>>6&63]+Bh[63&i]);return o.join("")}xh["-".charCodeAt(0)]=62,xh["_".charCodeAt(0)]=63,Object.defineProperty(kh,"__esModule",{value:!0}),kh.decode=kh.encode=kh.unescape=kh.escape=kh.pad=void 0;const Hh=Ah;function Dh(t){return`${t}${"=".repeat(4-(t.length%4||4))}`}function Mh(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Fh(t){return Dh(t).replace(/-/g,"+").replace(/_/g,"/")}kh.pad=Dh,kh.escape=Mh,kh.unescape=Fh,kh.encode=function(t){return Mh((0,Hh.fromByteArray)((new TextEncoder).encode(t)))},kh.decode=function(t){return(new TextDecoder).decode((0,Hh.toByteArray)(Dh(Fh(t))))};var jh={},Kh={},$h={};!function(t){
/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.schnorr=t.verify=t.signSync=t.sign=t.getSharedSecret=t.recoverPublicKey=t.getPublicKey=t.Signature=t.Point=t.CURVE=void 0;const e=f.default,r=BigInt(0),n=BigInt(1),i=BigInt(2),o=BigInt(3),s=BigInt(8),a=Object.freeze({a:r,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:n,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});t.CURVE=a;const u=(t,e)=>(t+e/i)/e,c={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(t){const{n:e}=a,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,c=BigInt("0x100000000000000000000000000000000"),f=u(s*t,e),h=u(-i*t,e);let p=D(t-f*r-h*o,e),l=D(-f*i-h*s,e);const d=p>c,y=l>c;if(d&&(p=e-p),y&&(l=e-l),p>c||l>c)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:d,k1:p,k2neg:y,k2:l}}},h=32,p=32,l=h+1,d=2*h+1;function y(t){const{a:e,b:r}=a,n=D(t*t),i=D(n*t);return D(i+e*t+r)}const w=a.a===r;class g extends Error{constructor(t){super(t)}}function b(t){if(!(t instanceof m))throw new TypeError("JacobianPoint expected")}class m{constructor(t,e,r){this.x=t,this.y=e,this.z=r}static fromAffine(t){if(!(t instanceof S))throw new TypeError("JacobianPoint#fromAffine: expected Point");return t.equals(S.ZERO)?m.ZERO:new m(t.x,t.y,n)}static toAffineBatch(t){const e=function(t,e=a.P){const i=new Array(t.length),o=t.reduce(((t,n,o)=>n===r?t:(i[o]=t,D(t*n,e))),n),s=F(o,e);return t.reduceRight(((t,n,o)=>n===r?t:(i[o]=D(t*i[o],e),D(t*n,e))),s),i}(t.map((t=>t.z)));return t.map(((t,r)=>t.toAffine(e[r])))}static normalizeZ(t){return m.toAffineBatch(t).map(m.fromAffine)}equals(t){b(t);const{x:e,y:r,z:n}=this,{x:i,y:o,z:s}=t,a=D(n*n),u=D(s*s),c=D(e*u),f=D(i*a),h=D(D(r*s)*u),p=D(D(o*n)*a);return c===f&&h===p}negate(){return new m(this.x,D(-this.y),this.z)}double(){const{x:t,y:e,z:r}=this,n=D(t*t),a=D(e*e),u=D(a*a),c=t+a,f=D(i*(D(c*c)-n-u)),h=D(o*n),p=D(h*h),l=D(p-i*f),d=D(h*(f-l)-s*u),y=D(i*e*r);return new m(l,d,y)}add(t){b(t);const{x:e,y:n,z:o}=this,{x:s,y:a,z:u}=t;if(s===r||a===r)return this;if(e===r||n===r)return t;const c=D(o*o),f=D(u*u),h=D(e*f),p=D(s*c),l=D(D(n*u)*f),d=D(D(a*o)*c),y=D(p-h),w=D(d-l);if(y===r)return w===r?this.double():m.ZERO;const g=D(y*y),E=D(y*g),v=D(h*g),S=D(w*w-E-i*v),T=D(w*(v-S)-l*E),O=D(o*u*y);return new m(S,T,O)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=m.ZERO;if("bigint"==typeof t&&t===r)return e;let i=H(t);if(i===n)return this;if(!w){let t=e,o=this;for(;i>r;)i&n&&(t=t.add(o)),o=o.double(),i>>=n;return t}let{k1neg:o,k1:s,k2neg:a,k2:u}=c.splitScalar(i),f=e,h=e,p=this;for(;s>r||u>r;)s&n&&(f=f.add(p)),u&n&&(h=h.add(p)),p=p.double(),s>>=n,u>>=n;return o&&(f=f.negate()),a&&(h=h.negate()),h=new m(D(h.x*c.beta),h.y,h.z),f.add(h)}precomputeWindow(t){const e=w?128/t+1:256/t+1,r=[];let n=this,i=n;for(let o=0;o<e;o++){i=n,r.push(i);for(let e=1;e<2**(t-1);e++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(t,e){!e&&this.equals(m.BASE)&&(e=S.BASE);const r=e&&e._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=e&&v.get(e);i||(i=this.precomputeWindow(r),e&&1!==r&&(i=m.normalizeZ(i),v.set(e,i)));let o=m.ZERO,s=m.BASE;const a=1+(w?128/r:256/r),u=2**(r-1),c=BigInt(2**r-1),f=2**r,h=BigInt(r);for(let e=0;e<a;e++){const r=e*u;let a=Number(t&c);t>>=h,a>u&&(a-=f,t+=n);const p=r,l=r+Math.abs(a)-1,d=e%2!=0,y=a<0;0===a?s=s.add(E(d,i[p])):o=o.add(E(y,i[l]))}return{p:o,f:s}}multiply(t,e){let r,n,i=H(t);if(w){const{k1neg:t,k1:o,k2neg:s,k2:a}=c.splitScalar(i);let{p:u,f:f}=this.wNAF(o,e),{p:h,f:p}=this.wNAF(a,e);u=E(t,u),h=E(s,h),h=new m(D(h.x*c.beta),h.y,h.z),r=u.add(h),n=f.add(p)}else{const{p:t,f:o}=this.wNAF(i,e);r=t,n=o}return m.normalizeZ([r,n])[0]}toAffine(t){const{x:e,y:r,z:i}=this,o=this.equals(m.ZERO);null==t&&(t=o?s:F(i));const a=t,u=D(a*a),c=D(u*a),f=D(e*u),h=D(r*c),p=D(i*a);if(o)return S.ZERO;if(p!==n)throw new Error("invZ was invalid");return new S(f,h)}}function E(t,e){const r=e.negate();return t?r:e}m.BASE=new m(a.Gx,a.Gy,n),m.ZERO=new m(r,n,r);const v=new WeakMap;class S{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,v.delete(this)}hasEvenY(){return this.y%i===r}static fromCompressedHex(t){const e=32===t.length,r=R(e?t:t.subarray(1));if(!q(r))throw new Error("Point is not on curve");let s=function(t){const{P:e}=a,r=BigInt(6),n=BigInt(11),s=BigInt(22),u=BigInt(23),c=BigInt(44),f=BigInt(88),h=t*t*t%e,p=h*h*t%e,l=M(p,o)*p%e,d=M(l,o)*p%e,y=M(d,i)*h%e,w=M(y,n)*y%e,g=M(w,s)*w%e,b=M(g,c)*g%e,m=M(b,f)*b%e,E=M(m,c)*g%e,v=M(E,o)*p%e,S=M(v,u)*w%e,T=M(S,r)*h%e,O=M(T,i);if(O*O%e!==t)throw new Error("Cannot find square root");return O}(y(r));const u=(s&n)===n;if(e)u&&(s=D(-s));else{!(1&~t[0])!==u&&(s=D(-s))}const c=new S(r,s);return c.assertValidity(),c}static fromUncompressedHex(t){const e=R(t.subarray(1,h+1)),r=R(t.subarray(h+1,2*h+1)),n=new S(e,r);return n.assertValidity(),n}static fromHex(t){const e=L(t),r=e.length,n=e[0];if(r===h)return this.fromCompressedHex(e);if(r===l&&(2===n||3===n))return this.fromCompressedHex(e);if(r===d&&4===n)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-${l} compressed bytes or ${d} uncompressed bytes, not ${r}`)}static fromPrivateKey(t){return S.BASE.multiply(G(t))}static fromSignature(t,e,r){const{r:n,s:i}=X(e);if(![0,1,2,3].includes(r))throw new Error("Cannot recover: invalid recovery bit");const o=j(L(t)),{n:s}=a,u=2===r||3===r?n+s:n,c=F(u,s),f=D(-o*c,s),h=D(i*c,s),p=1&r?"03":"02",l=S.fromHex(p+B(u)),d=S.BASE.multiplyAndAddUnsafe(l,f,h);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(t=!1){return N(this.toHex(t))}toHex(t=!1){const e=B(this.x);if(t){return`${this.hasEvenY()?"02":"03"}${e}`}return`04${e}${B(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:n}=this;if(!q(e)||!q(n))throw new Error(t);const i=D(n*n);if(D(i-y(e))!==r)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new S(this.x,D(-this.y))}double(){return m.fromAffine(this).double().toAffine()}add(t){return m.fromAffine(this).add(m.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return m.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,i){const o=m.fromAffine(this),s=e===r||e===n||this!==S.BASE?o.multiplyUnsafe(e):o.multiply(e),a=m.fromAffine(t).multiplyUnsafe(i),u=s.add(a);return u.equals(m.ZERO)?void 0:u.toAffine()}}function T(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function O(t){if(t.length<2||2!==t[0])throw new Error(`Invalid signature integer tag: ${k(t)}`);const e=t[1],r=t.subarray(2,e+2);if(!e||r.length!==e)throw new Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:R(r),left:t.subarray(e+2)}}t.Point=S,S.BASE=new S(a.Gx,a.Gy),S.ZERO=new S(r,r);class P{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=t instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof t&&!e)throw new TypeError(`${r}: Expected string or Uint8Array`);const n=e?k(t):t;if(128!==n.length)throw new Error(`${r}: Expected 64-byte hex`);return new P(C(n.slice(0,64)),C(n.slice(64,128)))}static fromDER(t){const e=t instanceof Uint8Array;if("string"!=typeof t&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:r,s:n}=function(t){if(t.length<2||48!=t[0])throw new Error(`Invalid signature tag: ${k(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:r}=O(t.subarray(2)),{data:n,left:i}=O(r);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${k(i)}`);return{r:e,s:n}}(e?t:N(t));return new P(r,n)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!W(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!W(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=a.n>>n;return this.s>t}normalizeS(){return this.hasHighS()?new P(this.r,D(-this.s,a.n)):this}toDERRawBytes(){return N(this.toDERHex())}toDERHex(){const t=T(U(this.s)),e=T(U(this.r)),r=t.length/2,n=e.length/2,i=U(r),o=U(n);return`30${U(n+r+4)}02${o}${e}02${i}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return N(this.toCompactHex())}toCompactHex(){return B(this.r)+B(this.s)}}function _(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const i=t[e];r.set(i,n),n+=i.length}return r}t.Signature=P;const I=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function k(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let r=0;r<t.length;r++)e+=I[t[r]];return e}const A=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function B(t){if("bigint"!=typeof t)throw new Error("Expected bigint");if(!(r<=t&&t<A))throw new Error("Expected number 0 <= n < 2^256");return t.toString(16).padStart(64,"0")}function x(t){const e=N(B(t));if(32!==e.length)throw new Error("Error: expected 32 bytes");return e}function U(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function C(t){if("string"!=typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function N(t){if("string"!=typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);const e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){const n=2*r,i=t.slice(n,n+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");e[r]=o}return e}function R(t){return C(k(t))}function L(t){return t instanceof Uint8Array?Uint8Array.from(t):N(t)}function H(t){if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if("bigint"==typeof t&&W(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function D(t,e=a.P){const n=t%e;return n>=r?n:e+n}function M(t,e){const{P:n}=a;let i=t;for(;e-- >r;)i*=i,i%=n;return i}function F(t,e=a.P){if(t===r||e<=r)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let i=D(t,e),o=e,s=r,u=n;for(;i!==r;){const t=o%i,e=s-u*(o/i);o=i,i=t,s=u,u=e}if(o!==n)throw new Error("invert: does not exist");return D(s,e)}function j(t,e=!1){const r=function(t){const e=8*t.length-8*p,r=R(t);return e>0?r>>BigInt(e):r}(t);if(e)return r;const{n:n}=a;return r>=n?r-n:r}let K,$;class V{constructor(t,e){if(this.hashLen=t,this.qByteLen=e,"number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(t).fill(1),this.k=new Uint8Array(t).fill(0),this.counter=0}hmac(...e){return t.utils.hmacSha256(this.k,...e)}hmacSync(...t){return $(this.k,...t)}checkSync(){if("function"!=typeof $)throw new g("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(t=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),t),this.v=await this.hmac(this.v),0!==t.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),t),this.v=await this.hmac(this.v))}reseedSync(t=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),t),this.v=this.hmacSync(this.v),0!==t.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),t),this.v=this.hmacSync(this.v))}async generate(){this.incr();let t=0;const e=[];for(;t<this.qByteLen;){this.v=await this.hmac(this.v);const r=this.v.slice();e.push(r),t+=this.v.length}return _(...e)}generateSync(){this.checkSync(),this.incr();let t=0;const e=[];for(;t<this.qByteLen;){this.v=this.hmacSync(this.v);const r=this.v.slice();e.push(r),t+=this.v.length}return _(...e)}}function W(t){return r<t&&t<a.n}function q(t){return r<t&&t<a.P}function z(t,e,i,o=!0){const{n:s}=a,u=j(t,!0);if(!W(u))return;const c=F(u,s),f=S.BASE.multiply(u),h=D(f.x,s);if(h===r)return;const p=D(c*D(e+i*h,s),s);if(p===r)return;let l=new P(h,p),d=(f.x===l.r?0:2)|Number(f.y&n);return o&&l.hasHighS()&&(l=l.normalizeS(),d^=1),{sig:l,recovery:d}}function G(t){let e;if("bigint"==typeof t)e=t;else if("number"==typeof t&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if("string"==typeof t){if(t.length!==2*p)throw new Error("Expected 32 bytes of private key");e=C(t)}else{if(!(t instanceof Uint8Array))throw new TypeError("Expected valid private key");if(t.length!==p)throw new Error("Expected 32 bytes of private key");e=R(t)}if(!W(e))throw new Error("Expected private key: 0 < key < n");return e}function Y(t){return t instanceof S?(t.assertValidity(),t):S.fromHex(t)}function X(t){if(t instanceof P)return t.assertValidity(),t;try{return P.fromDER(t)}catch(e){return P.fromCompact(t)}}function Q(t){const e=t instanceof Uint8Array,r="string"==typeof t,n=(e||r)&&t.length;return e?n===l||n===d:r?n===2*l||n===2*d:t instanceof S}function Z(t){return R(t.length>h?t.slice(0,h):t)}function J(t){const e=Z(t),n=D(e,a.n);return tt(n<r?e:n)}function tt(t){return x(t)}function et(e,r,n){if(null==e)throw new Error(`sign: expected valid message hash, not "${e}"`);const i=L(e),o=G(r),s=[tt(o),J(i)];if(null!=n){!0===n&&(n=t.utils.randomBytes(h));const e=L(n);if(e.length!==h)throw new Error(`sign: Expected ${h} bytes of extra data`);s.push(e)}return{seed:_(...s),m:Z(i),d:o}}function rt(t,e){const{sig:r,recovery:n}=t,{der:i,recovered:o}=Object.assign({canonical:!0,der:!0},e),s=i?r.toDERRawBytes():r.toCompactRawBytes();return o?[s,n]:s}t.getPublicKey=function(t,e=!1){return S.fromPrivateKey(t).toRawBytes(e)},t.recoverPublicKey=function(t,e,r,n=!1){return S.fromSignature(t,e,r).toRawBytes(n)},t.getSharedSecret=function(t,e,r=!1){if(Q(t))throw new TypeError("getSharedSecret: first arg must be private key");if(!Q(e))throw new TypeError("getSharedSecret: second arg must be public key");const n=Y(e);return n.assertValidity(),n.multiply(G(t)).toRawBytes(r)},t.sign=async function(t,e,r={}){const{seed:n,m:i,d:o}=et(t,e,r.extraEntropy),s=new V(32,p);let a;for(await s.reseed(n);!(a=z(await s.generate(),i,o,r.canonical));)await s.reseed();return rt(a,r)},t.signSync=function(t,e,r={}){const{seed:n,m:i,d:o}=et(t,e,r.extraEntropy),s=new V(32,p);let a;for(s.reseedSync(n);!(a=z(s.generateSync(),i,o,r.canonical));)s.reseedSync();return rt(a,r)};const nt={strict:!0};function it(t){return D(R(t),a.n)}t.verify=function(t,e,r,n=nt){let i;try{i=X(t),e=L(e)}catch(t){return!1}const{r:o,s:s}=i;if(n.strict&&i.hasHighS())return!1;const u=j(e);let c;try{c=Y(r)}catch(t){return!1}const{n:f}=a,h=F(s,f),p=D(u*h,f),l=D(o*h,f),d=S.BASE.multiplyAndAddUnsafe(c,p,l);return!!d&&D(d.x,f)===o};class ot{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=L(t);if(64!==e.length)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${e.length}`);const r=R(e.subarray(0,32)),n=R(e.subarray(32,64));return new ot(r,n)}assertValidity(){const{r:t,s:e}=this;if(!q(t)||!W(e))throw new Error("Invalid signature")}toHex(){return B(this.r)+B(this.s)}toRawBytes(){return N(this.toHex())}}class st{constructor(e,r,n=t.utils.randomBytes()){if(null==e)throw new TypeError(`sign: Expected valid message, not "${e}"`);this.m=L(e);const{x:i,scalar:o}=this.getScalar(G(r));if(this.px=i,this.d=o,this.rand=L(n),32!==this.rand.length)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(t){const e=S.fromPrivateKey(t),r=e.hasEvenY()?t:a.n-t;return{point:e,scalar:r,x:e.toRawX()}}initNonce(t,e){return x(t^R(e))}finalizeNonce(t){const e=D(R(t),a.n);if(e===r)throw new Error("sign: Creation of signature failed. k is zero");const{point:n,x:i,scalar:o}=this.getScalar(e);return{R:n,rx:i,k:o}}finalizeSig(t,e,r,n){return new ot(t.x,D(e+r*n,a.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:e,d:r,px:n,rand:i}=this,o=t.utils.taggedHash,s=this.initNonce(r,await o(pt.aux,i)),{R:a,rx:u,k:c}=this.finalizeNonce(await o(pt.nonce,s,n,e)),f=it(await o(pt.challenge,u,n,e)),h=this.finalizeSig(a,c,f,r);return await ct(h,e,n)||this.error(),h}calcSync(){const{m:e,d:r,px:n,rand:i}=this,o=t.utils.taggedHashSync,s=this.initNonce(r,o(pt.aux,i)),{R:a,rx:u,k:c}=this.finalizeNonce(o(pt.nonce,s,n,e)),f=it(o(pt.challenge,u,n,e)),h=this.finalizeSig(a,c,f,r);return ft(h,e,n)||this.error(),h}}function at(t,e,r){const n=t instanceof ot,i=n?t:ot.fromHex(t);return n&&i.assertValidity(),{...i,m:L(e),P:Y(r)}}function ut(t,e,r,n){const i=S.BASE.multiplyAndAddUnsafe(e,G(r),D(-n,a.n));return!(!i||!i.hasEvenY()||i.x!==t)}async function ct(e,r,n){try{const{r:i,s:o,m:s,P:a}=at(e,r,n),u=it(await t.utils.taggedHash(pt.challenge,x(i),a.toRawX(),s));return ut(i,a,o,u)}catch(t){return!1}}function ft(e,r,n){try{const{r:i,s:o,m:s,P:a}=at(e,r,n),u=it(t.utils.taggedHashSync(pt.challenge,x(i),a.toRawX(),s));return ut(i,a,o,u)}catch(t){if(t instanceof g)throw t;return!1}}t.schnorr={Signature:ot,getPublicKey:function(t){return S.fromPrivateKey(t).toRawX()},sign:async function(t,e,r){return new st(t,e,r).calc()},verify:ct,signSync:function(t,e,r){return new st(t,e,r).calcSync()},verifySync:ft},S.BASE._setWindowSize(8);const ht={node:e,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},pt={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},lt={};t.utils={bytesToHex:k,hexToBytes:N,concatBytes:_,mod:D,invert:F,isValidPrivateKey(t){try{return G(t),!0}catch(t){return!1}},_bigintTo32Bytes:x,_normalizePrivateKey:G,hashToPrivateKey:t=>{t=L(t);const e=p+8;if(t.length<e||t.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");return x(D(R(t),a.n-n)+n)},randomBytes:(t=32)=>{if(ht.web)return ht.web.getRandomValues(new Uint8Array(t));if(ht.node){const{randomBytes:e}=ht.node;return Uint8Array.from(e(t))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>t.utils.hashToPrivateKey(t.utils.randomBytes(p+8)),precompute(t=8,e=S.BASE){const r=e===S.BASE?e:new S(e.x,e.y);return r._setWindowSize(t),r.multiply(o),r},sha256:async(...t)=>{if(ht.web){const e=await ht.web.subtle.digest("SHA-256",_(...t));return new Uint8Array(e)}if(ht.node){const{createHash:e}=ht.node,r=e("sha256");return t.forEach((t=>r.update(t))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(ht.web){const r=await ht.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=_(...e),i=await ht.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}if(ht.node){const{createHmac:r}=ht.node,n=r("sha256",t);return e.forEach((t=>n.update(t))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...r)=>{let n=lt[e];if(void 0===n){const r=await t.utils.sha256(Uint8Array.from(e,(t=>t.charCodeAt(0))));n=_(r,r),lt[e]=n}return t.utils.sha256(n,...r)},taggedHashSync:(t,...e)=>{if("function"!=typeof K)throw new g("sha256Sync is undefined, you need to set it");let r=lt[t];if(void 0===r){const e=K(Uint8Array.from(t,(t=>t.charCodeAt(0))));r=_(e,e),lt[t]=r}return K(r,...e)},_JacobianPoint:m},Object.defineProperties(t.utils,{sha256Sync:{configurable:!1,get:()=>K,set(t){K||(K=t)}},hmacSha256Sync:{configurable:!1,get:()=>$,set(t){$||($=t)}}})}($h);var Vh={};Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.joseToDer=Vh.derToJose=void 0;const Wh=Ah,qh=kh;function zh(t){return(t/8|0)+(t%8==0?0:1)}const Gh={ES256:zh(256),ES384:zh(384),ES512:zh(521)};function Yh(t){const e=Gh[t];if(e)return e;throw new Error(`Unknown algorithm "${t}"`)}const Xh=128;function Qh(t){if(t instanceof Uint8Array)return t;if("string"==typeof t)return(0,Wh.toByteArray)((0,qh.pad)(t));throw new TypeError("ECDSA signature must be a Base64 string or a Uint8Array")}function Zh(t,e,r){let n=0;for(;e+n<r&&0===t[e+n];)++n;return t[e+n]>=Xh&&--n,n}Vh.derToJose=function(t,e){const r=Qh(t),n=Yh(e),i=n+1,o=r.length;let s=0;if(48!==r[s++])throw new Error('Could not find expected "seq"');let a=r[s++];if(a===(1|Xh)&&(a=r[s++]),o-s<a)throw new Error(`"seq" specified length of "${a}", only "${o-s}" remaining`);if(2!==r[s++])throw new Error('Could not find expected "int" for "r"');const u=r[s++];if(o-s-2<u)throw new Error(`"r" specified length of "${u}", only "${o-s-2}" available`);if(i<u)throw new Error(`"r" specified length of "${u}", max of "${i}" is acceptable`);const c=s;if(s+=u,2!==r[s++])throw new Error('Could not find expected "int" for "s"');const f=r[s++];if(o-s!==f)throw new Error(`"s" specified length of "${f}", expected "${o-s}"`);if(i<f)throw new Error(`"s" specified length of "${f}", max of "${i}" is acceptable`);const h=s;if(s+=f,s!==o)throw new Error(`Expected to consume entire array, but "${o-s}" bytes remain`);const p=n-u,l=n-f,d=new Uint8Array(p+u+l+f);for(s=0;s<p;++s)d[s]=0;d.set(r.subarray(c+Math.max(-p,0),c+u),s),s=n;for(const t=s;s<t+l;++s)d[s]=0;return d.set(r.subarray(h+Math.max(-l,0),h+f),s),(0,qh.escape)((0,Wh.fromByteArray)(d))},Vh.joseToDer=function(t,e){t=Qh(t);const r=Yh(e),n=t.length;if(n!==2*r)throw new TypeError(`"${e}" signatures must be "${2*r}" bytes, saw "${n}"`);const i=Zh(t,0,r),o=Zh(t,r,t.length),s=r-i,a=r-o,u=2+s+1+1+a,c=u<Xh,f=new Uint8Array((c?2:3)+u);let h=0;return f[h++]=48,c?f[h++]=u:(f[h++]=1|Xh,f[h++]=255&u),f[h++]=2,f[h++]=s,i<0?(f[h++]=0,f.set(t.subarray(0,r),h),h+=r):(f.set(t.subarray(i,r),h),h+=r-i),f[h++]=2,f[h++]=a,o<0?(f[h++]=0,f.set(t.subarray(r),h)):f.set(t.subarray(r+o),h),f};var Jh={};Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.InvalidTokenError=Jh.MissingParametersError=void 0;class tp extends Error{constructor(t){super(),this.name="MissingParametersError",this.message=t||""}}Jh.MissingParametersError=tp;class ep extends Error{constructor(t){super(),this.name="InvalidTokenError",this.message=t||""}}Jh.InvalidTokenError=ep,Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.SECP256K1Client=void 0;const rp=Du,np=Ar,ip=$h,op=Vh,sp=Jh,ap=ir;ip.utils.hmacSha256Sync=(t,...e)=>{const r=rp.hmac.create(np.sha256,t);return e.forEach((t=>r.update(t))),r.digest()};class up{static derivePublicKey(t,e=!0){return 66===t.length&&(t=t.slice(0,64)),t.length<64&&(t=t.padStart(64,"0")),(0,ap.bytesToHex)(ip.getPublicKey(t,e))}static signHash(t,e,r="jose"){if(!t||!e)throw new sp.MissingParametersError("a signing input hash and private key are all required");const n=ip.signSync(t,e.slice(0,64),{der:!0,canonical:!1});if("der"===r)return(0,ap.bytesToHex)(n);if("jose"===r)return(0,op.derToJose)(n,"ES256");throw Error("Invalid signature format")}static loadSignature(t){return(0,op.joseToDer)(t,"ES256")}static verifyHash(t,e,r){if(!t||!e||!r)throw new sp.MissingParametersError("a signing input hash, der signature, and public key are all required");return ip.verify(e,t,r,{strict:!1})}}Kh.SECP256K1Client=up,up.algorithmName="ES256K",function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.cryptoClients=t.SECP256K1Client=void 0;const e=Kh;Object.defineProperty(t,"SECP256K1Client",{enumerable:!0,get:function(){return e.SECP256K1Client}});const r={ES256K:e.SECP256K1Client};t.cryptoClients=r}(jh);var cp={},fp=It&&It.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(t.value).then(s,a)}u((n=n.apply(t,e||[])).next())}))};Object.defineProperty(cp,"__esModule",{value:!0}),cp.hashSha256Async=cp.hashSha256=void 0;const hp=Ar;function pp(t){return(0,hp.sha256)(t)}cp.hashSha256=pp,cp.hashSha256Async=function(t){return fp(this,void 0,void 0,(function*(){try{if("undefined"!=typeof crypto&&void 0!==crypto.subtle){const e="string"==typeof t?(new TextEncoder).encode(t):t,r=yield crypto.subtle.digest("SHA-256",e);return new Uint8Array(r)}{const e=require("crypto");if(!e.createHash)throw new Error("`crypto` module does not contain `createHash`");return Promise.resolve(e.createHash("sha256").update(t).digest())}}catch(e){return console.log(e),console.log('Crypto lib not found. Neither the global `crypto.subtle` Web Crypto API, nor the or the Node.js `require("crypto").createHash` module is available. Falling back to JS implementation.'),Promise.resolve(pp(t))}}))};var lp=It&&It.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(t.value).then(s,a)}u((n=n.apply(t,e||[])).next())}))};Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.TokenSigner=Ih.createUnsecuredToken=void 0;const dp=kh,yp=jh,wp=Jh,gp=cp;function bp(t,e){const r=[],n=dp.encode(JSON.stringify(e));r.push(n);const i=dp.encode(JSON.stringify(t));r.push(i);return r.join(".")}Ih.createUnsecuredToken=function(t){return bp(t,{typ:"JWT",alg:"none"})+"."};Ih.TokenSigner=class{constructor(t,e){if(!t||!e)throw new wp.MissingParametersError("a signing algorithm and private key are required");if("string"!=typeof t)throw new Error("signing algorithm parameter must be a string");if(t=t.toUpperCase(),!yp.cryptoClients.hasOwnProperty(t))throw new Error("invalid signing algorithm");this.tokenType="JWT",this.cryptoClient=yp.cryptoClients[t],this.rawPrivateKey=e}header(t={}){const e={typ:this.tokenType,alg:this.cryptoClient.algorithmName};return Object.assign({},e,t)}sign(t,e=!1,r={}){const n=this.header(r),i=bp(t,n),o=(0,gp.hashSha256)(i);return this.createWithSignedHash(t,e,n,i,o)}signAsync(t,e=!1,r={}){return lp(this,void 0,void 0,(function*(){const n=this.header(r),i=bp(t,n),o=yield(0,gp.hashSha256Async)(i);return this.createWithSignedHash(t,e,n,i,o)}))}createWithSignedHash(t,e,r,n,i){const o=this.cryptoClient.signHash(i,this.rawPrivateKey);if(e){return{header:[dp.encode(JSON.stringify(r))],payload:JSON.stringify(t),signature:[o]}}return[n,o].join(".")}};var mp={};Object.defineProperty(mp,"__esModule",{value:!0}),mp.TokenVerifier=void 0;const Ep=kh,vp=jh,Sp=Jh,Tp=cp;mp.TokenVerifier=class{constructor(t,e){if(!t||!e)throw new Sp.MissingParametersError("a signing algorithm and public key are required");if("string"!=typeof t)throw"signing algorithm parameter must be a string";if(t=t.toUpperCase(),!vp.cryptoClients.hasOwnProperty(t))throw"invalid signing algorithm";this.tokenType="JWT",this.cryptoClient=vp.cryptoClients[t],this.rawPublicKey=e}verify(t){return"string"==typeof t?this.verifyCompact(t,!1):"object"==typeof t&&this.verifyExpanded(t,!1)}verifyAsync(t){return"string"==typeof t?this.verifyCompact(t,!0):"object"==typeof t?this.verifyExpanded(t,!0):Promise.resolve(!1)}verifyCompact(t,e){const r=t.split("."),n=r[0]+"."+r[1],i=t=>{const e=this.cryptoClient.loadSignature(r[2]);return this.cryptoClient.verifyHash(t,e,this.rawPublicKey)};if(e)return(0,Tp.hashSha256Async)(n).then((t=>i(t)));{const t=(0,Tp.hashSha256)(n);return i(t)}}verifyExpanded(t,e){const r=[t.header.join("."),Ep.encode(t.payload)].join(".");let n=!0;const i=e=>(t.signature.map((t=>{const r=this.cryptoClient.loadSignature(t);this.cryptoClient.verifyHash(e,r,this.rawPublicKey)||(n=!1)})),n);if(e)return(0,Tp.hashSha256Async)(r).then((t=>i(t)));{const t=(0,Tp.hashSha256)(r);return i(t)}}};var Op={};Object.defineProperty(Op,"__esModule",{value:!0}),Op.decodeToken=void 0;const Pp=kh;Op.decodeToken=function(t){if("string"==typeof t){const e=t.split(".");return{header:JSON.parse(Pp.decode(e[0])),payload:JSON.parse(Pp.decode(e[1])),signature:e[2]}}if("object"==typeof t){if("string"!=typeof t.payload)throw new Error("Expected token payload to be a base64 or json string");let e=t.payload;"{"!==t.payload[0]&&(e=Pp.decode(e));const r=[];return t.header.map((t=>{const e=JSON.parse(Pp.decode(t));r.push(e)})),{header:r,payload:JSON.parse(e),signature:t.signature}}},function(t){var e=It&&It.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=It&&It.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(Ih,t),r(mp,t),r(Op,t),r(Jh,t),r(jh,t)}(_h);var _p=(t=>(t.Mainnet="Mainnet",t.Testnet="Testnet",t.Signet="Signet",t))(_p||{}),Ip=c.optional(c.union([c.string(),c.number(),c.null()])),kp=c.object({jsonrpc:c.literal("2.0"),method:c.string(),params:c.optional(c.union([c.array(c.unknown()),c.looseObject({}),c.null()])),id:Ip}),Ap=c.object({jsonrpc:c.literal("2.0"),result:c.nonOptional(c.unknown()),id:Ip}),Bp=c.object({jsonrpc:c.literal("2.0"),error:c.nonOptional(c.unknown()),id:Ip});async function xp(t){const e=await(t?.())||window.XverseProviders?.BitcoinProvider||window.BitcoinProvider;if(!e)throw new Error("No Bitcoin wallet installed");return e}c.union([Ap,Bp]);var Up=(t=>(t.Ordinals="ordinals",t.Payment="payment",t.Stacks="stacks",t))(Up||{}),Cp=(t=>(t.p2pkh="p2pkh",t.p2sh="p2sh",t.p2wpkh="p2wpkh",t.p2wsh="p2wsh",t.p2tr="p2tr",t.stacks="stacks",t))(Cp||{}),Np=c.object({address:c.string(),publicKey:c.string(),purpose:c.enum(Up),addressType:c.enum(Cp)}),Rp=async t=>{const e=await xp(t.getProvider),{purposes:r}=t.payload;if(!r)throw new Error("Address purposes are required");try{const r=_h.createUnsecuredToken(t.payload),n=await e.connect(r);t.onFinish?.(n)}catch(e){console.error("[Connect] Error during address request",e),t.onCancel?.()}},Lp=c.nullish(c.object({message:c.optional(c.string())}));c.object({addresses:c.array(Np)}),c.object({...kp.entries,...c.object({method:c.literal("stx_getAddresses"),params:Lp,id:c.string()}).entries});var Hp=c.nullish(c.null());c.object({version:c.string(),methods:c.optional(c.array(c.string())),supports:c.array(c.string())}),c.object({...kp.entries,...c.object({method:c.literal("getInfo"),params:Hp,id:c.string()}).entries});var Dp=c.object({purposes:c.array(c.enum(Up)),message:c.optional(c.string())});c.object({addresses:c.array(Np)}),c.object({...kp.entries,...c.object({method:c.literal("getAddresses"),params:Dp,id:c.string()}).entries});var Mp=c.object({address:c.string(),message:c.string()});c.object({signature:c.string(),messageHash:c.string(),address:c.string()}),c.object({...kp.entries,...c.object({method:c.literal("signMessage"),params:Mp,id:c.string()}).entries});var Fp=Dp;c.array(Np),c.object({...kp.entries,...c.object({method:c.literal("getAccounts"),params:Fp,id:c.string()}).entries});c.nullish(c.null()),c.object({confirmed:c.string(),unconfirmed:c.string(),total:c.string()}),c.object({...kp.entries,...c.object({method:c.literal("getBalance"),id:c.string()}).entries});var jp=c.undefined();c.literal(!0),c.object({...kp.entries,...c.object({method:c.literal("wallet_requestPermissions"),params:jp,id:c.string()}).entries});var Kp=c.undefined();c.literal(!0),c.object({...kp.entries,...c.object({method:c.literal("wallet_renouncePermissions"),params:Kp,id:c.string()}).entries});var $p=c.nullish(c.null());c.object({balances:c.array(c.object({runeName:c.string(),amount:c.string(),divisibility:c.number(),symbol:c.string(),inscriptionId:c.nullish(c.string())}))}),c.object({...kp.entries,...c.object({method:c.literal("runes_getBalance"),params:$p,id:c.string()}).entries});var Vp=c.object({offset:c.number(),limit:c.number()});c.object({total:c.number(),limit:c.number(),offset:c.number(),inscriptions:c.array(c.object({inscriptionId:c.string(),inscriptionNumber:c.string(),address:c.string(),collectionName:c.optional(c.string()),postage:c.string(),contentLength:c.string(),contentType:c.string(),timestamp:c.number(),offset:c.number(),genesisTransaction:c.string(),output:c.string()}))}),c.object({...kp.entries,...c.object({method:c.literal("ord_getInscriptions"),params:Vp,id:c.string()}).entries});var Wp=async t=>{const{getProvider:e}=t,r=await xp(e);(t=>{const{contentType:e,content:r,payloadType:n,network:i,appFeeAddress:o,appFee:s}=t;if(!/^[a-z]+\/[a-z0-9\-\.\+]+(?=;.*|$)/.test(e))throw new Error("Invalid content type detected");if(!r||0===r.length)throw new Error("Empty content not allowed");if(!n||"BASE_64"!==n&&"PLAIN_TEXT"!==n)throw new Error("Empty invalid payloadType specified");if(r.length>("Mainnet"===i.type?4e5:6e4))throw new Error("Content too large");if((o?.length??0)>0&&(s??0)<=0)throw new Error("Invalid combination of app fee address and fee provided")})(t.payload);try{const e=_h.createUnsecuredToken(t.payload),n=await r.createInscription(e);t.onFinish?.(n)}catch(e){console.error("[Connect] Error during create inscription",e),t.onCancel?.()}},qp=async t=>{const e=await xp(t.getProvider),{address:r,message:n}=t.payload;if(!r)throw new Error("An address is required to sign a message");if(!n)throw new Error("A message to be signed is required");try{const r=_h.createUnsecuredToken(t.payload),n=await e.signMessage(r);t.onFinish?.(n)}catch(e){console.error("[Connect] Error during sign message request",e),t.onCancel?.()}},zp=async t=>{const e=await xp(t.getProvider),{recipients:r,senderAddress:n,network:i,message:o}=t.payload;if(!r||0===r.length)throw new Error("At least one recipient is required");if(r.some((t=>"string"!=typeof t.address||"bigint"!=typeof t.amountSats)))throw new Error("Incorrect recipient format");if(!n)throw new Error("The sender address is required");try{const s=r.map((t=>{const{address:e,amountSats:r}=t;return{address:e,amountSats:r.toString()}})),a={network:i,senderAddress:n,message:o,recipients:s},u=_h.createUnsecuredToken(a),c=await e.sendBtcTransaction(u);t.onFinish?.(c)}catch(e){console.error("[Connect] Error during send BTC transaction request",e),t.onCancel?.()}},Gp=async t=>{const e=await xp(t.getProvider),{psbtBase64:r,inputsToSign:n}=t.payload;if(!r)throw new Error("A value for psbtBase64 representing the tx hash is required");if(!n)throw new Error("An array specifying the inputs to be signed by the wallet is required");try{const r=_h.createUnsecuredToken(t.payload),n=await e.signTransaction(r);t.onFinish?.(n)}catch(e){console.error("[Connect] Error during sign transaction request",e),t.onCancel?.()}},Yp=function(t){return{type:"mainnet"===t?_p.Mainnet:_p.Testnet}},Xp=function(t){function e(e){var r=t.call(this,e)||this;return r.id="xverse",r.name="Xverse",r.homepage="https://www.xverse.app/",r}return St(e,t),e.prototype.connect=function(){return Pt(this,void 0,void 0,(function(){var t=this;return _t(this,(function(e){return[2,new Promise((function(e,r){return Pt(t,void 0,void 0,(function(){var t=this;return _t(this,(function(n){switch(n.label){case 0:return[4,Rp({payload:{purposes:[Up.Ordinals,Up.Payment],message:"Address for receiving Ordinals and payments",network:Yp(this.network)},onFinish:function(r){var n=r.addresses.find((function(t){return t.purpose===Up.Ordinals})),i=n.address,o=n.publicKey,s=r.addresses.find((function(t){return t.purpose===Up.Payment})).address;if(!Gf(t.network,i))throw new Error("Invalid Network. Please switch to bitcoin ".concat(t.network,"."));t.accounts=r.addresses.map((function(t){return t.address})),t.address=i,t.paymentAddress=s,t.publicKey=o,e()},onCancel:function(){r(new Error("User rejected connect"))}})];case 1:return n.sent(),[2]}}))}))}))]}))}))},e.prototype.switchNetwork=function(e){return Pt(this,void 0,void 0,(function(){return _t(this,(function(r){return t.prototype.switchNetwork.call(this,e),this.address?[2,this.connect()]:[2]}))}))},e.prototype.isReady=function(){return Pt(this,void 0,void 0,(function(){return _t(this,(function(t){return this.ready=!!window.XverseProviders,[2,this.ready]}))}))},e.prototype.signMessage=function(t){return Pt(this,void 0,void 0,(function(){var e=this;return _t(this,(function(r){return[2,new Promise((function(r,n){return Pt(e,void 0,void 0,(function(){return _t(this,(function(e){switch(e.label){case 0:return this.address&&this.paymentAddress?[4,qp({payload:{network:Yp(this.network),address:this.address,message:t},onFinish:function(t){r(t)},onCancel:function(){n(new Error("Sign Message canceled"))}})]:[2,n(new Error("Something went wrong while connecting"))];case 1:return e.sent(),[2]}}))}))}))]}))}))},e.prototype.sendToAddress=function(t,e){return Pt(this,void 0,void 0,(function(){var r=this;return _t(this,(function(n){return[2,new Promise((function(n,i){return Pt(r,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return this.address&&this.paymentAddress?[4,zp({payload:{network:Yp(this.network),recipients:[{address:t,amountSats:BigInt(e)}],senderAddress:this.paymentAddress},onFinish:function(t){n(t)},onCancel:function(){i(new Error("Send BTC Transaction canceled"))}})]:[2,i(new Error("Something went wrong while connecting"))];case 1:return r.sent(),[2]}}))}))}))]}))}))},e.prototype.inscribe=function(t,e){return Pt(this,void 0,void 0,(function(){var r=this;return _t(this,(function(n){return[2,new Promise((function(n,i){return Pt(r,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return[4,Wp({payload:{network:Yp(this.network),content:e,contentType:"text"===t?"text/plaincharset=utf-8":"image/jpeg",payloadType:"text"===t?"PLAIN_TEXT":"BASE_64"},onFinish:function(t){n(t.txId)},onCancel:function(){return i(new Error("Canceled"))}})];case 1:return r.sent(),[2]}}))}))}))]}))}))},e.prototype.signInput=function(t,e){return Pt(this,void 0,void 0,(function(){var r=this;return _t(this,(function(n){return[2,new Promise((function(n,i){return Pt(r,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return this.address?[4,Gp({payload:{network:Yp(this.network),message:"Sign Transaction",psbtBase64:e.toBase64(),broadcast:!1,inputsToSign:[{address:this.address,signingIndexes:[t]}]},onFinish:function(t){n(Rt.Psbt.fromBase64(t.psbtBase64))},onCancel:function(){return i(new Error("Canceled"))}})]:[2,i(new Error("Something went wrong while connecting"))];case 1:return r.sent(),[2]}}))}))}))]}))}))},e}(Xf),Qp={connectors:[],connector:void 0,setConnector:function(){},network:"mainnet",setNetwork:function(){}},Zp=t.createContext(Qp),Jp=function(){var e=t.useContext(Zp);if(void 0===e)throw new Error("useBitcoinWagmi must be used within a BitcoinWagmiConfig!");return e};exports.BitcoinWagmiProvider=function(e){var r=e.children,n=e.initialNetwork,i=void 0===n?"mainnet":n,o=e.queryClient,s=void 0===o?new Q:o,u=t.useState([]),c=u[0],f=u[1],h=t.useState(),p=h[0],l=h[1],d=t.useState(i),y=d[0],w=d[1];return t.useEffect((function(){f([new Xp(i),new sh(i),new nh(i),new th(i),new Jf(i)])}),[]),t.useEffect((function(){c.forEach((function(t){return t.network!==y&&t.switchNetwork(y)}))}),[c,y]),a.default.createElement(st,{client:s},a.default.createElement(Zp.Provider,{value:{connectors:c,connector:p,setConnector:l,network:y,setNetwork:w}},r))},exports.BitgetConnector=Jf,exports.LeatherConnector=th,exports.OkxConnector=nh,exports.SatsConnector=Xf,exports.UnisatConnector=sh,exports.XverseConnector=Xp,exports.createImageInscription=Kf,exports.estimateTxSize=Cf,exports.findUtxoForInscriptionId=$f,exports.findUtxosWithoutInscriptions=async function(t,e){const r=[];for(const n of e)if(n.confirmed){const t=await fetch(`${Eu.TESTNET_ORD_BASE_PATH}/output/${n.txid}:${n.vout}`,{headers:{Accept:"application/json"}});0===(await t.json()).inscriptions.length&&r.push(n)}else{0===(await Mf(t,n.txid)).length&&r.push(n)}return r},exports.getContentType=function(t){const e=t.tags[Lf];return Buffer.isBuffer(e)?e.toString("utf-8"):null},exports.getInscriptionFromId=async function(t,e){const{txid:r,index:n}=Eu.InscriptionId.fromString(e);return(await Mf(t,r))[n]},exports.getTapscript=Hf,exports.getTxInscriptions=Mf,exports.isValidBTCAddress=Gf,exports.parseInscriptionId=Ff,exports.parseInscriptions=Df,exports.truncateBtcAddress=t=>t.slice(0,6)+"..."+t.slice(-6),exports.truncateEthAddress=t=>{const e=t.match(Vf);return e?`${e[1]}…${e[2]}`:t},exports.useBitcoinAccount=function(){var t=Jp().connector,e=mt({queryKey:["account",t],queryFn:function(){return t?[t.getAccount(),t.getAccounts()]:[void 0,[]]},enabled:!!t,initialData:[void 0,[]]}),r=e.data,n=r[0],i=r[1],o=Ot(e,["data"]);return Tt(Tt({},o),{connector:t,address:n,addresses:i})},exports.useBitcoinConnect=function(){var t=this,e=Jp(),r=e.connectors,n=e.setConnector,i=Et({mutationKey:["connect"],mutationFn:function(e){return Pt(t,[e],void 0,(function(t){var e,r=t.connector;return _t(this,(function(t){switch(t.label){case 0:if(!r)throw new Error("Invalid connector");return(e="MetaMask"!==r.name)?[4,r.isReady()]:[3,2];case 1:e=!t.sent(),t.label=2;case 2:if(e)throw window.open(r.homepage,"_blank","noopener"),new Error("Wallet is not installed");return[2,r.connect()]}}))}))},onSuccess:function(t,e){var r=e.connector;n(r)}}),o=i.mutate,s=i.mutateAsync,a=Ot(i,["mutate","mutateAsync"]);return Tt(Tt({},a),{connectors:r,connect:o,connectAsync:s})},exports.useBitcoinDisconnect=function(){var t=this,e=Jp().setConnector,r=Et({mutationKey:["disconnect"],mutationFn:function(){return Pt(t,void 0,void 0,(function(){return _t(this,(function(t){return e(void 0),[2]}))}))}}),n=r.mutate,i=r.mutateAsync,o=Ot(r,["mutate","mutateAsync"]);return Tt(Tt({},o),{disconnect:n,disconnectAsync:i})},exports.useBitcoinWagmi=Jp;
//# sourceMappingURL=index.js.map
